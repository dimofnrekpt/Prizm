"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.prizmParseTag = void 0;
const element_1 = require("./element");
const prizmAttrRegular = /\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;
/**
 * Функция для разбора тега HTML.
 *
 * @param {string} tag - Тег HTML, который необходимо разобрать.
 * @returns {PrizmAstHtmlItem | PrizmHtmlComment} - Объект с информацией о теге или комментарии.
 * В случае тега, объект будет содержать следующие свойства:
 * - type: 'tag'
 * - name: имя тега
 * - voidElement: флаг, указывающий, является ли элемент пустым (void)
 * - attrs: объект, содержащий атрибуты тега и их значения
 * - children: массив дочерних элементов (пустой, заполняется в другой функции)
 * В случае комментария, объект будет содержать следующие свойства:
 * - type: 'comment'
 * - comment: текст комментария
 */
const prizmParseTag = (tag) => {
    // Создание объекта для хранения информации о теге
    const res = {
        type: 'tag',
        name: '',
        voidElement: false,
        attrs: {},
        children: [],
    };
    // Находим имя тега и его тип (открывающий, закрывающий или пустой)
    const tagMatch = tag.match(/<\/?([^\s]+?)[/\s>]/);
    if (tagMatch) {
        res.name = tagMatch[1];
        // Определяем, является ли тег пустым (void) элементом
        res.voidElement = element_1.prizmHtmlVoidElements.includes(tagMatch[1]) || tag.charAt(tag.length - 2) === '/';
        // Обработка комментариев
        if (res.name.startsWith('!--')) {
            const endIndex = tag.indexOf('-->');
            return {
                type: 'comment',
                comment: endIndex !== -1 ? tag.slice(4, endIndex) : '',
            };
        }
    }
    // Создание нового регулярного выражения на основе prizmAttrRegular
    const reg = new RegExp(prizmAttrRegular);
    let result = null;
    for (;;) {
        // Проходимся по всем найденным атрибутам в теге
        // eslint-disable-next-line @typescript-eslint/ban-ts-comment
        // @ts-ignore
        result = reg.exec(tag);
        // Если результат пустой, значит, все атрибуты разобраны
        if (result === null) {
            break;
        }
        // Если текущий результат - пустая строка, пропускаем его
        // eslint-disable-next-line @typescript-eslint/ban-ts-comment
        // @ts-ignore
        if (!result[0].trim()) {
            continue;
        }
        // Если найден атрибут без значения
        if (result[1]) {
            // eslint-disable-next-line @typescript-eslint/ban-ts-comment
            // @ts-ignore
            const attr = result[1].trim();
            let arr = [attr, ''];
            // Если атрибут содержит символ "=", разбиваем его на ключ и значение
            if (attr.indexOf('=') > -1) {
                arr = attr.split('=');
                // Сохраняем атрибут и его значение в объекте res
                res.attrs[arr[0]] = arr[1];
            }
            else {
                // Сохраняем атрибут и его значение в объекте res
                res.attrs[arr[0]] = null;
            }
            // Уменьшаем индекс для следующей итерации, чтобы не пропустить символы
            reg.lastIndex--;
        }
        else if (result[2]) {
            // Если найден атрибут с значением (в кавычках), сохраняем его в объекте res
            // eslint-disable-next-line @typescript-eslint/ban-ts-comment
            // @ts-ignore
            res.attrs[result[2]] = result[3].trim().substring(1, result[3].length - 1);
        }
    }
    // Возвращаем объект с информацией о теге
    return res;
};
exports.prizmParseTag = prizmParseTag;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyc2UtdGFnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9hc3Qvc3JjL2xpYi9odG1sL3BhcnNlLXRhZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFFQSx1Q0FBa0Q7QUFFbEQsTUFBTSxnQkFBZ0IsR0FBRyxvREFBb0QsQ0FBQztBQUU5RTs7Ozs7Ozs7Ozs7Ozs7R0FjRztBQUNJLE1BQU0sYUFBYSxHQUFHLENBQUMsR0FBVyxFQUF1QyxFQUFFO0lBQ2hGLGtEQUFrRDtJQUNsRCxNQUFNLEdBQUcsR0FBcUI7UUFDNUIsSUFBSSxFQUFFLEtBQUs7UUFDWCxJQUFJLEVBQUUsRUFBRTtRQUNSLFdBQVcsRUFBRSxLQUFLO1FBQ2xCLEtBQUssRUFBRSxFQUFFO1FBQ1QsUUFBUSxFQUFFLEVBQUU7S0FDYixDQUFDO0lBRUYsbUVBQW1FO0lBQ25FLE1BQU0sUUFBUSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMscUJBQXFCLENBQUMsQ0FBQztJQUNsRCxJQUFJLFFBQVEsRUFBRTtRQUNaLEdBQUcsQ0FBQyxJQUFJLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3ZCLHNEQUFzRDtRQUN0RCxHQUFHLENBQUMsV0FBVyxHQUFHLCtCQUFxQixDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDO1FBRXBHLHlCQUF5QjtRQUN6QixJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQzlCLE1BQU0sUUFBUSxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDcEMsT0FBTztnQkFDTCxJQUFJLEVBQUUsU0FBUztnQkFDZixPQUFPLEVBQUUsUUFBUSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRTthQUN2RCxDQUFDO1NBQ0g7S0FDRjtJQUVELG1FQUFtRTtJQUNuRSxNQUFNLEdBQUcsR0FBRyxJQUFJLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQ3pDLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQztJQUNsQixTQUFTO1FBQ1AsZ0RBQWdEO1FBQ2hELDZEQUE2RDtRQUM3RCxhQUFhO1FBQ2IsTUFBTSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFdkIsd0RBQXdEO1FBQ3hELElBQUksTUFBTSxLQUFLLElBQUksRUFBRTtZQUNuQixNQUFNO1NBQ1A7UUFFRCx5REFBeUQ7UUFDekQsNkRBQTZEO1FBQzdELGFBQWE7UUFDYixJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO1lBQ3JCLFNBQVM7U0FDVjtRQUVELG1DQUFtQztRQUNuQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUNiLDZEQUE2RDtZQUM3RCxhQUFhO1lBQ2IsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1lBQzlCLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBRXJCLHFFQUFxRTtZQUNyRSxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUU7Z0JBQzFCLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUN0QixpREFBaUQ7Z0JBQ2pELEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQzVCO2lCQUFNO2dCQUNMLGlEQUFpRDtnQkFDakQsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFXLENBQUM7YUFDakM7WUFFRCx1RUFBdUU7WUFDdkUsR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDO1NBQ2pCO2FBQU0sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUU7WUFDcEIsNEVBQTRFO1lBQzVFLDZEQUE2RDtZQUM3RCxhQUFhO1lBQ2IsR0FBRyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1NBQzVFO0tBQ0Y7SUFFRCx5Q0FBeUM7SUFDekMsT0FBTyxHQUFHLENBQUM7QUFDYixDQUFDLENBQUM7QUE3RVcsUUFBQSxhQUFhLGlCQTZFeEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcml6bUh0bWxDb21tZW50LCBQcml6bUFzdEh0bWxJdGVtIH0gZnJvbSAnLi90eXBlcyc7XG5cbmltcG9ydCB7IHByaXptSHRtbFZvaWRFbGVtZW50cyB9IGZyb20gJy4vZWxlbWVudCc7XG5cbmNvbnN0IHByaXptQXR0clJlZ3VsYXIgPSAvXFxzKFteJ1wiL1xccz48XSs/KVtcXHMvPl18KFteXFxzPV0rKT1cXHM/KFwiLio/XCJ8Jy4qPycpL2c7XG5cbi8qKlxuICog0KTRg9C90LrRhtC40Y8g0LTQu9GPINGA0LDQt9Cx0L7RgNCwINGC0LXQs9CwIEhUTUwuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHRhZyAtINCi0LXQsyBIVE1MLCDQutC+0YLQvtGA0YvQuSDQvdC10L7QsdGF0L7QtNC40LzQviDRgNCw0LfQvtCx0YDQsNGC0YwuXG4gKiBAcmV0dXJucyB7UHJpem1Bc3RIdG1sSXRlbSB8IFByaXptSHRtbENvbW1lbnR9IC0g0J7QsdGK0LXQutGCINGBINC40L3RhNC+0YDQvNCw0YbQuNC10Lkg0L4g0YLQtdCz0LUg0LjQu9C4INC60L7QvNC80LXQvdGC0LDRgNC40LguXG4gKiDQkiDRgdC70YPRh9Cw0LUg0YLQtdCz0LAsINC+0LHRitC10LrRgiDQsdGD0LTQtdGCINGB0L7QtNC10YDQttCw0YLRjCDRgdC70LXQtNGD0Y7RidC40LUg0YHQstC+0LnRgdGC0LLQsDpcbiAqIC0gdHlwZTogJ3RhZydcbiAqIC0gbmFtZTog0LjQvNGPINGC0LXQs9CwXG4gKiAtIHZvaWRFbGVtZW50OiDRhNC70LDQsywg0YPQutCw0LfRi9Cy0LDRjtGJ0LjQuSwg0Y/QstC70Y/QtdGC0YHRjyDQu9C4INGN0LvQtdC80LXQvdGCINC/0YPRgdGC0YvQvCAodm9pZClcbiAqIC0gYXR0cnM6INC+0LHRitC10LrRgiwg0YHQvtC00LXRgNC20LDRidC40Lkg0LDRgtGA0LjQsdGD0YLRiyDRgtC10LPQsCDQuCDQuNGFINC30L3QsNGH0LXQvdC40Y9cbiAqIC0gY2hpbGRyZW46INC80LDRgdGB0LjQsiDQtNC+0YfQtdGA0L3QuNGFINGN0LvQtdC80LXQvdGC0L7QsiAo0L/Rg9GB0YLQvtC5LCDQt9Cw0L/QvtC70L3Rj9C10YLRgdGPINCyINC00YDRg9Cz0L7QuSDRhNGD0L3QutGG0LjQuClcbiAqINCSINGB0LvRg9GH0LDQtSDQutC+0LzQvNC10L3RgtCw0YDQuNGPLCDQvtCx0YrQtdC60YIg0LHRg9C00LXRgiDRgdC+0LTQtdGA0LbQsNGC0Ywg0YHQu9C10LTRg9GO0YnQuNC1INGB0LLQvtC50YHRgtCy0LA6XG4gKiAtIHR5cGU6ICdjb21tZW50J1xuICogLSBjb21tZW50OiDRgtC10LrRgdGCINC60L7QvNC80LXQvdGC0LDRgNC40Y9cbiAqL1xuZXhwb3J0IGNvbnN0IHByaXptUGFyc2VUYWcgPSAodGFnOiBzdHJpbmcpOiBQcml6bUFzdEh0bWxJdGVtIHwgUHJpem1IdG1sQ29tbWVudCA9PiB7XG4gIC8vINCh0L7Qt9C00LDQvdC40LUg0L7QsdGK0LXQutGC0LAg0LTQu9GPINGF0YDQsNC90LXQvdC40Y8g0LjQvdGE0L7RgNC80LDRhtC40Lgg0L4g0YLQtdCz0LVcbiAgY29uc3QgcmVzOiBQcml6bUFzdEh0bWxJdGVtID0ge1xuICAgIHR5cGU6ICd0YWcnLFxuICAgIG5hbWU6ICcnLFxuICAgIHZvaWRFbGVtZW50OiBmYWxzZSxcbiAgICBhdHRyczoge30sXG4gICAgY2hpbGRyZW46IFtdLFxuICB9O1xuXG4gIC8vINCd0LDRhdC+0LTQuNC8INC40LzRjyDRgtC10LPQsCDQuCDQtdCz0L4g0YLQuNC/ICjQvtGC0LrRgNGL0LLQsNGO0YnQuNC5LCDQt9Cw0LrRgNGL0LLQsNGO0YnQuNC5INC40LvQuCDQv9GD0YHRgtC+0LkpXG4gIGNvbnN0IHRhZ01hdGNoID0gdGFnLm1hdGNoKC88XFwvPyhbXlxcc10rPylbL1xccz5dLyk7XG4gIGlmICh0YWdNYXRjaCkge1xuICAgIHJlcy5uYW1lID0gdGFnTWF0Y2hbMV07XG4gICAgLy8g0J7Qv9GA0LXQtNC10LvRj9C10LwsINGP0LLQu9GP0LXRgtGB0Y8g0LvQuCDRgtC10LMg0L/Rg9GB0YLRi9C8ICh2b2lkKSDRjdC70LXQvNC10L3RgtC+0LxcbiAgICByZXMudm9pZEVsZW1lbnQgPSBwcml6bUh0bWxWb2lkRWxlbWVudHMuaW5jbHVkZXModGFnTWF0Y2hbMV0pIHx8IHRhZy5jaGFyQXQodGFnLmxlbmd0aCAtIDIpID09PSAnLyc7XG5cbiAgICAvLyDQntCx0YDQsNCx0L7RgtC60LAg0LrQvtC80LzQtdC90YLQsNGA0LjQtdCyXG4gICAgaWYgKHJlcy5uYW1lLnN0YXJ0c1dpdGgoJyEtLScpKSB7XG4gICAgICBjb25zdCBlbmRJbmRleCA9IHRhZy5pbmRleE9mKCctLT4nKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6ICdjb21tZW50JyxcbiAgICAgICAgY29tbWVudDogZW5kSW5kZXggIT09IC0xID8gdGFnLnNsaWNlKDQsIGVuZEluZGV4KSA6ICcnLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvLyDQodC+0LfQtNCw0L3QuNC1INC90L7QstC+0LPQviDRgNC10LPRg9C70Y/RgNC90L7Qs9C+INCy0YvRgNCw0LbQtdC90LjRjyDQvdCwINC+0YHQvdC+0LLQtSBwcml6bUF0dHJSZWd1bGFyXG4gIGNvbnN0IHJlZyA9IG5ldyBSZWdFeHAocHJpem1BdHRyUmVndWxhcik7XG4gIGxldCByZXN1bHQgPSBudWxsO1xuICBmb3IgKDs7KSB7XG4gICAgLy8g0J/RgNC+0YXQvtC00LjQvNGB0Y8g0L/QviDQstGB0LXQvCDQvdCw0LnQtNC10L3QvdGL0Lwg0LDRgtGA0LjQsdGD0YLQsNC8INCyINGC0LXQs9C1XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxuICAgIC8vIEB0cy1pZ25vcmVcbiAgICByZXN1bHQgPSByZWcuZXhlYyh0YWcpO1xuXG4gICAgLy8g0JXRgdC70Lgg0YDQtdC30YPQu9GM0YLQsNGCINC/0YPRgdGC0L7QuSwg0LfQvdCw0YfQuNGCLCDQstGB0LUg0LDRgtGA0LjQsdGD0YLRiyDRgNCw0LfQvtCx0YDQsNC90YtcbiAgICBpZiAocmVzdWx0ID09PSBudWxsKSB7XG4gICAgICBicmVhaztcbiAgICB9XG5cbiAgICAvLyDQldGB0LvQuCDRgtC10LrRg9GJ0LjQuSDRgNC10LfRg9C70YzRgtCw0YIgLSDQv9GD0YHRgtCw0Y8g0YHRgtGA0L7QutCwLCDQv9GA0L7Qv9GD0YHQutCw0LXQvCDQtdCz0L5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGlmICghcmVzdWx0WzBdLnRyaW0oKSkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8g0JXRgdC70Lgg0L3QsNC50LTQtdC9INCw0YLRgNC40LHRg9GCINCx0LXQtyDQt9C90LDRh9C10L3QuNGPXG4gICAgaWYgKHJlc3VsdFsxXSkge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgY29uc3QgYXR0ciA9IHJlc3VsdFsxXS50cmltKCk7XG4gICAgICBsZXQgYXJyID0gW2F0dHIsICcnXTtcblxuICAgICAgLy8g0JXRgdC70Lgg0LDRgtGA0LjQsdGD0YIg0YHQvtC00LXRgNC20LjRgiDRgdC40LzQstC+0LsgXCI9XCIsINGA0LDQt9Cx0LjQstCw0LXQvCDQtdCz0L4g0L3QsCDQutC70Y7RhyDQuCDQt9C90LDRh9C10L3QuNC1XG4gICAgICBpZiAoYXR0ci5pbmRleE9mKCc9JykgPiAtMSkge1xuICAgICAgICBhcnIgPSBhdHRyLnNwbGl0KCc9Jyk7XG4gICAgICAgIC8vINCh0L7RhdGA0LDQvdGP0LXQvCDQsNGC0YDQuNCx0YPRgiDQuCDQtdCz0L4g0LfQvdCw0YfQtdC90LjQtSDQsiDQvtCx0YrQtdC60YLQtSByZXNcbiAgICAgICAgcmVzLmF0dHJzW2FyclswXV0gPSBhcnJbMV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyDQodC+0YXRgNCw0L3Rj9C10Lwg0LDRgtGA0LjQsdGD0YIg0Lgg0LXQs9C+INC30L3QsNGH0LXQvdC40LUg0LIg0L7QsdGK0LXQutGC0LUgcmVzXG4gICAgICAgIHJlcy5hdHRyc1thcnJbMF1dID0gbnVsbCBhcyBhbnk7XG4gICAgICB9XG5cbiAgICAgIC8vINCj0LzQtdC90YzRiNCw0LXQvCDQuNC90LTQtdC60YEg0LTQu9GPINGB0LvQtdC00YPRjtGJ0LXQuSDQuNGC0LXRgNCw0YbQuNC4LCDRh9GC0L7QsdGLINC90LUg0L/RgNC+0L/Rg9GB0YLQuNGC0Ywg0YHQuNC80LLQvtC70YtcbiAgICAgIHJlZy5sYXN0SW5kZXgtLTtcbiAgICB9IGVsc2UgaWYgKHJlc3VsdFsyXSkge1xuICAgICAgLy8g0JXRgdC70Lgg0L3QsNC50LTQtdC9INCw0YLRgNC40LHRg9GCINGBINC30L3QsNGH0LXQvdC40LXQvCAo0LIg0LrQsNCy0YvRh9C60LDRhSksINGB0L7RhdGA0LDQvdGP0LXQvCDQtdCz0L4g0LIg0L7QsdGK0LXQutGC0LUgcmVzXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICByZXMuYXR0cnNbcmVzdWx0WzJdXSA9IHJlc3VsdFszXS50cmltKCkuc3Vic3RyaW5nKDEsIHJlc3VsdFszXS5sZW5ndGggLSAxKTtcbiAgICB9XG4gIH1cblxuICAvLyDQktC+0LfQstGA0LDRidCw0LXQvCDQvtCx0YrQtdC60YIg0YEg0LjQvdGE0L7RgNC80LDRhtC40LXQuSDQviDRgtC10LPQtVxuICByZXR1cm4gcmVzO1xufTtcbiJdfQ==