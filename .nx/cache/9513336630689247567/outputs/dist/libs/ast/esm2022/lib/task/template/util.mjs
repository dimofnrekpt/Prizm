"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.prizmAstGetTypeOfActionBy = exports.prizmAstCreateActionBy = exports.prizmAstGetAttrName = exports.prizmAstConvertAttrNameToOutputInput = exports.prizmAstConvertAttrNameToInputOutput = exports.prizmAstHasAttribute = exports.prizmAstFindAttributeWithType = exports.prizmAstConvertAttrNameToOutputVar = exports.prizmAstConvertAttrNameToInputVar = exports.prizmAstConvertAttrNameByType = exports.prizmAstGetOutputBytAttrForTemplate = exports.prizmAstRemoveByAttrName = exports.prizmAstGetTypeOfAttribute = void 0;
const model_1 = require("./model");
function prizmAstGetTypeOfAttribute(attribute) {
    attribute = attribute.trim();
    if (attribute.startsWith('['))
        return model_1.PrizmAstTemplateAttributeType.inputVar;
    else if (attribute.startsWith('([') || attribute.startsWith('[('))
        return model_1.PrizmAstTemplateAttributeType.inputOutput;
    else if (attribute.startsWith('('))
        return model_1.PrizmAstTemplateAttributeType.output;
    return model_1.PrizmAstTemplateAttributeType.input;
}
exports.prizmAstGetTypeOfAttribute = prizmAstGetTypeOfAttribute;
// export function prizmAstGetOutputBytAttrForTemplate (
//   attrName: string,
//   attributes: Record<string, unknown>
// ) {
//   const name = prizmAstCheckAndGetAttrName(
//     attributes,
//     attrName
//   )
//   if (!name) return null;
//
//   const type = prizmAstGetTypeOfAttribute(
//     name
//   );
//
//   if (type === PrizmAstTemplateAttributeType.input) return name;
//   if (type === PrizmAstTemplateAttributeType.inputVar) return `{{${attrName}}`;
//   if (type === PrizmAstTemplateAttributeType.inputOutput) return `{{${attrName}}`;
//
//   return null;
// }
function prizmAstRemoveByAttrName(attributes, attrName) {
    attrName = prizmAstGetAttrName(attrName);
    const inputName = prizmAstConvertAttrNameToInputVar(attrName);
    const outputName = prizmAstConvertAttrNameToOutputVar(attrName);
    const inputOutputName = prizmAstConvertAttrNameToInputOutput(attrName);
    const outputInputName = prizmAstConvertAttrNameToOutputInput(attrName);
    delete attributes[attrName];
    delete attributes[inputName];
    delete attributes[outputName];
    delete attributes[inputOutputName];
    delete attributes[outputInputName];
    return attributes;
}
exports.prizmAstRemoveByAttrName = prizmAstRemoveByAttrName;
function prizmAstGetOutputBytAttrForTemplate(attributes, attrName) {
    attrName = prizmAstGetAttrName(attrName);
    const data = prizmAstFindAttributeWithType(attrName, attributes);
    const type = data?.type;
    const value = data?.value;
    switch (type) {
        case model_1.PrizmAstTemplateAttributeType.input:
            return value;
        case model_1.PrizmAstTemplateAttributeType.inputVar:
        case model_1.PrizmAstTemplateAttributeType.inputOutput:
            return `{{${value}}}`;
        default:
            return null;
    }
}
exports.prizmAstGetOutputBytAttrForTemplate = prizmAstGetOutputBytAttrForTemplate;
function prizmAstConvertAttrNameByType(attrName, type) {
    switch (type) {
        case model_1.PrizmAstTemplateAttributeType.inputOutput:
            return prizmAstConvertAttrNameToInputOutput(attrName);
        case model_1.PrizmAstTemplateAttributeType.output:
            return prizmAstConvertAttrNameToOutputVar(attrName);
        case model_1.PrizmAstTemplateAttributeType.inputVar:
            return prizmAstConvertAttrNameToInputVar(attrName);
        default:
        case model_1.PrizmAstTemplateAttributeType.input:
            return attrName;
    }
}
exports.prizmAstConvertAttrNameByType = prizmAstConvertAttrNameByType;
function prizmAstConvertAttrNameToInputVar(attrName) {
    return `[${attrName}]`;
}
exports.prizmAstConvertAttrNameToInputVar = prizmAstConvertAttrNameToInputVar;
function prizmAstConvertAttrNameToOutputVar(attrName) {
    return `(${attrName})`;
}
exports.prizmAstConvertAttrNameToOutputVar = prizmAstConvertAttrNameToOutputVar;
function prizmAstFindAttributeWithType(attrName, attributes, check = [
    model_1.PrizmAstTemplateAttributeType.inputOutput,
    model_1.PrizmAstTemplateAttributeType.input,
    model_1.PrizmAstTemplateAttributeType.output,
    model_1.PrizmAstTemplateAttributeType.inputVar,
]) {
    if (!attributes || !attrName)
        return null;
    const originAttrName = prizmAstGetAttrName(attrName);
    const searchAttribute = (name, type) => {
        if (name in attributes) {
            return {
                attrName: name,
                value: attributes[name],
                type: type,
            };
        }
        return null;
    };
    const searchInputOutputAttribute = (name) => {
        const attrNameInputOutput = prizmAstConvertAttrNameToInputOutput(name);
        const attrNameOutputInput = prizmAstConvertAttrNameToOutputInput(name);
        return (searchAttribute(attrNameInputOutput, model_1.PrizmAstTemplateAttributeType.inputOutput) ??
            searchAttribute(attrNameOutputInput, model_1.PrizmAstTemplateAttributeType.inputOutput));
    };
    if (check.includes(model_1.PrizmAstTemplateAttributeType.input)) {
        const result = searchAttribute(originAttrName, model_1.PrizmAstTemplateAttributeType.input);
        if (result)
            return result;
    }
    if (check.includes(model_1.PrizmAstTemplateAttributeType.inputVar)) {
        const result = searchAttribute(prizmAstConvertAttrNameToInputVar(originAttrName), 
        // originAttrName,
        model_1.PrizmAstTemplateAttributeType.inputVar);
        if (result)
            return result;
    }
    if (check.includes(model_1.PrizmAstTemplateAttributeType.output)) {
        const result = searchAttribute(prizmAstConvertAttrNameToOutputVar(originAttrName), 
        // originAttrName,
        model_1.PrizmAstTemplateAttributeType.output);
        if (result)
            return result;
    }
    return searchInputOutputAttribute(originAttrName);
}
exports.prizmAstFindAttributeWithType = prizmAstFindAttributeWithType;
// export function prizmAstFindAttributeWithType(
//   attrName: string,
//   attributes: Record<string, unknown>,
//   check: PrizmAstTemplateAttributeType[] = [
//     PrizmAstTemplateAttributeType.inputOutput,
//     PrizmAstTemplateAttributeType.input,
//     PrizmAstTemplateAttributeType.output,
//     PrizmAstTemplateAttributeType.inputVar,
//   ]
// ): {
//   attrName: string;
//   value: any;
//   type: PrizmAstTemplateAttributeType;
// } | null {
//   if (!attributes) return null;
//   const originAttrName = attrName;
//   if (
//     check.includes(PrizmAstTemplateAttributeType.input) ||
//     check.includes(PrizmAstTemplateAttributeType.inputOutput)
//   ) {
//     if (attrName in attributes)
//       return {
//         attrName: attrName,
//         value: attributes[attrName],
//         type: PrizmAstTemplateAttributeType.input,
//       };
//
//     attrName = prizmAstConvertAttrNameToInputOutput(originAttrName);
//     const attrNameOutputInput = prizmAstConvertAttrNameToOutputInput(originAttrName);
//     if (attrName in attributes || attrNameOutputInput in attributes)
//       return {
//         attrName: attrName ?? attrNameOutputInput,
//         value: attributes[attrName] ?? attributes[attrNameOutputInput],
//         type: PrizmAstTemplateAttributeType.inputOutput,
//       };
//   }
//
//   if (
//     check.includes(PrizmAstTemplateAttributeType.inputVar) ||
//     check.includes(PrizmAstTemplateAttributeType.inputOutput)
//   ) {
//     attrName = prizmAstConvertAttrNameToInputOutput(originAttrName);
//     const attrNameOutputInput = prizmAstConvertAttrNameToOutputInput(originAttrName);
//     if (attrName in attributes || attrNameOutputInput in attributes)
//       return {
//         attrName: attrName ?? attrNameOutputInput,
//         value: attributes[attrName] ?? attributes[attrNameOutputInput],
//         type: PrizmAstTemplateAttributeType.inputOutput,
//       };
//
//     attrName = prizmAstConvertAttrNameToInputVar(originAttrName);
//     if (attrName in attributes)
//       return {
//         attrName: attrName,
//         value: attributes[attrName],
//         type: PrizmAstTemplateAttributeType.inputVar,
//       };
//   }
//
//   if (
//     check.includes(PrizmAstTemplateAttributeType.output) ||
//     check.includes(PrizmAstTemplateAttributeType.inputOutput)
//   ) {
//     attrName = prizmAstConvertAttrNameToOutputVar(originAttrName);
//     if (attrName in attributes)
//       return {
//         attrName: attrName,
//         value: attributes[attrName],
//         type: PrizmAstTemplateAttributeType.output,
//       };
//   }
//
//   return null;
// }
function prizmAstHasAttribute(attrName, attributes, check = [
    model_1.PrizmAstTemplateAttributeType.inputOutput,
    model_1.PrizmAstTemplateAttributeType.input,
    model_1.PrizmAstTemplateAttributeType.output,
    model_1.PrizmAstTemplateAttributeType.inputVar,
]) {
    if (!attributes)
        return false;
    if ((check.includes(model_1.PrizmAstTemplateAttributeType.input) ||
        check.includes(model_1.PrizmAstTemplateAttributeType.inputOutput)) &&
        (attrName in attributes ||
            prizmAstConvertAttrNameToInputOutput(attrName) in attributes ||
            prizmAstConvertAttrNameToOutputInput(attrName) in attributes))
        return true;
    if ((check.includes(model_1.PrizmAstTemplateAttributeType.inputVar) ||
        check.includes(model_1.PrizmAstTemplateAttributeType.inputOutput)) &&
        (prizmAstConvertAttrNameToInputVar(attrName) in attributes ||
            prizmAstConvertAttrNameToInputOutput(attrName) in attributes ||
            prizmAstConvertAttrNameToOutputInput(attrName) in attributes))
        return true;
    if ((check.includes(model_1.PrizmAstTemplateAttributeType.output) ||
        check.includes(model_1.PrizmAstTemplateAttributeType.inputOutput)) &&
        (prizmAstConvertAttrNameToOutputVar(attrName) in attributes ||
            prizmAstConvertAttrNameToInputOutput(attrName) in attributes ||
            prizmAstConvertAttrNameToOutputInput(attrName) in attributes))
        return true;
    return false;
}
exports.prizmAstHasAttribute = prizmAstHasAttribute;
function prizmAstConvertAttrNameToInputOutput(attrName) {
    return `[(${attrName})]`;
}
exports.prizmAstConvertAttrNameToInputOutput = prizmAstConvertAttrNameToInputOutput;
function prizmAstConvertAttrNameToOutputInput(attrName) {
    return `([${attrName}])`;
}
exports.prizmAstConvertAttrNameToOutputInput = prizmAstConvertAttrNameToOutputInput;
function prizmAstGetAttrName(attrName) {
    return attrName.replace(/[[(\]) ]/g, '');
}
exports.prizmAstGetAttrName = prizmAstGetAttrName;
function prizmAstCreateActionBy(objClass, payload) {
    return new objClass().create(payload);
}
exports.prizmAstCreateActionBy = prizmAstCreateActionBy;
function prizmAstGetTypeOfActionBy(objClass) {
    return new objClass().type;
}
exports.prizmAstGetTypeOfActionBy = prizmAstGetTypeOfActionBy;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvYXN0L3NyYy9saWIvdGFzay90ZW1wbGF0ZS91dGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLG1DQUF3RDtBQUd4RCxTQUFnQiwwQkFBMEIsQ0FBQyxTQUFpQjtJQUMxRCxTQUFTLEdBQUcsU0FBUyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQzdCLElBQUksU0FBUyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUM7UUFBRSxPQUFPLHFDQUE2QixDQUFDLFFBQVEsQ0FBQztTQUN4RSxJQUFJLFNBQVMsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksU0FBUyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUM7UUFDL0QsT0FBTyxxQ0FBNkIsQ0FBQyxXQUFXLENBQUM7U0FDOUMsSUFBSSxTQUFTLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQztRQUFFLE9BQU8scUNBQTZCLENBQUMsTUFBTSxDQUFDO0lBRWhGLE9BQU8scUNBQTZCLENBQUMsS0FBSyxDQUFDO0FBQzdDLENBQUM7QUFSRCxnRUFRQztBQUVELHdEQUF3RDtBQUN4RCxzQkFBc0I7QUFDdEIsd0NBQXdDO0FBQ3hDLE1BQU07QUFDTiw4Q0FBOEM7QUFDOUMsa0JBQWtCO0FBQ2xCLGVBQWU7QUFDZixNQUFNO0FBQ04sNEJBQTRCO0FBQzVCLEVBQUU7QUFDRiw2Q0FBNkM7QUFDN0MsV0FBVztBQUNYLE9BQU87QUFDUCxFQUFFO0FBQ0YsbUVBQW1FO0FBQ25FLGtGQUFrRjtBQUNsRixxRkFBcUY7QUFDckYsRUFBRTtBQUNGLGlCQUFpQjtBQUNqQixJQUFJO0FBRUosU0FBZ0Isd0JBQXdCLENBQ3RDLFVBQW1DLEVBQ25DLFFBQWdCO0lBRWhCLFFBQVEsR0FBRyxtQkFBbUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUN6QyxNQUFNLFNBQVMsR0FBRyxpQ0FBaUMsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUM5RCxNQUFNLFVBQVUsR0FBRyxrQ0FBa0MsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUNoRSxNQUFNLGVBQWUsR0FBRyxvQ0FBb0MsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUN2RSxNQUFNLGVBQWUsR0FBRyxvQ0FBb0MsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUV2RSxPQUFPLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUM1QixPQUFPLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUM3QixPQUFPLFVBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUM5QixPQUFPLFVBQVUsQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUNuQyxPQUFPLFVBQVUsQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUVuQyxPQUFPLFVBQVUsQ0FBQztBQUNwQixDQUFDO0FBakJELDREQWlCQztBQUVELFNBQWdCLG1DQUFtQyxDQUNqRCxVQUFtQyxFQUNuQyxRQUFnQjtJQUVoQixRQUFRLEdBQUcsbUJBQW1CLENBQUMsUUFBUSxDQUFDLENBQUM7SUFFekMsTUFBTSxJQUFJLEdBQUcsNkJBQTZCLENBQUMsUUFBUSxFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBQ2pFLE1BQU0sSUFBSSxHQUFHLElBQUksRUFBRSxJQUFJLENBQUM7SUFDeEIsTUFBTSxLQUFLLEdBQUcsSUFBSSxFQUFFLEtBQUssQ0FBQztJQUUxQixRQUFRLElBQUksRUFBRTtRQUNaLEtBQUsscUNBQTZCLENBQUMsS0FBSztZQUN0QyxPQUFPLEtBQUssQ0FBQztRQUNmLEtBQUsscUNBQTZCLENBQUMsUUFBUSxDQUFDO1FBQzVDLEtBQUsscUNBQTZCLENBQUMsV0FBVztZQUM1QyxPQUFPLEtBQUssS0FBSyxJQUFJLENBQUM7UUFFeEI7WUFDRSxPQUFPLElBQUksQ0FBQztLQUNmO0FBQ0gsQ0FBQztBQXBCRCxrRkFvQkM7QUFFRCxTQUFnQiw2QkFBNkIsQ0FBQyxRQUFnQixFQUFFLElBQW1DO0lBQ2pHLFFBQVEsSUFBSSxFQUFFO1FBQ1osS0FBSyxxQ0FBNkIsQ0FBQyxXQUFXO1lBQzVDLE9BQU8sb0NBQW9DLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDeEQsS0FBSyxxQ0FBNkIsQ0FBQyxNQUFNO1lBQ3ZDLE9BQU8sa0NBQWtDLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDdEQsS0FBSyxxQ0FBNkIsQ0FBQyxRQUFRO1lBQ3pDLE9BQU8saUNBQWlDLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFckQsUUFBUTtRQUNSLEtBQUsscUNBQTZCLENBQUMsS0FBSztZQUN0QyxPQUFPLFFBQVEsQ0FBQztLQUNuQjtBQUNILENBQUM7QUFiRCxzRUFhQztBQUNELFNBQWdCLGlDQUFpQyxDQUFDLFFBQWdCO0lBQ2hFLE9BQU8sSUFBSSxRQUFRLEdBQUcsQ0FBQztBQUN6QixDQUFDO0FBRkQsOEVBRUM7QUFFRCxTQUFnQixrQ0FBa0MsQ0FBQyxRQUFnQjtJQUNqRSxPQUFPLElBQUksUUFBUSxHQUFHLENBQUM7QUFDekIsQ0FBQztBQUZELGdGQUVDO0FBRUQsU0FBZ0IsNkJBQTZCLENBQzNDLFFBQWdCLEVBQ2hCLFVBQW1DLEVBQ25DLFFBQXlDO0lBQ3ZDLHFDQUE2QixDQUFDLFdBQVc7SUFDekMscUNBQTZCLENBQUMsS0FBSztJQUNuQyxxQ0FBNkIsQ0FBQyxNQUFNO0lBQ3BDLHFDQUE2QixDQUFDLFFBQVE7Q0FDdkM7SUFNRCxJQUFJLENBQUMsVUFBVSxJQUFJLENBQUMsUUFBUTtRQUFFLE9BQU8sSUFBSSxDQUFDO0lBRTFDLE1BQU0sY0FBYyxHQUFHLG1CQUFtQixDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBRXJELE1BQU0sZUFBZSxHQUFHLENBQ3RCLElBQVksRUFDWixJQUFtQyxFQUMyQyxFQUFFO1FBQ2hGLElBQUksSUFBSSxJQUFJLFVBQVUsRUFBRTtZQUN0QixPQUFPO2dCQUNMLFFBQVEsRUFBRSxJQUFJO2dCQUNkLEtBQUssRUFBRSxVQUFVLENBQUMsSUFBSSxDQUFDO2dCQUN2QixJQUFJLEVBQUUsSUFBSTthQUNYLENBQUM7U0FDSDtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQyxDQUFDO0lBRUYsTUFBTSwwQkFBMEIsR0FBRyxDQUNqQyxJQUFZLEVBQ2tFLEVBQUU7UUFDaEYsTUFBTSxtQkFBbUIsR0FBRyxvQ0FBb0MsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN2RSxNQUFNLG1CQUFtQixHQUFHLG9DQUFvQyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3ZFLE9BQU8sQ0FDTCxlQUFlLENBQUMsbUJBQW1CLEVBQUUscUNBQTZCLENBQUMsV0FBVyxDQUFDO1lBQy9FLGVBQWUsQ0FBQyxtQkFBbUIsRUFBRSxxQ0FBNkIsQ0FBQyxXQUFXLENBQUMsQ0FDaEYsQ0FBQztJQUNKLENBQUMsQ0FBQztJQUVGLElBQUksS0FBSyxDQUFDLFFBQVEsQ0FBQyxxQ0FBNkIsQ0FBQyxLQUFLLENBQUMsRUFBRTtRQUN2RCxNQUFNLE1BQU0sR0FBRyxlQUFlLENBQUMsY0FBYyxFQUFFLHFDQUE2QixDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3BGLElBQUksTUFBTTtZQUFFLE9BQU8sTUFBTSxDQUFDO0tBQzNCO0lBRUQsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLHFDQUE2QixDQUFDLFFBQVEsQ0FBQyxFQUFFO1FBQzFELE1BQU0sTUFBTSxHQUFHLGVBQWUsQ0FDNUIsaUNBQWlDLENBQUMsY0FBYyxDQUFDO1FBQ2pELGtCQUFrQjtRQUNsQixxQ0FBNkIsQ0FBQyxRQUFRLENBQ3ZDLENBQUM7UUFDRixJQUFJLE1BQU07WUFBRSxPQUFPLE1BQU0sQ0FBQztLQUMzQjtJQUVELElBQUksS0FBSyxDQUFDLFFBQVEsQ0FBQyxxQ0FBNkIsQ0FBQyxNQUFNLENBQUMsRUFBRTtRQUN4RCxNQUFNLE1BQU0sR0FBRyxlQUFlLENBQzVCLGtDQUFrQyxDQUFDLGNBQWMsQ0FBQztRQUNsRCxrQkFBa0I7UUFDbEIscUNBQTZCLENBQUMsTUFBTSxDQUNyQyxDQUFDO1FBQ0YsSUFBSSxNQUFNO1lBQUUsT0FBTyxNQUFNLENBQUM7S0FDM0I7SUFFRCxPQUFPLDBCQUEwQixDQUFDLGNBQWMsQ0FBQyxDQUFDO0FBQ3BELENBQUM7QUFuRUQsc0VBbUVDO0FBRUQsaURBQWlEO0FBQ2pELHNCQUFzQjtBQUN0Qix5Q0FBeUM7QUFDekMsK0NBQStDO0FBQy9DLGlEQUFpRDtBQUNqRCwyQ0FBMkM7QUFDM0MsNENBQTRDO0FBQzVDLDhDQUE4QztBQUM5QyxNQUFNO0FBQ04sT0FBTztBQUNQLHNCQUFzQjtBQUN0QixnQkFBZ0I7QUFDaEIseUNBQXlDO0FBQ3pDLGFBQWE7QUFDYixrQ0FBa0M7QUFDbEMscUNBQXFDO0FBQ3JDLFNBQVM7QUFDVCw2REFBNkQ7QUFDN0QsZ0VBQWdFO0FBQ2hFLFFBQVE7QUFDUixrQ0FBa0M7QUFDbEMsaUJBQWlCO0FBQ2pCLDhCQUE4QjtBQUM5Qix1Q0FBdUM7QUFDdkMscURBQXFEO0FBQ3JELFdBQVc7QUFDWCxFQUFFO0FBQ0YsdUVBQXVFO0FBQ3ZFLHdGQUF3RjtBQUN4Rix1RUFBdUU7QUFDdkUsaUJBQWlCO0FBQ2pCLHFEQUFxRDtBQUNyRCwwRUFBMEU7QUFDMUUsMkRBQTJEO0FBQzNELFdBQVc7QUFDWCxNQUFNO0FBQ04sRUFBRTtBQUNGLFNBQVM7QUFDVCxnRUFBZ0U7QUFDaEUsZ0VBQWdFO0FBQ2hFLFFBQVE7QUFDUix1RUFBdUU7QUFDdkUsd0ZBQXdGO0FBQ3hGLHVFQUF1RTtBQUN2RSxpQkFBaUI7QUFDakIscURBQXFEO0FBQ3JELDBFQUEwRTtBQUMxRSwyREFBMkQ7QUFDM0QsV0FBVztBQUNYLEVBQUU7QUFDRixvRUFBb0U7QUFDcEUsa0NBQWtDO0FBQ2xDLGlCQUFpQjtBQUNqQiw4QkFBOEI7QUFDOUIsdUNBQXVDO0FBQ3ZDLHdEQUF3RDtBQUN4RCxXQUFXO0FBQ1gsTUFBTTtBQUNOLEVBQUU7QUFDRixTQUFTO0FBQ1QsOERBQThEO0FBQzlELGdFQUFnRTtBQUNoRSxRQUFRO0FBQ1IscUVBQXFFO0FBQ3JFLGtDQUFrQztBQUNsQyxpQkFBaUI7QUFDakIsOEJBQThCO0FBQzlCLHVDQUF1QztBQUN2QyxzREFBc0Q7QUFDdEQsV0FBVztBQUNYLE1BQU07QUFDTixFQUFFO0FBQ0YsaUJBQWlCO0FBQ2pCLElBQUk7QUFFSixTQUFnQixvQkFBb0IsQ0FDbEMsUUFBZ0IsRUFDaEIsVUFBbUMsRUFDbkMsUUFBeUM7SUFDdkMscUNBQTZCLENBQUMsV0FBVztJQUN6QyxxQ0FBNkIsQ0FBQyxLQUFLO0lBQ25DLHFDQUE2QixDQUFDLE1BQU07SUFDcEMscUNBQTZCLENBQUMsUUFBUTtDQUN2QztJQUVELElBQUksQ0FBQyxVQUFVO1FBQUUsT0FBTyxLQUFLLENBQUM7SUFFOUIsSUFDRSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMscUNBQTZCLENBQUMsS0FBSyxDQUFDO1FBQ2xELEtBQUssQ0FBQyxRQUFRLENBQUMscUNBQTZCLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDNUQsQ0FBQyxRQUFRLElBQUksVUFBVTtZQUNyQixvQ0FBb0MsQ0FBQyxRQUFRLENBQUMsSUFBSSxVQUFVO1lBQzVELG9DQUFvQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLFVBQVUsQ0FBQztRQUUvRCxPQUFPLElBQUksQ0FBQztJQUVkLElBQ0UsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLHFDQUE2QixDQUFDLFFBQVEsQ0FBQztRQUNyRCxLQUFLLENBQUMsUUFBUSxDQUFDLHFDQUE2QixDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzVELENBQUMsaUNBQWlDLENBQUMsUUFBUSxDQUFDLElBQUksVUFBVTtZQUN4RCxvQ0FBb0MsQ0FBQyxRQUFRLENBQUMsSUFBSSxVQUFVO1lBQzVELG9DQUFvQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLFVBQVUsQ0FBQztRQUUvRCxPQUFPLElBQUksQ0FBQztJQUVkLElBQ0UsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLHFDQUE2QixDQUFDLE1BQU0sQ0FBQztRQUNuRCxLQUFLLENBQUMsUUFBUSxDQUFDLHFDQUE2QixDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzVELENBQUMsa0NBQWtDLENBQUMsUUFBUSxDQUFDLElBQUksVUFBVTtZQUN6RCxvQ0FBb0MsQ0FBQyxRQUFRLENBQUMsSUFBSSxVQUFVO1lBQzVELG9DQUFvQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLFVBQVUsQ0FBQztRQUUvRCxPQUFPLElBQUksQ0FBQztJQUVkLE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQXhDRCxvREF3Q0M7QUFFRCxTQUFnQixvQ0FBb0MsQ0FBQyxRQUFnQjtJQUNuRSxPQUFPLEtBQUssUUFBUSxJQUFJLENBQUM7QUFDM0IsQ0FBQztBQUZELG9GQUVDO0FBRUQsU0FBZ0Isb0NBQW9DLENBQUMsUUFBZ0I7SUFDbkUsT0FBTyxLQUFLLFFBQVEsSUFBSSxDQUFDO0FBQzNCLENBQUM7QUFGRCxvRkFFQztBQUVELFNBQWdCLG1CQUFtQixDQUFDLFFBQWdCO0lBQ2xELE9BQU8sUUFBUSxDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUUsRUFBRSxDQUFDLENBQUM7QUFDM0MsQ0FBQztBQUZELGtEQUVDO0FBRUQsU0FBZ0Isc0JBQXNCLENBQ3BDLFFBQXFCLEVBQ3JCLE9BQXFCO0lBRXJCLE9BQU8sSUFBSSxRQUFRLEVBQUUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDeEMsQ0FBQztBQUxELHdEQUtDO0FBQ0QsU0FBZ0IseUJBQXlCLENBQ3ZDLFFBQXFCO0lBRXJCLE9BQU8sSUFBSSxRQUFRLEVBQUUsQ0FBQyxJQUFJLENBQUM7QUFDN0IsQ0FBQztBQUpELDhEQUlDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJpem1Bc3RUZW1wbGF0ZUF0dHJpYnV0ZVR5cGUgfSBmcm9tICcuL21vZGVsJztcbmltcG9ydCB7IFByaXptQXN0VGFza1RlbXBsYXRlIH0gZnJvbSAnLi9hYnN0cmFjdCc7XG5cbmV4cG9ydCBmdW5jdGlvbiBwcml6bUFzdEdldFR5cGVPZkF0dHJpYnV0ZShhdHRyaWJ1dGU6IHN0cmluZyk6IFByaXptQXN0VGVtcGxhdGVBdHRyaWJ1dGVUeXBlIHtcbiAgYXR0cmlidXRlID0gYXR0cmlidXRlLnRyaW0oKTtcbiAgaWYgKGF0dHJpYnV0ZS5zdGFydHNXaXRoKCdbJykpIHJldHVybiBQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZS5pbnB1dFZhcjtcbiAgZWxzZSBpZiAoYXR0cmlidXRlLnN0YXJ0c1dpdGgoJyhbJykgfHwgYXR0cmlidXRlLnN0YXJ0c1dpdGgoJ1soJykpXG4gICAgcmV0dXJuIFByaXptQXN0VGVtcGxhdGVBdHRyaWJ1dGVUeXBlLmlucHV0T3V0cHV0O1xuICBlbHNlIGlmIChhdHRyaWJ1dGUuc3RhcnRzV2l0aCgnKCcpKSByZXR1cm4gUHJpem1Bc3RUZW1wbGF0ZUF0dHJpYnV0ZVR5cGUub3V0cHV0O1xuXG4gIHJldHVybiBQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZS5pbnB1dDtcbn1cblxuLy8gZXhwb3J0IGZ1bmN0aW9uIHByaXptQXN0R2V0T3V0cHV0Qnl0QXR0ckZvclRlbXBsYXRlIChcbi8vICAgYXR0ck5hbWU6IHN0cmluZyxcbi8vICAgYXR0cmlidXRlczogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbi8vICkge1xuLy8gICBjb25zdCBuYW1lID0gcHJpem1Bc3RDaGVja0FuZEdldEF0dHJOYW1lKFxuLy8gICAgIGF0dHJpYnV0ZXMsXG4vLyAgICAgYXR0ck5hbWVcbi8vICAgKVxuLy8gICBpZiAoIW5hbWUpIHJldHVybiBudWxsO1xuLy9cbi8vICAgY29uc3QgdHlwZSA9IHByaXptQXN0R2V0VHlwZU9mQXR0cmlidXRlKFxuLy8gICAgIG5hbWVcbi8vICAgKTtcbi8vXG4vLyAgIGlmICh0eXBlID09PSBQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZS5pbnB1dCkgcmV0dXJuIG5hbWU7XG4vLyAgIGlmICh0eXBlID09PSBQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZS5pbnB1dFZhcikgcmV0dXJuIGB7eyR7YXR0ck5hbWV9fWA7XG4vLyAgIGlmICh0eXBlID09PSBQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZS5pbnB1dE91dHB1dCkgcmV0dXJuIGB7eyR7YXR0ck5hbWV9fWA7XG4vL1xuLy8gICByZXR1cm4gbnVsbDtcbi8vIH1cblxuZXhwb3J0IGZ1bmN0aW9uIHByaXptQXN0UmVtb3ZlQnlBdHRyTmFtZShcbiAgYXR0cmlidXRlczogUmVjb3JkPHN0cmluZywgdW5rbm93bj4sXG4gIGF0dHJOYW1lOiBzdHJpbmdcbik6IHR5cGVvZiBhdHRyaWJ1dGVzIHtcbiAgYXR0ck5hbWUgPSBwcml6bUFzdEdldEF0dHJOYW1lKGF0dHJOYW1lKTtcbiAgY29uc3QgaW5wdXROYW1lID0gcHJpem1Bc3RDb252ZXJ0QXR0ck5hbWVUb0lucHV0VmFyKGF0dHJOYW1lKTtcbiAgY29uc3Qgb3V0cHV0TmFtZSA9IHByaXptQXN0Q29udmVydEF0dHJOYW1lVG9PdXRwdXRWYXIoYXR0ck5hbWUpO1xuICBjb25zdCBpbnB1dE91dHB1dE5hbWUgPSBwcml6bUFzdENvbnZlcnRBdHRyTmFtZVRvSW5wdXRPdXRwdXQoYXR0ck5hbWUpO1xuICBjb25zdCBvdXRwdXRJbnB1dE5hbWUgPSBwcml6bUFzdENvbnZlcnRBdHRyTmFtZVRvT3V0cHV0SW5wdXQoYXR0ck5hbWUpO1xuXG4gIGRlbGV0ZSBhdHRyaWJ1dGVzW2F0dHJOYW1lXTtcbiAgZGVsZXRlIGF0dHJpYnV0ZXNbaW5wdXROYW1lXTtcbiAgZGVsZXRlIGF0dHJpYnV0ZXNbb3V0cHV0TmFtZV07XG4gIGRlbGV0ZSBhdHRyaWJ1dGVzW2lucHV0T3V0cHV0TmFtZV07XG4gIGRlbGV0ZSBhdHRyaWJ1dGVzW291dHB1dElucHV0TmFtZV07XG5cbiAgcmV0dXJuIGF0dHJpYnV0ZXM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwcml6bUFzdEdldE91dHB1dEJ5dEF0dHJGb3JUZW1wbGF0ZShcbiAgYXR0cmlidXRlczogUmVjb3JkPHN0cmluZywgdW5rbm93bj4sXG4gIGF0dHJOYW1lOiBzdHJpbmdcbik6IHN0cmluZyB8IG51bGwge1xuICBhdHRyTmFtZSA9IHByaXptQXN0R2V0QXR0ck5hbWUoYXR0ck5hbWUpO1xuXG4gIGNvbnN0IGRhdGEgPSBwcml6bUFzdEZpbmRBdHRyaWJ1dGVXaXRoVHlwZShhdHRyTmFtZSwgYXR0cmlidXRlcyk7XG4gIGNvbnN0IHR5cGUgPSBkYXRhPy50eXBlO1xuICBjb25zdCB2YWx1ZSA9IGRhdGE/LnZhbHVlO1xuXG4gIHN3aXRjaCAodHlwZSkge1xuICAgIGNhc2UgUHJpem1Bc3RUZW1wbGF0ZUF0dHJpYnV0ZVR5cGUuaW5wdXQ6XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgY2FzZSBQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZS5pbnB1dFZhcjpcbiAgICBjYXNlIFByaXptQXN0VGVtcGxhdGVBdHRyaWJ1dGVUeXBlLmlucHV0T3V0cHV0OlxuICAgICAgcmV0dXJuIGB7eyR7dmFsdWV9fX1gO1xuXG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwcml6bUFzdENvbnZlcnRBdHRyTmFtZUJ5VHlwZShhdHRyTmFtZTogc3RyaW5nLCB0eXBlOiBQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZSk6IHN0cmluZyB7XG4gIHN3aXRjaCAodHlwZSkge1xuICAgIGNhc2UgUHJpem1Bc3RUZW1wbGF0ZUF0dHJpYnV0ZVR5cGUuaW5wdXRPdXRwdXQ6XG4gICAgICByZXR1cm4gcHJpem1Bc3RDb252ZXJ0QXR0ck5hbWVUb0lucHV0T3V0cHV0KGF0dHJOYW1lKTtcbiAgICBjYXNlIFByaXptQXN0VGVtcGxhdGVBdHRyaWJ1dGVUeXBlLm91dHB1dDpcbiAgICAgIHJldHVybiBwcml6bUFzdENvbnZlcnRBdHRyTmFtZVRvT3V0cHV0VmFyKGF0dHJOYW1lKTtcbiAgICBjYXNlIFByaXptQXN0VGVtcGxhdGVBdHRyaWJ1dGVUeXBlLmlucHV0VmFyOlxuICAgICAgcmV0dXJuIHByaXptQXN0Q29udmVydEF0dHJOYW1lVG9JbnB1dFZhcihhdHRyTmFtZSk7XG5cbiAgICBkZWZhdWx0OlxuICAgIGNhc2UgUHJpem1Bc3RUZW1wbGF0ZUF0dHJpYnV0ZVR5cGUuaW5wdXQ6XG4gICAgICByZXR1cm4gYXR0ck5hbWU7XG4gIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBwcml6bUFzdENvbnZlcnRBdHRyTmFtZVRvSW5wdXRWYXIoYXR0ck5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBgWyR7YXR0ck5hbWV9XWA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwcml6bUFzdENvbnZlcnRBdHRyTmFtZVRvT3V0cHV0VmFyKGF0dHJOYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gYCgke2F0dHJOYW1lfSlgO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcHJpem1Bc3RGaW5kQXR0cmlidXRlV2l0aFR5cGUoXG4gIGF0dHJOYW1lOiBzdHJpbmcsXG4gIGF0dHJpYnV0ZXM6IFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICBjaGVjazogUHJpem1Bc3RUZW1wbGF0ZUF0dHJpYnV0ZVR5cGVbXSA9IFtcbiAgICBQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZS5pbnB1dE91dHB1dCxcbiAgICBQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZS5pbnB1dCxcbiAgICBQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZS5vdXRwdXQsXG4gICAgUHJpem1Bc3RUZW1wbGF0ZUF0dHJpYnV0ZVR5cGUuaW5wdXRWYXIsXG4gIF1cbik6IHtcbiAgYXR0ck5hbWU6IHN0cmluZztcbiAgdmFsdWU6IGFueTtcbiAgdHlwZTogUHJpem1Bc3RUZW1wbGF0ZUF0dHJpYnV0ZVR5cGU7XG59IHwgbnVsbCB7XG4gIGlmICghYXR0cmlidXRlcyB8fCAhYXR0ck5hbWUpIHJldHVybiBudWxsO1xuXG4gIGNvbnN0IG9yaWdpbkF0dHJOYW1lID0gcHJpem1Bc3RHZXRBdHRyTmFtZShhdHRyTmFtZSk7XG5cbiAgY29uc3Qgc2VhcmNoQXR0cmlidXRlID0gKFxuICAgIG5hbWU6IHN0cmluZyxcbiAgICB0eXBlOiBQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZVxuICApOiB7IGF0dHJOYW1lOiBzdHJpbmc7IHZhbHVlOiBhbnk7IHR5cGU6IFByaXptQXN0VGVtcGxhdGVBdHRyaWJ1dGVUeXBlIH0gfCBudWxsID0+IHtcbiAgICBpZiAobmFtZSBpbiBhdHRyaWJ1dGVzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhdHRyTmFtZTogbmFtZSxcbiAgICAgICAgdmFsdWU6IGF0dHJpYnV0ZXNbbmFtZV0sXG4gICAgICAgIHR5cGU6IHR5cGUsXG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfTtcblxuICBjb25zdCBzZWFyY2hJbnB1dE91dHB1dEF0dHJpYnV0ZSA9IChcbiAgICBuYW1lOiBzdHJpbmdcbiAgKTogeyBhdHRyTmFtZTogc3RyaW5nOyB2YWx1ZTogYW55OyB0eXBlOiBQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZSB9IHwgbnVsbCA9PiB7XG4gICAgY29uc3QgYXR0ck5hbWVJbnB1dE91dHB1dCA9IHByaXptQXN0Q29udmVydEF0dHJOYW1lVG9JbnB1dE91dHB1dChuYW1lKTtcbiAgICBjb25zdCBhdHRyTmFtZU91dHB1dElucHV0ID0gcHJpem1Bc3RDb252ZXJ0QXR0ck5hbWVUb091dHB1dElucHV0KG5hbWUpO1xuICAgIHJldHVybiAoXG4gICAgICBzZWFyY2hBdHRyaWJ1dGUoYXR0ck5hbWVJbnB1dE91dHB1dCwgUHJpem1Bc3RUZW1wbGF0ZUF0dHJpYnV0ZVR5cGUuaW5wdXRPdXRwdXQpID8/XG4gICAgICBzZWFyY2hBdHRyaWJ1dGUoYXR0ck5hbWVPdXRwdXRJbnB1dCwgUHJpem1Bc3RUZW1wbGF0ZUF0dHJpYnV0ZVR5cGUuaW5wdXRPdXRwdXQpXG4gICAgKTtcbiAgfTtcblxuICBpZiAoY2hlY2suaW5jbHVkZXMoUHJpem1Bc3RUZW1wbGF0ZUF0dHJpYnV0ZVR5cGUuaW5wdXQpKSB7XG4gICAgY29uc3QgcmVzdWx0ID0gc2VhcmNoQXR0cmlidXRlKG9yaWdpbkF0dHJOYW1lLCBQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZS5pbnB1dCk7XG4gICAgaWYgKHJlc3VsdCkgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGlmIChjaGVjay5pbmNsdWRlcyhQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZS5pbnB1dFZhcikpIHtcbiAgICBjb25zdCByZXN1bHQgPSBzZWFyY2hBdHRyaWJ1dGUoXG4gICAgICBwcml6bUFzdENvbnZlcnRBdHRyTmFtZVRvSW5wdXRWYXIob3JpZ2luQXR0ck5hbWUpLFxuICAgICAgLy8gb3JpZ2luQXR0ck5hbWUsXG4gICAgICBQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZS5pbnB1dFZhclxuICAgICk7XG4gICAgaWYgKHJlc3VsdCkgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGlmIChjaGVjay5pbmNsdWRlcyhQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZS5vdXRwdXQpKSB7XG4gICAgY29uc3QgcmVzdWx0ID0gc2VhcmNoQXR0cmlidXRlKFxuICAgICAgcHJpem1Bc3RDb252ZXJ0QXR0ck5hbWVUb091dHB1dFZhcihvcmlnaW5BdHRyTmFtZSksXG4gICAgICAvLyBvcmlnaW5BdHRyTmFtZSxcbiAgICAgIFByaXptQXN0VGVtcGxhdGVBdHRyaWJ1dGVUeXBlLm91dHB1dFxuICAgICk7XG4gICAgaWYgKHJlc3VsdCkgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIHJldHVybiBzZWFyY2hJbnB1dE91dHB1dEF0dHJpYnV0ZShvcmlnaW5BdHRyTmFtZSk7XG59XG5cbi8vIGV4cG9ydCBmdW5jdGlvbiBwcml6bUFzdEZpbmRBdHRyaWJ1dGVXaXRoVHlwZShcbi8vICAgYXR0ck5hbWU6IHN0cmluZyxcbi8vICAgYXR0cmlidXRlczogUmVjb3JkPHN0cmluZywgdW5rbm93bj4sXG4vLyAgIGNoZWNrOiBQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZVtdID0gW1xuLy8gICAgIFByaXptQXN0VGVtcGxhdGVBdHRyaWJ1dGVUeXBlLmlucHV0T3V0cHV0LFxuLy8gICAgIFByaXptQXN0VGVtcGxhdGVBdHRyaWJ1dGVUeXBlLmlucHV0LFxuLy8gICAgIFByaXptQXN0VGVtcGxhdGVBdHRyaWJ1dGVUeXBlLm91dHB1dCxcbi8vICAgICBQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZS5pbnB1dFZhcixcbi8vICAgXVxuLy8gKToge1xuLy8gICBhdHRyTmFtZTogc3RyaW5nO1xuLy8gICB2YWx1ZTogYW55O1xuLy8gICB0eXBlOiBQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZTtcbi8vIH0gfCBudWxsIHtcbi8vICAgaWYgKCFhdHRyaWJ1dGVzKSByZXR1cm4gbnVsbDtcbi8vICAgY29uc3Qgb3JpZ2luQXR0ck5hbWUgPSBhdHRyTmFtZTtcbi8vICAgaWYgKFxuLy8gICAgIGNoZWNrLmluY2x1ZGVzKFByaXptQXN0VGVtcGxhdGVBdHRyaWJ1dGVUeXBlLmlucHV0KSB8fFxuLy8gICAgIGNoZWNrLmluY2x1ZGVzKFByaXptQXN0VGVtcGxhdGVBdHRyaWJ1dGVUeXBlLmlucHV0T3V0cHV0KVxuLy8gICApIHtcbi8vICAgICBpZiAoYXR0ck5hbWUgaW4gYXR0cmlidXRlcylcbi8vICAgICAgIHJldHVybiB7XG4vLyAgICAgICAgIGF0dHJOYW1lOiBhdHRyTmFtZSxcbi8vICAgICAgICAgdmFsdWU6IGF0dHJpYnV0ZXNbYXR0ck5hbWVdLFxuLy8gICAgICAgICB0eXBlOiBQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZS5pbnB1dCxcbi8vICAgICAgIH07XG4vL1xuLy8gICAgIGF0dHJOYW1lID0gcHJpem1Bc3RDb252ZXJ0QXR0ck5hbWVUb0lucHV0T3V0cHV0KG9yaWdpbkF0dHJOYW1lKTtcbi8vICAgICBjb25zdCBhdHRyTmFtZU91dHB1dElucHV0ID0gcHJpem1Bc3RDb252ZXJ0QXR0ck5hbWVUb091dHB1dElucHV0KG9yaWdpbkF0dHJOYW1lKTtcbi8vICAgICBpZiAoYXR0ck5hbWUgaW4gYXR0cmlidXRlcyB8fCBhdHRyTmFtZU91dHB1dElucHV0IGluIGF0dHJpYnV0ZXMpXG4vLyAgICAgICByZXR1cm4ge1xuLy8gICAgICAgICBhdHRyTmFtZTogYXR0ck5hbWUgPz8gYXR0ck5hbWVPdXRwdXRJbnB1dCxcbi8vICAgICAgICAgdmFsdWU6IGF0dHJpYnV0ZXNbYXR0ck5hbWVdID8/IGF0dHJpYnV0ZXNbYXR0ck5hbWVPdXRwdXRJbnB1dF0sXG4vLyAgICAgICAgIHR5cGU6IFByaXptQXN0VGVtcGxhdGVBdHRyaWJ1dGVUeXBlLmlucHV0T3V0cHV0LFxuLy8gICAgICAgfTtcbi8vICAgfVxuLy9cbi8vICAgaWYgKFxuLy8gICAgIGNoZWNrLmluY2x1ZGVzKFByaXptQXN0VGVtcGxhdGVBdHRyaWJ1dGVUeXBlLmlucHV0VmFyKSB8fFxuLy8gICAgIGNoZWNrLmluY2x1ZGVzKFByaXptQXN0VGVtcGxhdGVBdHRyaWJ1dGVUeXBlLmlucHV0T3V0cHV0KVxuLy8gICApIHtcbi8vICAgICBhdHRyTmFtZSA9IHByaXptQXN0Q29udmVydEF0dHJOYW1lVG9JbnB1dE91dHB1dChvcmlnaW5BdHRyTmFtZSk7XG4vLyAgICAgY29uc3QgYXR0ck5hbWVPdXRwdXRJbnB1dCA9IHByaXptQXN0Q29udmVydEF0dHJOYW1lVG9PdXRwdXRJbnB1dChvcmlnaW5BdHRyTmFtZSk7XG4vLyAgICAgaWYgKGF0dHJOYW1lIGluIGF0dHJpYnV0ZXMgfHwgYXR0ck5hbWVPdXRwdXRJbnB1dCBpbiBhdHRyaWJ1dGVzKVxuLy8gICAgICAgcmV0dXJuIHtcbi8vICAgICAgICAgYXR0ck5hbWU6IGF0dHJOYW1lID8/IGF0dHJOYW1lT3V0cHV0SW5wdXQsXG4vLyAgICAgICAgIHZhbHVlOiBhdHRyaWJ1dGVzW2F0dHJOYW1lXSA/PyBhdHRyaWJ1dGVzW2F0dHJOYW1lT3V0cHV0SW5wdXRdLFxuLy8gICAgICAgICB0eXBlOiBQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZS5pbnB1dE91dHB1dCxcbi8vICAgICAgIH07XG4vL1xuLy8gICAgIGF0dHJOYW1lID0gcHJpem1Bc3RDb252ZXJ0QXR0ck5hbWVUb0lucHV0VmFyKG9yaWdpbkF0dHJOYW1lKTtcbi8vICAgICBpZiAoYXR0ck5hbWUgaW4gYXR0cmlidXRlcylcbi8vICAgICAgIHJldHVybiB7XG4vLyAgICAgICAgIGF0dHJOYW1lOiBhdHRyTmFtZSxcbi8vICAgICAgICAgdmFsdWU6IGF0dHJpYnV0ZXNbYXR0ck5hbWVdLFxuLy8gICAgICAgICB0eXBlOiBQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZS5pbnB1dFZhcixcbi8vICAgICAgIH07XG4vLyAgIH1cbi8vXG4vLyAgIGlmIChcbi8vICAgICBjaGVjay5pbmNsdWRlcyhQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZS5vdXRwdXQpIHx8XG4vLyAgICAgY2hlY2suaW5jbHVkZXMoUHJpem1Bc3RUZW1wbGF0ZUF0dHJpYnV0ZVR5cGUuaW5wdXRPdXRwdXQpXG4vLyAgICkge1xuLy8gICAgIGF0dHJOYW1lID0gcHJpem1Bc3RDb252ZXJ0QXR0ck5hbWVUb091dHB1dFZhcihvcmlnaW5BdHRyTmFtZSk7XG4vLyAgICAgaWYgKGF0dHJOYW1lIGluIGF0dHJpYnV0ZXMpXG4vLyAgICAgICByZXR1cm4ge1xuLy8gICAgICAgICBhdHRyTmFtZTogYXR0ck5hbWUsXG4vLyAgICAgICAgIHZhbHVlOiBhdHRyaWJ1dGVzW2F0dHJOYW1lXSxcbi8vICAgICAgICAgdHlwZTogUHJpem1Bc3RUZW1wbGF0ZUF0dHJpYnV0ZVR5cGUub3V0cHV0LFxuLy8gICAgICAgfTtcbi8vICAgfVxuLy9cbi8vICAgcmV0dXJuIG51bGw7XG4vLyB9XG5cbmV4cG9ydCBmdW5jdGlvbiBwcml6bUFzdEhhc0F0dHJpYnV0ZShcbiAgYXR0ck5hbWU6IHN0cmluZyxcbiAgYXR0cmlidXRlczogUmVjb3JkPHN0cmluZywgdW5rbm93bj4sXG4gIGNoZWNrOiBQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZVtdID0gW1xuICAgIFByaXptQXN0VGVtcGxhdGVBdHRyaWJ1dGVUeXBlLmlucHV0T3V0cHV0LFxuICAgIFByaXptQXN0VGVtcGxhdGVBdHRyaWJ1dGVUeXBlLmlucHV0LFxuICAgIFByaXptQXN0VGVtcGxhdGVBdHRyaWJ1dGVUeXBlLm91dHB1dCxcbiAgICBQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZS5pbnB1dFZhcixcbiAgXVxuKTogYm9vbGVhbiB7XG4gIGlmICghYXR0cmlidXRlcykgcmV0dXJuIGZhbHNlO1xuXG4gIGlmIChcbiAgICAoY2hlY2suaW5jbHVkZXMoUHJpem1Bc3RUZW1wbGF0ZUF0dHJpYnV0ZVR5cGUuaW5wdXQpIHx8XG4gICAgICBjaGVjay5pbmNsdWRlcyhQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZS5pbnB1dE91dHB1dCkpICYmXG4gICAgKGF0dHJOYW1lIGluIGF0dHJpYnV0ZXMgfHxcbiAgICAgIHByaXptQXN0Q29udmVydEF0dHJOYW1lVG9JbnB1dE91dHB1dChhdHRyTmFtZSkgaW4gYXR0cmlidXRlcyB8fFxuICAgICAgcHJpem1Bc3RDb252ZXJ0QXR0ck5hbWVUb091dHB1dElucHV0KGF0dHJOYW1lKSBpbiBhdHRyaWJ1dGVzKVxuICApXG4gICAgcmV0dXJuIHRydWU7XG5cbiAgaWYgKFxuICAgIChjaGVjay5pbmNsdWRlcyhQcml6bUFzdFRlbXBsYXRlQXR0cmlidXRlVHlwZS5pbnB1dFZhcikgfHxcbiAgICAgIGNoZWNrLmluY2x1ZGVzKFByaXptQXN0VGVtcGxhdGVBdHRyaWJ1dGVUeXBlLmlucHV0T3V0cHV0KSkgJiZcbiAgICAocHJpem1Bc3RDb252ZXJ0QXR0ck5hbWVUb0lucHV0VmFyKGF0dHJOYW1lKSBpbiBhdHRyaWJ1dGVzIHx8XG4gICAgICBwcml6bUFzdENvbnZlcnRBdHRyTmFtZVRvSW5wdXRPdXRwdXQoYXR0ck5hbWUpIGluIGF0dHJpYnV0ZXMgfHxcbiAgICAgIHByaXptQXN0Q29udmVydEF0dHJOYW1lVG9PdXRwdXRJbnB1dChhdHRyTmFtZSkgaW4gYXR0cmlidXRlcylcbiAgKVxuICAgIHJldHVybiB0cnVlO1xuXG4gIGlmIChcbiAgICAoY2hlY2suaW5jbHVkZXMoUHJpem1Bc3RUZW1wbGF0ZUF0dHJpYnV0ZVR5cGUub3V0cHV0KSB8fFxuICAgICAgY2hlY2suaW5jbHVkZXMoUHJpem1Bc3RUZW1wbGF0ZUF0dHJpYnV0ZVR5cGUuaW5wdXRPdXRwdXQpKSAmJlxuICAgIChwcml6bUFzdENvbnZlcnRBdHRyTmFtZVRvT3V0cHV0VmFyKGF0dHJOYW1lKSBpbiBhdHRyaWJ1dGVzIHx8XG4gICAgICBwcml6bUFzdENvbnZlcnRBdHRyTmFtZVRvSW5wdXRPdXRwdXQoYXR0ck5hbWUpIGluIGF0dHJpYnV0ZXMgfHxcbiAgICAgIHByaXptQXN0Q29udmVydEF0dHJOYW1lVG9PdXRwdXRJbnB1dChhdHRyTmFtZSkgaW4gYXR0cmlidXRlcylcbiAgKVxuICAgIHJldHVybiB0cnVlO1xuXG4gIHJldHVybiBmYWxzZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHByaXptQXN0Q29udmVydEF0dHJOYW1lVG9JbnB1dE91dHB1dChhdHRyTmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIGBbKCR7YXR0ck5hbWV9KV1gO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcHJpem1Bc3RDb252ZXJ0QXR0ck5hbWVUb091dHB1dElucHV0KGF0dHJOYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gYChbJHthdHRyTmFtZX1dKWA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwcml6bUFzdEdldEF0dHJOYW1lKGF0dHJOYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gYXR0ck5hbWUucmVwbGFjZSgvW1soXFxdKSBdL2csICcnKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHByaXptQXN0Q3JlYXRlQWN0aW9uQnk8VCBleHRlbmRzIFByaXptQXN0VGFza1RlbXBsYXRlPGFueT4+KFxuICBvYmpDbGFzczogbmV3ICgpID0+IFQsXG4gIHBheWxvYWQ6IFRbJ3BheWxvYWQnXVxuKTogUmV0dXJuVHlwZTxUWydjcmVhdGUnXT4ge1xuICByZXR1cm4gbmV3IG9iakNsYXNzKCkuY3JlYXRlKHBheWxvYWQpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHByaXptQXN0R2V0VHlwZU9mQWN0aW9uQnk8VCBleHRlbmRzIFByaXptQXN0VGFza1RlbXBsYXRlPGFueT4+KFxuICBvYmpDbGFzczogbmV3ICgpID0+IFRcbik6IFJldHVyblR5cGU8VFsndHlwZSddPiB7XG4gIHJldHVybiBuZXcgb2JqQ2xhc3MoKS50eXBlO1xufVxuIl19