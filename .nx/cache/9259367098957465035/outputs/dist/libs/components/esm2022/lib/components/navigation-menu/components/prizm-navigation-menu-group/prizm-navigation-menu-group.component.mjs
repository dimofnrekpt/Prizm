import { ChangeDetectionStrategy, ChangeDetectorRef, Component, EventEmitter, Input, Output, TemplateRef, ViewChild, } from '@angular/core';
import { PrizmDestroyService } from '@prizm-ui/helpers';
import { BehaviorSubject, merge } from 'rxjs';
import { debounceTime, map, takeUntil, withLatestFrom } from 'rxjs/operators';
import { PrizmNavigationMenuService } from '../../services/prizm-navigation-menu.service';
import { PrizmNavigationMenuGroupService } from '../../services/prizm-navigation-menu-group.service';
import { PrizmNavigationMenuToolbarService } from '../../services/prizm-navigation-menu-toolbar.service';
import { PrizmNavigationMenuItemsComponent } from '../prizm-navigation-menu-items/prizm-navigation-menu-items.component';
import { PrizmAbstractTestId } from '@prizm-ui/core';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { PolymorphOutletDirective } from '../../../../directives';
import { PrizmAccordionComponent, PrizmAccordionContentDirective, PrizmAccordionItemComponent, } from '../../../accordion';
import { PrizmNavigationMenuToolbarComponent } from '../prizm-navigation-menu-toolbar/prizm-navigation-menu-toolbar.component';
import * as i0 from "@angular/core";
import * as i1 from "@prizm-ui/helpers";
import * as i2 from "../../services/prizm-navigation-menu-group.service";
import * as i3 from "../../services/prizm-navigation-menu.service";
import * as i4 from "@angular/common";
export class PrizmNavigationMenuGroupComponent extends PrizmAbstractTestId {
    set items(items) {
        this.items$$.next(items);
    }
    set toolbarConfig(toolbarConfig) {
        this.groupService.setToolbarConfig(toolbarConfig);
    }
    set emptySearchResultMessageConfig(config) {
        this.groupService.setEmptySearchResultMessageConfig(config);
    }
    set emptyDataMessageConfig(config) {
        this.groupService.setEmptyDataMessageConfig(config);
    }
    set searchConfig(config) {
        this.groupService.setSearchConfig(config);
    }
    constructor(cdr, destroy$, groupService, menuService) {
        super();
        this.cdr = cdr;
        this.destroy$ = destroy$;
        this.groupService = groupService;
        this.menuService = menuService;
        this.itemExpandedChanged = new EventEmitter();
        this.groupExpandedChanged = new EventEmitter();
        this.testId_ = 'ui_navigation_menu_group';
        this.groupItems$ = this.groupService.groupItems$;
        this.expandedItemsMap$ = this.groupService.expandedItemsMap$;
        this.toolbarConfig$ = this.groupService.toolbarConfig$;
        this.searchConfig$ = this.groupService.searchConfig$;
        this.emptyMessageConfig$ = this.groupService.searchEnabled$.pipe(withLatestFrom(this.groupService.emptySearchResultMessageConfig$, this.groupService.emptyDataMessageConfig$), map(([searchEnabled, emptySearchResultMessageConfig, emptyDataMessageConfig]) => {
            return searchEnabled ? emptySearchResultMessageConfig : emptyDataMessageConfig;
        }));
        this.activeItem$ = this.menuService.activeItem$;
        this.mode$ = this.groupService.viewMode$;
        this.items$$ = new BehaviorSubject([]);
    }
    ngOnInit() {
        this.registerItems();
        this.setGroupIsExpanded();
        this.ensureViewUpdatesCorrectly();
    }
    handleActiveItemChange(item) {
        this.menuService.handleActiveItemChange(item);
    }
    handleItemExpandedChanged(event) {
        if (this.groupService.viewMode === 'rubricator')
            return;
        if (this.groupService.viewMode === 'folder') {
            return this.groupService.handleFolderExpanded(event.item);
        }
        this.menuService.handleExpandedChanged(event);
        this.itemExpandedChanged.emit({
            item: this.menuService.getUserItem(event.item),
            isExpanded: event.isExpanded,
        });
    }
    handleGroupExpandedChanged(isExpanded) {
        const event = {
            groupId: this.groupId,
            isExpanded,
        };
        this.menuService.handleGroupExpandedChanged(event);
        this.groupExpandedChanged.emit(event);
    }
    handleGoToParentItem(item) {
        this.groupService.goToParentFolder(item);
    }
    handleGoToRootItem(_item) {
        this.groupService.goToRootFolder();
    }
    registerItems() {
        const groupId = this.groupId || this.title;
        this.groupService.setGroupId(groupId);
        this.items$$.pipe(takeUntil(this.destroy$)).subscribe(items => {
            this.menuService.registerGroupItems(groupId, items);
        });
    }
    setGroupIsExpanded() {
        this.groupIsExpanded = this.menuService.getGroupIsExpanded(this.groupId);
    }
    ensureViewUpdatesCorrectly() {
        merge(this.activeItem$, this.groupService.closeAll$, this.groupService.viewMode$, this.menuService.itemExpandedChangedEvent$)
            .pipe(debounceTime(0), takeUntil(this.destroy$))
            .subscribe(() => {
            this.cdr.markForCheck();
            this.menuItemsComponent?.triggerCdr();
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.8", ngImport: i0, type: PrizmNavigationMenuGroupComponent, deps: [{ token: i0.ChangeDetectorRef }, { token: i1.PrizmDestroyService }, { token: i2.PrizmNavigationMenuGroupService }, { token: i3.PrizmNavigationMenuService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.8", type: PrizmNavigationMenuGroupComponent, isStandalone: true, selector: "prizm-navigation-menu-group", inputs: { groupId: "groupId", title: "title", hideGroupAppearance: "hideGroupAppearance", icon: "icon", toolbarExtraTemplate: "toolbarExtraTemplate", itemExtraTemplate: "itemExtraTemplate", items: "items", toolbarConfig: "toolbarConfig", emptySearchResultMessageConfig: "emptySearchResultMessageConfig", emptyDataMessageConfig: "emptyDataMessageConfig", searchConfig: "searchConfig", childrenHandler: "childrenHandler" }, outputs: { itemExpandedChanged: "itemExpandedChanged", groupExpandedChanged: "groupExpandedChanged" }, providers: [PrizmNavigationMenuToolbarService, PrizmNavigationMenuGroupService], viewQueries: [{ propertyName: "menuItemsComponent", first: true, predicate: PrizmNavigationMenuItemsComponent, descendants: true }], usesInheritance: true, ngImport: i0, template: "<div class=\"prizm-navigation-menu-group\" [class.prizm-navigation-menu-group_expanded]=\"groupIsExpanded\">\n  <prizm-accordion *ngIf=\"!hideGroupAppearance; else noGroupAppearanceTemplate\">\n    <prizm-accordion-item\n      [icon]=\"$any(icon)\"\n      [title]=\"$any(title)\"\n      [isExpanded]=\"groupIsExpanded\"\n      (isExpandedChange)=\"handleGroupExpandedChanged($event)\"\n    >\n      <ng-template prizmAccordionContent>\n        <ng-container [ngTemplateOutlet]=\"itemsTemplate\"></ng-container>\n      </ng-template>\n    </prizm-accordion-item>\n  </prizm-accordion>\n\n  <ng-template #noGroupAppearanceTemplate>\n    <ng-container [ngTemplateOutlet]=\"itemsTemplate\"></ng-container>\n  </ng-template>\n</div>\n\n<ng-template #itemsTemplate>\n  <prizm-navigation-menu-toolbar\n    [searchConfig]=\"$any(searchConfig$ | async)\"\n    [toolbarConfig]=\"$any(toolbarConfig$ | async)\"\n    [toolbarExtraTemplate]=\"toolbarExtraTemplate\"\n    [hideGroupAppearance]=\"$any(hideGroupAppearance)\"\n  ></prizm-navigation-menu-toolbar>\n  <ng-container *ngIf=\"groupItems$ | async as groupItems\">\n    <prizm-navigation-menu-items\n      [items]=\"groupItems\"\n      [itemExtraTemplate]=\"$any(itemExtraTemplate)\"\n      [childrenHandler]=\"childrenHandler\"\n      [expandedItemsMap]=\"$any(expandedItemsMap$ | async)\"\n      [activeItem]=\"$any(activeItem$ | async)\"\n      [mode]=\"$any(mode$ | async)\"\n      (activeItemChanged)=\"handleActiveItemChange($event)\"\n      (itemExpandedChanged)=\"handleItemExpandedChanged($event)\"\n      (goToParentItem)=\"handleGoToParentItem($event)\"\n      (goToRootItem)=\"handleGoToRootItem($event)\"\n    ></prizm-navigation-menu-items>\n\n    <ng-container *ngIf=\"!groupItems.length\">\n      <div\n        class=\"prizm-navigation-menu-group__no-items-content\"\n        *ngIf=\"emptyMessageConfig$ | async as emptyMessageConfig\"\n      >\n        <div class=\"empty-message\">\n          <span class=\"empty-message__main\">{{ emptyMessageConfig.title }}</span>\n          <span class=\"empty-message__sub\">{{ emptyMessageConfig.subtitle }}</span>\n        </div>\n      </div>\n    </ng-container>\n  </ng-container>\n</ng-template>\n", styles: [":host:last-of-type{flex:1;height:100%}:host .prizm-navigation-menu-group{--prizm-empty-message__padding: 16px 32px;border-bottom:1px solid var(--prizm-v3-background-stroke);height:100%}:host .prizm-navigation-menu-group_expanded:has(.empty-message){border-bottom:none}:host .prizm-navigation-menu-group ::ng-deep prizm-accordion{border:none}:host .prizm-navigation-menu-group ::ng-deep prizm-accordion .accordion__content{padding:0!important;background:var(--prizm-v3-background-fill-primary);cursor:default}:host .prizm-navigation-menu-group ::ng-deep prizm-accordion .prizm_accordion{border:0!important}:host .prizm-navigation-menu-group ::ng-deep prizm-accordion .accordion{box-shadow:unset;border-top:unset}:host .prizm-navigation-menu-group ::ng-deep prizm-accordion .accordion:hover:not(.accordion_disabled){box-shadow:unset;border-top:unset}:host .prizm-navigation-menu-group ::ng-deep prizm-accordion .accordion__header{padding:var(--prizm-navigation-menu__item-padding);padding-left:12px;border-left:4px solid transparent}:host .prizm-navigation-menu-group__no-items-content{background:var(--prizm-v3-background-fill-primary);height:100%;display:flex;justify-content:center;align-items:center}:host .empty-message{display:flex;flex-direction:column;align-items:center;gap:16px;font-size:14px;line-height:20px;text-align:center;padding:var(--prizm-empty-message__padding)}:host .empty-message__main{font-weight:600;color:var(--prizm-v3-text-icon-primary);text-align:center}:host .empty-message__sub{font-weight:400;color:var(--prizm-v3-text-icon-secondary)}\n"], dependencies: [{ kind: "ngmodule", type: CommonModule }, { kind: "directive", type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i4.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "pipe", type: i4.AsyncPipe, name: "async" }, { kind: "ngmodule", type: ReactiveFormsModule }, { kind: "component", type: PrizmAccordionItemComponent, selector: "prizm-accordion-item", inputs: ["icon", "title", "isExpanded", "disabled"], outputs: ["isExpandedChange"] }, { kind: "component", type: PrizmAccordionComponent, selector: "prizm-accordion", inputs: ["onlyOneExpanded"] }, { kind: "component", type: PrizmNavigationMenuToolbarComponent, selector: "prizm-navigation-menu-toolbar", inputs: ["toolbarExtraTemplate", "toolbarConfig", "searchConfig", "hideGroupAppearance"] }, { kind: "component", type: PrizmNavigationMenuItemsComponent, selector: "prizm-navigation-menu-items", inputs: ["items", "mode", "activeItem", "itemExtraTemplate", "expandedItemsMap", "childrenHandler"], outputs: ["itemExpandedChanged", "activeItemChanged", "goToRootItem", "goToParentItem"] }, { kind: "directive", type: PrizmAccordionContentDirective, selector: "[prizmAccordionContent]" }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.8", ngImport: i0, type: PrizmNavigationMenuGroupComponent, decorators: [{
            type: Component,
            args: [{ selector: 'prizm-navigation-menu-group', changeDetection: ChangeDetectionStrategy.OnPush, providers: [PrizmNavigationMenuToolbarService, PrizmNavigationMenuGroupService], standalone: true, imports: [
                        CommonModule,
                        ReactiveFormsModule,
                        PrizmAccordionItemComponent,
                        PrizmAccordionComponent,
                        PrizmNavigationMenuToolbarComponent,
                        PrizmNavigationMenuItemsComponent,
                        PrizmAccordionContentDirective,
                        PolymorphOutletDirective,
                    ], template: "<div class=\"prizm-navigation-menu-group\" [class.prizm-navigation-menu-group_expanded]=\"groupIsExpanded\">\n  <prizm-accordion *ngIf=\"!hideGroupAppearance; else noGroupAppearanceTemplate\">\n    <prizm-accordion-item\n      [icon]=\"$any(icon)\"\n      [title]=\"$any(title)\"\n      [isExpanded]=\"groupIsExpanded\"\n      (isExpandedChange)=\"handleGroupExpandedChanged($event)\"\n    >\n      <ng-template prizmAccordionContent>\n        <ng-container [ngTemplateOutlet]=\"itemsTemplate\"></ng-container>\n      </ng-template>\n    </prizm-accordion-item>\n  </prizm-accordion>\n\n  <ng-template #noGroupAppearanceTemplate>\n    <ng-container [ngTemplateOutlet]=\"itemsTemplate\"></ng-container>\n  </ng-template>\n</div>\n\n<ng-template #itemsTemplate>\n  <prizm-navigation-menu-toolbar\n    [searchConfig]=\"$any(searchConfig$ | async)\"\n    [toolbarConfig]=\"$any(toolbarConfig$ | async)\"\n    [toolbarExtraTemplate]=\"toolbarExtraTemplate\"\n    [hideGroupAppearance]=\"$any(hideGroupAppearance)\"\n  ></prizm-navigation-menu-toolbar>\n  <ng-container *ngIf=\"groupItems$ | async as groupItems\">\n    <prizm-navigation-menu-items\n      [items]=\"groupItems\"\n      [itemExtraTemplate]=\"$any(itemExtraTemplate)\"\n      [childrenHandler]=\"childrenHandler\"\n      [expandedItemsMap]=\"$any(expandedItemsMap$ | async)\"\n      [activeItem]=\"$any(activeItem$ | async)\"\n      [mode]=\"$any(mode$ | async)\"\n      (activeItemChanged)=\"handleActiveItemChange($event)\"\n      (itemExpandedChanged)=\"handleItemExpandedChanged($event)\"\n      (goToParentItem)=\"handleGoToParentItem($event)\"\n      (goToRootItem)=\"handleGoToRootItem($event)\"\n    ></prizm-navigation-menu-items>\n\n    <ng-container *ngIf=\"!groupItems.length\">\n      <div\n        class=\"prizm-navigation-menu-group__no-items-content\"\n        *ngIf=\"emptyMessageConfig$ | async as emptyMessageConfig\"\n      >\n        <div class=\"empty-message\">\n          <span class=\"empty-message__main\">{{ emptyMessageConfig.title }}</span>\n          <span class=\"empty-message__sub\">{{ emptyMessageConfig.subtitle }}</span>\n        </div>\n      </div>\n    </ng-container>\n  </ng-container>\n</ng-template>\n", styles: [":host:last-of-type{flex:1;height:100%}:host .prizm-navigation-menu-group{--prizm-empty-message__padding: 16px 32px;border-bottom:1px solid var(--prizm-v3-background-stroke);height:100%}:host .prizm-navigation-menu-group_expanded:has(.empty-message){border-bottom:none}:host .prizm-navigation-menu-group ::ng-deep prizm-accordion{border:none}:host .prizm-navigation-menu-group ::ng-deep prizm-accordion .accordion__content{padding:0!important;background:var(--prizm-v3-background-fill-primary);cursor:default}:host .prizm-navigation-menu-group ::ng-deep prizm-accordion .prizm_accordion{border:0!important}:host .prizm-navigation-menu-group ::ng-deep prizm-accordion .accordion{box-shadow:unset;border-top:unset}:host .prizm-navigation-menu-group ::ng-deep prizm-accordion .accordion:hover:not(.accordion_disabled){box-shadow:unset;border-top:unset}:host .prizm-navigation-menu-group ::ng-deep prizm-accordion .accordion__header{padding:var(--prizm-navigation-menu__item-padding);padding-left:12px;border-left:4px solid transparent}:host .prizm-navigation-menu-group__no-items-content{background:var(--prizm-v3-background-fill-primary);height:100%;display:flex;justify-content:center;align-items:center}:host .empty-message{display:flex;flex-direction:column;align-items:center;gap:16px;font-size:14px;line-height:20px;text-align:center;padding:var(--prizm-empty-message__padding)}:host .empty-message__main{font-weight:600;color:var(--prizm-v3-text-icon-primary);text-align:center}:host .empty-message__sub{font-weight:400;color:var(--prizm-v3-text-icon-secondary)}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }, { type: i1.PrizmDestroyService }, { type: i2.PrizmNavigationMenuGroupService }, { type: i3.PrizmNavigationMenuService }]; }, propDecorators: { menuItemsComponent: [{
                type: ViewChild,
                args: [PrizmNavigationMenuItemsComponent]
            }], itemExpandedChanged: [{
                type: Output
            }], groupExpandedChanged: [{
                type: Output
            }], groupId: [{
                type: Input
            }], title: [{
                type: Input
            }], hideGroupAppearance: [{
                type: Input
            }], icon: [{
                type: Input
            }], toolbarExtraTemplate: [{
                type: Input
            }], itemExtraTemplate: [{
                type: Input
            }], items: [{
                type: Input
            }], toolbarConfig: [{
                type: Input
            }], emptySearchResultMessageConfig: [{
                type: Input
            }], emptyDataMessageConfig: [{
                type: Input
            }], searchConfig: [{
                type: Input
            }], childrenHandler: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJpem0tbmF2aWdhdGlvbi1tZW51LWdyb3VwLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvY29tcG9uZW50cy9zcmMvbGliL2NvbXBvbmVudHMvbmF2aWdhdGlvbi1tZW51L2NvbXBvbmVudHMvcHJpem0tbmF2aWdhdGlvbi1tZW51LWdyb3VwL3ByaXptLW5hdmlnYXRpb24tbWVudS1ncm91cC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL2NvbXBvbmVudHMvc3JjL2xpYi9jb21wb25lbnRzL25hdmlnYXRpb24tbWVudS9jb21wb25lbnRzL3ByaXptLW5hdmlnYXRpb24tbWVudS1ncm91cC9wcml6bS1uYXZpZ2F0aW9uLW1lbnUtZ3JvdXAuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIsU0FBUyxFQUNULFlBQVksRUFDWixLQUFLLEVBRUwsTUFBTSxFQUNOLFdBQVcsRUFDWCxTQUFTLEdBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDeEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxLQUFLLEVBQWMsTUFBTSxNQUFNLENBQUM7QUFDMUQsT0FBTyxFQUFFLFlBQVksRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLGNBQWMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBUzlFLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLDhDQUE4QyxDQUFDO0FBQzFGLE9BQU8sRUFBRSwrQkFBK0IsRUFBRSxNQUFNLG9EQUFvRCxDQUFDO0FBQ3JHLE9BQU8sRUFBRSxpQ0FBaUMsRUFBRSxNQUFNLHNEQUFzRCxDQUFDO0FBQ3pHLE9BQU8sRUFBRSxpQ0FBaUMsRUFBRSxNQUFNLHNFQUFzRSxDQUFD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LDhWQUNaLG1CQUFtQiwrQkFDbkIsMkJBQTJCLHFKQUMzQix1QkFBdUIseUZBQ3ZCLG1DQUFtQyxvS0FDbkMsaUNBQWlDLHNRQUNqQyw4QkFBOEI7OzJGQUlyQixpQ0FBaUM7a0JBbEI3QyxTQUFTOytCQUNFLDZCQUE2QixtQkFHdEIsdUJBQXVCLENBQUMsTUFBTSxhQUNwQyxDQUFDLGlDQUFpQyxFQUFFLCtCQUErQixDQUFDLGNBQ25FLElBQUksV0FDUDt3QkFDUCxZQUFZO3dCQUNaLG1CQUFtQjt3QkFDbkIsMkJBQTJCO3dCQUMzQix1QkFBdUI7d0JBQ3ZCLG1DQUFtQzt3QkFDbkMsaUNBQWlDO3dCQUNqQyw4QkFBOEI7d0JBQzlCLHdCQUF3QjtxQkFDekI7aU9BU08sa0JBQWtCO3NCQUR6QixTQUFTO3VCQUFDLGlDQUFpQztnQkFHbEMsbUJBQW1CO3NCQUE1QixNQUFNO2dCQUtHLG9CQUFvQjtzQkFBN0IsTUFBTTtnQkFLRSxPQUFPO3NCQUFmLEtBQUs7Z0JBQ0csS0FBSztzQkFBYixLQUFLO2dCQUNHLG1CQUFtQjtzQkFBM0IsS0FBSztnQkFDRyxJQUFJO3NCQUFaLEtBQUs7Z0JBQ0csb0JBQW9CO3NCQUE1QixLQUFLO2dCQUNHLGlCQUFpQjtzQkFBekIsS0FBSztnQkFFTyxLQUFLO3NCQUFqQixLQUFLO2dCQUlPLGFBQWE7c0JBQXpCLEtBQUs7Z0JBSU8sOEJBQThCO3NCQUExQyxLQUFLO2dCQUlPLHNCQUFzQjtzQkFBbEMsS0FBSztnQkFJTyxZQUFZO3NCQUF4QixLQUFLO2dCQUlHLGVBQWU7c0JBQXZCLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgRXZlbnRFbWl0dGVyLFxuICBJbnB1dCxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG4gIFRlbXBsYXRlUmVmLFxuICBWaWV3Q2hpbGQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUHJpem1EZXN0cm95U2VydmljZSB9IGZyb20gJ0Bwcml6bS11aS9oZWxwZXJzJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgbWVyZ2UsIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRlYm91bmNlVGltZSwgbWFwLCB0YWtlVW50aWwsIHdpdGhMYXRlc3RGcm9tIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHtcbiAgSW50ZXJuYWxQcml6bU5hdmlnYXRpb25NZW51SXRlbSxcbiAgUHJpem1OYXZpZ2F0aW9uTWVudUVtcHR5TWVzc2FnZUNvbmZpZyxcbiAgUHJpem1OYXZpZ2F0aW9uTWVudUl0ZW0sXG4gIFByaXptTmF2aWdhdGlvbk1lbnVTZWFyY2hDb25maWcsXG4gIFByaXptTmF2aWdhdGlvbk1lbnVUb29sYmFyQ29uZmlnLFxuICBWaWV3TW9kZSxcbn0gZnJvbSAnLi4vLi4vaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyBQcml6bU5hdmlnYXRpb25NZW51U2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3ByaXptLW5hdmlnYXRpb24tbWVudS5zZXJ2aWNlJztcbmltcG9ydCB7IFByaXptTmF2aWdhdGlvbk1lbnVHcm91cFNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9wcml6bS1uYXZpZ2F0aW9uLW1lbnUtZ3JvdXAuc2VydmljZSc7XG5pbXBvcnQgeyBQcml6bU5hdmlnYXRpb25NZW51VG9vbGJhclNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9wcml6bS1uYXZpZ2F0aW9uLW1lbnUtdG9vbGJhci5zZXJ2aWNlJztcbmltcG9ydCB7IFByaXptTmF2aWdhdGlvbk1lbnVJdGVtc0NvbXBvbmVudCB9IGZyb20gJy4uL3ByaXptLW5hdmlnYXRpb24tbWVudS1pdGVtcy9wcml6bS1uYXZpZ2F0aW9uLW1lbnUtaXRlbXMuY29tcG9uZW50JztcbmltcG9ydCB7IFByaXptSGFuZGxlciB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL2xpYi90eXBlcyc7XG5pbXBvcnQgeyBQcml6bUFic3RyYWN0VGVzdElkIH0gZnJvbSAnQHByaXptLXVpL2NvcmUnO1xuaW1wb3J0IHsgQ29tbW9uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IFJlYWN0aXZlRm9ybXNNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBQb2x5bW9ycGhPdXRsZXREaXJlY3RpdmUgfSBmcm9tICcuLi8uLi8uLi8uLi9kaXJlY3RpdmVzJztcbmltcG9ydCB7XG4gIFByaXptQWNjb3JkaW9uQ29tcG9uZW50LFxuICBQcml6bUFjY29yZGlvbkNvbnRlbnREaXJlY3RpdmUsXG4gIFByaXptQWNjb3JkaW9uSXRlbUNvbXBvbmVudCxcbn0gZnJvbSAnLi4vLi4vLi4vYWNjb3JkaW9uJztcbmltcG9ydCB7IFByaXptTmF2aWdhdGlvbk1lbnVUb29sYmFyQ29tcG9uZW50IH0gZnJvbSAnLi4vcHJpem0tbmF2aWdhdGlvbi1tZW51LXRvb2xiYXIvcHJpem0tbmF2aWdhdGlvbi1tZW51LXRvb2xiYXIuY29tcG9uZW50JztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncHJpem0tbmF2aWdhdGlvbi1tZW51LWdyb3VwJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3ByaXptLW5hdmlnYXRpb24tbWVudS1ncm91cC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3ByaXptLW5hdmlnYXRpb24tbWVudS1ncm91cC5jb21wb25lbnQubGVzcyddLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgcHJvdmlkZXJzOiBbUHJpem1OYXZpZ2F0aW9uTWVudVRvb2xiYXJTZXJ2aWNlLCBQcml6bU5hdmlnYXRpb25NZW51R3JvdXBTZXJ2aWNlXSxcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcbiAgaW1wb3J0czogW1xuICAgIENvbW1vbk1vZHVsZSxcbiAgICBSZWFjdGl2ZUZvcm1zTW9kdWxlLFxuICAgIFByaXptQWNjb3JkaW9uSXRlbUNvbXBvbmVudCxcbiAgICBQcml6bUFjY29yZGlvbkNvbXBvbmVudCxcbiAgICBQcml6bU5hdmlnYXRpb25NZW51VG9vbGJhckNvbXBvbmVudCxcbiAgICBQcml6bU5hdmlnYXRpb25NZW51SXRlbXNDb21wb25lbnQsXG4gICAgUHJpem1BY2NvcmRpb25Db250ZW50RGlyZWN0aXZlLFxuICAgIFBvbHltb3JwaE91dGxldERpcmVjdGl2ZSxcbiAgXSxcbn0pXG5leHBvcnQgY2xhc3MgUHJpem1OYXZpZ2F0aW9uTWVudUdyb3VwQ29tcG9uZW50PFxuICAgIFVzZXJJdGVtIGV4dGVuZHMgT21pdDxQcml6bU5hdmlnYXRpb25NZW51SXRlbSwgJ2NoaWxkcmVuJz4gJiB7IGNoaWxkcmVuPzogVXNlckl0ZW1bXSB9XG4gID5cbiAgZXh0ZW5kcyBQcml6bUFic3RyYWN0VGVzdElkXG4gIGltcGxlbWVudHMgT25Jbml0XG57XG4gIEBWaWV3Q2hpbGQoUHJpem1OYXZpZ2F0aW9uTWVudUl0ZW1zQ29tcG9uZW50KVxuICBwcml2YXRlIG1lbnVJdGVtc0NvbXBvbmVudCE6IFByaXptTmF2aWdhdGlvbk1lbnVJdGVtc0NvbXBvbmVudDxVc2VySXRlbT47XG5cbiAgQE91dHB1dCgpIGl0ZW1FeHBhbmRlZENoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyPHtcbiAgICBpdGVtOiBVc2VySXRlbTtcbiAgICBpc0V4cGFuZGVkOiBib29sZWFuO1xuICB9PigpO1xuXG4gIEBPdXRwdXQoKSBncm91cEV4cGFuZGVkQ2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXI8e1xuICAgIGdyb3VwSWQ6IHN0cmluZztcbiAgICBpc0V4cGFuZGVkOiBib29sZWFuO1xuICB9PigpO1xuXG4gIEBJbnB1dCgpIGdyb3VwSWQhOiBzdHJpbmc7XG4gIEBJbnB1dCgpIHRpdGxlITogc3RyaW5nO1xuICBASW5wdXQoKSBoaWRlR3JvdXBBcHBlYXJhbmNlPzogYm9vbGVhbjtcbiAgQElucHV0KCkgaWNvbj86IHN0cmluZztcbiAgQElucHV0KCkgdG9vbGJhckV4dHJhVGVtcGxhdGUhOiBUZW1wbGF0ZVJlZjx1bmtub3duPjtcbiAgQElucHV0KCkgaXRlbUV4dHJhVGVtcGxhdGU/OiBUZW1wbGF0ZVJlZjx1bmtub3duPjtcblxuICBASW5wdXQoKSBzZXQgaXRlbXMoaXRlbXM6IFVzZXJJdGVtW10pIHtcbiAgICB0aGlzLml0ZW1zJCQubmV4dChpdGVtcyk7XG4gIH1cblxuICBASW5wdXQoKSBzZXQgdG9vbGJhckNvbmZpZyh0b29sYmFyQ29uZmlnOiBQcml6bU5hdmlnYXRpb25NZW51VG9vbGJhckNvbmZpZykge1xuICAgIHRoaXMuZ3JvdXBTZXJ2aWNlLnNldFRvb2xiYXJDb25maWcodG9vbGJhckNvbmZpZyk7XG4gIH1cblxuICBASW5wdXQoKSBzZXQgZW1wdHlTZWFyY2hSZXN1bHRNZXNzYWdlQ29uZmlnKGNvbmZpZzogUHJpem1OYXZpZ2F0aW9uTWVudUVtcHR5TWVzc2FnZUNvbmZpZykge1xuICAgIHRoaXMuZ3JvdXBTZXJ2aWNlLnNldEVtcHR5U2VhcmNoUmVzdWx0TWVzc2FnZUNvbmZpZyhjb25maWcpO1xuICB9XG5cbiAgQElucHV0KCkgc2V0IGVtcHR5RGF0YU1lc3NhZ2VDb25maWcoY29uZmlnOiBQcml6bU5hdmlnYXRpb25NZW51RW1wdHlNZXNzYWdlQ29uZmlnKSB7XG4gICAgdGhpcy5ncm91cFNlcnZpY2Uuc2V0RW1wdHlEYXRhTWVzc2FnZUNvbmZpZyhjb25maWcpO1xuICB9XG5cbiAgQElucHV0KCkgc2V0IHNlYXJjaENvbmZpZyhjb25maWc6IFByaXptTmF2aWdhdGlvbk1lbnVTZWFyY2hDb25maWcpIHtcbiAgICB0aGlzLmdyb3VwU2VydmljZS5zZXRTZWFyY2hDb25maWcoY29uZmlnKTtcbiAgfVxuXG4gIEBJbnB1dCgpIGNoaWxkcmVuSGFuZGxlciE6IFByaXptSGFuZGxlcjxcbiAgICBJbnRlcm5hbFByaXptTmF2aWdhdGlvbk1lbnVJdGVtPFVzZXJJdGVtPixcbiAgICByZWFkb25seSBJbnRlcm5hbFByaXptTmF2aWdhdGlvbk1lbnVJdGVtPFVzZXJJdGVtPltdXG4gID47XG5cbiAgb3ZlcnJpZGUgcmVhZG9ubHkgdGVzdElkXyA9ICd1aV9uYXZpZ2F0aW9uX21lbnVfZ3JvdXAnO1xuICBncm91cElzRXhwYW5kZWQhOiBib29sZWFuO1xuXG4gIGdyb3VwSXRlbXMkOiBPYnNlcnZhYmxlPEludGVybmFsUHJpem1OYXZpZ2F0aW9uTWVudUl0ZW08VXNlckl0ZW0+W10+ID0gdGhpcy5ncm91cFNlcnZpY2UuZ3JvdXBJdGVtcyQ7XG5cbiAgZXhwYW5kZWRJdGVtc01hcCQ6IE9ic2VydmFibGU8TWFwPEludGVybmFsUHJpem1OYXZpZ2F0aW9uTWVudUl0ZW08VXNlckl0ZW0+LCBib29sZWFuPj4gPVxuICAgIHRoaXMuZ3JvdXBTZXJ2aWNlLmV4cGFuZGVkSXRlbXNNYXAkO1xuXG4gIHRvb2xiYXJDb25maWckOiBPYnNlcnZhYmxlPFByaXptTmF2aWdhdGlvbk1lbnVUb29sYmFyQ29uZmlnPiA9IHRoaXMuZ3JvdXBTZXJ2aWNlLnRvb2xiYXJDb25maWckO1xuXG4gIHNlYXJjaENvbmZpZyQ6IE9ic2VydmFibGU8UHJpem1OYXZpZ2F0aW9uTWVudVNlYXJjaENvbmZpZz4gPSB0aGlzLmdyb3VwU2VydmljZS5zZWFyY2hDb25maWckO1xuXG4gIGVtcHR5TWVzc2FnZUNvbmZpZyQ6IE9ic2VydmFibGU8UHJpem1OYXZpZ2F0aW9uTWVudUVtcHR5TWVzc2FnZUNvbmZpZz4gPVxuICAgIHRoaXMuZ3JvdXBTZXJ2aWNlLnNlYXJjaEVuYWJsZWQkLnBpcGUoXG4gICAgICB3aXRoTGF0ZXN0RnJvbShcbiAgICAgICAgdGhpcy5ncm91cFNlcnZpY2UuZW1wdHlTZWFyY2hSZXN1bHRNZXNzYWdlQ29uZmlnJCxcbiAgICAgICAgdGhpcy5ncm91cFNlcnZpY2UuZW1wdHlEYXRhTWVzc2FnZUNvbmZpZyRcbiAgICAgICksXG4gICAgICBtYXAoKFtzZWFyY2hFbmFibGVkLCBlbXB0eVNlYXJjaFJlc3VsdE1lc3NhZ2VDb25maWcsIGVtcHR5RGF0YU1lc3NhZ2VDb25maWddKSA9PiB7XG4gICAgICAgIHJldHVybiBzZWFyY2hFbmFibGVkID8gZW1wdHlTZWFyY2hSZXN1bHRNZXNzYWdlQ29uZmlnIDogZW1wdHlEYXRhTWVzc2FnZUNvbmZpZztcbiAgICAgIH0pXG4gICAgKTtcblxuICBhY3RpdmVJdGVtJDogT2JzZXJ2YWJsZTxJbnRlcm5hbFByaXptTmF2aWdhdGlvbk1lbnVJdGVtPFVzZXJJdGVtPiB8IG51bGw+ID0gdGhpcy5tZW51U2VydmljZS5hY3RpdmVJdGVtJDtcblxuICBtb2RlJDogT2JzZXJ2YWJsZTxWaWV3TW9kZT4gPSB0aGlzLmdyb3VwU2VydmljZS52aWV3TW9kZSQ7XG5cbiAgcHJpdmF0ZSBpdGVtcyQkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxVc2VySXRlbVtdPihbXSk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIHByaXZhdGUgZGVzdHJveSQ6IFByaXptRGVzdHJveVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBncm91cFNlcnZpY2U6IFByaXptTmF2aWdhdGlvbk1lbnVHcm91cFNlcnZpY2U8VXNlckl0ZW0+LFxuICAgIHByaXZhdGUgbWVudVNlcnZpY2U6IFByaXptTmF2aWdhdGlvbk1lbnVTZXJ2aWNlPFVzZXJJdGVtPlxuICApIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5yZWdpc3Rlckl0ZW1zKCk7XG4gICAgdGhpcy5zZXRHcm91cElzRXhwYW5kZWQoKTtcbiAgICB0aGlzLmVuc3VyZVZpZXdVcGRhdGVzQ29ycmVjdGx5KCk7XG4gIH1cblxuICBwdWJsaWMgaGFuZGxlQWN0aXZlSXRlbUNoYW5nZShpdGVtOiBJbnRlcm5hbFByaXptTmF2aWdhdGlvbk1lbnVJdGVtPFVzZXJJdGVtPik6IHZvaWQge1xuICAgIHRoaXMubWVudVNlcnZpY2UuaGFuZGxlQWN0aXZlSXRlbUNoYW5nZShpdGVtKTtcbiAgfVxuXG4gIHB1YmxpYyBoYW5kbGVJdGVtRXhwYW5kZWRDaGFuZ2VkKGV2ZW50OiB7XG4gICAgaXRlbTogSW50ZXJuYWxQcml6bU5hdmlnYXRpb25NZW51SXRlbTxVc2VySXRlbT47XG4gICAgaXNFeHBhbmRlZDogYm9vbGVhbjtcbiAgfSk6IHZvaWQge1xuICAgIGlmICh0aGlzLmdyb3VwU2VydmljZS52aWV3TW9kZSA9PT0gJ3J1YnJpY2F0b3InKSByZXR1cm47XG5cbiAgICBpZiAodGhpcy5ncm91cFNlcnZpY2Uudmlld01vZGUgPT09ICdmb2xkZXInKSB7XG4gICAgICByZXR1cm4gdGhpcy5ncm91cFNlcnZpY2UuaGFuZGxlRm9sZGVyRXhwYW5kZWQoZXZlbnQuaXRlbSk7XG4gICAgfVxuXG4gICAgdGhpcy5tZW51U2VydmljZS5oYW5kbGVFeHBhbmRlZENoYW5nZWQoZXZlbnQpO1xuICAgIHRoaXMuaXRlbUV4cGFuZGVkQ2hhbmdlZC5lbWl0KHtcbiAgICAgIGl0ZW06IHRoaXMubWVudVNlcnZpY2UuZ2V0VXNlckl0ZW0oZXZlbnQuaXRlbSksXG4gICAgICBpc0V4cGFuZGVkOiBldmVudC5pc0V4cGFuZGVkLFxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGhhbmRsZUdyb3VwRXhwYW5kZWRDaGFuZ2VkKGlzRXhwYW5kZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICBjb25zdCBldmVudCA9IHtcbiAgICAgIGdyb3VwSWQ6IHRoaXMuZ3JvdXBJZCxcbiAgICAgIGlzRXhwYW5kZWQsXG4gICAgfTtcblxuICAgIHRoaXMubWVudVNlcnZpY2UuaGFuZGxlR3JvdXBFeHBhbmRlZENoYW5nZWQoZXZlbnQpO1xuICAgIHRoaXMuZ3JvdXBFeHBhbmRlZENoYW5nZWQuZW1pdChldmVudCk7XG4gIH1cblxuICBwdWJsaWMgaGFuZGxlR29Ub1BhcmVudEl0ZW0oaXRlbTogSW50ZXJuYWxQcml6bU5hdmlnYXRpb25NZW51SXRlbTxVc2VySXRlbT4pOiB2b2lkIHtcbiAgICB0aGlzLmdyb3VwU2VydmljZS5nb1RvUGFyZW50Rm9sZGVyKGl0ZW0pO1xuICB9XG5cbiAgcHVibGljIGhhbmRsZUdvVG9Sb290SXRlbShfaXRlbTogSW50ZXJuYWxQcml6bU5hdmlnYXRpb25NZW51SXRlbTxVc2VySXRlbT4pOiB2b2lkIHtcbiAgICB0aGlzLmdyb3VwU2VydmljZS5nb1RvUm9vdEZvbGRlcigpO1xuICB9XG5cbiAgcHJpdmF0ZSByZWdpc3Rlckl0ZW1zKCk6IHZvaWQge1xuICAgIGNvbnN0IGdyb3VwSWQ6IHN0cmluZyA9IHRoaXMuZ3JvdXBJZCB8fCB0aGlzLnRpdGxlO1xuICAgIHRoaXMuZ3JvdXBTZXJ2aWNlLnNldEdyb3VwSWQoZ3JvdXBJZCk7XG4gICAgdGhpcy5pdGVtcyQkLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKS5zdWJzY3JpYmUoaXRlbXMgPT4ge1xuICAgICAgdGhpcy5tZW51U2VydmljZS5yZWdpc3Rlckdyb3VwSXRlbXMoZ3JvdXBJZCwgaXRlbXMpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRHcm91cElzRXhwYW5kZWQoKTogdm9pZCB7XG4gICAgdGhpcy5ncm91cElzRXhwYW5kZWQgPSB0aGlzLm1lbnVTZXJ2aWNlLmdldEdyb3VwSXNFeHBhbmRlZCh0aGlzLmdyb3VwSWQpO1xuICB9XG5cbiAgcHJpdmF0ZSBlbnN1cmVWaWV3VXBkYXRlc0NvcnJlY3RseSgpOiB2b2lkIHtcbiAgICBtZXJnZShcbiAgICAgIHRoaXMuYWN0aXZlSXRlbSQsXG4gICAgICB0aGlzLmdyb3VwU2VydmljZS5jbG9zZUFsbCQsXG4gICAgICB0aGlzLmdyb3VwU2VydmljZS52aWV3TW9kZSQsXG4gICAgICB0aGlzLm1lbnVTZXJ2aWNlLml0ZW1FeHBhbmRlZENoYW5nZWRFdmVudCRcbiAgICApXG4gICAgICAucGlwZShkZWJvdW5jZVRpbWUoMCksIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSlcbiAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgdGhpcy5tZW51SXRlbXNDb21wb25lbnQ/LnRyaWdnZXJDZHIoKTtcbiAgICAgIH0pO1xuICB9XG59XG4iLCI8ZGl2IGNsYXNzPVwicHJpem0tbmF2aWdhdGlvbi1tZW51LWdyb3VwXCIgW2NsYXNzLnByaXptLW5hdmlnYXRpb24tbWVudS1ncm91cF9leHBhbmRlZF09XCJncm91cElzRXhwYW5kZWRcIj5cbiAgPHByaXptLWFjY29yZGlvbiAqbmdJZj1cIiFoaWRlR3JvdXBBcHBlYXJhbmNlOyBlbHNlIG5vR3JvdXBBcHBlYXJhbmNlVGVtcGxhdGVcIj5cbiAgICA8cHJpem0tYWNjb3JkaW9uLWl0ZW1cbiAgICAgIFtpY29uXT1cIiRhbnkoaWNvbilcIlxuICAgICAgW3RpdGxlXT1cIiRhbnkodGl0bGUpXCJcbiAgICAgIFtpc0V4cGFuZGVkXT1cImdyb3VwSXNFeHBhbmRlZFwiXG4gICAgICAoaXNFeHBhbmRlZENoYW5nZSk9XCJoYW5kbGVHcm91cEV4cGFuZGVkQ2hhbmdlZCgkZXZlbnQpXCJcbiAgICA+XG4gICAgICA8bmctdGVtcGxhdGUgcHJpem1BY2NvcmRpb25Db250ZW50PlxuICAgICAgICA8bmctY29udGFpbmVyIFtuZ1RlbXBsYXRlT3V0bGV0XT1cIml0ZW1zVGVtcGxhdGVcIj48L25nLWNvbnRhaW5lcj5cbiAgICAgIDwvbmctdGVtcGxhdGU+XG4gICAgPC9wcml6bS1hY2NvcmRpb24taXRlbT5cbiAgPC9wcml6bS1hY2NvcmRpb24+XG5cbiAgPG5nLXRlbXBsYXRlICNub0dyb3VwQXBwZWFyYW5jZVRlbXBsYXRlPlxuICAgIDxuZy1jb250YWluZXIgW25nVGVtcGxhdGVPdXRsZXRdPVwiaXRlbXNUZW1wbGF0ZVwiPjwvbmctY29udGFpbmVyPlxuICA8L25nLXRlbXBsYXRlPlxuPC9kaXY+XG5cbjxuZy10ZW1wbGF0ZSAjaXRlbXNUZW1wbGF0ZT5cbiAgPHByaXptLW5hdmlnYXRpb24tbWVudS10b29sYmFyXG4gICAgW3NlYXJjaENvbmZpZ109XCIkYW55KHNlYXJjaENvbmZpZyQgfCBhc3luYylcIlxuICAgIFt0b29sYmFyQ29uZmlnXT1cIiRhbnkodG9vbGJhckNvbmZpZyQgfCBhc3luYylcIlxuICAgIFt0b29sYmFyRXh0cmFUZW1wbGF0ZV09XCJ0b29sYmFyRXh0cmFUZW1wbGF0ZVwiXG4gICAgW2hpZGVHcm91cEFwcGVhcmFuY2VdPVwiJGFueShoaWRlR3JvdXBBcHBlYXJhbmNlKVwiXG4gID48L3ByaXptLW5hdmlnYXRpb24tbWVudS10b29sYmFyPlxuICA8bmctY29udGFpbmVyICpuZ0lmPVwiZ3JvdXBJdGVtcyQgfCBhc3luYyBhcyBncm91cEl0ZW1zXCI+XG4gICAgPHByaXptLW5hdmlnYXRpb24tbWVudS1pdGVtc1xuICAgICAgW2l0ZW1zXT1cImdyb3VwSXRlbXNcIlxuICAgICAgW2l0ZW1FeHRyYVRlbXBsYXRlXT1cIiRhbnkoaXRlbUV4dHJhVGVtcGxhdGUpXCJcbiAgICAgIFtjaGlsZHJlbkhhbmRsZXJdPVwiY2hpbGRyZW5IYW5kbGVyXCJcbiAgICAgIFtleHBhbmRlZEl0ZW1zTWFwXT1cIiRhbnkoZXhwYW5kZWRJdGVtc01hcCQgfCBhc3luYylcIlxuICAgICAgW2FjdGl2ZUl0ZW1dPVwiJGFueShhY3RpdmVJdGVtJCB8IGFzeW5jKVwiXG4gICAgICBbbW9kZV09XCIkYW55KG1vZGUkIHwgYXN5bmMpXCJcbiAgICAgIChhY3RpdmVJdGVtQ2hhbmdlZCk9XCJoYW5kbGVBY3RpdmVJdGVtQ2hhbmdlKCRldmVudClcIlxuICAgICAgKGl0ZW1FeHBhbmRlZENoYW5nZWQpPVwiaGFuZGxlSXRlbUV4cGFuZGVkQ2hhbmdlZCgkZXZlbnQpXCJcbiAgICAgIChnb1RvUGFyZW50SXRlbSk9XCJoYW5kbGVHb1RvUGFyZW50SXRlbSgkZXZlbnQpXCJcbiAgICAgIChnb1RvUm9vdEl0ZW0pPVwiaGFuZGxlR29Ub1Jvb3RJdGVtKCRldmVudClcIlxuICAgID48L3ByaXptLW5hdmlnYXRpb24tbWVudS1pdGVtcz5cblxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCIhZ3JvdXBJdGVtcy5sZW5ndGhcIj5cbiAgICAgIDxkaXZcbiAgICAgICAgY2xhc3M9XCJwcml6bS1uYXZpZ2F0aW9uLW1lbnUtZ3JvdXBfX25vLWl0ZW1zLWNvbnRlbnRcIlxuICAgICAgICAqbmdJZj1cImVtcHR5TWVzc2FnZUNvbmZpZyQgfCBhc3luYyBhcyBlbXB0eU1lc3NhZ2VDb25maWdcIlxuICAgICAgPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiZW1wdHktbWVzc2FnZVwiPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwiZW1wdHktbWVzc2FnZV9fbWFpblwiPnt7IGVtcHR5TWVzc2FnZUNvbmZpZy50aXRsZSB9fTwvc3Bhbj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cImVtcHR5LW1lc3NhZ2VfX3N1YlwiPnt7IGVtcHR5TWVzc2FnZUNvbmZpZy5zdWJ0aXRsZSB9fTwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L25nLWNvbnRhaW5lcj5cbiAgPC9uZy1jb250YWluZXI+XG48L25nLXRlbXBsYXRlPlxuIl19