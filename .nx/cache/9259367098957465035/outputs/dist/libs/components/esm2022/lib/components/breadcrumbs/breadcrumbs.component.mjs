import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChildren, ElementRef, EventEmitter, Input, Output, QueryList, ViewChild, ViewChildren, } from '@angular/core';
import { animationFrameScheduler, BehaviorSubject, merge, Subject } from 'rxjs';
import { PrizmDestroyService, prizmEmptyQueryList } from '@prizm-ui/helpers';
import { debounceTime, observeOn, takeUntil, tap } from 'rxjs/operators';
import { PrizmAbstractTestId } from '../../abstract/interactive';
import { PrizmBreadcrumbDirective } from './breadcrumbs.directive';
import { CommonModule } from '@angular/common';
import { PrizmIconModule } from '../icon';
import { PrizmDropdownHostModule } from '../dropdowns/dropdown-host';
import * as i0 from "@angular/core";
import * as i1 from "@prizm-ui/helpers";
import * as i2 from "@angular/common";
import * as i3 from "../icon/icon.component";
import * as i4 from "../dropdowns/dropdown-host/dropdown-host.component";
export class PrizmBreadcrumbsComponent extends PrizmAbstractTestId {
    set breadcrumbs(data) {
        this.breadcrumbs$.next(data);
    }
    get breadcrumbs() {
        return this.breadcrumbs$.getValue();
    }
    get activeBreadcrumbIdx() {
        return this.breadcrumbsToShow$.getValue().length - 1;
    }
    constructor(cdRef, destroy) {
        super();
        this.cdRef = cdRef;
        this.destroy = destroy;
        this.testId_ = 'ui_breadcrumbs';
        this.breadcrumbChange = new EventEmitter();
        this.breadcrumbsList = prizmEmptyQueryList();
        this.breadcrumbsItem = prizmEmptyQueryList();
        this.breadcrumbs$ = new BehaviorSubject([]);
        this.breadcrumbsToShow$ = new BehaviorSubject([]);
        this.breadcrumbsInMenu$ = new BehaviorSubject([]);
        this.isDropdownOpened = false;
        this.isContainerOverflowed = false;
        this.mutationDetector$ = new Subject();
    }
    changeBreadcrumb(idx) {
        this.breadcrumbs = this.breadcrumbs.filter((item, i) => i <= idx);
        this.breadcrumbChange.emit(this.breadcrumbs[idx]);
    }
    ngOnInit() {
        this.resizeObserver = new ResizeObserver(() => this.mutationDetector$.next());
        this.resizeObserver.observe(this.containerRef.nativeElement);
    }
    ngAfterViewInit() {
        const $mutation = this.mutationDetector$.pipe(debounceTime(200), observeOn(animationFrameScheduler), tap(() => {
            this.calculateOverflowState();
            this.setViewBreadcrumbs(this.breadcrumbs);
        }));
        const $breadcrumbsChange = this.breadcrumbs$.pipe(debounceTime(200), observeOn(animationFrameScheduler), tap(item => {
            this.calculateBreadcrumbsWidth();
            this.calculateOverflowState();
            this.setViewBreadcrumbs(item);
        }));
        merge($breadcrumbsChange, $mutation)
            .pipe(debounceTime(200), takeUntil(this.destroy))
            .subscribe(() => this.cdRef.detectChanges());
    }
    ngOnDestroy() {
        this.resizeObserver.disconnect();
        this.mutationDetector$.complete();
    }
    calculateOverflowState() {
        const containerWidth = this.containerRef.nativeElement.clientWidth;
        const contentWidth = this.breadcrumbsElementsWidth;
        if (contentWidth > containerWidth) {
            this.isContainerOverflowed = this.breadcrumbs.length > 2;
        }
        else {
            this.isDropdownOpened = false;
            this.isContainerOverflowed = false;
        }
    }
    calculateBreadcrumbsWidth() {
        this.breadcrumbsElementsWidth = this.fakeBreadcrumbContainer.nativeElement.clientWidth;
    }
    setViewBreadcrumbs(breadcrumbs) {
        if (this.isContainerOverflowed) {
            this.breadcrumbsInMenu$.next(breadcrumbs.filter((item, i) => i > 0 && i < breadcrumbs.length - 1));
            this.breadcrumbsToShow$.next(breadcrumbs.filter((item, i) => i === 0 || i === breadcrumbs.length - 1));
        }
        else {
            this.breadcrumbsInMenu$.next([]);
            this.breadcrumbsToShow$.next(breadcrumbs);
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.8", ngImport: i0, type: PrizmBreadcrumbsComponent, deps: [{ token: i0.ChangeDetectorRef }, { token: i1.PrizmDestroyService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.8", type: PrizmBreadcrumbsComponent, isStandalone: true, selector: "prizm-breadcrumbs", inputs: { breadcrumbs: "breadcrumbs" }, outputs: { breadcrumbChange: "breadcrumbChange" }, providers: [PrizmDestroyService], queries: [{ propertyName: "breadcrumbsItem", predicate: PrizmBreadcrumbDirective }], viewQueries: [{ propertyName: "containerRef", first: true, predicate: ["container"], descendants: true, static: true }, { propertyName: "fakeBreadcrumbContainer", first: true, predicate: ["breadcrumbsFake"], descendants: true, static: true }, { propertyName: "breadcrumbsList", predicate: ["breadcrumb"], descendants: true, read: ElementRef }], usesInheritance: true, ngImport: i0, template: "<div class=\"container\" #container>\n  <div class=\"breadcrumbs\" *ngFor=\"let item of breadcrumbsItem; let i = index\">\n    <prizm-icon\n      class=\"breadcrumbs__chevron\"\n      *ngIf=\"i !== 0\"\n      [size]=\"16\"\n      iconClass=\"chevrons-right\"\n    ></prizm-icon>\n\n    <div class=\"breadcrumb breadcrumb__name\">\n      <ng-container [ngTemplateOutlet]=\"item.template\" [ngTemplateOutletContext]=\"{ idx: i }\"></ng-container>\n    </div>\n\n    <prizm-dropdown-host\n      class=\"breadcrumbs__dots\"\n      *ngIf=\"i === 0 && this.isContainerOverflowed\"\n      [(isOpen)]=\"isDropdownOpened\"\n      [content]=\"dropdown\"\n      prizmDropdownHostWidth=\"auto\"\n    >\n      <div class=\"dropdown-inner\">\n        <prizm-icon class=\"breadcrumbs__chevron\" [size]=\"16\" iconClass=\"chevrons-right\"></prizm-icon>\n        <button class=\"dots-buttons\" (click)=\"isDropdownOpened = !isDropdownOpened\">...</button>\n      </div>\n    </prizm-dropdown-host>\n  </div>\n\n  <ng-container>\n    <div class=\"breadcrumbs\" #breadcrumb *ngFor=\"let breadcrumb of breadcrumbsToShow$ | async; let i = index\">\n      <prizm-icon\n        class=\"breadcrumbs__chevron\"\n        *ngIf=\"i !== 0\"\n        [size]=\"16\"\n        iconClass=\"chevrons-right\"\n      ></prizm-icon>\n\n      <button\n        class=\"breadcrumb\"\n        [class.breadcrumb_active]=\"i === activeBreadcrumbIdx\"\n        (click)=\"changeBreadcrumb(i)\"\n      >\n        <prizm-icon\n          class=\"breadcrumb__icon\"\n          *ngIf=\"breadcrumb.icon\"\n          [size]=\"16\"\n          [iconClass]=\"breadcrumb.icon\"\n        ></prizm-icon>\n        <span class=\"breadcrumb__name\" *ngIf=\"breadcrumb.name\">{{ breadcrumb.name }}</span>\n      </button>\n\n      <prizm-dropdown-host\n        class=\"breadcrumbs__dots\"\n        *ngIf=\"i === 0 && this.isContainerOverflowed\"\n        [(isOpen)]=\"isDropdownOpened\"\n        [content]=\"dropdown\"\n        prizmDropdownHostWidth=\"auto\"\n      >\n        <div class=\"dropdown-inner\">\n          <prizm-icon class=\"breadcrumbs__chevron\" [size]=\"16\" iconClass=\"chevrons-right\"></prizm-icon>\n          <button class=\"dots-buttons\" (click)=\"isDropdownOpened = !isDropdownOpened\">...</button>\n        </div>\n      </prizm-dropdown-host>\n    </div>\n  </ng-container>\n</div>\n\n<div class=\"container container__fake\" #breadcrumbsFake>\n  <div class=\"breadcrumbs\" #breadcrumbsFake *ngFor=\"let breadcrumb of breadcrumbs$ | async; let i = index\">\n    <prizm-icon\n      class=\"breadcrumbs__chevron\"\n      *ngIf=\"i !== 0\"\n      [size]=\"16\"\n      iconClass=\"chevrons-right\"\n    ></prizm-icon>\n    <button class=\"breadcrumb\">\n      <prizm-icon\n        class=\"breadcrumb__icon\"\n        *ngIf=\"!!breadcrumb.icon\"\n        [size]=\"16\"\n        [iconClass]=\"breadcrumb.icon\"\n      ></prizm-icon>\n      <span class=\"breadcrumb__name\">{{ breadcrumb?.name }}</span>\n    </button>\n  </div>\n</div>\n\n<ng-template #dropdown>\n  <div class=\"dropdown-content\" *ngIf=\"breadcrumbsInMenu$ | async as breadcrumbsInMenu\">\n    <ng-container *ngFor=\"let breadcrumb of breadcrumbsInMenu; let i = index\">\n      <button class=\"dropdown-breadcrumb\" (click)=\"changeBreadcrumb(i + 1)\">\n        <prizm-icon\n          class=\"dropdown-breadcrumb__icon\"\n          *ngIf=\"!!breadcrumb.icon\"\n          [size]=\"16\"\n          [iconClass]=\"breadcrumb.icon\"\n        ></prizm-icon>\n        <span class=\"dropdown-breadcrumb__name\">{{ breadcrumb?.name }}</span>\n      </button>\n    </ng-container>\n  </div>\n</ng-template>\n", styles: ["button{border:none;outline:none;background:transparent;cursor:pointer}span{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}:host{height:100%;width:100%;display:flex;position:relative;overflow:hidden}:host .container{flex:1;display:flex;overflow:hidden}:host .container__fake{position:absolute;opacity:0;z-index:0;pointer-events:none}:host .container .breadcrumbs{display:flex;align-items:center}:host .container .breadcrumbs .dropdown-inner{display:flex}:host .container .breadcrumbs__chevron{display:flex;color:var(--prizm-v3-text-icon-tertiary)}:host .container .breadcrumbs__dots{display:flex;align-items:center}:host .container .breadcrumbs__dots button:hover,:host .container .breadcrumbs__dots button:focus{color:var(--prizm-v3-button-primary-solid-hover)}:host .container .breadcrumbs .breadcrumb{height:32px;padding:0 6px;display:flex;align-items:center;justify-content:center;gap:8px;border:2px solid transparent;border-radius:4px}:host .container .breadcrumbs .breadcrumb__name{font-weight:400;font-size:12px;line-height:16px;color:var(--prizm-v3-text-icon-tertiary)}:host .container .breadcrumbs .breadcrumb__icon{height:32px;display:flex;align-items:center;justify-content:center;color:var(--prizm-v3-text-icon-tertiary)}:host .container .breadcrumbs .breadcrumb_active{cursor:auto}:host .container .breadcrumbs .breadcrumb_active .breadcrumb__name,:host .container .breadcrumbs .breadcrumb_active .breadcrumb__icon{color:var(--prizm-v3-text-icon-primary)}:host .container .breadcrumbs .breadcrumb:hover:not(.breadcrumb_active) .breadcrumb__name,:host .container .breadcrumbs .breadcrumb:hover:not(.breadcrumb_active) .breadcrumb__icon{color:var(--prizm-v3-button-primary-solid-hover);transition:.4s}:host .container .breadcrumbs .breadcrumb:focus:not(.breadcrumb_active){border-color:var(--prizm-v3-background-stroke-focus)}.dropdown-content{padding:8px 0;display:flex;flex-direction:column;background:var(--prizm-v3-background-fill-overlay)}.dropdown-content .dropdown-breadcrumb{height:32px;min-width:32px;max-width:210px;padding:0 8px;display:flex;align-items:center;gap:8px}.dropdown-content .dropdown-breadcrumb__name{height:24px;display:flex;align-items:center;font-weight:400;font-size:14px;line-height:16px;color:var(--prizm-v3-text-icon-secondary)}.dropdown-content .dropdown-breadcrumb__icon{height:32px;display:flex;align-items:center;justify-content:center;color:var(--prizm-v3-text-icon-secondary)}.dropdown-content .dropdown-breadcrumb:hover,.dropdown-content .dropdown-breadcrumb:focus{background:var(--prizm-v3-table-fill-row-hover)}.dots-buttons{color:var(--prizm-v3-text-icon-tertiary)}\n"], dependencies: [{ kind: "ngmodule", type: CommonModule }, { kind: "directive", type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i2.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "pipe", type: i2.AsyncPipe, name: "async" }, { kind: "ngmodule", type: 
                // TODO !ng16 change all icon module to svg module
                PrizmIconModule }, { kind: "component", type: i3.PrizmIconComponent, selector: "prizm-icon", inputs: ["iconClass", "size"] }, { kind: "ngmodule", type: PrizmDropdownHostModule }, { kind: "component", type: i4.PrizmDropdownHostComponent, selector: "prizm-dropdown-host", inputs: ["content", "prizmDropdownHostId", "prizmDropdownCustomContext", "delay", "canOpen", "closeByEsc", "closeOnOutsideClick", "prizmDropdownHost", "prizmDropdownHostWidth", "autoReposition", "placement", "isOpen", "dropdownStyles", "dropdownClasses"], outputs: ["isOpenChange"], exportAs: ["prizm-dropdown-host"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.8", ngImport: i0, type: PrizmBreadcrumbsComponent, decorators: [{
            type: Component,
            args: [{ selector: 'prizm-breadcrumbs', changeDetection: ChangeDetectionStrategy.OnPush, providers: [PrizmDestroyService], standalone: true, imports: [
                        CommonModule,
                        // TODO !ng16 change all icon module to svg module
                        PrizmIconModule,
                        PrizmDropdownHostModule,
                    ], template: "<div class=\"container\" #container>\n  <div class=\"breadcrumbs\" *ngFor=\"let item of breadcrumbsItem; let i = index\">\n    <prizm-icon\n      class=\"breadcrumbs__chevron\"\n      *ngIf=\"i !== 0\"\n      [size]=\"16\"\n      iconClass=\"chevrons-right\"\n    ></prizm-icon>\n\n    <div class=\"breadcrumb breadcrumb__name\">\n      <ng-container [ngTemplateOutlet]=\"item.template\" [ngTemplateOutletContext]=\"{ idx: i }\"></ng-container>\n    </div>\n\n    <prizm-dropdown-host\n      class=\"breadcrumbs__dots\"\n      *ngIf=\"i === 0 && this.isContainerOverflowed\"\n      [(isOpen)]=\"isDropdownOpened\"\n      [content]=\"dropdown\"\n      prizmDropdownHostWidth=\"auto\"\n    >\n      <div class=\"dropdown-inner\">\n        <prizm-icon class=\"breadcrumbs__chevron\" [size]=\"16\" iconClass=\"chevrons-right\"></prizm-icon>\n        <button class=\"dots-buttons\" (click)=\"isDropdownOpened = !isDropdownOpened\">...</button>\n      </div>\n    </prizm-dropdown-host>\n  </div>\n\n  <ng-container>\n    <div class=\"breadcrumbs\" #breadcrumb *ngFor=\"let breadcrumb of breadcrumbsToShow$ | async; let i = index\">\n      <prizm-icon\n        class=\"breadcrumbs__chevron\"\n        *ngIf=\"i !== 0\"\n        [size]=\"16\"\n        iconClass=\"chevrons-right\"\n      ></prizm-icon>\n\n      <button\n        class=\"breadcrumb\"\n        [class.breadcrumb_active]=\"i === activeBreadcrumbIdx\"\n        (click)=\"changeBreadcrumb(i)\"\n      >\n        <prizm-icon\n          class=\"breadcrumb__icon\"\n          *ngIf=\"breadcrumb.icon\"\n          [size]=\"16\"\n          [iconClass]=\"breadcrumb.icon\"\n        ></prizm-icon>\n        <span class=\"breadcrumb__name\" *ngIf=\"breadcrumb.name\">{{ breadcrumb.name }}</span>\n      </button>\n\n      <prizm-dropdown-host\n        class=\"breadcrumbs__dots\"\n        *ngIf=\"i === 0 && this.isContainerOverflowed\"\n        [(isOpen)]=\"isDropdownOpened\"\n        [content]=\"dropdown\"\n        prizmDropdownHostWidth=\"auto\"\n      >\n        <div class=\"dropdown-inner\">\n          <prizm-icon class=\"breadcrumbs__chevron\" [size]=\"16\" iconClass=\"chevrons-right\"></prizm-icon>\n          <button class=\"dots-buttons\" (click)=\"isDropdownOpened = !isDropdownOpened\">...</button>\n        </div>\n      </prizm-dropdown-host>\n    </div>\n  </ng-container>\n</div>\n\n<div class=\"container container__fake\" #breadcrumbsFake>\n  <div class=\"breadcrumbs\" #breadcrumbsFake *ngFor=\"let breadcrumb of breadcrumbs$ | async; let i = index\">\n    <prizm-icon\n      class=\"breadcrumbs__chevron\"\n      *ngIf=\"i !== 0\"\n      [size]=\"16\"\n      iconClass=\"chevrons-right\"\n    ></prizm-icon>\n    <button class=\"breadcrumb\">\n      <prizm-icon\n        class=\"breadcrumb__icon\"\n        *ngIf=\"!!breadcrumb.icon\"\n        [size]=\"16\"\n        [iconClass]=\"breadcrumb.icon\"\n      ></prizm-icon>\n      <span class=\"breadcrumb__name\">{{ breadcrumb?.name }}</span>\n    </button>\n  </div>\n</div>\n\n<ng-template #dropdown>\n  <div class=\"dropdown-content\" *ngIf=\"breadcrumbsInMenu$ | async as breadcrumbsInMenu\">\n    <ng-container *ngFor=\"let breadcrumb of breadcrumbsInMenu; let i = index\">\n      <button class=\"dropdown-breadcrumb\" (click)=\"changeBreadcrumb(i + 1)\">\n        <prizm-icon\n          class=\"dropdown-breadcrumb__icon\"\n          *ngIf=\"!!breadcrumb.icon\"\n          [size]=\"16\"\n          [iconClass]=\"breadcrumb.icon\"\n        ></prizm-icon>\n        <span class=\"dropdown-breadcrumb__name\">{{ breadcrumb?.name }}</span>\n      </button>\n    </ng-container>\n  </div>\n</ng-template>\n", styles: ["button{border:none;outline:none;background:transparent;cursor:pointer}span{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}:host{height:100%;width:100%;display:flex;position:relative;overflow:hidden}:host .container{flex:1;display:flex;overflow:hidden}:host .container__fake{position:absolute;opacity:0;z-index:0;pointer-events:none}:host .container .breadcrumbs{display:flex;align-items:center}:host .container .breadcrumbs .dropdown-inner{display:flex}:host .container .breadcrumbs__chevron{display:flex;color:var(--prizm-v3-text-icon-tertiary)}:host .container .breadcrumbs__dots{display:flex;align-items:center}:host .container .breadcrumbs__dots button:hover,:host .container .breadcrumbs__dots button:focus{color:var(--prizm-v3-button-primary-solid-hover)}:host .container .breadcrumbs .breadcrumb{height:32px;padding:0 6px;display:flex;align-items:center;justify-content:center;gap:8px;border:2px solid transparent;border-radius:4px}:host .container .breadcrumbs .breadcrumb__name{font-weight:400;font-size:12px;line-height:16px;color:var(--prizm-v3-text-icon-tertiary)}:host .container .breadcrumbs .breadcrumb__icon{height:32px;display:flex;align-items:center;justify-content:center;color:var(--prizm-v3-text-icon-tertiary)}:host .container .breadcrumbs .breadcrumb_active{cursor:auto}:host .container .breadcrumbs .breadcrumb_active .breadcrumb__name,:host .container .breadcrumbs .breadcrumb_active .breadcrumb__icon{color:var(--prizm-v3-text-icon-primary)}:host .container .breadcrumbs .breadcrumb:hover:not(.breadcrumb_active) .breadcrumb__name,:host .container .breadcrumbs .breadcrumb:hover:not(.breadcrumb_active) .breadcrumb__icon{color:var(--prizm-v3-button-primary-solid-hover);transition:.4s}:host .container .breadcrumbs .breadcrumb:focus:not(.breadcrumb_active){border-color:var(--prizm-v3-background-stroke-focus)}.dropdown-content{padding:8px 0;display:flex;flex-direction:column;background:var(--prizm-v3-background-fill-overlay)}.dropdown-content .dropdown-breadcrumb{height:32px;min-width:32px;max-width:210px;padding:0 8px;display:flex;align-items:center;gap:8px}.dropdown-content .dropdown-breadcrumb__name{height:24px;display:flex;align-items:center;font-weight:400;font-size:14px;line-height:16px;color:var(--prizm-v3-text-icon-secondary)}.dropdown-content .dropdown-breadcrumb__icon{height:32px;display:flex;align-items:center;justify-content:center;color:var(--prizm-v3-text-icon-secondary)}.dropdown-content .dropdown-breadcrumb:hover,.dropdown-content .dropdown-breadcrumb:focus{background:var(--prizm-v3-table-fill-row-hover)}.dots-buttons{color:var(--prizm-v3-text-icon-tertiary)}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }, { type: i1.PrizmDestroyService }]; }, propDecorators: { breadcrumbs: [{
                type: Input
            }], breadcrumbChange: [{
                type: Output
            }], containerRef: [{
                type: ViewChild,
                args: ['container', { static: true }]
            }], fakeBreadcrumbContainer: [{
                type: ViewChild,
                args: ['breadcrumbsFake', { static: true }]
            }], breadcrumbsList: [{
                type: ViewChildren,
                args: ['breadcrumb', { read: ElementRef }]
            }], breadcrumbsItem: [{
                type: ContentChildren,
                args: [PrizmBreadcrumbDirective]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnJlYWRjcnVtYnMuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9jb21wb25lbnRzL3NyYy9saWIvY29tcG9uZW50cy9icmVhZGNydW1icy9icmVhZGNydW1icy5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL2NvbXBvbmVudHMvc3JjL2xpYi9jb21wb25lbnRzL2JyZWFkY3J1bWJzL2JyZWFkY3J1bWJzLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFTCx1QkFBdUIsRUFDdkIsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxlQUFlLEVBQ2YsVUFBVSxFQUNWLFlBQVksRUFDWixLQUFLLEVBR0wsTUFBTSxFQUNOLFNBQVMsRUFDVCxTQUFTLEVBQ1QsWUFBWSxHQUNiLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxlQUFlLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNoRixPQUFPLEVBQUUsbUJBQW1CLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUM3RSxPQUFPLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDakUsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDbkUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDMUMsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sNEJBQTRCLENBQUM7Ozs7OztBQWdCckUsTUFBTSxPQUFPLHlCQUNYLFNBQVEsbUJBQW1CO0lB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QUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3hHO2FBQU07WUFDTCxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ2pDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7U0FDM0M7SUFDSCxDQUFDOzhHQXpHVSx5QkFBeUI7a0dBQXpCLHlCQUF5QiwySkFUekIsQ0FBQyxtQkFBbUIsQ0FBQywwREE0QmYsd0JBQXdCLCtVQUZMLFVBQVUsb0RDekRoRCwyaUhBcUdBLDhuRkRuRUksWUFBWTtnQkFDWixrREFBa0Q7Z0JBQ2xELGVBQWUseUlBQ2YsdUJBQXVCOzsyRkFHZCx5QkFBeUI7a0JBZHJDLFNBQVM7K0JBQ0UsbUJBQW1CLG1CQUdaLHVCQUF1QixDQUFDLE1BQU0sYUFDcEMsQ0FBQyxtQkFBbUIsQ0FBQyxjQUNwQixJQUFJLFdBQ1A7d0JBQ1AsWUFBWTt3QkFDWixrREFBa0Q7d0JBQ2xELGVBQWU7d0JBQ2YsdUJBQXVCO3FCQUN4QjswSUFNWSxXQUFXO3NCQUF2QixLQUFLO2dCQVVXLGdCQUFnQjtzQkFBaEMsTUFBTTtnQkFDMEMsWUFBWTtzQkFBNUQsU0FBUzt1QkFBQyxXQUFXLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO2dCQUNlLHVCQUF1QjtzQkFBN0UsU0FBUzt1QkFBQyxpQkFBaUIsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7Z0JBQ1csZUFBZTtzQkFBdkUsWUFBWTt1QkFBQyxZQUFZLEVBQUUsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFO2dCQUVFLGVBQWU7c0JBQWhFLGVBQWU7dUJBQUMsd0JBQXdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIENvbnRlbnRDaGlsZHJlbixcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBJbnB1dCxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgUXVlcnlMaXN0LFxuICBWaWV3Q2hpbGQsXG4gIFZpZXdDaGlsZHJlbixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBJQnJlYWRjcnVtYiB9IGZyb20gJy4vYnJlYWRjcnVtYi5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgYW5pbWF0aW9uRnJhbWVTY2hlZHVsZXIsIEJlaGF2aW9yU3ViamVjdCwgbWVyZ2UsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFByaXptRGVzdHJveVNlcnZpY2UsIHByaXptRW1wdHlRdWVyeUxpc3QgfSBmcm9tICdAcHJpem0tdWkvaGVscGVycyc7XG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUsIG9ic2VydmVPbiwgdGFrZVVudGlsLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBQcml6bUFic3RyYWN0VGVzdElkIH0gZnJvbSAnLi4vLi4vYWJzdHJhY3QvaW50ZXJhY3RpdmUnO1xuaW1wb3J0IHsgUHJpem1CcmVhZGNydW1iRGlyZWN0aXZlIH0gZnJvbSAnLi9icmVhZGNydW1icy5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgQ29tbW9uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IFByaXptSWNvbk1vZHVsZSB9IGZyb20gJy4uL2ljb24nO1xuaW1wb3J0IHsgUHJpem1Ecm9wZG93bkhvc3RNb2R1bGUgfSBmcm9tICcuLi9kcm9wZG93bnMvZHJvcGRvd24taG9zdCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3ByaXptLWJyZWFkY3J1bWJzJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2JyZWFkY3J1bWJzLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vYnJlYWRjcnVtYnMuY29tcG9uZW50Lmxlc3MnXSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIHByb3ZpZGVyczogW1ByaXptRGVzdHJveVNlcnZpY2VdLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbXG4gICAgQ29tbW9uTW9kdWxlLFxuICAgIC8vIFRPRE8gIW5nMTYgY2hhbmdlIGFsbCBpY29uIG1vZHVsZSB0byBzdmcgbW9kdWxlXG4gICAgUHJpem1JY29uTW9kdWxlLFxuICAgIFByaXptRHJvcGRvd25Ib3N0TW9kdWxlLFxuICBdLFxufSlcbmV4cG9ydCBjbGFzcyBQcml6bUJyZWFkY3J1bWJzQ29tcG9uZW50PEJyZWFkY3J1bWIgZXh0ZW5kcyBJQnJlYWRjcnVtYj5cbiAgZXh0ZW5kcyBQcml6bUFic3RyYWN0VGVzdElkXG4gIGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3ksIEFmdGVyVmlld0luaXRcbntcbiAgQElucHV0KCkgc2V0IGJyZWFkY3J1bWJzKGRhdGE6IEJyZWFkY3J1bWJbXSkge1xuICAgIHRoaXMuYnJlYWRjcnVtYnMkLm5leHQoZGF0YSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGJyZWFkY3J1bWJzKCk6IEJyZWFkY3J1bWJbXSB7XG4gICAgcmV0dXJuIHRoaXMuYnJlYWRjcnVtYnMkLmdldFZhbHVlKCk7XG4gIH1cblxuICBvdmVycmlkZSByZWFkb25seSB0ZXN0SWRfID0gJ3VpX2JyZWFkY3J1bWJzJztcblxuICBAT3V0cHV0KCkgcHVibGljIGJyZWFkY3J1bWJDaGFuZ2U6IEV2ZW50RW1pdHRlcjxCcmVhZGNydW1iPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQFZpZXdDaGlsZCgnY29udGFpbmVyJywgeyBzdGF0aWM6IHRydWUgfSkgcHVibGljIGNvbnRhaW5lclJlZiE6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoJ2JyZWFkY3J1bWJzRmFrZScsIHsgc3RhdGljOiB0cnVlIH0pIHB1YmxpYyBmYWtlQnJlYWRjcnVtYkNvbnRhaW5lciE6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGRyZW4oJ2JyZWFkY3J1bWInLCB7IHJlYWQ6IEVsZW1lbnRSZWYgfSkgcHVibGljIGJyZWFkY3J1bWJzTGlzdDogUXVlcnlMaXN0PEVsZW1lbnRSZWY+ID1cbiAgICBwcml6bUVtcHR5UXVlcnlMaXN0KCk7XG4gIEBDb250ZW50Q2hpbGRyZW4oUHJpem1CcmVhZGNydW1iRGlyZWN0aXZlKSBwdWJsaWMgYnJlYWRjcnVtYnNJdGVtOiBRdWVyeUxpc3Q8UHJpem1CcmVhZGNydW1iRGlyZWN0aXZlPiA9XG4gICAgcHJpem1FbXB0eVF1ZXJ5TGlzdCgpO1xuXG4gIHB1YmxpYyBicmVhZGNydW1icyQ6IEJlaGF2aW9yU3ViamVjdDxCcmVhZGNydW1iW10+ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxCcmVhZGNydW1iW10+KFtdKTtcbiAgcHVibGljIGJyZWFkY3J1bWJzVG9TaG93JDogQmVoYXZpb3JTdWJqZWN0PEJyZWFkY3J1bWJbXT4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0PEJyZWFkY3J1bWJbXT4oW10pO1xuICBwdWJsaWMgYnJlYWRjcnVtYnNJbk1lbnUkOiBCZWhhdmlvclN1YmplY3Q8QnJlYWRjcnVtYltdPiA9IG5ldyBCZWhhdmlvclN1YmplY3Q8QnJlYWRjcnVtYltdPihbXSk7XG5cbiAgcHVibGljIGlzRHJvcGRvd25PcGVuZWQgPSBmYWxzZTtcbiAgcHVibGljIGlzQ29udGFpbmVyT3ZlcmZsb3dlZCA9IGZhbHNlO1xuICBwdWJsaWMgYnJlYWRjcnVtYnNFbGVtZW50c1dpZHRoITogbnVtYmVyO1xuXG4gIHB1YmxpYyBnZXQgYWN0aXZlQnJlYWRjcnVtYklkeCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmJyZWFkY3J1bWJzVG9TaG93JC5nZXRWYWx1ZSgpLmxlbmd0aCAtIDE7XG4gIH1cblxuICBwcml2YXRlIHJlc2l6ZU9ic2VydmVyITogUmVzaXplT2JzZXJ2ZXI7XG4gIHByaXZhdGUgbXV0YXRpb25EZXRlY3RvciQ6IFN1YmplY3Q8dm9pZD4gPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgY2RSZWY6IENoYW5nZURldGVjdG9yUmVmLCBwcml2YXRlIHJlYWRvbmx5IGRlc3Ryb3k6IFByaXptRGVzdHJveVNlcnZpY2UpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgcHVibGljIGNoYW5nZUJyZWFkY3J1bWIoaWR4OiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLmJyZWFkY3J1bWJzID0gdGhpcy5icmVhZGNydW1icy5maWx0ZXIoKGl0ZW0sIGkpID0+IGkgPD0gaWR4KTtcbiAgICB0aGlzLmJyZWFkY3J1bWJDaGFuZ2UuZW1pdCh0aGlzLmJyZWFkY3J1bWJzW2lkeF0pO1xuICB9XG5cbiAgcHVibGljIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMucmVzaXplT2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoKCkgPT4gdGhpcy5tdXRhdGlvbkRldGVjdG9yJC5uZXh0KCkpO1xuICAgIHRoaXMucmVzaXplT2JzZXJ2ZXIub2JzZXJ2ZSh0aGlzLmNvbnRhaW5lclJlZi5uYXRpdmVFbGVtZW50KTtcbiAgfVxuXG4gIHB1YmxpYyBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XG4gICAgY29uc3QgJG11dGF0aW9uID0gdGhpcy5tdXRhdGlvbkRldGVjdG9yJC5waXBlKFxuICAgICAgZGVib3VuY2VUaW1lKDIwMCksXG4gICAgICBvYnNlcnZlT24oYW5pbWF0aW9uRnJhbWVTY2hlZHVsZXIpLFxuICAgICAgdGFwKCgpID0+IHtcbiAgICAgICAgdGhpcy5jYWxjdWxhdGVPdmVyZmxvd1N0YXRlKCk7XG4gICAgICAgIHRoaXMuc2V0Vmlld0JyZWFkY3J1bWJzKHRoaXMuYnJlYWRjcnVtYnMpO1xuICAgICAgfSlcbiAgICApO1xuXG4gICAgY29uc3QgJGJyZWFkY3J1bWJzQ2hhbmdlID0gdGhpcy5icmVhZGNydW1icyQucGlwZShcbiAgICAgIGRlYm91bmNlVGltZSgyMDApLFxuICAgICAgb2JzZXJ2ZU9uKGFuaW1hdGlvbkZyYW1lU2NoZWR1bGVyKSxcbiAgICAgIHRhcChpdGVtID0+IHtcbiAgICAgICAgdGhpcy5jYWxjdWxhdGVCcmVhZGNydW1ic1dpZHRoKCk7XG4gICAgICAgIHRoaXMuY2FsY3VsYXRlT3ZlcmZsb3dTdGF0ZSgpO1xuICAgICAgICB0aGlzLnNldFZpZXdCcmVhZGNydW1icyhpdGVtKTtcbiAgICAgIH0pXG4gICAgKTtcblxuICAgIG1lcmdlKCRicmVhZGNydW1ic0NoYW5nZSwgJG11dGF0aW9uKVxuICAgICAgLnBpcGUoZGVib3VuY2VUaW1lKDIwMCksIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kpKVxuICAgICAgLnN1YnNjcmliZSgoKSA9PiB0aGlzLmNkUmVmLmRldGVjdENoYW5nZXMoKSk7XG4gIH1cblxuICBwdWJsaWMgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5yZXNpemVPYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgdGhpcy5tdXRhdGlvbkRldGVjdG9yJC5jb21wbGV0ZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVPdmVyZmxvd1N0YXRlKCk6IHZvaWQge1xuICAgIGNvbnN0IGNvbnRhaW5lcldpZHRoID0gdGhpcy5jb250YWluZXJSZWYubmF0aXZlRWxlbWVudC5jbGllbnRXaWR0aDtcbiAgICBjb25zdCBjb250ZW50V2lkdGggPSB0aGlzLmJyZWFkY3J1bWJzRWxlbWVudHNXaWR0aDtcblxuICAgIGlmIChjb250ZW50V2lkdGggPiBjb250YWluZXJXaWR0aCkge1xuICAgICAgdGhpcy5pc0NvbnRhaW5lck92ZXJmbG93ZWQgPSB0aGlzLmJyZWFkY3J1bWJzLmxlbmd0aCA+IDI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaXNEcm9wZG93bk9wZW5lZCA9IGZhbHNlO1xuICAgICAgdGhpcy5pc0NvbnRhaW5lck92ZXJmbG93ZWQgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZUJyZWFkY3J1bWJzV2lkdGgoKTogdm9pZCB7XG4gICAgdGhpcy5icmVhZGNydW1ic0VsZW1lbnRzV2lkdGggPSB0aGlzLmZha2VCcmVhZGNydW1iQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuY2xpZW50V2lkdGg7XG4gIH1cblxuICBwcml2YXRlIHNldFZpZXdCcmVhZGNydW1icyhicmVhZGNydW1iczogQnJlYWRjcnVtYltdKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaXNDb250YWluZXJPdmVyZmxvd2VkKSB7XG4gICAgICB0aGlzLmJyZWFkY3J1bWJzSW5NZW51JC5uZXh0KGJyZWFkY3J1bWJzLmZpbHRlcigoaXRlbSwgaSkgPT4gaSA+IDAgJiYgaSA8IGJyZWFkY3J1bWJzLmxlbmd0aCAtIDEpKTtcbiAgICAgIHRoaXMuYnJlYWRjcnVtYnNUb1Nob3ckLm5leHQoYnJlYWRjcnVtYnMuZmlsdGVyKChpdGVtLCBpKSA9PiBpID09PSAwIHx8IGkgPT09IGJyZWFkY3J1bWJzLmxlbmd0aCAtIDEpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5icmVhZGNydW1ic0luTWVudSQubmV4dChbXSk7XG4gICAgICB0aGlzLmJyZWFkY3J1bWJzVG9TaG93JC5uZXh0KGJyZWFkY3J1bWJzKTtcbiAgICB9XG4gIH1cbn1cbiIsIjxkaXYgY2xhc3M9XCJjb250YWluZXJcIiAjY29udGFpbmVyPlxuICA8ZGl2IGNsYXNzPVwiYnJlYWRjcnVtYnNcIiAqbmdGb3I9XCJsZXQgaXRlbSBvZiBicmVhZGNydW1ic0l0ZW07IGxldCBpID0gaW5kZXhcIj5cbiAgICA8cHJpem0taWNvblxuICAgICAgY2xhc3M9XCJicmVhZGNydW1ic19fY2hldnJvblwiXG4gICAgICAqbmdJZj1cImkgIT09IDBcIlxuICAgICAgW3NpemVdPVwiMTZcIlxuICAgICAgaWNvbkNsYXNzPVwiY2hldnJvbnMtcmlnaHRcIlxuICAgID48L3ByaXptLWljb24+XG5cbiAgICA8ZGl2IGNsYXNzPVwiYnJlYWRjcnVtYiBicmVhZGNydW1iX19uYW1lXCI+XG4gICAgICA8bmctY29udGFpbmVyIFtuZ1RlbXBsYXRlT3V0bGV0XT1cIml0ZW0udGVtcGxhdGVcIiBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwieyBpZHg6IGkgfVwiPjwvbmctY29udGFpbmVyPlxuICAgIDwvZGl2PlxuXG4gICAgPHByaXptLWRyb3Bkb3duLWhvc3RcbiAgICAgIGNsYXNzPVwiYnJlYWRjcnVtYnNfX2RvdHNcIlxuICAgICAgKm5nSWY9XCJpID09PSAwICYmIHRoaXMuaXNDb250YWluZXJPdmVyZmxvd2VkXCJcbiAgICAgIFsoaXNPcGVuKV09XCJpc0Ryb3Bkb3duT3BlbmVkXCJcbiAgICAgIFtjb250ZW50XT1cImRyb3Bkb3duXCJcbiAgICAgIHByaXptRHJvcGRvd25Ib3N0V2lkdGg9XCJhdXRvXCJcbiAgICA+XG4gICAgICA8ZGl2IGNsYXNzPVwiZHJvcGRvd24taW5uZXJcIj5cbiAgICAgICAgPHByaXptLWljb24gY2xhc3M9XCJicmVhZGNydW1ic19fY2hldnJvblwiIFtzaXplXT1cIjE2XCIgaWNvbkNsYXNzPVwiY2hldnJvbnMtcmlnaHRcIj48L3ByaXptLWljb24+XG4gICAgICAgIDxidXR0b24gY2xhc3M9XCJkb3RzLWJ1dHRvbnNcIiAoY2xpY2spPVwiaXNEcm9wZG93bk9wZW5lZCA9ICFpc0Ryb3Bkb3duT3BlbmVkXCI+Li4uPC9idXR0b24+XG4gICAgICA8L2Rpdj5cbiAgICA8L3ByaXptLWRyb3Bkb3duLWhvc3Q+XG4gIDwvZGl2PlxuXG4gIDxuZy1jb250YWluZXI+XG4gICAgPGRpdiBjbGFzcz1cImJyZWFkY3J1bWJzXCIgI2JyZWFkY3J1bWIgKm5nRm9yPVwibGV0IGJyZWFkY3J1bWIgb2YgYnJlYWRjcnVtYnNUb1Nob3ckIHwgYXN5bmM7IGxldCBpID0gaW5kZXhcIj5cbiAgICAgIDxwcml6bS1pY29uXG4gICAgICAgIGNsYXNzPVwiYnJlYWRjcnVtYnNfX2NoZXZyb25cIlxuICAgICAgICAqbmdJZj1cImkgIT09IDBcIlxuICAgICAgICBbc2l6ZV09XCIxNlwiXG4gICAgICAgIGljb25DbGFzcz1cImNoZXZyb25zLXJpZ2h0XCJcbiAgICAgID48L3ByaXptLWljb24+XG5cbiAgICAgIDxidXR0b25cbiAgICAgICAgY2xhc3M9XCJicmVhZGNydW1iXCJcbiAgICAgICAgW2NsYXNzLmJyZWFkY3J1bWJfYWN0aXZlXT1cImkgPT09IGFjdGl2ZUJyZWFkY3J1bWJJZHhcIlxuICAgICAgICAoY2xpY2spPVwiY2hhbmdlQnJlYWRjcnVtYihpKVwiXG4gICAgICA+XG4gICAgICAgIDxwcml6bS1pY29uXG4gICAgICAgICAgY2xhc3M9XCJicmVhZGNydW1iX19pY29uXCJcbiAgICAgICAgICAqbmdJZj1cImJyZWFkY3J1bWIuaWNvblwiXG4gICAgICAgICAgW3NpemVdPVwiMTZcIlxuICAgICAgICAgIFtpY29uQ2xhc3NdPVwiYnJlYWRjcnVtYi5pY29uXCJcbiAgICAgICAgPjwvcHJpem0taWNvbj5cbiAgICAgICAgPHNwYW4gY2xhc3M9XCJicmVhZGNydW1iX19uYW1lXCIgKm5nSWY9XCJicmVhZGNydW1iLm5hbWVcIj57eyBicmVhZGNydW1iLm5hbWUgfX08L3NwYW4+XG4gICAgICA8L2J1dHRvbj5cblxuICAgICAgPHByaXptLWRyb3Bkb3duLWhvc3RcbiAgICAgICAgY2xhc3M9XCJicmVhZGNydW1ic19fZG90c1wiXG4gICAgICAgICpuZ0lmPVwiaSA9PT0gMCAmJiB0aGlzLmlzQ29udGFpbmVyT3ZlcmZsb3dlZFwiXG4gICAgICAgIFsoaXNPcGVuKV09XCJpc0Ryb3Bkb3duT3BlbmVkXCJcbiAgICAgICAgW2NvbnRlbnRdPVwiZHJvcGRvd25cIlxuICAgICAgICBwcml6bURyb3Bkb3duSG9zdFdpZHRoPVwiYXV0b1wiXG4gICAgICA+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJkcm9wZG93bi1pbm5lclwiPlxuICAgICAgICAgIDxwcml6bS1pY29uIGNsYXNzPVwiYnJlYWRjcnVtYnNfX2NoZXZyb25cIiBbc2l6ZV09XCIxNlwiIGljb25DbGFzcz1cImNoZXZyb25zLXJpZ2h0XCI+PC9wcml6bS1pY29uPlxuICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJkb3RzLWJ1dHRvbnNcIiAoY2xpY2spPVwiaXNEcm9wZG93bk9wZW5lZCA9ICFpc0Ryb3Bkb3duT3BlbmVkXCI+Li4uPC9idXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9wcml6bS1kcm9wZG93bi1ob3N0PlxuICAgIDwvZGl2PlxuICA8L25nLWNvbnRhaW5lcj5cbjwvZGl2PlxuXG48ZGl2IGNsYXNzPVwiY29udGFpbmVyIGNvbnRhaW5lcl9fZmFrZVwiICNicmVhZGNydW1ic0Zha2U+XG4gIDxkaXYgY2xhc3M9XCJicmVhZGNydW1ic1wiICNicmVhZGNydW1ic0Zha2UgKm5nRm9yPVwibGV0IGJyZWFkY3J1bWIgb2YgYnJlYWRjcnVtYnMkIHwgYXN5bmM7IGxldCBpID0gaW5kZXhcIj5cbiAgICA8cHJpem0taWNvblxuICAgICAgY2xhc3M9XCJicmVhZGNydW1ic19fY2hldnJvblwiXG4gICAgICAqbmdJZj1cImkgIT09IDBcIlxuICAgICAgW3NpemVdPVwiMTZcIlxuICAgICAgaWNvbkNsYXNzPVwiY2hldnJvbnMtcmlnaHRcIlxuICAgID48L3ByaXptLWljb24+XG4gICAgPGJ1dHRvbiBjbGFzcz1cImJyZWFkY3J1bWJcIj5cbiAgICAgIDxwcml6bS1pY29uXG4gICAgICAgIGNsYXNzPVwiYnJlYWRjcnVtYl9faWNvblwiXG4gICAgICAgICpuZ0lmPVwiISFicmVhZGNydW1iLmljb25cIlxuICAgICAgICBbc2l6ZV09XCIxNlwiXG4gICAgICAgIFtpY29uQ2xhc3NdPVwiYnJlYWRjcnVtYi5pY29uXCJcbiAgICAgID48L3ByaXptLWljb24+XG4gICAgICA8c3BhbiBjbGFzcz1cImJyZWFkY3J1bWJfX25hbWVcIj57eyBicmVhZGNydW1iPy5uYW1lIH19PC9zcGFuPlxuICAgIDwvYnV0dG9uPlxuICA8L2Rpdj5cbjwvZGl2PlxuXG48bmctdGVtcGxhdGUgI2Ryb3Bkb3duPlxuICA8ZGl2IGNsYXNzPVwiZHJvcGRvd24tY29udGVudFwiICpuZ0lmPVwiYnJlYWRjcnVtYnNJbk1lbnUkIHwgYXN5bmMgYXMgYnJlYWRjcnVtYnNJbk1lbnVcIj5cbiAgICA8bmctY29udGFpbmVyICpuZ0Zvcj1cImxldCBicmVhZGNydW1iIG9mIGJyZWFkY3J1bWJzSW5NZW51OyBsZXQgaSA9IGluZGV4XCI+XG4gICAgICA8YnV0dG9uIGNsYXNzPVwiZHJvcGRvd24tYnJlYWRjcnVtYlwiIChjbGljayk9XCJjaGFuZ2VCcmVhZGNydW1iKGkgKyAxKVwiPlxuICAgICAgICA8cHJpem0taWNvblxuICAgICAgICAgIGNsYXNzPVwiZHJvcGRvd24tYnJlYWRjcnVtYl9faWNvblwiXG4gICAgICAgICAgKm5nSWY9XCIhIWJyZWFkY3J1bWIuaWNvblwiXG4gICAgICAgICAgW3NpemVdPVwiMTZcIlxuICAgICAgICAgIFtpY29uQ2xhc3NdPVwiYnJlYWRjcnVtYi5pY29uXCJcbiAgICAgICAgPjwvcHJpem0taWNvbj5cbiAgICAgICAgPHNwYW4gY2xhc3M9XCJkcm9wZG93bi1icmVhZGNydW1iX19uYW1lXCI+e3sgYnJlYWRjcnVtYj8ubmFtZSB9fTwvc3Bhbj5cbiAgICAgIDwvYnV0dG9uPlxuICAgIDwvbmctY29udGFpbmVyPlxuICA8L2Rpdj5cbjwvbmctdGVtcGxhdGU+XG4iXX0=