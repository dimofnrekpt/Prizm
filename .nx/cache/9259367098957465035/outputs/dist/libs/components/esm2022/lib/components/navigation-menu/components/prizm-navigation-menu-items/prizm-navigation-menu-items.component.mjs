import { Component, ChangeDetectionStrategy, Input, TemplateRef, Output, EventEmitter, ChangeDetectorRef, ViewChildren, QueryList, Inject, } from '@angular/core';
import { PrizmNavigationMenuItemComponent } from '../prizm-navigation-menu-item/prizm-navigation-menu-item.component';
import { findItem } from '../../helpers/prizm-navigation-menu-items-helpers';
import { PRIZM_NAVIGATION_MENU_CHILDREN_HANDLER } from '../../tokens';
import { PrizmAbstractTestId } from '@prizm-ui/core';
import { PrizmTreeModule } from '../../../tree';
import { NgFor } from '@angular/common';
import { prizmEmptyQueryList } from '@prizm-ui/helpers';
import * as i0 from "@angular/core";
import * as i1 from "../../../tree/components/tree/tree.component";
import * as i2 from "../../../tree/directives/tree-children.directive";
import * as i3 from "../../../tree/directives/tree-controller.directive";
export class PrizmNavigationMenuItemsComponent extends PrizmAbstractTestId {
    get menuItemsChildrenHandler() {
        return this.childrenHandler || this.childrenHandlerToken;
    }
    constructor(childrenHandlerToken, cdr) {
        super();
        this.childrenHandlerToken = childrenHandlerToken;
        this.cdr = cdr;
        this.menuItemsList = prizmEmptyQueryList();
        this.itemExpandedChanged = new EventEmitter();
        this.activeItemChanged = new EventEmitter();
        this.goToRootItem = new EventEmitter();
        this.goToParentItem = new EventEmitter();
        this.expandedItemsMap = new Map();
        this.testId_ = 'ui_navigation_menu_items';
    }
    handleInteraction(item, treeCtrl) {
        if (item.isGroup) {
            treeCtrl.toggleByItemValue(item);
        }
        else {
            this.activeItemChanged.emit(item);
        }
    }
    handleExpandedChanged({ value, isExpanded, }) {
        this.itemExpandedChanged.emit({
            item: value,
            isExpanded,
        });
    }
    getItemIsExpanded(item) {
        return this.expandedItemsMap.get(item) ?? false;
    }
    getItemIsActive(item) {
        if (item === this.activeItem)
            return true;
        if (!this.getItemIsExpanded(item) && item.children && this.mode !== 'rubricator') {
            const anyActiveChild = findItem(item.children, item => item === this.activeItem);
            return !!anyActiveChild;
        }
        return false;
    }
    triggerCdr() {
        this.cdr.markForCheck();
        this.menuItemsList?.forEach(itemComponent => itemComponent.cdr.markForCheck());
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.8", ngImport: i0, type: PrizmNavigationMenuItemsComponent, deps: [{ token: PRIZM_NAVIGATION_MENU_CHILDREN_HANDLER }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.8", type: PrizmNavigationMenuItemsComponent, isStandalone: true, selector: "prizm-navigation-menu-items", inputs: { items: "items", mode: "mode", activeItem: "activeItem", itemExtraTemplate: "itemExtraTemplate", expandedItemsMap: "expandedItemsMap", childrenHandler: "childrenHandler" }, outputs: { itemExpandedChanged: "itemExpandedChanged", activeItemChanged: "activeItemChanged", goToRootItem: "goToRootItem", goToParentItem: "goToParentItem" }, viewQueries: [{ propertyName: "menuItemsList", predicate: PrizmNavigationMenuItemComponent, descendants: true }], usesInheritance: true, ngImport: i0, template: "<prizm-tree\n  #treeCtrl=\"prizmTreeController\"\n  *ngFor=\"let item of items\"\n  [prizmTreeController]=\"false\"\n  [map]=\"expandedItemsMap\"\n  [content]=\"content\"\n  [value]=\"item\"\n  [childrenHandler]=\"menuItemsChildrenHandler\"\n  (expandedChanged)=\"handleExpandedChanged($event)\"\n>\n  <ng-template #content let-item>\n    <prizm-navigation-menu-item\n      [item]=\"item\"\n      [mode]=\"mode\"\n      [itemExtraTemplate]=\"itemExtraTemplate\"\n      [isActive]=\"getItemIsActive(item)\"\n      [isExpandable]=\"menuItemsChildrenHandler(item).length > 0\"\n      [isExpanded]=\"getItemIsExpanded(item)\"\n      (toggleExpanded)=\"treeCtrl.toggleByItemValue($event)\"\n      (interaction)=\"handleInteraction($event, treeCtrl)\"\n      (goToParentItem)=\"goToParentItem.emit($event)\"\n      (goToRootItem)=\"goToRootItem.emit($event)\"\n    ></prizm-navigation-menu-item>\n  </ng-template>\n</prizm-tree>\n", styles: [":host ::ng-deep prizm-tree>prizm-tree-item>.prizm-tree-item__dynamic-content,:host ::ng-deep prizm-tree>prizm-tree-item>.prizm-tree-item__dynamic-content>prizm-tree-item-content,:host ::ng-deep prizm-tree>prizm-tree-item>prizm-expand{margin:0!important;padding:0!important}:host ::ng-deep prizm-tree prizm-tree-item-content>button[prizmiconbutton]{display:none}.prizm-menu-item-content{display:flex;flex:1;align-items:center;height:100%;width:calc(100% - var(--expand-item-width))}.prizm-menu-item-content__icon{flex-basis:24px;padding-left:8px}.prizm-menu-item-content__text{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;flex:1;padding:0 8px;outline:none}.prizm-menu-item-content__text_has-action{cursor:pointer}\n"], dependencies: [{ kind: "ngmodule", type: PrizmTreeModule }, { kind: "component", type: i1.PrizmTreeComponent, selector: "prizm-tree[value]", inputs: ["value", "usePaddingIndent", "content"], exportAs: ["prizmTree"] }, { kind: "directive", type: i2.PrizmTreeChildrenDirective, selector: "prizm-tree[childrenHandler]", inputs: ["childrenHandler"] }, { kind: "directive", type: i3.PrizmTreeControllerDirective, selector: "[prizmTreeController][map]", inputs: ["prizmTreeController", "map"], outputs: ["toggled", "expandedChanged"], exportAs: ["prizmTreeController"] }, { kind: "directive", type: NgFor, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "component", type: PrizmNavigationMenuItemComponent, selector: "prizm-navigation-menu-item", inputs: ["itemExtraTemplate", "isExpandable", "isExpanded", "isActive", "item", "mode", "showGoToButtons"], outputs: ["interaction", "toggleExpanded", "goToParentItem", "goToRootItem"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.8", ngImport: i0, type: PrizmNavigationMenuItemsComponent, decorators: [{
            type: Component,
            args: [{ selector: 'prizm-navigation-menu-items', changeDetection: ChangeDetectionStrategy.OnPush, standalone: true, imports: [PrizmTreeModule, NgFor, PrizmNavigationMenuItemComponent], template: "<prizm-tree\n  #treeCtrl=\"prizmTreeController\"\n  *ngFor=\"let item of items\"\n  [prizmTreeController]=\"false\"\n  [map]=\"expandedItemsMap\"\n  [content]=\"content\"\n  [value]=\"item\"\n  [childrenHandler]=\"menuItemsChildrenHandler\"\n  (expandedChanged)=\"handleExpandedChanged($event)\"\n>\n  <ng-template #content let-item>\n    <prizm-navigation-menu-item\n      [item]=\"item\"\n      [mode]=\"mode\"\n      [itemExtraTemplate]=\"itemExtraTemplate\"\n      [isActive]=\"getItemIsActive(item)\"\n      [isExpandable]=\"menuItemsChildrenHandler(item).length > 0\"\n      [isExpanded]=\"getItemIsExpanded(item)\"\n      (toggleExpanded)=\"treeCtrl.toggleByItemValue($event)\"\n      (interaction)=\"handleInteraction($event, treeCtrl)\"\n      (goToParentItem)=\"goToParentItem.emit($event)\"\n      (goToRootItem)=\"goToRootItem.emit($event)\"\n    ></prizm-navigation-menu-item>\n  </ng-template>\n</prizm-tree>\n", styles: [":host ::ng-deep prizm-tree>prizm-tree-item>.prizm-tree-item__dynamic-content,:host ::ng-deep prizm-tree>prizm-tree-item>.prizm-tree-item__dynamic-content>prizm-tree-item-content,:host ::ng-deep prizm-tree>prizm-tree-item>prizm-expand{margin:0!important;padding:0!important}:host ::ng-deep prizm-tree prizm-tree-item-content>button[prizmiconbutton]{display:none}.prizm-menu-item-content{display:flex;flex:1;align-items:center;height:100%;width:calc(100% - var(--expand-item-width))}.prizm-menu-item-content__icon{flex-basis:24px;padding-left:8px}.prizm-menu-item-content__text{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;flex:1;padding:0 8px;outline:none}.prizm-menu-item-content__text_has-action{cursor:pointer}\n"] }]
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [PRIZM_NAVIGATION_MENU_CHILDREN_HANDLER]
                }] }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { menuItemsList: [{
                type: ViewChildren,
                args: [PrizmNavigationMenuItemComponent]
            }], itemExpandedChanged: [{
                type: Output
            }], activeItemChanged: [{
                type: Output
            }], goToRootItem: [{
                type: Output
            }], goToParentItem: [{
                type: Output
            }], items: [{
                type: Input
            }], mode: [{
                type: Input
            }], activeItem: [{
                type: Input
            }], itemExtraTemplate: [{
                type: Input
            }], expandedItemsMap: [{
                type: Input
            }], childrenHandler: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJpem0tbmF2aWdhdGlvbi1tZW51LWl0ZW1zLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvY29tcG9uZW50cy9zcmMvbGliL2NvbXBvbmVudHMvbmF2aWdhdGlvbi1tZW51L2NvbXBvbmVudHMvcHJpem0tbmF2aWdhdGlvbi1tZW51LWl0ZW1zL3ByaXptLW5hdmlnYXRpb24tbWVudS1pdGVtcy5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL2NvbXBvbmVudHMvc3JjL2xpYi9jb21wb25lbnRzL25hdmlnYXRpb24tbWVudS9jb21wb25lbnRzL3ByaXptLW5hdmlnYXRpb24tbWVudS1pdGVtcy9wcml6bS1uYXZpZ2F0aW9uLW1lbnUtaXRlbXMuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCx1QkFBdUIsRUFDdkIsS0FBSyxFQUNMLFdBQVcsRUFDWCxNQUFNLEVBQ04sWUFBWSxFQUNaLGlCQUFpQixFQUNqQixZQUFZLEVBQ1osU0FBUyxFQUNULE1BQU0sR0FDUCxNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUsZ0NBQWdDLEVBQUUsTUFBTSxvRUFBb0UsQ0FBQztBQUN0SCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sbURBQW1ELENBQUM7QUFDN0UsT0FBTyxFQUFFLHNDQUFzQyxFQUFzQyxNQUFNLGNBQWMsQ0FBQztBQUMxRyxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNyRCxPQUFPLEVBQWdDLGVBQWUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM5RSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDeEMsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7Ozs7O0FBVXhELE1BQU0sT0FBTyxp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O2dCQUVFLEtBQUs7c0JBQWIsS0FBSztnQkFDRyxJQUFJO3NCQUFaLEtBQUs7Z0JBQ0csVUFBVTtzQkFBbEIsS0FBSztnQkFDRyxpQkFBaUI7c0JBQXpCLEtBQUs7Z0JBQ0csZ0JBQWdCO3NCQUF4QixLQUFLO2dCQUlHLGVBQWU7c0JBQXZCLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBJbnB1dCxcbiAgVGVtcGxhdGVSZWYsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyLFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgVmlld0NoaWxkcmVuLFxuICBRdWVyeUxpc3QsXG4gIEluamVjdCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBJbnRlcm5hbFByaXptTmF2aWdhdGlvbk1lbnVJdGVtLCBWaWV3TW9kZSB9IGZyb20gJy4uLy4uL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgUHJpem1OYXZpZ2F0aW9uTWVudUl0ZW1Db21wb25lbnQgfSBmcm9tICcuLi9wcml6bS1uYXZpZ2F0aW9uLW1lbnUtaXRlbS9wcml6bS1uYXZpZ2F0aW9uLW1lbnUtaXRlbS5jb21wb25lbnQnO1xuaW1wb3J0IHsgZmluZEl0ZW0gfSBmcm9tICcuLi8uLi9oZWxwZXJzL3ByaXptLW5hdmlnYXRpb24tbWVudS1pdGVtcy1oZWxwZXJzJztcbmltcG9ydCB7IFBSSVpNX05BVklHQVRJT05fTUVOVV9DSElMRFJFTl9IQU5ETEVSLCBQcml6bU5hdmlnYXRpb25NZW51Q2hpbGRyZW5IYW5kbGVyIH0gZnJvbSAnLi4vLi4vdG9rZW5zJztcbmltcG9ydCB7IFByaXptQWJzdHJhY3RUZXN0SWQgfSBmcm9tICdAcHJpem0tdWkvY29yZSc7XG5pbXBvcnQgeyBQcml6bVRyZWVDb250cm9sbGVyRGlyZWN0aXZlLCBQcml6bVRyZWVNb2R1bGUgfSBmcm9tICcuLi8uLi8uLi90cmVlJztcbmltcG9ydCB7IE5nRm9yIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IHByaXptRW1wdHlRdWVyeUxpc3QgfSBmcm9tICdAcHJpem0tdWkvaGVscGVycyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3ByaXptLW5hdmlnYXRpb24tbWVudS1pdGVtcycsXG4gIHRlbXBsYXRlVXJsOiAnLi9wcml6bS1uYXZpZ2F0aW9uLW1lbnUtaXRlbXMuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9wcml6bS1uYXZpZ2F0aW9uLW1lbnUtaXRlbXMuY29tcG9uZW50Lmxlc3MnXSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIHN0YW5kYWxvbmU6IHRydWUsXG4gIGltcG9ydHM6IFtQcml6bVRyZWVNb2R1bGUsIE5nRm9yLCBQcml6bU5hdmlnYXRpb25NZW51SXRlbUNvbXBvbmVudF0sXG59KVxuZXhwb3J0IGNsYXNzIFByaXptTmF2aWdhdGlvbk1lbnVJdGVtc0NvbXBvbmVudDxcbiAgVCBleHRlbmRzIHsgY2hpbGRyZW4/OiB1bmtub3duW10gfVxuPiBleHRlbmRzIFByaXptQWJzdHJhY3RUZXN0SWQge1xuICBAVmlld0NoaWxkcmVuKFByaXptTmF2aWdhdGlvbk1lbnVJdGVtQ29tcG9uZW50KSBwcml2YXRlIG1lbnVJdGVtc0xpc3Q6IFF1ZXJ5TGlzdDxcbiAgICBQcml6bU5hdmlnYXRpb25NZW51SXRlbUNvbXBvbmVudDxUPlxuICA+ID0gcHJpem1FbXB0eVF1ZXJ5TGlzdCgpO1xuXG4gIEBPdXRwdXQoKSBpdGVtRXhwYW5kZWRDaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcjx7XG4gICAgaXRlbTogSW50ZXJuYWxQcml6bU5hdmlnYXRpb25NZW51SXRlbTxUPjtcbiAgICBpc0V4cGFuZGVkOiBib29sZWFuO1xuICB9PigpO1xuXG4gIEBPdXRwdXQoKSBhY3RpdmVJdGVtQ2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXI8SW50ZXJuYWxQcml6bU5hdmlnYXRpb25NZW51SXRlbTxUPj4oKTtcblxuICBAT3V0cHV0KCkgZ29Ub1Jvb3RJdGVtID0gbmV3IEV2ZW50RW1pdHRlcjxJbnRlcm5hbFByaXptTmF2aWdhdGlvbk1lbnVJdGVtPFQ+PigpO1xuXG4gIEBPdXRwdXQoKSBnb1RvUGFyZW50SXRlbSA9IG5ldyBFdmVudEVtaXR0ZXI8SW50ZXJuYWxQcml6bU5hdmlnYXRpb25NZW51SXRlbTxUPj4oKTtcblxuICBASW5wdXQoKSBpdGVtcyE6IEludGVybmFsUHJpem1OYXZpZ2F0aW9uTWVudUl0ZW08VD5bXTtcbiAgQElucHV0KCkgbW9kZSE6IFZpZXdNb2RlO1xuICBASW5wdXQoKSBhY3RpdmVJdGVtITogSW50ZXJuYWxQcml6bU5hdmlnYXRpb25NZW51SXRlbTxUPjtcbiAgQElucHV0KCkgaXRlbUV4dHJhVGVtcGxhdGUhOiBUZW1wbGF0ZVJlZjx1bmtub3duPjtcbiAgQElucHV0KCkgZXhwYW5kZWRJdGVtc01hcDogTWFwPEludGVybmFsUHJpem1OYXZpZ2F0aW9uTWVudUl0ZW08VD4sIGJvb2xlYW4+ID0gbmV3IE1hcDxcbiAgICBJbnRlcm5hbFByaXptTmF2aWdhdGlvbk1lbnVJdGVtPFQ+LFxuICAgIGJvb2xlYW5cbiAgPigpO1xuICBASW5wdXQoKSBjaGlsZHJlbkhhbmRsZXIhOiBQcml6bU5hdmlnYXRpb25NZW51Q2hpbGRyZW5IYW5kbGVyPFQ+O1xuXG4gIGdldCBtZW51SXRlbXNDaGlsZHJlbkhhbmRsZXIoKTogUHJpem1OYXZpZ2F0aW9uTWVudUNoaWxkcmVuSGFuZGxlcjxUPiB7XG4gICAgcmV0dXJuIHRoaXMuY2hpbGRyZW5IYW5kbGVyIHx8IHRoaXMuY2hpbGRyZW5IYW5kbGVyVG9rZW47XG4gIH1cbiAgb3ZlcnJpZGUgcmVhZG9ubHkgdGVzdElkXyA9ICd1aV9uYXZpZ2F0aW9uX21lbnVfaXRlbXMnO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIEBJbmplY3QoUFJJWk1fTkFWSUdBVElPTl9NRU5VX0NISUxEUkVOX0hBTkRMRVIpXG4gICAgcHJpdmF0ZSBjaGlsZHJlbkhhbmRsZXJUb2tlbjogUHJpem1OYXZpZ2F0aW9uTWVudUNoaWxkcmVuSGFuZGxlcjxUPixcbiAgICBwdWJsaWMgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZlxuICApIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgcHVibGljIGhhbmRsZUludGVyYWN0aW9uKFxuICAgIGl0ZW06IEludGVybmFsUHJpem1OYXZpZ2F0aW9uTWVudUl0ZW08VD4sXG4gICAgdHJlZUN0cmw6IFByaXptVHJlZUNvbnRyb2xsZXJEaXJlY3RpdmU8SW50ZXJuYWxQcml6bU5hdmlnYXRpb25NZW51SXRlbTxUPj5cbiAgKTogdm9pZCB7XG4gICAgaWYgKGl0ZW0uaXNHcm91cCkge1xuICAgICAgdHJlZUN0cmwudG9nZ2xlQnlJdGVtVmFsdWUoaXRlbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYWN0aXZlSXRlbUNoYW5nZWQuZW1pdChpdGVtKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgaGFuZGxlRXhwYW5kZWRDaGFuZ2VkKHtcbiAgICB2YWx1ZSxcbiAgICBpc0V4cGFuZGVkLFxuICB9OiB7XG4gICAgdmFsdWU6IEludGVybmFsUHJpem1OYXZpZ2F0aW9uTWVudUl0ZW08VD47XG4gICAgaXNFeHBhbmRlZDogYm9vbGVhbjtcbiAgfSk6IHZvaWQge1xuICAgIHRoaXMuaXRlbUV4cGFuZGVkQ2hhbmdlZC5lbWl0KHtcbiAgICAgIGl0ZW06IHZhbHVlLFxuICAgICAgaXNFeHBhbmRlZCxcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRJdGVtSXNFeHBhbmRlZChpdGVtOiBJbnRlcm5hbFByaXptTmF2aWdhdGlvbk1lbnVJdGVtPFQ+KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZXhwYW5kZWRJdGVtc01hcC5nZXQoaXRlbSkgPz8gZmFsc2U7XG4gIH1cblxuICBwdWJsaWMgZ2V0SXRlbUlzQWN0aXZlKGl0ZW06IEludGVybmFsUHJpem1OYXZpZ2F0aW9uTWVudUl0ZW08VD4pOiBib29sZWFuIHtcbiAgICBpZiAoaXRlbSA9PT0gdGhpcy5hY3RpdmVJdGVtKSByZXR1cm4gdHJ1ZTtcblxuICAgIGlmICghdGhpcy5nZXRJdGVtSXNFeHBhbmRlZChpdGVtKSAmJiBpdGVtLmNoaWxkcmVuICYmIHRoaXMubW9kZSAhPT0gJ3J1YnJpY2F0b3InKSB7XG4gICAgICBjb25zdCBhbnlBY3RpdmVDaGlsZCA9IGZpbmRJdGVtKGl0ZW0uY2hpbGRyZW4sIGl0ZW0gPT4gaXRlbSA9PT0gdGhpcy5hY3RpdmVJdGVtKTtcbiAgICAgIHJldHVybiAhIWFueUFjdGl2ZUNoaWxkO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHB1YmxpYyB0cmlnZ2VyQ2RyKCk6IHZvaWQge1xuICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgIHRoaXMubWVudUl0ZW1zTGlzdD8uZm9yRWFjaChpdGVtQ29tcG9uZW50ID0+IGl0ZW1Db21wb25lbnQuY2RyLm1hcmtGb3JDaGVjaygpKTtcbiAgfVxufVxuIiwiPHByaXptLXRyZWVcbiAgI3RyZWVDdHJsPVwicHJpem1UcmVlQ29udHJvbGxlclwiXG4gICpuZ0Zvcj1cImxldCBpdGVtIG9mIGl0ZW1zXCJcbiAgW3ByaXptVHJlZUNvbnRyb2xsZXJdPVwiZmFsc2VcIlxuICBbbWFwXT1cImV4cGFuZGVkSXRlbXNNYXBcIlxuICBbY29udGVudF09XCJjb250ZW50XCJcbiAgW3ZhbHVlXT1cIml0ZW1cIlxuICBbY2hpbGRyZW5IYW5kbGVyXT1cIm1lbnVJdGVtc0NoaWxkcmVuSGFuZGxlclwiXG4gIChleHBhbmRlZENoYW5nZWQpPVwiaGFuZGxlRXhwYW5kZWRDaGFuZ2VkKCRldmVudClcIlxuPlxuICA8bmctdGVtcGxhdGUgI2NvbnRlbnQgbGV0LWl0ZW0+XG4gICAgPHByaXptLW5hdmlnYXRpb24tbWVudS1pdGVtXG4gICAgICBbaXRlbV09XCJpdGVtXCJcbiAgICAgIFttb2RlXT1cIm1vZGVcIlxuICAgICAgW2l0ZW1FeHRyYVRlbXBsYXRlXT1cIml0ZW1FeHRyYVRlbXBsYXRlXCJcbiAgICAgIFtpc0FjdGl2ZV09XCJnZXRJdGVtSXNBY3RpdmUoaXRlbSlcIlxuICAgICAgW2lzRXhwYW5kYWJsZV09XCJtZW51SXRlbXNDaGlsZHJlbkhhbmRsZXIoaXRlbSkubGVuZ3RoID4gMFwiXG4gICAgICBbaXNFeHBhbmRlZF09XCJnZXRJdGVtSXNFeHBhbmRlZChpdGVtKVwiXG4gICAgICAodG9nZ2xlRXhwYW5kZWQpPVwidHJlZUN0cmwudG9nZ2xlQnlJdGVtVmFsdWUoJGV2ZW50KVwiXG4gICAgICAoaW50ZXJhY3Rpb24pPVwiaGFuZGxlSW50ZXJhY3Rpb24oJGV2ZW50LCB0cmVlQ3RybClcIlxuICAgICAgKGdvVG9QYXJlbnRJdGVtKT1cImdvVG9QYXJlbnRJdGVtLmVtaXQoJGV2ZW50KVwiXG4gICAgICAoZ29Ub1Jvb3RJdGVtKT1cImdvVG9Sb290SXRlbS5lbWl0KCRldmVudClcIlxuICAgID48L3ByaXptLW5hdmlnYXRpb24tbWVudS1pdGVtPlxuICA8L25nLXRlbXBsYXRlPlxuPC9wcml6bS10cmVlPlxuIl19