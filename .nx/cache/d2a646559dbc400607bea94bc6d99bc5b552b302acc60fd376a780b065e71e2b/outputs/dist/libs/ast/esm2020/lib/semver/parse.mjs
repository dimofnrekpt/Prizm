"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.prizmSemVerParse = void 0;
function isSemverCommandValue(val) {
    return ['*', 'up', 'down'].includes(val.toString());
}
function prizmSemVerParse(versionString, getCommand) {
    const semVer = {
        major: 0,
        minor: 0,
        patch: 0,
        prerelease: null,
        prereleaseNumber: null,
        buildMetadata: null,
    };
    const [versionPart, data] = versionString.split('-');
    let prereleaseAndBuildMetadata = data;
    const [major, minor, patch] = versionPart.split(/[.+]{1}/g).map(val => {
        if (getCommand && isNaN(Number(val))) {
            let result = val;
            if (isSemverCommandValue(val))
                result = val;
            return result;
        }
        return Number(val);
    });
    semVer.major = major;
    semVer.minor = minor;
    semVer.patch = patch;
    if (!prereleaseAndBuildMetadata)
        prereleaseAndBuildMetadata = versionPart.split(/[^.]+.[^.]+.[^.+]+/g)?.pop();
    if (prereleaseAndBuildMetadata) {
        const [prereleasePart, buildMetadata] = prereleaseAndBuildMetadata.split('+');
        semVer.buildMetadata = buildMetadata ?? null;
        const [prerelease, prereleaseNumber] = prereleasePart.split('.');
        semVer.prerelease = !prerelease || prerelease === '*' ? null : prerelease;
        if (getCommand && prereleaseNumber && isSemverCommandValue(prereleaseNumber))
            semVer.prereleaseNumber = prereleaseNumber;
        else
            semVer.prereleaseNumber = prereleaseNumber ? Number(prereleaseNumber) : null;
    }
    return semVer;
}
exports.prizmSemVerParse = prizmSemVerParse;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL2FzdC9zcmMvbGliL3NlbXZlci9wYXJzZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFFQSxTQUFTLG9CQUFvQixDQUFDLEdBQW9CO0lBQ2hELE9BQU8sQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztBQUN0RCxDQUFDO0FBSUQsU0FBZ0IsZ0JBQWdCLENBQzlCLGFBQXFCLEVBQ3JCLFVBQWlCO0lBRWpCLE1BQU0sTUFBTSxHQUFnQjtRQUMxQixLQUFLLEVBQUUsQ0FBQztRQUNSLEtBQUssRUFBRSxDQUFDO1FBQ1IsS0FBSyxFQUFFLENBQUM7UUFDUixVQUFVLEVBQUUsSUFBSTtRQUNoQixnQkFBZ0IsRUFBRSxJQUFJO1FBQ3RCLGFBQWEsRUFBRSxJQUFJO0tBQ3BCLENBQUM7SUFFRixNQUFNLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxHQUFHLGFBQWEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDckQsSUFBSSwwQkFBMEIsR0FBRyxJQUFJLENBQUM7SUFDdEMsTUFBTSxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUU7UUFDcEUsSUFBSSxVQUFVLElBQUksS0FBSyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFO1lBQ3BDLElBQUksTUFBTSxHQUFHLEdBQVUsQ0FBQztZQUN4QixJQUFJLG9CQUFvQixDQUFDLEdBQUcsQ0FBQztnQkFBRSxNQUFNLEdBQUcsR0FBRyxDQUFDO1lBQzVDLE9BQU8sTUFBTSxDQUFDO1NBQ2Y7UUFFRCxPQUFPLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNyQixDQUFDLENBQUMsQ0FBQztJQUNILE1BQU0sQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0lBQ3JCLE1BQU0sQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0lBQ3JCLE1BQU0sQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0lBRXJCLElBQUksQ0FBQywwQkFBMEI7UUFDN0IsMEJBQTBCLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxFQUFFLEdBQUcsRUFBUyxDQUFDO0lBQ3RGLElBQUksMEJBQTBCLEVBQUU7UUFDOUIsTUFBTSxDQUFDLGNBQWMsRUFBRSxhQUFhLENBQUMsR0FBRywwQkFBMEIsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDOUUsTUFBTSxDQUFDLGFBQWEsR0FBRyxhQUFhLElBQUksSUFBSSxDQUFDO1FBRTdDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsZ0JBQWdCLENBQUMsR0FBRyxjQUFjLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2pFLE1BQU0sQ0FBQyxVQUFVLEdBQUcsQ0FBQyxVQUFVLElBQUksVUFBVSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUM7UUFDMUUsSUFBSSxVQUFVLElBQUksZ0JBQWdCLElBQUksb0JBQW9CLENBQUMsZ0JBQWdCLENBQUM7WUFDMUUsTUFBTSxDQUFDLGdCQUFnQixHQUFHLGdCQUF1QixDQUFDOztZQUMvQyxNQUFNLENBQUMsZ0JBQWdCLEdBQUcsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7S0FDbkY7SUFFRCxPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDO0FBMUNELDRDQTBDQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFByaXptU2VtVmVyLCBQcml6bVNlbVZlclVwZGF0ZUNvbW1hbmQgfSBmcm9tICcuL21vZGVsJztcblxuZnVuY3Rpb24gaXNTZW12ZXJDb21tYW5kVmFsdWUodmFsOiBzdHJpbmcgfCBudW1iZXIpOiBib29sZWFuIHtcbiAgcmV0dXJuIFsnKicsICd1cCcsICdkb3duJ10uaW5jbHVkZXModmFsLnRvU3RyaW5nKCkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcHJpem1TZW1WZXJQYXJzZSh2ZXJzaW9uU3RyaW5nOiBzdHJpbmcpOiBQcml6bVNlbVZlcjtcbmV4cG9ydCBmdW5jdGlvbiBwcml6bVNlbVZlclBhcnNlKHZlcnNpb25TdHJpbmc6IHN0cmluZywgZ2V0Q29tbWFuZDogdHJ1ZSk6IFByaXptU2VtVmVyVXBkYXRlQ29tbWFuZDtcbmV4cG9ydCBmdW5jdGlvbiBwcml6bVNlbVZlclBhcnNlKFxuICB2ZXJzaW9uU3RyaW5nOiBzdHJpbmcsXG4gIGdldENvbW1hbmQ/OiB0cnVlXG4pOiBQcml6bVNlbVZlciB8IFByaXptU2VtVmVyVXBkYXRlQ29tbWFuZCB7XG4gIGNvbnN0IHNlbVZlcjogUHJpem1TZW1WZXIgPSB7XG4gICAgbWFqb3I6IDAsXG4gICAgbWlub3I6IDAsXG4gICAgcGF0Y2g6IDAsXG4gICAgcHJlcmVsZWFzZTogbnVsbCxcbiAgICBwcmVyZWxlYXNlTnVtYmVyOiBudWxsLFxuICAgIGJ1aWxkTWV0YWRhdGE6IG51bGwsXG4gIH07XG5cbiAgY29uc3QgW3ZlcnNpb25QYXJ0LCBkYXRhXSA9IHZlcnNpb25TdHJpbmcuc3BsaXQoJy0nKTtcbiAgbGV0IHByZXJlbGVhc2VBbmRCdWlsZE1ldGFkYXRhID0gZGF0YTtcbiAgY29uc3QgW21ham9yLCBtaW5vciwgcGF0Y2hdID0gdmVyc2lvblBhcnQuc3BsaXQoL1suK117MX0vZykubWFwKHZhbCA9PiB7XG4gICAgaWYgKGdldENvbW1hbmQgJiYgaXNOYU4oTnVtYmVyKHZhbCkpKSB7XG4gICAgICBsZXQgcmVzdWx0ID0gdmFsIGFzIGFueTtcbiAgICAgIGlmIChpc1NlbXZlckNvbW1hbmRWYWx1ZSh2YWwpKSByZXN1bHQgPSB2YWw7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIHJldHVybiBOdW1iZXIodmFsKTtcbiAgfSk7XG4gIHNlbVZlci5tYWpvciA9IG1ham9yO1xuICBzZW1WZXIubWlub3IgPSBtaW5vcjtcbiAgc2VtVmVyLnBhdGNoID0gcGF0Y2g7XG5cbiAgaWYgKCFwcmVyZWxlYXNlQW5kQnVpbGRNZXRhZGF0YSlcbiAgICBwcmVyZWxlYXNlQW5kQnVpbGRNZXRhZGF0YSA9IHZlcnNpb25QYXJ0LnNwbGl0KC9bXi5dKy5bXi5dKy5bXi4rXSsvZyk/LnBvcCgpIGFzIGFueTtcbiAgaWYgKHByZXJlbGVhc2VBbmRCdWlsZE1ldGFkYXRhKSB7XG4gICAgY29uc3QgW3ByZXJlbGVhc2VQYXJ0LCBidWlsZE1ldGFkYXRhXSA9IHByZXJlbGVhc2VBbmRCdWlsZE1ldGFkYXRhLnNwbGl0KCcrJyk7XG4gICAgc2VtVmVyLmJ1aWxkTWV0YWRhdGEgPSBidWlsZE1ldGFkYXRhID8/IG51bGw7XG5cbiAgICBjb25zdCBbcHJlcmVsZWFzZSwgcHJlcmVsZWFzZU51bWJlcl0gPSBwcmVyZWxlYXNlUGFydC5zcGxpdCgnLicpO1xuICAgIHNlbVZlci5wcmVyZWxlYXNlID0gIXByZXJlbGVhc2UgfHwgcHJlcmVsZWFzZSA9PT0gJyonID8gbnVsbCA6IHByZXJlbGVhc2U7XG4gICAgaWYgKGdldENvbW1hbmQgJiYgcHJlcmVsZWFzZU51bWJlciAmJiBpc1NlbXZlckNvbW1hbmRWYWx1ZShwcmVyZWxlYXNlTnVtYmVyKSlcbiAgICAgIHNlbVZlci5wcmVyZWxlYXNlTnVtYmVyID0gcHJlcmVsZWFzZU51bWJlciBhcyBhbnk7XG4gICAgZWxzZSBzZW1WZXIucHJlcmVsZWFzZU51bWJlciA9IHByZXJlbGVhc2VOdW1iZXIgPyBOdW1iZXIocHJlcmVsZWFzZU51bWJlcikgOiBudWxsO1xuICB9XG5cbiAgcmV0dXJuIHNlbVZlcjtcbn1cbiJdfQ==