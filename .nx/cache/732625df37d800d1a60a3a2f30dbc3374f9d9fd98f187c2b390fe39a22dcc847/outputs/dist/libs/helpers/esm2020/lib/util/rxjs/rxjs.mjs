import { Compare } from '../compare/compare';
import { debounceTime, filter, map, observeOn, switchMap, tap, throttleTime } from 'rxjs/operators';
import { asyncScheduler, BehaviorSubject, merge, Observable, race, } from 'rxjs';
/**
 * Фильтрует значения, которые являются неправдивыми (falsy).
 * @returns Оператор, который можно использовать с Observable.
 */
export function filterFalsy() {
    return filter(Compare.isFalsy);
}
/**
 * Использует первый observable, который будет излучен в заданном промежутке времени.
 * @param time - время в миллисекундах
 * @param sources - массив источников Observable
 * @returns Observable, который эмитирует первое значение из источников.
 */
export function raceEmit(time, ...sources) {
    return merge(...sources).pipe(throttleTime(time));
}
/**
 * Создает Observable, который излучает изменения размера элемента.
 * @param elements - массив элементов, для которых должны быть отслеживаны изменения размера.
 * @returns Observable, который эмитирует массив событий изменения размера.
 */
export function prizmElementResized$(...elements) {
    return new Observable((subscriber) => {
        const resizeObserver = new ResizeObserver((entries) => subscriber.next(entries));
        elements.forEach(elem => resizeObserver.observe(elem));
        return () => resizeObserver.disconnect();
    });
}
/**
 * Фильтрует значения, которые являются истинными (truthy).
 * @returns Оператор, который можно использовать с Observable.
 */
export function filterTruthy() {
    return filter(Compare.isTruthy);
}
/**
 * Фильтрует значения, которые не являются нулевыми или неопределенными.
 * @returns Оператор, который можно использовать с Observable.
 */
export function filterNotNullish() {
    return filter(Compare.isNotNullish);
}
/**
 * Фильтрует значения, которые являются нулевыми или неопределенными.
 * @returns Оператор, который можно использовать с Observable.
 */
export function filterNullish() {
    return filter(Compare.isNullish);
}
/**
 * Преобразует неопределенные значения в null.
 * @returns Оператор, который можно использовать с Observable.
 */
export function mapUndefinedToNull() {
    return map((v) => (Compare.isUndefined(v) ? null : v));
}
/**
 * Перемещает выполнение функции на указанное количество итераций в цикле событий.
 * @param count - Количество итераций цикла событий для перемещения.
 * @returns Оператор, который можно использовать с Observable для продолжения цепочки.
 */
export function moveInEventLoopIteration(count) {
    return (source) => {
        if (!count)
            return source;
        source = source.pipe(observeOn(asyncScheduler, 0));
        if (count > 1) {
            source = source.pipe(moveInEventLoopIteration(count - 1));
        }
        return source;
    };
}
export function prizmRaceInEmit(inner, reloadTime) {
    const repeat$ = new BehaviorSubject(void 0);
    let result = repeat$.pipe(switchMap(() => {
        return race(...inner);
    }));
    if (Compare.isNotNullish(reloadTime))
        result = result.pipe(debounceTime(reloadTime));
    return result.pipe(tap(() => repeat$.next()));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicnhqcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvaGVscGVycy9zcmMvbGliL3V0aWwvcnhqcy9yeGpzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUM3QyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDcEcsT0FBTyxFQUNMLGNBQWMsRUFDZCxlQUFlLEVBQ2YsS0FBSyxFQUVMLFVBQVUsRUFFVixJQUFJLEdBR0wsTUFBTSxNQUFNLENBQUM7QUFFZDs7O0dBR0c7QUFDSCxNQUFNLFVBQVUsV0FBVztJQUN6QixPQUFPLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDakMsQ0FBQztBQUVEOzs7OztHQUtHO0FBQ0gsTUFBTSxVQUFVLFFBQVEsQ0FBVSxJQUFZLEVBQUUsR0FBRyxPQUEwQjtJQUMzRSxPQUFPLEtBQUssQ0FBQyxHQUFHLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztBQUNwRCxDQUFDO0FBRUQ7Ozs7R0FJRztBQUNILE1BQU0sVUFBVSxvQkFBb0IsQ0FBQyxHQUFHLFFBQW1CO0lBQ3pELE9BQU8sSUFBSSxVQUFVLENBQUMsQ0FBQyxVQUE2QyxFQUFFLEVBQUU7UUFDdEUsTUFBTSxjQUFjLEdBQUcsSUFBSSxjQUFjLENBQUMsQ0FBQyxPQUE4QixFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFFeEcsUUFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUV2RCxPQUFPLEdBQVMsRUFBRSxDQUFDLGNBQWMsQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUNqRCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7QUFFRDs7O0dBR0c7QUFDSCxNQUFNLFVBQVUsWUFBWTtJQUMxQixPQUFPLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDbEMsQ0FBQztBQUVEOzs7R0FHRztBQUNILE1BQU0sVUFBVSxnQkFBZ0I7SUFDOUIsT0FBTyxNQUFNLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQ3RDLENBQUM7QUFFRDs7O0dBR0c7QUFDSCxNQUFNLFVBQVUsYUFBYTtJQUMzQixPQUFPLE1BQU0sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDbkMsQ0FBQztBQUVEOzs7R0FHRztBQUNILE1BQU0sVUFBVSxrQkFBa0I7SUFDaEMsT0FBTyxHQUFHLENBQUMsQ0FBQyxDQUFnQixFQUFFLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUUsQ0FBTyxDQUFDLENBQUMsQ0FBQztBQUMvRSxDQUFDO0FBRUQ7Ozs7R0FJRztBQUNILE1BQU0sVUFBVSx3QkFBd0IsQ0FBSSxLQUFhO0lBQ3ZELE9BQU8sQ0FBQyxNQUFxQixFQUFFLEVBQUU7UUFDL0IsSUFBSSxDQUFDLEtBQUs7WUFBRSxPQUFPLE1BQU0sQ0FBQztRQUUxQixNQUFNLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFbkQsSUFBSSxLQUFLLEdBQUcsQ0FBQyxFQUFFO1lBQ2IsTUFBTSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDM0Q7UUFFRCxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDLENBQUM7QUFDSixDQUFDO0FBRUQsTUFBTSxVQUFVLGVBQWUsQ0FBSSxLQUFzQixFQUFFLFVBQW1CO0lBQzVFLE1BQU0sT0FBTyxHQUFHLElBQUksZUFBZSxDQUFPLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDbEQsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FDdkIsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLE9BQU8sSUFBSSxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUM7SUFDeEIsQ0FBQyxDQUFDLENBQ0gsQ0FBQztJQUNGLElBQUksT0FBTyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUM7UUFBRSxNQUFNLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztJQUVyRixPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDaEQsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBhcmUgfSBmcm9tICcuLi9jb21wYXJlL2NvbXBhcmUnO1xuaW1wb3J0IHsgZGVib3VuY2VUaW1lLCBmaWx0ZXIsIG1hcCwgb2JzZXJ2ZU9uLCBzd2l0Y2hNYXAsIHRhcCwgdGhyb3R0bGVUaW1lIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHtcbiAgYXN5bmNTY2hlZHVsZXIsXG4gIEJlaGF2aW9yU3ViamVjdCxcbiAgbWVyZ2UsXG4gIE1vbm9UeXBlT3BlcmF0b3JGdW5jdGlvbixcbiAgT2JzZXJ2YWJsZSxcbiAgT3BlcmF0b3JGdW5jdGlvbixcbiAgcmFjZSxcbiAgU3Vic2NyaWJlcixcbiAgdGltZXIsXG59IGZyb20gJ3J4anMnO1xuXG4vKipcbiAqINCk0LjQu9GM0YLRgNGD0LXRgiDQt9C90LDRh9C10L3QuNGPLCDQutC+0YLQvtGA0YvQtSDRj9Cy0LvRj9GO0YLRgdGPINC90LXQv9GA0LDQstC00LjQstGL0LzQuCAoZmFsc3kpLlxuICogQHJldHVybnMg0J7Qv9C10YDQsNGC0L7RgCwg0LrQvtGC0L7RgNGL0Lkg0LzQvtC20L3QviDQuNGB0L/QvtC70YzQt9C+0LLQsNGC0Ywg0YEgT2JzZXJ2YWJsZS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZpbHRlckZhbHN5PFQ+KCk6IE1vbm9UeXBlT3BlcmF0b3JGdW5jdGlvbjxUPiB7XG4gIHJldHVybiBmaWx0ZXIoQ29tcGFyZS5pc0ZhbHN5KTtcbn1cblxuLyoqXG4gKiDQmNGB0L/QvtC70YzQt9GD0LXRgiDQv9C10YDQstGL0Lkgb2JzZXJ2YWJsZSwg0LrQvtGC0L7RgNGL0Lkg0LHRg9C00LXRgiDQuNC30LvRg9GH0LXQvSDQsiDQt9Cw0LTQsNC90L3QvtC8INC/0YDQvtC80LXQttGD0YLQutC1INCy0YDQtdC80LXQvdC4LlxuICogQHBhcmFtIHRpbWUgLSDQstGA0LXQvNGPINCyINC80LjQu9C70LjRgdC10LrRg9C90LTQsNGFXG4gKiBAcGFyYW0gc291cmNlcyAtINC80LDRgdGB0LjQsiDQuNGB0YLQvtGH0L3QuNC60L7QsiBPYnNlcnZhYmxlXG4gKiBAcmV0dXJucyBPYnNlcnZhYmxlLCDQutC+0YLQvtGA0YvQuSDRjdC80LjRgtC40YDRg9C10YIg0L/QtdGA0LLQvtC1INC30L3QsNGH0LXQvdC40LUg0LjQtyDQuNGB0YLQvtGH0L3QuNC60L7Qsi5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJhY2VFbWl0PFIgPSBhbnk+KHRpbWU6IG51bWJlciwgLi4uc291cmNlczogT2JzZXJ2YWJsZTxhbnk+W10pOiBPYnNlcnZhYmxlPFI+IHtcbiAgcmV0dXJuIG1lcmdlKC4uLnNvdXJjZXMpLnBpcGUodGhyb3R0bGVUaW1lKHRpbWUpKTtcbn1cblxuLyoqXG4gKiDQodC+0LfQtNCw0LXRgiBPYnNlcnZhYmxlLCDQutC+0YLQvtGA0YvQuSDQuNC30LvRg9GH0LDQtdGCINC40LfQvNC10L3QtdC90LjRjyDRgNCw0LfQvNC10YDQsCDRjdC70LXQvNC10L3RgtCwLlxuICogQHBhcmFtIGVsZW1lbnRzIC0g0LzQsNGB0YHQuNCyINGN0LvQtdC80LXQvdGC0L7Qsiwg0LTQu9GPINC60L7RgtC+0YDRi9GFINC00L7Qu9C20L3RiyDQsdGL0YLRjCDQvtGC0YHQu9C10LbQuNCy0LDQvdGLINC40LfQvNC10L3QtdC90LjRjyDRgNCw0LfQvNC10YDQsC5cbiAqIEByZXR1cm5zIE9ic2VydmFibGUsINC60L7RgtC+0YDRi9C5INGN0LzQuNGC0LjRgNGD0LXRgiDQvNCw0YHRgdC40LIg0YHQvtCx0YvRgtC40Lkg0LjQt9C80LXQvdC10L3QuNGPINGA0LDQt9C80LXRgNCwLlxuICovXG5leHBvcnQgZnVuY3Rpb24gcHJpem1FbGVtZW50UmVzaXplZCQoLi4uZWxlbWVudHM6IEVsZW1lbnRbXSk6IE9ic2VydmFibGU8UmVzaXplT2JzZXJ2ZXJFbnRyeVtdPiB7XG4gIHJldHVybiBuZXcgT2JzZXJ2YWJsZSgoc3Vic2NyaWJlcjogU3Vic2NyaWJlcjxSZXNpemVPYnNlcnZlckVudHJ5W10+KSA9PiB7XG4gICAgY29uc3QgcmVzaXplT2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoKGVudHJpZXM6IFJlc2l6ZU9ic2VydmVyRW50cnlbXSkgPT4gc3Vic2NyaWJlci5uZXh0KGVudHJpZXMpKTtcblxuICAgIGVsZW1lbnRzLmZvckVhY2goZWxlbSA9PiByZXNpemVPYnNlcnZlci5vYnNlcnZlKGVsZW0pKTtcblxuICAgIHJldHVybiAoKTogdm9pZCA9PiByZXNpemVPYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gIH0pO1xufVxuXG4vKipcbiAqINCk0LjQu9GM0YLRgNGD0LXRgiDQt9C90LDRh9C10L3QuNGPLCDQutC+0YLQvtGA0YvQtSDRj9Cy0LvRj9GO0YLRgdGPINC40YHRgtC40L3QvdGL0LzQuCAodHJ1dGh5KS5cbiAqIEByZXR1cm5zINCe0L/QtdGA0LDRgtC+0YAsINC60L7RgtC+0YDRi9C5INC80L7QttC90L4g0LjRgdC/0L7Qu9GM0LfQvtCy0LDRgtGMINGBIE9ic2VydmFibGUuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmaWx0ZXJUcnV0aHk8VD4oKTogTW9ub1R5cGVPcGVyYXRvckZ1bmN0aW9uPFQ+IHtcbiAgcmV0dXJuIGZpbHRlcihDb21wYXJlLmlzVHJ1dGh5KTtcbn1cblxuLyoqXG4gKiDQpNC40LvRjNGC0YDRg9C10YIg0LfQvdCw0YfQtdC90LjRjywg0LrQvtGC0L7RgNGL0LUg0L3QtSDRj9Cy0LvRj9GO0YLRgdGPINC90YPQu9C10LLRi9C80Lgg0LjQu9C4INC90LXQvtC/0YDQtdC00LXQu9C10L3QvdGL0LzQuC5cbiAqIEByZXR1cm5zINCe0L/QtdGA0LDRgtC+0YAsINC60L7RgtC+0YDRi9C5INC80L7QttC90L4g0LjRgdC/0L7Qu9GM0LfQvtCy0LDRgtGMINGBIE9ic2VydmFibGUuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmaWx0ZXJOb3ROdWxsaXNoPFQ+KCk6IE9wZXJhdG9yRnVuY3Rpb248VCwgVD4ge1xuICByZXR1cm4gZmlsdGVyKENvbXBhcmUuaXNOb3ROdWxsaXNoKTtcbn1cblxuLyoqXG4gKiDQpNC40LvRjNGC0YDRg9C10YIg0LfQvdCw0YfQtdC90LjRjywg0LrQvtGC0L7RgNGL0LUg0Y/QstC70Y/RjtGC0YHRjyDQvdGD0LvQtdCy0YvQvNC4INC40LvQuCDQvdC10L7Qv9GA0LXQtNC10LvQtdC90L3Ri9C80LguXG4gKiBAcmV0dXJucyDQntC/0LXRgNCw0YLQvtGALCDQutC+0YLQvtGA0YvQuSDQvNC+0LbQvdC+INC40YHQv9C+0LvRjNC30L7QstCw0YLRjCDRgSBPYnNlcnZhYmxlLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZmlsdGVyTnVsbGlzaDxUPigpOiBPcGVyYXRvckZ1bmN0aW9uPFQsIG51bGwgfCB1bmRlZmluZWQ+IHtcbiAgcmV0dXJuIGZpbHRlcihDb21wYXJlLmlzTnVsbGlzaCk7XG59XG5cbi8qKlxuICog0J/RgNC10L7QsdGA0LDQt9GD0LXRgiDQvdC10L7Qv9GA0LXQtNC10LvQtdC90L3Ri9C1INC30L3QsNGH0LXQvdC40Y8g0LIgbnVsbC5cbiAqIEByZXR1cm5zINCe0L/QtdGA0LDRgtC+0YAsINC60L7RgtC+0YDRi9C5INC80L7QttC90L4g0LjRgdC/0L7Qu9GM0LfQvtCy0LDRgtGMINGBIE9ic2VydmFibGUuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtYXBVbmRlZmluZWRUb051bGw8VD4oKTogT3BlcmF0b3JGdW5jdGlvbjxULCBUIHwgbnVsbD4ge1xuICByZXR1cm4gbWFwKCh2OiBUIHwgdW5kZWZpbmVkKSA9PiAoQ29tcGFyZS5pc1VuZGVmaW5lZCh2KSA/IG51bGwgOiAodiBhcyBUKSkpO1xufVxuXG4vKipcbiAqINCf0LXRgNC10LzQtdGJ0LDQtdGCINCy0YvQv9C+0LvQvdC10L3QuNC1INGE0YPQvdC60YbQuNC4INC90LAg0YPQutCw0LfQsNC90L3QvtC1INC60L7Qu9C40YfQtdGB0YLQstC+INC40YLQtdGA0LDRhtC40Lkg0LIg0YbQuNC60LvQtSDRgdC+0LHRi9GC0LjQuS5cbiAqIEBwYXJhbSBjb3VudCAtINCa0L7Qu9C40YfQtdGB0YLQstC+INC40YLQtdGA0LDRhtC40Lkg0YbQuNC60LvQsCDRgdC+0LHRi9GC0LjQuSDQtNC70Y8g0L/QtdGA0LXQvNC10YnQtdC90LjRjy5cbiAqIEByZXR1cm5zINCe0L/QtdGA0LDRgtC+0YAsINC60L7RgtC+0YDRi9C5INC80L7QttC90L4g0LjRgdC/0L7Qu9GM0LfQvtCy0LDRgtGMINGBIE9ic2VydmFibGUg0LTQu9GPINC/0YDQvtC00L7Qu9C20LXQvdC40Y8g0YbQtdC/0L7Rh9C60LguXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtb3ZlSW5FdmVudExvb3BJdGVyYXRpb248VD4oY291bnQ6IG51bWJlcik6IE1vbm9UeXBlT3BlcmF0b3JGdW5jdGlvbjxUPiB7XG4gIHJldHVybiAoc291cmNlOiBPYnNlcnZhYmxlPFQ+KSA9PiB7XG4gICAgaWYgKCFjb3VudCkgcmV0dXJuIHNvdXJjZTtcblxuICAgIHNvdXJjZSA9IHNvdXJjZS5waXBlKG9ic2VydmVPbihhc3luY1NjaGVkdWxlciwgMCkpO1xuXG4gICAgaWYgKGNvdW50ID4gMSkge1xuICAgICAgc291cmNlID0gc291cmNlLnBpcGUobW92ZUluRXZlbnRMb29wSXRlcmF0aW9uKGNvdW50IC0gMSkpO1xuICAgIH1cblxuICAgIHJldHVybiBzb3VyY2U7XG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwcml6bVJhY2VJbkVtaXQ8VD4oaW5uZXI6IE9ic2VydmFibGU8VD5bXSwgcmVsb2FkVGltZT86IG51bWJlcik6IE9ic2VydmFibGU8VD4ge1xuICBjb25zdCByZXBlYXQkID0gbmV3IEJlaGF2aW9yU3ViamVjdDx2b2lkPih2b2lkIDApO1xuICBsZXQgcmVzdWx0ID0gcmVwZWF0JC5waXBlKFxuICAgIHN3aXRjaE1hcCgoKSA9PiB7XG4gICAgICByZXR1cm4gcmFjZSguLi5pbm5lcik7XG4gICAgfSlcbiAgKTtcbiAgaWYgKENvbXBhcmUuaXNOb3ROdWxsaXNoKHJlbG9hZFRpbWUpKSByZXN1bHQgPSByZXN1bHQucGlwZShkZWJvdW5jZVRpbWUocmVsb2FkVGltZSkpO1xuXG4gIHJldHVybiByZXN1bHQucGlwZSh0YXAoKCkgPT4gcmVwZWF0JC5uZXh0KCkpKTtcbn1cbiJdfQ==