import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChild, ContentChildren, ElementRef, EventEmitter, Input, Output, QueryList, ViewChild, ViewChildren, } from '@angular/core';
import { asyncScheduler, BehaviorSubject, fromEvent, merge } from 'rxjs';
import { map, observeOn, startWith, switchMap, takeUntil, tap, withLatestFrom } from 'rxjs/operators';
import { PrizmDestroyService, prizmEmptyQueryList } from '@prizm-ui/helpers';
import { PrizmSplitterGutterComponent } from './gutter/gutter.component';
import { PrizmSplitterAreaComponent } from './area/area.component';
import { PrizmSplitterService } from './splitter.service';
import { PrizmSplitterCustomGutterDirective } from './custom-gutter.directive';
import { PrizmAbstractTestId } from '@prizm-ui/core';
import { CommonModule } from '@angular/common';
import { ResizeObserverModule } from '@ng-web-apis/resize-observer';
import * as i0 from "@angular/core";
import * as i1 from "@prizm-ui/helpers";
import * as i2 from "./splitter.service";
import * as i3 from "@angular/common";
export class PrizmSplitterComponent extends PrizmAbstractTestId {
    get gutterElementSize() {
        return this.customGutter ? this.customGutter.size : 8;
    }
    constructor(cdr, destroy$, splitterService) {
        super();
        this.cdr = cdr;
        this.destroy$ = destroy$;
        this.splitterService = splitterService;
        this.orientation = 'horizontal';
        this.areasSizeChange = new EventEmitter();
        this.areasSplitStart = new EventEmitter();
        this.areasSplitEnd = new EventEmitter();
        this.splitterAreaQueryList = prizmEmptyQueryList();
        this.splitterGutterQueryList = prizmEmptyQueryList();
        this.testId_ = 'ui_splitter';
        this.guttersData = [];
        this.containerSize$$ = new BehaviorSubject(0);
        this.lastGap = 0;
    }
    ngAfterContentInit() {
        this.areas$ = merge(this.splitterAreaQueryList.changes.pipe(startWith(this.splitterAreaQueryList), map(ql => ql.toArray())), this.splitterService.areaInputSizeChange$$.pipe(map(() => this.splitterAreaQueryList.toArray()))).pipe(map(areas => areas.filter(area => !area.hidden)), observeOn(asyncScheduler));
        this.areas$.pipe(takeUntil(this.destroy$)).subscribe(areas => {
            const gap = ((areas.length - 1) * this.gutterElementSize) / areas.length;
            if (gap !== this.lastGap) {
                areas.forEach(area => area.setCurrentSizeWithCalc(gap));
            }
            this.lastGap = gap;
            this.guttersData = [];
            areas.forEach((area, index) => {
                area.order = index;
                if (index < areas.length - 1) {
                    this.guttersData.push({ areaBefore: index, areaAfter: index + 1, order: index + 1 });
                }
            });
            this.cdr.markForCheck();
        });
        this.splitterService.areaInputSizeChange$$
            .pipe(withLatestFrom(this.areas$), takeUntil(this.destroy$))
            .subscribe(([changedArea, areas]) => {
            const gap = ((areas.length - 1) * this.gutterElementSize) / areas.length;
            changedArea.setCurrentSizeWithCalc(gap);
            this.cdr.markForCheck();
        });
    }
    ngAfterViewInit() {
        const guttersComponents$ = this.splitterGutterQueryList.changes.pipe(startWith(this.splitterGutterQueryList), map(ql => ql.toArray()));
        guttersComponents$
            .pipe(switchMap(gutters => merge(...gutters.map(gutter => {
            const elem = gutter.elementRef.nativeElement;
            return fromEvent(elem, 'pointerdown').pipe(withLatestFrom(this.areas$), switchMap(([event, areas]) => {
                event.preventDefault();
                elem.setPointerCapture(event.pointerId);
                const containerBCR = this.containerElement.nativeElement.getBoundingClientRect();
                const containerSize = this.isHorizontal ? containerBCR.width : containerBCR.height;
                const guttersSize = this.splitterGutterQueryList.length * this.gutterElementSize;
                const guttersGapInPx = this.splitterService.mathOperation(guttersSize, areas.length, '/');
                const guttersGapInPercent = this.splitterService.mathOperation(guttersGapInPx, containerSize, '/') * 100;
                const guttersBefore = gutter.order - 1;
                const guttersAfter = gutters.length - gutter.order;
                const areasBefore = areas
                    .filter(area => area.order < gutter.order)
                    .map(area => this.getAreaRealSizes(area, containerSize, guttersGapInPercent));
                const areasAfter = areas
                    .filter(area => area.order >= gutter.order)
                    .map(area => this.getAreaRealSizes(area, containerSize, guttersGapInPercent));
                const min = this.splitterService.mathOperation(this.isHorizontal ? containerBCR.left : containerBCR.top, this.splitterService.mathOperation(this.gutterElementSize, guttersBefore, '*'), '+');
                const max = this.splitterService.mathOperation(this.isHorizontal ? containerBCR.right : containerBCR.bottom, this.gutterElementSize * (guttersAfter + 1), '-');
                const splitterBCR = elem.getBoundingClientRect();
                const offset = {
                    left: this.splitterService.mathOperation(event.clientX, splitterBCR.left, '-'),
                    top: this.splitterService.mathOperation(event.clientY, splitterBCR.top, '-'),
                };
                gutter.position = this.isHorizontal
                    ? this.splitterService.mathOperation(event.clientX, offset.left, '-')
                    : this.splitterService.mathOperation(event.clientY, offset.top, '-');
                this.areasSplitStart.emit(this.getAreasSize([...areasBefore, ...areasAfter], containerSize, containerSize - guttersSize));
                return fromEvent(elem, 'pointermove').pipe(map(event => {
                    event.preventDefault();
                    return {
                        gutter,
                        event,
                        offset,
                        min,
                        max,
                        areasBefore,
                        areasAfter,
                        containerSize,
                        guttersSize,
                    };
                }), takeUntil(merge(fromEvent(document, 'pointerup'), fromEvent(elem, 'pointercancel')).pipe(tap(event => {
                    this.areasSplitEnd.emit(this.getAreasSize([...areasBefore, ...areasAfter], containerSize, containerSize - guttersSize));
                }))));
            }));
        }))), takeUntil(this.destroy$))
            .subscribe(({ gutter, event, offset, min, max, areasBefore, areasAfter, containerSize, guttersSize }) => {
            let newPosition = this.isHorizontal
                ? this.splitterService.mathOperation(event.clientX, offset.left, '-')
                : this.splitterService.mathOperation(event.clientY, offset.top, '-');
            if (newPosition < min) {
                newPosition = min;
            }
            if (newPosition > max) {
                newPosition = max;
            }
            const diff = this.splitterService.mathOperation(gutter.position, newPosition, '-');
            let offsetInPercent;
            if (newPosition === min) {
                offsetInPercent = areasBefore.reduce((prev, curr) => prev + curr.realSize, 0);
            }
            else if (newPosition === max) {
                offsetInPercent = areasAfter.reduce((prev, curr) => prev + curr.realSize, 0);
            }
            else {
                offsetInPercent = Math.abs(this.splitterService.mathOperation(diff, containerSize, '/')) * 100;
            }
            const revercedAreasBefore = [...areasBefore].reverse();
            if (diff === 0) {
                return;
            }
            if (diff < 0) {
                const shrinked = this.shrinkAreas(areasAfter, offsetInPercent);
                revercedAreasBefore[0].realSize = this.splitterService.mathOperation(revercedAreasBefore[0].realSize, shrinked, '+');
                revercedAreasBefore[0].area.setCurrentSize(revercedAreasBefore[0].realSize);
            }
            else if (diff > 0) {
                const shrinked = this.shrinkAreas(revercedAreasBefore, offsetInPercent);
                areasAfter[0].realSize = this.splitterService.mathOperation(areasAfter[0].realSize, shrinked, '+');
                areasAfter[0].area.setCurrentSize(areasAfter[0].realSize);
            }
            gutter.position = newPosition;
            this.areasSizeChange.emit(this.getAreasSize([...areasBefore, ...areasAfter], containerSize, containerSize - guttersSize));
            this.cdr.markForCheck();
        });
    }
    shrinkAreas(areas, offsetInPercent) {
        let sum = 0;
        for (const areaRealSizes of areas) {
            if (offsetInPercent === 0) {
                break;
            }
            const avalableSize = this.splitterService.mathOperation(areaRealSizes.realSize, areaRealSizes.realMinSize, '-');
            if (avalableSize >= offsetInPercent) {
                areaRealSizes.realSize = this.splitterService.mathOperation(areaRealSizes.realSize, offsetInPercent, '-');
                areaRealSizes.area.setCurrentSize(areaRealSizes.realSize);
                sum = this.splitterService.mathOperation(sum, offsetInPercent, '+');
                offsetInPercent = 0;
                if (areaRealSizes.realSize === areaRealSizes.realMinSize) {
                    areaRealSizes.area.areaMinSize.emit();
                }
                break;
            }
            else {
                offsetInPercent = this.splitterService.mathOperation(offsetInPercent, avalableSize, '-');
                sum = this.splitterService.mathOperation(sum, avalableSize, '+');
                areaRealSizes.realSize = areaRealSizes.realMinSize;
                areaRealSizes.area.setCurrentSize(areaRealSizes.realSize);
                areaRealSizes.area.areaMinSize.emit();
            }
        }
        return sum;
    }
    get isHorizontal() {
        return this.orientation === 'horizontal';
    }
    getAreaRealSizes(area, containerSize, guttersGapInPercent) {
        const sizeInPx = area.elementRef.nativeElement[this.isHorizontal ? 'offsetWidth' : 'offsetHeight'];
        const realSize = this.splitterService.mathOperation(sizeInPx, containerSize, '/') * 100;
        const realMinSize = Math.max(0, this.splitterService.mathOperation(area.minSize, guttersGapInPercent, '-'));
        return {
            area,
            realSize,
            realMinSize,
        };
    }
    getAreasSize(areas, containerSize, areasSize) {
        const sizes = areas.map(({ area, realSize, realMinSize }) => {
            if (realMinSize === realSize) {
                return area.minSize;
            }
            else {
                return containerSize * (realSize / areasSize);
            }
        });
        return sizes;
    }
}
PrizmSplitterComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: PrizmSplitterComponent, deps: [{ token: i0.ChangeDetectorRef }, { token: i1.PrizmDestroyService }, { token: i2.PrizmSplitterService }], target: i0.ɵɵFactoryTarget.Component });
PrizmSplitterComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: PrizmSplitterComponent, isStandalone: true, selector: "prizm-splitter", inputs: { orientation: "orientation" }, outputs: { areasSizeChange: "areasSizeChange", areasSplitStart: "areasSplitStart", areasSplitEnd: "areasSplitEnd" }, host: { properties: { "class": "'prizm-spliiter ' + orientation" } }, providers: [PrizmDestroyService, PrizmSplitterService], queries: [{ propertyName: "customGutter", first: true, predicate: PrizmSplitterCustomGutterDirective, descendants: true }, { propertyName: "splitterAreaQueryList", predicate: PrizmSplitterAreaComponent }], viewQueries: [{ propertyName: "containerElement", first: true, predicate: ["container"], descendants: true, static: true }, { propertyName: "splitterGutterQueryList", predicate: PrizmSplitterGutterComponent, descendants: true }], usesInheritance: true, ngImport: i0, template: "<div class=\"container container--{{ orientation }}\" #container>\n  <prizm-splitter-gutter\n    *ngFor=\"let gutter of guttersData\"\n    [areaBefore]=\"$any(gutter.areaBefore)\"\n    [areaAfter]=\"$any(gutter.areaAfter)\"\n    [order]=\"$any(gutter.order)\"\n    [orientation]=\"orientation\"\n    [template]=\"$any(customGutter?.template)\"\n  >\n  </prizm-splitter-gutter>\n  <ng-content select=\"prizm-splitter-area\"></ng-content>\n</div>\n", styles: [":host{display:block;border:8px solid transparent}.container{display:flex;position:relative;overflow:hidden;width:100%;height:100%}.container--horizontal{flex-direction:row}.container--vertical{flex-direction:column}\n"], dependencies: [{ kind: "ngmodule", type: CommonModule }, { kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "component", type: PrizmSplitterGutterComponent, selector: "prizm-splitter-gutter", inputs: ["areaBefore", "areaAfter", "orientation", "order", "template"] }, { kind: "ngmodule", type: ResizeObserverModule }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: PrizmSplitterComponent, decorators: [{
            type: Component,
            args: [{ selector: 'prizm-splitter', changeDetection: ChangeDetectionStrategy.OnPush, providers: [PrizmDestroyService, PrizmSplitterService], host: {
                        '[class]': "'prizm-spliiter ' + orientation",
                    }, standalone: true, imports: [CommonModule, PrizmSplitterGutterComponent, ResizeObserverModule], template: "<div class=\"container container--{{ orientation }}\" #container>\n  <prizm-splitter-gutter\n    *ngFor=\"let gutter of guttersData\"\n    [areaBefore]=\"$any(gutter.areaBefore)\"\n    [areaAfter]=\"$any(gutter.areaAfter)\"\n    [order]=\"$any(gutter.order)\"\n    [orientation]=\"orientation\"\n    [template]=\"$any(customGutter?.template)\"\n  >\n  </prizm-splitter-gutter>\n  <ng-content select=\"prizm-splitter-area\"></ng-content>\n</div>\n", styles: [":host{display:block;border:8px solid transparent}.container{display:flex;position:relative;overflow:hidden;width:100%;height:100%}.container--horizontal{flex-direction:row}.container--vertical{flex-direction:column}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }, { type: i1.PrizmDestroyService }, { type: i2.PrizmSplitterService }]; }, propDecorators: { orientation: [{
                type: Input
            }], areasSizeChange: [{
                type: Output
            }], areasSplitStart: [{
                type: Output
            }], areasSplitEnd: [{
                type: Output
            }], containerElement: [{
                type: ViewChild,
                args: ['container', { static: true }]
            }], customGutter: [{
                type: ContentChild,
                args: [PrizmSplitterCustomGutterDirective]
            }], splitterAreaQueryList: [{
                type: ContentChildren,
                args: [PrizmSplitterAreaComponent]
            }], splitterGutterQueryList: [{
                type: ViewChildren,
                args: [PrizmSplitterGutterComponent]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3BsaXR0ZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9jb21wb25lbnRzL3NyYy9saWIvY29tcG9uZW50cy9zcGxpdHRlci9zcGxpdHRlci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL2NvbXBvbmVudHMvc3JjL2xpYi9jb21wb25lbnRzL3NwbGl0dGVyL3NwbGl0dGVyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFHTCx1QkFBdUIsRUFDdkIsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxZQUFZLEVBQ1osZUFBZSxFQUNmLFVBQVUsRUFDVixZQUFZLEVBQ1osS0FBSyxFQUNMLE1BQU0sRUFDTixTQUFTLEVBQ1QsU0FBUyxFQUNULFlBQVksR0FDYixNQUFNLGVBQWUsQ0FBQztBQUd2QixPQUFPLEVBQUUsY0FBYyxFQUFFLGVBQWUsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQ3JGLE9BQU8sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxjQUFjLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUV0RyxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUU3RSxPQUFPLEVBQUUsNEJBQTRCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN6RSxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUVuRSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUMxRCxPQUFPLEVBQUUsa0NBQWtDLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUMvRSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNyRCxPQUFPLEVB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LGNBQ1csSUFBSSxXQUNQLENBQUMsWUFBWSxFQUFFLDRCQUE0QixFQUFFLG9CQUFvQixDQUFDOzZLQUdsRSxXQUFXO3NCQUFuQixLQUFLO2dCQUVJLGVBQWU7c0JBQXhCLE1BQU07Z0JBQ0csZUFBZTtzQkFBeEIsTUFBTTtnQkFDRyxhQUFhO3NCQUF0QixNQUFNO2dCQUUyQyxnQkFBZ0I7c0JBQWpFLFNBQVM7dUJBQUMsV0FBVyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTtnQkFDVSxZQUFZO3NCQUE3RCxZQUFZO3VCQUFDLGtDQUFrQztnQkFFSCxxQkFBcUI7c0JBQWpFLGVBQWU7dUJBQUMsMEJBQTBCO2dCQUkzQyx1QkFBdUI7c0JBRHRCLFlBQVk7dUJBQUMsNEJBQTRCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIENvbnRlbnRDaGlsZCxcbiAgQ29udGVudENoaWxkcmVuLFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIElucHV0LFxuICBPdXRwdXQsXG4gIFF1ZXJ5TGlzdCxcbiAgVmlld0NoaWxkLFxuICBWaWV3Q2hpbGRyZW4sXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUHJpem1TcGxpdHRlck9yaWVudGF0aW9uIH0gZnJvbSAnLi90eXBlcyc7XG5cbmltcG9ydCB7IGFzeW5jU2NoZWR1bGVyLCBCZWhhdmlvclN1YmplY3QsIGZyb21FdmVudCwgbWVyZ2UsIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCwgb2JzZXJ2ZU9uLCBzdGFydFdpdGgsIHN3aXRjaE1hcCwgdGFrZVVudGlsLCB0YXAsIHdpdGhMYXRlc3RGcm9tIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBQcml6bURlc3Ryb3lTZXJ2aWNlLCBwcml6bUVtcHR5UXVlcnlMaXN0IH0gZnJvbSAnQHByaXptLXVpL2hlbHBlcnMnO1xuXG5pbXBvcnQgeyBQcml6bVNwbGl0dGVyR3V0dGVyQ29tcG9uZW50IH0gZnJvbSAnLi9ndXR0ZXIvZ3V0dGVyLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQcml6bVNwbGl0dGVyQXJlYUNvbXBvbmVudCB9IGZyb20gJy4vYXJlYS9hcmVhLmNvbXBvbmVudCc7XG5cbmltcG9ydCB7IFByaXptU3BsaXR0ZXJTZXJ2aWNlIH0gZnJvbSAnLi9zcGxpdHRlci5zZXJ2aWNlJztcbmltcG9ydCB7IFByaXptU3BsaXR0ZXJDdXN0b21HdXR0ZXJEaXJlY3RpdmUgfSBmcm9tICcuL2N1c3RvbS1ndXR0ZXIuZGlyZWN0aXZlJztcbmltcG9ydCB7IFByaXptQWJzdHJhY3RUZXN0SWQgfSBmcm9tICdAcHJpem0tdWkvY29yZSc7XG5pbXBvcnQgeyBDb21tb25Nb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgUmVzaXplT2JzZXJ2ZXJNb2R1bGUgfSBmcm9tICdAbmctd2ViLWFwaXMvcmVzaXplLW9ic2VydmVyJztcblxudHlwZSBBcmVhUmVhbFNpemUgPSB7IGFyZWE6IFByaXptU3BsaXR0ZXJBcmVhQ29tcG9uZW50OyByZWFsU2l6ZTogbnVtYmVyOyByZWFsTWluU2l6ZTogbnVtYmVyIH07XG50eXBlIEd1dHRlckRhdGEgPSB7IGFyZWFCZWZvcmU6IG51bWJlcjsgYXJlYUFmdGVyOiBudW1iZXI7IG9yZGVyOiBudW1iZXIgfTtcbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3ByaXptLXNwbGl0dGVyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3NwbGl0dGVyLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vc3BsaXR0ZXIuY29tcG9uZW50Lmxlc3MnXSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIHByb3ZpZGVyczogW1ByaXptRGVzdHJveVNlcnZpY2UsIFByaXptU3BsaXR0ZXJTZXJ2aWNlXSxcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC9uby1ob3N0LW1ldGFkYXRhLXByb3BlcnR5XG4gIGhvc3Q6IHtcbiAgICAnW2NsYXNzXSc6IFwiJ3ByaXptLXNwbGlpdGVyICcgKyBvcmllbnRhdGlvblwiLFxuICB9LFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbQ29tbW9uTW9kdWxlLCBQcml6bVNwbGl0dGVyR3V0dGVyQ29tcG9uZW50LCBSZXNpemVPYnNlcnZlck1vZHVsZV0sXG59KVxuZXhwb3J0IGNsYXNzIFByaXptU3BsaXR0ZXJDb21wb25lbnQgZXh0ZW5kcyBQcml6bUFic3RyYWN0VGVzdElkIGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgQWZ0ZXJDb250ZW50SW5pdCB7XG4gIEBJbnB1dCgpIG9yaWVudGF0aW9uOiBQcml6bVNwbGl0dGVyT3JpZW50YXRpb24gPSAnaG9yaXpvbnRhbCc7XG5cbiAgQE91dHB1dCgpIGFyZWFzU2l6ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8QXJyYXk8bnVtYmVyPj4oKTtcbiAgQE91dHB1dCgpIGFyZWFzU3BsaXRTdGFydCA9IG5ldyBFdmVudEVtaXR0ZXI8QXJyYXk8bnVtYmVyPj4oKTtcbiAgQE91dHB1dCgpIGFyZWFzU3BsaXRFbmQgPSBuZXcgRXZlbnRFbWl0dGVyPEFycmF5PG51bWJlcj4+KCk7XG5cbiAgQFZpZXdDaGlsZCgnY29udGFpbmVyJywgeyBzdGF0aWM6IHRydWUgfSkgcHJpdmF0ZSBjb250YWluZXJFbGVtZW50ITogRWxlbWVudFJlZjxIVE1MRWxlbWVudD47XG4gIEBDb250ZW50Q2hpbGQoUHJpem1TcGxpdHRlckN1c3RvbUd1dHRlckRpcmVjdGl2ZSkgY3VzdG9tR3V0dGVyITogUHJpem1TcGxpdHRlckN1c3RvbUd1dHRlckRpcmVjdGl2ZTtcblxuICBAQ29udGVudENoaWxkcmVuKFByaXptU3BsaXR0ZXJBcmVhQ29tcG9uZW50KSBzcGxpdHRlckFyZWFRdWVyeUxpc3Q6IFF1ZXJ5TGlzdDxQcml6bVNwbGl0dGVyQXJlYUNvbXBvbmVudD4gPVxuICAgIHByaXptRW1wdHlRdWVyeUxpc3QoKTtcblxuICBAVmlld0NoaWxkcmVuKFByaXptU3BsaXR0ZXJHdXR0ZXJDb21wb25lbnQpXG4gIHNwbGl0dGVyR3V0dGVyUXVlcnlMaXN0OiBRdWVyeUxpc3Q8UHJpem1TcGxpdHRlckd1dHRlckNvbXBvbmVudD4gPSBwcml6bUVtcHR5UXVlcnlMaXN0KCk7XG5cbiAgb3ZlcnJpZGUgcmVhZG9ubHkgdGVzdElkXyA9ICd1aV9zcGxpdHRlcic7XG4gIGdldCBndXR0ZXJFbGVtZW50U2l6ZSgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmN1c3RvbUd1dHRlciA/IHRoaXMuY3VzdG9tR3V0dGVyLnNpemUgOiA4O1xuICB9XG5cbiAgYXJlYXMkITogT2JzZXJ2YWJsZTxQcml6bVNwbGl0dGVyQXJlYUNvbXBvbmVudFtdPjtcblxuICBndXR0ZXJzRGF0YTogQXJyYXk8R3V0dGVyRGF0YT4gPSBbXTtcblxuICBjb250YWluZXJTaXplJCQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0KDApO1xuXG4gIGxhc3RHYXAgPSAwO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBwcml2YXRlIGRlc3Ryb3kkOiBQcml6bURlc3Ryb3lTZXJ2aWNlLFxuICAgIHByaXZhdGUgc3BsaXR0ZXJTZXJ2aWNlOiBQcml6bVNwbGl0dGVyU2VydmljZVxuICApIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgcHVibGljIG5nQWZ0ZXJDb250ZW50SW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmFyZWFzJCA9IG1lcmdlKFxuICAgICAgdGhpcy5zcGxpdHRlckFyZWFRdWVyeUxpc3QuY2hhbmdlcy5waXBlKFxuICAgICAgICBzdGFydFdpdGg8UXVlcnlMaXN0PFByaXptU3BsaXR0ZXJBcmVhQ29tcG9uZW50Pj4odGhpcy5zcGxpdHRlckFyZWFRdWVyeUxpc3QpLFxuICAgICAgICBtYXAocWwgPT4gcWwudG9BcnJheSgpKVxuICAgICAgKSxcbiAgICAgIHRoaXMuc3BsaXR0ZXJTZXJ2aWNlLmFyZWFJbnB1dFNpemVDaGFuZ2UkJC5waXBlKG1hcCgoKSA9PiB0aGlzLnNwbGl0dGVyQXJlYVF1ZXJ5TGlzdC50b0FycmF5KCkpKVxuICAgICkucGlwZShcbiAgICAgIG1hcChhcmVhcyA9PiBhcmVhcy5maWx0ZXIoYXJlYSA9PiAhYXJlYS5oaWRkZW4pKSxcbiAgICAgIG9ic2VydmVPbihhc3luY1NjaGVkdWxlcilcbiAgICApO1xuXG4gICAgdGhpcy5hcmVhcyQucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpLnN1YnNjcmliZShhcmVhcyA9PiB7XG4gICAgICBjb25zdCBnYXAgPSAoKGFyZWFzLmxlbmd0aCAtIDEpICogdGhpcy5ndXR0ZXJFbGVtZW50U2l6ZSkgLyBhcmVhcy5sZW5ndGg7XG4gICAgICBpZiAoZ2FwICE9PSB0aGlzLmxhc3RHYXApIHtcbiAgICAgICAgYXJlYXMuZm9yRWFjaChhcmVhID0+IGFyZWEuc2V0Q3VycmVudFNpemVXaXRoQ2FsYyhnYXApKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5sYXN0R2FwID0gZ2FwO1xuXG4gICAgICB0aGlzLmd1dHRlcnNEYXRhID0gW107XG4gICAgICBhcmVhcy5mb3JFYWNoKChhcmVhLCBpbmRleCkgPT4ge1xuICAgICAgICBhcmVhLm9yZGVyID0gaW5kZXg7XG4gICAgICAgIGlmIChpbmRleCA8IGFyZWFzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICB0aGlzLmd1dHRlcnNEYXRhLnB1c2goeyBhcmVhQmVmb3JlOiBpbmRleCwgYXJlYUFmdGVyOiBpbmRleCArIDEsIG9yZGVyOiBpbmRleCArIDEgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgICB9KTtcblxuICAgIHRoaXMuc3BsaXR0ZXJTZXJ2aWNlLmFyZWFJbnB1dFNpemVDaGFuZ2UkJFxuICAgICAgLnBpcGUod2l0aExhdGVzdEZyb20odGhpcy5hcmVhcyQpLCB0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpXG4gICAgICAuc3Vic2NyaWJlKChbY2hhbmdlZEFyZWEsIGFyZWFzXSkgPT4ge1xuICAgICAgICBjb25zdCBnYXAgPSAoKGFyZWFzLmxlbmd0aCAtIDEpICogdGhpcy5ndXR0ZXJFbGVtZW50U2l6ZSkgLyBhcmVhcy5sZW5ndGg7XG4gICAgICAgIGNoYW5nZWRBcmVhLnNldEN1cnJlbnRTaXplV2l0aENhbGMoZ2FwKTtcbiAgICAgICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XG4gICAgY29uc3QgZ3V0dGVyc0NvbXBvbmVudHMkID0gdGhpcy5zcGxpdHRlckd1dHRlclF1ZXJ5TGlzdC5jaGFuZ2VzLnBpcGUoXG4gICAgICBzdGFydFdpdGg8UXVlcnlMaXN0PFByaXptU3BsaXR0ZXJHdXR0ZXJDb21wb25lbnQ+Pih0aGlzLnNwbGl0dGVyR3V0dGVyUXVlcnlMaXN0KSxcbiAgICAgIG1hcChxbCA9PiBxbC50b0FycmF5KCkpXG4gICAgKTtcblxuICAgIGd1dHRlcnNDb21wb25lbnRzJFxuICAgICAgLnBpcGUoXG4gICAgICAgIHN3aXRjaE1hcChndXR0ZXJzID0+XG4gICAgICAgICAgbWVyZ2UoXG4gICAgICAgICAgICAuLi5ndXR0ZXJzLm1hcChndXR0ZXIgPT4ge1xuICAgICAgICAgICAgICBjb25zdCBlbGVtID0gZ3V0dGVyLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudDtcblxuICAgICAgICAgICAgICByZXR1cm4gZnJvbUV2ZW50PFBvaW50ZXJFdmVudD4oZWxlbSwgJ3BvaW50ZXJkb3duJykucGlwZShcbiAgICAgICAgICAgICAgICB3aXRoTGF0ZXN0RnJvbSh0aGlzLmFyZWFzJCksXG4gICAgICAgICAgICAgICAgc3dpdGNoTWFwKChbZXZlbnQsIGFyZWFzXSkgPT4ge1xuICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgIGVsZW0uc2V0UG9pbnRlckNhcHR1cmUoZXZlbnQucG9pbnRlcklkKTtcblxuICAgICAgICAgICAgICAgICAgY29uc3QgY29udGFpbmVyQkNSID0gdGhpcy5jb250YWluZXJFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgICAgICAgICAgICBjb25zdCBjb250YWluZXJTaXplID0gdGhpcy5pc0hvcml6b250YWwgPyBjb250YWluZXJCQ1Iud2lkdGggOiBjb250YWluZXJCQ1IuaGVpZ2h0O1xuXG4gICAgICAgICAgICAgICAgICBjb25zdCBndXR0ZXJzU2l6ZSA9IHRoaXMuc3BsaXR0ZXJHdXR0ZXJRdWVyeUxpc3QubGVuZ3RoICogdGhpcy5ndXR0ZXJFbGVtZW50U2l6ZTtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IGd1dHRlcnNHYXBJblB4ID0gdGhpcy5zcGxpdHRlclNlcnZpY2UubWF0aE9wZXJhdGlvbihndXR0ZXJzU2l6ZSwgYXJlYXMubGVuZ3RoLCAnLycpO1xuICAgICAgICAgICAgICAgICAgY29uc3QgZ3V0dGVyc0dhcEluUGVyY2VudCA9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3BsaXR0ZXJTZXJ2aWNlLm1hdGhPcGVyYXRpb24oZ3V0dGVyc0dhcEluUHgsIGNvbnRhaW5lclNpemUsICcvJykgKiAxMDA7XG5cbiAgICAgICAgICAgICAgICAgIGNvbnN0IGd1dHRlcnNCZWZvcmUgPSBndXR0ZXIub3JkZXIgLSAxO1xuICAgICAgICAgICAgICAgICAgY29uc3QgZ3V0dGVyc0FmdGVyID0gZ3V0dGVycy5sZW5ndGggLSBndXR0ZXIub3JkZXI7XG5cbiAgICAgICAgICAgICAgICAgIGNvbnN0IGFyZWFzQmVmb3JlID0gYXJlYXNcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihhcmVhID0+IGFyZWEub3JkZXIgPCBndXR0ZXIub3JkZXIpXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoYXJlYSA9PiB0aGlzLmdldEFyZWFSZWFsU2l6ZXMoYXJlYSwgY29udGFpbmVyU2l6ZSwgZ3V0dGVyc0dhcEluUGVyY2VudCkpO1xuXG4gICAgICAgICAgICAgICAgICBjb25zdCBhcmVhc0FmdGVyID0gYXJlYXNcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihhcmVhID0+IGFyZWEub3JkZXIgPj0gZ3V0dGVyLm9yZGVyKVxuICAgICAgICAgICAgICAgICAgICAubWFwKGFyZWEgPT4gdGhpcy5nZXRBcmVhUmVhbFNpemVzKGFyZWEsIGNvbnRhaW5lclNpemUsIGd1dHRlcnNHYXBJblBlcmNlbnQpKTtcblxuICAgICAgICAgICAgICAgICAgY29uc3QgbWluID0gdGhpcy5zcGxpdHRlclNlcnZpY2UubWF0aE9wZXJhdGlvbihcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0hvcml6b250YWwgPyBjb250YWluZXJCQ1IubGVmdCA6IGNvbnRhaW5lckJDUi50b3AsXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3BsaXR0ZXJTZXJ2aWNlLm1hdGhPcGVyYXRpb24odGhpcy5ndXR0ZXJFbGVtZW50U2l6ZSwgZ3V0dGVyc0JlZm9yZSwgJyonKSxcbiAgICAgICAgICAgICAgICAgICAgJysnXG4gICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICBjb25zdCBtYXggPSB0aGlzLnNwbGl0dGVyU2VydmljZS5tYXRoT3BlcmF0aW9uKFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSG9yaXpvbnRhbCA/IGNvbnRhaW5lckJDUi5yaWdodCA6IGNvbnRhaW5lckJDUi5ib3R0b20sXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ3V0dGVyRWxlbWVudFNpemUgKiAoZ3V0dGVyc0FmdGVyICsgMSksXG4gICAgICAgICAgICAgICAgICAgICctJ1xuICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgY29uc3Qgc3BsaXR0ZXJCQ1IgPSBlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgICAgICAgICAgICAgICBjb25zdCBvZmZzZXQgPSB7XG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IHRoaXMuc3BsaXR0ZXJTZXJ2aWNlLm1hdGhPcGVyYXRpb24oZXZlbnQuY2xpZW50WCwgc3BsaXR0ZXJCQ1IubGVmdCwgJy0nKSxcbiAgICAgICAgICAgICAgICAgICAgdG9wOiB0aGlzLnNwbGl0dGVyU2VydmljZS5tYXRoT3BlcmF0aW9uKGV2ZW50LmNsaWVudFksIHNwbGl0dGVyQkNSLnRvcCwgJy0nKSxcbiAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgIGd1dHRlci5wb3NpdGlvbiA9IHRoaXMuaXNIb3Jpem9udGFsXG4gICAgICAgICAgICAgICAgICAgID8gdGhpcy5zcGxpdHRlclNlcnZpY2UubWF0aE9wZXJhdGlvbihldmVudC5jbGllbnRYLCBvZmZzZXQubGVmdCwgJy0nKVxuICAgICAgICAgICAgICAgICAgICA6IHRoaXMuc3BsaXR0ZXJTZXJ2aWNlLm1hdGhPcGVyYXRpb24oZXZlbnQuY2xpZW50WSwgb2Zmc2V0LnRvcCwgJy0nKTtcblxuICAgICAgICAgICAgICAgICAgdGhpcy5hcmVhc1NwbGl0U3RhcnQuZW1pdChcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRBcmVhc1NpemUoXG4gICAgICAgICAgICAgICAgICAgICAgWy4uLmFyZWFzQmVmb3JlLCAuLi5hcmVhc0FmdGVyXSxcbiAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXJTaXplLFxuICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lclNpemUgLSBndXR0ZXJzU2l6ZVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICByZXR1cm4gZnJvbUV2ZW50PFBvaW50ZXJFdmVudD4oZWxlbSwgJ3BvaW50ZXJtb3ZlJykucGlwZShcbiAgICAgICAgICAgICAgICAgICAgbWFwKGV2ZW50ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBndXR0ZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pbixcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZWFzQmVmb3JlLFxuICAgICAgICAgICAgICAgICAgICAgICAgYXJlYXNBZnRlcixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lclNpemUsXG4gICAgICAgICAgICAgICAgICAgICAgICBndXR0ZXJzU2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgdGFrZVVudGlsKFxuICAgICAgICAgICAgICAgICAgICAgIG1lcmdlKGZyb21FdmVudChkb2N1bWVudCwgJ3BvaW50ZXJ1cCcpLCBmcm9tRXZlbnQoZWxlbSwgJ3BvaW50ZXJjYW5jZWwnKSkucGlwZShcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcChldmVudCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXJlYXNTcGxpdEVuZC5lbWl0KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0QXJlYXNTaXplKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWy4uLmFyZWFzQmVmb3JlLCAuLi5hcmVhc0FmdGVyXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lclNpemUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXJTaXplIC0gZ3V0dGVyc1NpemVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICApXG4gICAgICAgICksXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZShcbiAgICAgICAgKHsgZ3V0dGVyLCBldmVudCwgb2Zmc2V0LCBtaW4sIG1heCwgYXJlYXNCZWZvcmUsIGFyZWFzQWZ0ZXIsIGNvbnRhaW5lclNpemUsIGd1dHRlcnNTaXplIH0pID0+IHtcbiAgICAgICAgICBsZXQgbmV3UG9zaXRpb24gPSB0aGlzLmlzSG9yaXpvbnRhbFxuICAgICAgICAgICAgPyB0aGlzLnNwbGl0dGVyU2VydmljZS5tYXRoT3BlcmF0aW9uKGV2ZW50LmNsaWVudFgsIG9mZnNldC5sZWZ0LCAnLScpXG4gICAgICAgICAgICA6IHRoaXMuc3BsaXR0ZXJTZXJ2aWNlLm1hdGhPcGVyYXRpb24oZXZlbnQuY2xpZW50WSwgb2Zmc2V0LnRvcCwgJy0nKTtcblxuICAgICAgICAgIGlmIChuZXdQb3NpdGlvbiA8IG1pbikge1xuICAgICAgICAgICAgbmV3UG9zaXRpb24gPSBtaW47XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChuZXdQb3NpdGlvbiA+IG1heCkge1xuICAgICAgICAgICAgbmV3UG9zaXRpb24gPSBtYXg7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QgZGlmZiA9IHRoaXMuc3BsaXR0ZXJTZXJ2aWNlLm1hdGhPcGVyYXRpb24oZ3V0dGVyLnBvc2l0aW9uLCBuZXdQb3NpdGlvbiwgJy0nKTtcblxuICAgICAgICAgIGxldCBvZmZzZXRJblBlcmNlbnQ7XG5cbiAgICAgICAgICBpZiAobmV3UG9zaXRpb24gPT09IG1pbikge1xuICAgICAgICAgICAgb2Zmc2V0SW5QZXJjZW50ID0gYXJlYXNCZWZvcmUucmVkdWNlKChwcmV2LCBjdXJyKSA9PiBwcmV2ICsgY3Vyci5yZWFsU2l6ZSwgMCk7XG4gICAgICAgICAgfSBlbHNlIGlmIChuZXdQb3NpdGlvbiA9PT0gbWF4KSB7XG4gICAgICAgICAgICBvZmZzZXRJblBlcmNlbnQgPSBhcmVhc0FmdGVyLnJlZHVjZSgocHJldiwgY3VycikgPT4gcHJldiArIGN1cnIucmVhbFNpemUsIDApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvZmZzZXRJblBlcmNlbnQgPSBNYXRoLmFicyh0aGlzLnNwbGl0dGVyU2VydmljZS5tYXRoT3BlcmF0aW9uKGRpZmYsIGNvbnRhaW5lclNpemUsICcvJykpICogMTAwO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IHJldmVyY2VkQXJlYXNCZWZvcmUgPSBbLi4uYXJlYXNCZWZvcmVdLnJldmVyc2UoKTtcbiAgICAgICAgICBpZiAoZGlmZiA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZGlmZiA8IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHNocmlua2VkID0gdGhpcy5zaHJpbmtBcmVhcyhhcmVhc0FmdGVyLCBvZmZzZXRJblBlcmNlbnQpO1xuXG4gICAgICAgICAgICByZXZlcmNlZEFyZWFzQmVmb3JlWzBdLnJlYWxTaXplID0gdGhpcy5zcGxpdHRlclNlcnZpY2UubWF0aE9wZXJhdGlvbihcbiAgICAgICAgICAgICAgcmV2ZXJjZWRBcmVhc0JlZm9yZVswXS5yZWFsU2l6ZSxcbiAgICAgICAgICAgICAgc2hyaW5rZWQsXG4gICAgICAgICAgICAgICcrJ1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldmVyY2VkQXJlYXNCZWZvcmVbMF0uYXJlYS5zZXRDdXJyZW50U2l6ZShyZXZlcmNlZEFyZWFzQmVmb3JlWzBdLnJlYWxTaXplKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGRpZmYgPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBzaHJpbmtlZCA9IHRoaXMuc2hyaW5rQXJlYXMocmV2ZXJjZWRBcmVhc0JlZm9yZSwgb2Zmc2V0SW5QZXJjZW50KTtcbiAgICAgICAgICAgIGFyZWFzQWZ0ZXJbMF0ucmVhbFNpemUgPSB0aGlzLnNwbGl0dGVyU2VydmljZS5tYXRoT3BlcmF0aW9uKFxuICAgICAgICAgICAgICBhcmVhc0FmdGVyWzBdLnJlYWxTaXplLFxuICAgICAgICAgICAgICBzaHJpbmtlZCxcbiAgICAgICAgICAgICAgJysnXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgYXJlYXNBZnRlclswXS5hcmVhLnNldEN1cnJlbnRTaXplKGFyZWFzQWZ0ZXJbMF0ucmVhbFNpemUpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGd1dHRlci5wb3NpdGlvbiA9IG5ld1Bvc2l0aW9uO1xuXG4gICAgICAgICAgdGhpcy5hcmVhc1NpemVDaGFuZ2UuZW1pdChcbiAgICAgICAgICAgIHRoaXMuZ2V0QXJlYXNTaXplKFsuLi5hcmVhc0JlZm9yZSwgLi4uYXJlYXNBZnRlcl0sIGNvbnRhaW5lclNpemUsIGNvbnRhaW5lclNpemUgLSBndXR0ZXJzU2l6ZSlcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gIH1cblxuICBwcml2YXRlIHNocmlua0FyZWFzKGFyZWFzOiBBcmVhUmVhbFNpemVbXSwgb2Zmc2V0SW5QZXJjZW50OiBudW1iZXIpOiBudW1iZXIge1xuICAgIGxldCBzdW0gPSAwO1xuXG4gICAgZm9yIChjb25zdCBhcmVhUmVhbFNpemVzIG9mIGFyZWFzKSB7XG4gICAgICBpZiAob2Zmc2V0SW5QZXJjZW50ID09PSAwKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBhdmFsYWJsZVNpemUgPSB0aGlzLnNwbGl0dGVyU2VydmljZS5tYXRoT3BlcmF0aW9uKFxuICAgICAgICBhcmVhUmVhbFNpemVzLnJlYWxTaXplLFxuICAgICAgICBhcmVhUmVhbFNpemVzLnJlYWxNaW5TaXplLFxuICAgICAgICAnLSdcbiAgICAgICk7XG4gICAgICBpZiAoYXZhbGFibGVTaXplID49IG9mZnNldEluUGVyY2VudCkge1xuICAgICAgICBhcmVhUmVhbFNpemVzLnJlYWxTaXplID0gdGhpcy5zcGxpdHRlclNlcnZpY2UubWF0aE9wZXJhdGlvbihcbiAgICAgICAgICBhcmVhUmVhbFNpemVzLnJlYWxTaXplLFxuICAgICAgICAgIG9mZnNldEluUGVyY2VudCxcbiAgICAgICAgICAnLSdcbiAgICAgICAgKTtcbiAgICAgICAgYXJlYVJlYWxTaXplcy5hcmVhLnNldEN1cnJlbnRTaXplKGFyZWFSZWFsU2l6ZXMucmVhbFNpemUpO1xuICAgICAgICBzdW0gPSB0aGlzLnNwbGl0dGVyU2VydmljZS5tYXRoT3BlcmF0aW9uKHN1bSwgb2Zmc2V0SW5QZXJjZW50LCAnKycpO1xuICAgICAgICBvZmZzZXRJblBlcmNlbnQgPSAwO1xuXG4gICAgICAgIGlmIChhcmVhUmVhbFNpemVzLnJlYWxTaXplID09PSBhcmVhUmVhbFNpemVzLnJlYWxNaW5TaXplKSB7XG4gICAgICAgICAgYXJlYVJlYWxTaXplcy5hcmVhLmFyZWFNaW5TaXplLmVtaXQoKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9mZnNldEluUGVyY2VudCA9IHRoaXMuc3BsaXR0ZXJTZXJ2aWNlLm1hdGhPcGVyYXRpb24ob2Zmc2V0SW5QZXJjZW50LCBhdmFsYWJsZVNpemUsICctJyk7XG4gICAgICAgIHN1bSA9IHRoaXMuc3BsaXR0ZXJTZXJ2aWNlLm1hdGhPcGVyYXRpb24oc3VtLCBhdmFsYWJsZVNpemUsICcrJyk7XG4gICAgICAgIGFyZWFSZWFsU2l6ZXMucmVhbFNpemUgPSBhcmVhUmVhbFNpemVzLnJlYWxNaW5TaXplO1xuICAgICAgICBhcmVhUmVhbFNpemVzLmFyZWEuc2V0Q3VycmVudFNpemUoYXJlYVJlYWxTaXplcy5yZWFsU2l6ZSk7XG5cbiAgICAgICAgYXJlYVJlYWxTaXplcy5hcmVhLmFyZWFNaW5TaXplLmVtaXQoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gc3VtO1xuICB9XG5cbiAgcHVibGljIGdldCBpc0hvcml6b250YWwoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMub3JpZW50YXRpb24gPT09ICdob3Jpem9udGFsJztcbiAgfVxuXG4gIHByaXZhdGUgZ2V0QXJlYVJlYWxTaXplcyhcbiAgICBhcmVhOiBQcml6bVNwbGl0dGVyQXJlYUNvbXBvbmVudCxcbiAgICBjb250YWluZXJTaXplOiBudW1iZXIsXG4gICAgZ3V0dGVyc0dhcEluUGVyY2VudDogbnVtYmVyXG4gICk6IEFyZWFSZWFsU2l6ZSB7XG4gICAgY29uc3Qgc2l6ZUluUHggPSBhcmVhLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudFt0aGlzLmlzSG9yaXpvbnRhbCA/ICdvZmZzZXRXaWR0aCcgOiAnb2Zmc2V0SGVpZ2h0J107XG4gICAgY29uc3QgcmVhbFNpemUgPSB0aGlzLnNwbGl0dGVyU2VydmljZS5tYXRoT3BlcmF0aW9uKHNpemVJblB4LCBjb250YWluZXJTaXplLCAnLycpICogMTAwO1xuICAgIGNvbnN0IHJlYWxNaW5TaXplID0gTWF0aC5tYXgoXG4gICAgICAwLFxuICAgICAgdGhpcy5zcGxpdHRlclNlcnZpY2UubWF0aE9wZXJhdGlvbihhcmVhLm1pblNpemUsIGd1dHRlcnNHYXBJblBlcmNlbnQsICctJylcbiAgICApO1xuICAgIHJldHVybiB7XG4gICAgICBhcmVhLFxuICAgICAgcmVhbFNpemUsXG4gICAgICByZWFsTWluU2l6ZSxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRBcmVhc1NpemUoYXJlYXM6IEFycmF5PEFyZWFSZWFsU2l6ZT4sIGNvbnRhaW5lclNpemU6IG51bWJlciwgYXJlYXNTaXplOiBudW1iZXIpOiBBcnJheTxudW1iZXI+IHtcbiAgICBjb25zdCBzaXplcyA9IGFyZWFzLm1hcCgoeyBhcmVhLCByZWFsU2l6ZSwgcmVhbE1pblNpemUgfSkgPT4ge1xuICAgICAgaWYgKHJlYWxNaW5TaXplID09PSByZWFsU2l6ZSkge1xuICAgICAgICByZXR1cm4gYXJlYS5taW5TaXplO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGNvbnRhaW5lclNpemUgKiAocmVhbFNpemUgLyBhcmVhc1NpemUpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHNpemVzO1xuICB9XG59XG4iLCI8ZGl2IGNsYXNzPVwiY29udGFpbmVyIGNvbnRhaW5lci0te3sgb3JpZW50YXRpb24gfX1cIiAjY29udGFpbmVyPlxuICA8cHJpem0tc3BsaXR0ZXItZ3V0dGVyXG4gICAgKm5nRm9yPVwibGV0IGd1dHRlciBvZiBndXR0ZXJzRGF0YVwiXG4gICAgW2FyZWFCZWZvcmVdPVwiJGFueShndXR0ZXIuYXJlYUJlZm9yZSlcIlxuICAgIFthcmVhQWZ0ZXJdPVwiJGFueShndXR0ZXIuYXJlYUFmdGVyKVwiXG4gICAgW29yZGVyXT1cIiRhbnkoZ3V0dGVyLm9yZGVyKVwiXG4gICAgW29yaWVudGF0aW9uXT1cIm9yaWVudGF0aW9uXCJcbiAgICBbdGVtcGxhdGVdPVwiJGFueShjdXN0b21HdXR0ZXI/LnRlbXBsYXRlKVwiXG4gID5cbiAgPC9wcml6bS1zcGxpdHRlci1ndXR0ZXI+XG4gIDxuZy1jb250ZW50IHNlbGVjdD1cInByaXptLXNwbGl0dGVyLWFyZWFcIj48L25nLWNvbnRlbnQ+XG48L2Rpdj5cbiJdfQ==