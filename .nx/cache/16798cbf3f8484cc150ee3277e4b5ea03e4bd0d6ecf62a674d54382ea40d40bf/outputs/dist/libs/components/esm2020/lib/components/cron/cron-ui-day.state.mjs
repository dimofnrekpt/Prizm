import { Injectable } from '@angular/core';
import { PrizmCronUiDayType } from './model';
import { PrizmCronUiBaseState } from './cron-ui-base.state';
import { PrizmDestroyService } from '@prizm-ui/helpers';
import { PrizmCronService } from '../../services/cron';
import { getArrWithStringNumbers, getArrWithWeekNumber, getCarousel, getCarouselWeek, prizmConvertDayToType, } from './util';
import { combineLatest } from 'rxjs';
import { filter, map, takeUntil, tap } from 'rxjs/operators';
import { PRIZM_CRON_UI_DAYS_OF_WEEK_CRON_KEYS } from './const';
import * as i0 from "@angular/core";
import * as i1 from "../../services/cron";
import * as i2 from "@prizm-ui/helpers";
export class PrizmCronUiDayState extends PrizmCronUiBaseState {
    constructor(cron, destroy$) {
        super(cron.value$.pipe(map(i => [i.dayOfMonth, i.dayOfWeek])), PrizmCronUiDayType.every, PrizmCronUiDayType, {
            value: {
                start: '0',
                end: '1',
            },
            list: {
                start: getCarousel(31, 0),
                end: getCarousel(31, 0),
            },
        }, {
            value: ['0'],
            list: getArrWithStringNumbers(31, 0, false).map((i, idx) => ({
                key: i,
                value: i,
            })),
        }, {
            list: {
                on: getCarousel(31, 1),
                after: getCarousel(31, 0),
            },
            value: {
                on: '1',
                after: '0',
            },
        });
        this.cron = cron;
        this.destroy$ = destroy$;
        this.lastChosenDayOfMonthValue = '1';
        this.selectedDayOfWeek = [];
        this.afterNumberOfWeekList = getCarousel(5, 1);
        this.onNumberOfWeekListValue = this.afterNumberOfWeekList.first;
        this.dayOfMonthItems = getArrWithStringNumbers(31, 1).map((key, index) => ({
            key: key,
            value: key,
        }));
        this.dayOfWeekItems = getArrWithWeekNumber().map(i => ({
            key: PRIZM_CRON_UI_DAYS_OF_WEEK_CRON_KEYS[parseInt(i, 10) - 1],
            value: i,
        }));
        this.carouselWeek = getCarouselWeek();
        this.carouselWeekLastChosenDayOfChosenWeek = getCarouselWeek();
        this.carouselWeekLastChosenDayOfWeek = getCarouselWeek();
        this.carouselWeekAfterDayOfWeek = getCarouselWeek();
        this.lastChosenDayOfWeekValue2 = this.carouselWeek.first;
        this.lastChosenDayOfWeekValue = this.carouselWeek.first;
        this.nearestDayOfMonth = getCarousel(31, 1);
        this.contentLastChosenDayOfMonth = getCarousel(31, 1);
        this.afterDayOfWeekListDays = getCarousel(7, 1);
        this.selectedDayOfMonth = [];
        this.afterDayOfWeekListDaysValue = this.afterDayOfWeekListDays.first;
        this.afterDayOfWeekListDayOfWeeksValue = this.carouselWeek.first;
        this.afterDayOfMonthListDays = getCarousel(31, 1);
        this.afterDayOfMonthListDaysValue = this.afterDayOfMonthListDays.first;
        this.afterDayOfMonthListRepeatDays = getCarousel(31, 1);
        this.afterDayOfMonthListRepeatDaysValue = this.afterDayOfMonthListRepeatDays.first;
        this.nearestDayOfMonthValue = '1';
    }
    setLastDayOfMonth() {
        this.cron.updateWith({
            dayOfMonth: 'L',
            dayOfWeek: '?',
        });
    }
    setLastWeekDayOfMonth() {
        this.cron.updateWith({
            dayOfMonth: 'LW',
            dayOfWeek: '?',
        });
    }
    init() {
        combineLatest([this.cron.dayOfMonth$, this.cron.dayOfWeek$])
            .pipe(map(([day, dayOfWeek]) => prizmConvertDayToType(day, dayOfWeek)), filter(i => i != this.typeControl.value), tap(type => {
            this.typeControl.setValue(type);
        }), takeUntil(this.destroy$))
            .subscribe();
        this.initLocalStateChanger();
    }
    /**
     * set every *
     * */
    setEvery() {
        this.cron.updateWith({
            dayOfWeek: `*`,
            dayOfMonth: `?`,
        });
    }
    updateLastChosenDayOfMonth(lastChosenDayOfMonthValue) {
        this.lastChosenDayOfMonthValue = lastChosenDayOfMonthValue ?? this.lastChosenDayOfMonthValue;
        this.cron.updateWith({
            dayOfWeek: `?`,
            dayOfMonth: `L-${lastChosenDayOfMonthValue || 1}`,
        });
    }
    updateLastChosenDayOfWeek(lastChosenDayOfWeekValue, addEnding = true) {
        const newValue = (addEnding ? lastChosenDayOfWeekValue : lastChosenDayOfWeekValue.replace(/L$/g, '')) || '2';
        this.lastChosenDayOfWeekValue = newValue;
        this.cron.updateWith({
            dayOfMonth: `?`,
            dayOfWeek: `${newValue}L`,
        });
    }
    updateLastChosenDayOfChosenWeek(onNumberOfWeekListValue, lastChosenDayOfWeekValue2) {
        this.onNumberOfWeekListValue = onNumberOfWeekListValue ?? this.onNumberOfWeekListValue;
        this.lastChosenDayOfWeekValue2 = lastChosenDayOfWeekValue2 ?? this.lastChosenDayOfWeekValue2;
        this.cron.updateWith({
            dayOfMonth: `?`,
            dayOfWeek: `${this.lastChosenDayOfWeekValue2}#${this.onNumberOfWeekListValue}`,
        });
    }
    updateAfterDayOfWeek({ afterDayOfWeekListDaysValue, afterDayOfWeekListDayOfWeeksValue, } = {}) {
        this.afterDayOfWeekListDaysValue = afterDayOfWeekListDaysValue ?? this.afterDayOfWeekListDaysValue;
        this.afterDayOfWeekListDayOfWeeksValue =
            afterDayOfWeekListDayOfWeeksValue ?? this.afterDayOfWeekListDayOfWeeksValue;
        if (!this.afterDayOfWeekListDayOfWeeksValue)
            return;
        this.cron.updateWith({
            dayOfMonth: `?`,
            dayOfWeek: `${this.afterDayOfWeekListDayOfWeeksValue}/${this.afterDayOfWeekListDaysValue}`,
        });
    }
    updateSelectedDayOfWeek(selectedDayOfWeek) {
        this.selectedDayOfWeek = selectedDayOfWeek;
        this.cron.updateWith({
            dayOfMonth: `?`,
            dayOfWeek: this.selectedDayOfWeek.join(','),
        });
    }
    updateSelectedDayOfMonth(selectedDayOfMonth) {
        this.selectedDayOfMonth = selectedDayOfMonth;
        this.cron.updateWith({
            dayOfWeek: `?`,
            dayOfMonth: [...new Set(this.selectedDayOfMonth.length ? this.selectedDayOfMonth : ['1'])].join(','),
        });
    }
    updateAfterDayOfMonth(afterDayOfMonthListRepeatDaysValue, afterDayOfMonthListDaysValue) {
        this.afterDayOfMonthListRepeatDaysValue =
            afterDayOfMonthListRepeatDaysValue ?? this.afterDayOfMonthListRepeatDaysValue;
        this.afterDayOfMonthListDaysValue = afterDayOfMonthListDaysValue ?? this.afterDayOfMonthListDaysValue;
        this.cron.updateWith({
            dayOfWeek: `?`,
            dayOfMonth: `${this.afterDayOfMonthListDaysValue}/${this.afterDayOfMonthListRepeatDaysValue}`,
        });
    }
    updateNearestDayOfMonth(nearestDayOfMonthValue) {
        this.nearestDayOfMonthValue = nearestDayOfMonthValue ?? this.nearestDayOfMonthValue;
        this.cron.updateWith({
            dayOfMonth: `${this.nearestDayOfMonthValue}W`,
            dayOfWeek: '?',
        });
    }
    updateBetween({ start, end, } = {}) {
        start = start ?? this.state$.value.between.start;
        end = end ?? this.state$.value.between.end;
        this.state$.value.between.start = start;
        this.state$.value.between.end = end;
        this.cron.updateWith({
            dayOfMonth: `${start}-${end}`,
        });
    }
    getTypeByValueByDefault(value, cron) {
        return prizmConvertDayToType(cron.dayOfMonth, cron.dayOfWeek);
    }
    updateLocalState([dayOfMonth, dayOfWeek], type) {
        switch (type) {
            case this.TYPES.between:
                {
                    const arr = dayOfMonth.split('-');
                    const start = arr[0] ?? '0';
                    const end = arr[1] ?? '0';
                    this.updatePartial({
                        type: PrizmCronUiDayType.between,
                        between: {
                            start: start,
                            end: end,
                        },
                    });
                }
                break;
            case this.TYPES.every:
                this.updatePartial({
                    type: PrizmCronUiDayType.every,
                });
                break;
            case this.TYPES.specifiedDayOfWeek:
                {
                    this.updateSelectedDayOfWeek(dayOfWeek.split(','));
                }
                break;
            case this.TYPES.lastChosenDayOfWeek:
                {
                    this.updateLastChosenDayOfWeek(dayOfWeek, false);
                }
                break;
            case this.TYPES.nearestWeekDayToTheChosenDayOfMonth:
                {
                    this.updateNearestDayOfMonth(dayOfMonth?.replace('W', ''));
                }
                break;
            case this.TYPES.onTheChosenDayOfWeek:
                {
                    const [lastChosenDayOfWeekValue2, onNumberOfWeekListValue] = dayOfWeek?.split('#') ?? [];
                    if (lastChosenDayOfWeekValue2 && onNumberOfWeekListValue)
                        this.updateLastChosenDayOfChosenWeek(onNumberOfWeekListValue, lastChosenDayOfWeekValue2);
                }
                break;
            case this.TYPES.specifiedDayOfMonth:
                {
                    this.updateSelectedDayOfMonth(dayOfMonth.split(','));
                }
                break;
            case this.TYPES.lastChosenDaysOfMonth:
                {
                    this.updateLastChosenDayOfMonth(dayOfMonth?.replace(/L-/g, ''));
                }
                break;
            case this.TYPES.afterDayOfMonth:
                {
                    const [afterDayOfMonthListDaysValue, afterDayOfMonthListRepeatDaysValue] = dayOfMonth?.split('/') ?? [];
                    this.updateAfterDayOfMonth(afterDayOfMonthListRepeatDaysValue, afterDayOfMonthListDaysValue);
                }
                break;
            case this.TYPES.afterDayOfWeek:
                {
                    const [afterDayOfWeekListDayOfWeeksValue, afterDayOfWeekListDaysValue] = dayOfWeek?.split('/') ?? [];
                    if (afterDayOfWeekListDayOfWeeksValue && afterDayOfWeekListDaysValue)
                        this.updateAfterDayOfWeek({ afterDayOfWeekListDaysValue, afterDayOfWeekListDayOfWeeksValue });
                }
                break;
        }
    }
    isBaseChanged(a, b) {
        return a && b && a?.[0] === b?.[0] && a?.[1] === b?.[1];
    }
    updateMainState(value) {
        this.cron.updateWith({
            dayOfMonth: value,
        });
    }
}
PrizmCronUiDayState.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: PrizmCronUiDayState, deps: [{ token: i1.PrizmCronService }, { token: i2.PrizmDestroyService }], target: i0.ɵɵFactoryTarget.Injectable });
PrizmCronUiDayState.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: PrizmCronUiDayState });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: PrizmCronUiDayState, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.PrizmCronService }, { type: i2.PrizmDestroyService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3Jvbi11aS1kYXkuc3RhdGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL2NvbXBvbmVudHMvc3JjL2xpYi9jb21wb25lbnRzL2Nyb24vY3Jvbi11aS1kYXkuc3RhdGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQXVCLGtCQUFrQixFQUF1QixNQUFNLFNBQVMsQ0FBQztBQUN2RixPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsZ0JBQWdCLEVBQXdCLE1BQU0scUJBQXFCLENBQUM7QUFDN0UsT0FBTyxFQUNMLHVCQUF1QixFQUN2QixvQkFBb0IsRUFDcEIsV0FBVyxFQUNYLGVBQWUsRUFDZixxQkFBcUIsR0FDdEIsTUFBTSxRQUFRLENBQUM7QUFDaEIsT0FBTyxFQUFFLGFBQWEsRUFBUyxNQUFNLE1BQU0sQ0FBQztBQUM1QyxPQUFPLEVBQXdCLE1BQU0sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ25GLE9BQU8sRUFBRSxvQ0FBb0MsRUFBRSxNQUFNLFNBQVMsQ0FBQzs7OztBQUcvRCxNQUFNLE9BQU8sbUJBQW9CLFNBQVEsb0JBQW1FO0lBaUMxRyxZQUE0QixJQUFzQixFQUFrQixRQUE2QjtRQUMvRixLQUFLLENBQ0gsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQ3ZELGtCQUFrQixDQUFDLEtBQUssRUFDeEIsa0JBQWtCLEVBQ2xCO1lBQ0UsS0FBSyxF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TTtZQUVSLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjO2dCQUM1QjtvQkFDRSxNQUFNLENBQUMsaUNBQWlDLEVBQUUsMkJBQTJCLENBQUMsR0FDcEUsU0FBUyxFQUFFLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7b0JBQzlCLElBQUksaUNBQWlDLElBQUksMkJBQTJCO3dCQUNsRSxJQUFJLENBQUMsb0JBQW9CLENBQUMsRUFBRSwyQkFBMkIsRUFBRSxpQ0FBaUMsRUFBRSxDQUFDLENBQUM7aUJBQ2pHO2dCQUNELE1BQU07U0FDVDtJQUNILENBQUM7SUFFa0IsYUFBYSxDQUFDLENBQW1CLEVBQUUsQ0FBbUI7UUFDdkUsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzFELENBQUM7SUFFTSxlQUFlLENBQUMsS0FBYTtRQUNsQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQztZQUNuQixVQUFVLEVBQUUsS0FBSztTQUNsQixDQUFDLENBQUM7SUFDTCxDQUFDOztnSEExU1UsbUJBQW1CO29IQUFuQixtQkFBbUI7MkZBQW5CLG1CQUFtQjtrQkFEL0IsVUFBVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFByaXptQ3JvblVpQmFzZVR5cGUsIFByaXptQ3JvblVpRGF5VHlwZSwgUHJpem1Dcm9uVWlMaXN0SXRlbSB9IGZyb20gJy4vbW9kZWwnO1xuaW1wb3J0IHsgUHJpem1Dcm9uVWlCYXNlU3RhdGUgfSBmcm9tICcuL2Nyb24tdWktYmFzZS5zdGF0ZSc7XG5pbXBvcnQgeyBQcml6bURlc3Ryb3lTZXJ2aWNlIH0gZnJvbSAnQHByaXptLXVpL2hlbHBlcnMnO1xuaW1wb3J0IHsgUHJpem1Dcm9uU2VydmljZSwgUHJpem1Dcm9uVmFsdWVPYmplY3QgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9jcm9uJztcbmltcG9ydCB7XG4gIGdldEFycldpdGhTdHJpbmdOdW1iZXJzLFxuICBnZXRBcnJXaXRoV2Vla051bWJlcixcbiAgZ2V0Q2Fyb3VzZWwsXG4gIGdldENhcm91c2VsV2VlayxcbiAgcHJpem1Db252ZXJ0RGF5VG9UeXBlLFxufSBmcm9tICcuL3V0aWwnO1xuaW1wb3J0IHsgY29tYmluZUxhdGVzdCwgbWVyZ2UgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRpc3RpbmN0VW50aWxDaGFuZ2VkLCBmaWx0ZXIsIG1hcCwgdGFrZVVudGlsLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBQUklaTV9DUk9OX1VJX0RBWVNfT0ZfV0VFS19DUk9OX0tFWVMgfSBmcm9tICcuL2NvbnN0JztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFByaXptQ3JvblVpRGF5U3RhdGUgZXh0ZW5kcyBQcml6bUNyb25VaUJhc2VTdGF0ZTx0eXBlb2YgUHJpem1Dcm9uVWlEYXlUeXBlLCBQcml6bUNyb25VaURheVR5cGU+IHtcbiAgcHVibGljIGxhc3RDaG9zZW5EYXlPZk1vbnRoVmFsdWUgPSAnMSc7XG4gIHB1YmxpYyBzZWxlY3RlZERheU9mV2Vlazogc3RyaW5nW10gPSBbXTtcbiAgcHVibGljIHJlYWRvbmx5IGFmdGVyTnVtYmVyT2ZXZWVrTGlzdCA9IGdldENhcm91c2VsKDUsIDEpO1xuICBwdWJsaWMgb25OdW1iZXJPZldlZWtMaXN0VmFsdWUgPSB0aGlzLmFmdGVyTnVtYmVyT2ZXZWVrTGlzdC5maXJzdDtcbiAgcHVibGljIHJlYWRvbmx5IGRheU9mTW9udGhJdGVtczogUHJpem1Dcm9uVWlMaXN0SXRlbVtdID0gZ2V0QXJyV2l0aFN0cmluZ051bWJlcnMoMzEsIDEpLm1hcChcbiAgICAoa2V5LCBpbmRleCkgPT4gKHtcbiAgICAgIGtleToga2V5LFxuICAgICAgdmFsdWU6IGtleSxcbiAgICB9KVxuICApO1xuICBwdWJsaWMgcmVhZG9ubHkgZGF5T2ZXZWVrSXRlbXM6IFByaXptQ3JvblVpTGlzdEl0ZW1bXSA9IGdldEFycldpdGhXZWVrTnVtYmVyKCkubWFwKGkgPT4gKHtcbiAgICBrZXk6IFBSSVpNX0NST05fVUlfREFZU19PRl9XRUVLX0NST05fS0VZU1twYXJzZUludChpLCAxMCkgLSAxXSxcbiAgICB2YWx1ZTogaSxcbiAgfSkpO1xuXG4gIHB1YmxpYyByZWFkb25seSBjYXJvdXNlbFdlZWsgPSBnZXRDYXJvdXNlbFdlZWsoKTtcbiAgcHVibGljIHJlYWRvbmx5IGNhcm91c2VsV2Vla0xhc3RDaG9zZW5EYXlPZkNob3NlbldlZWsgPSBnZXRDYXJvdXNlbFdlZWsoKTtcbiAgcHVibGljIHJlYWRvbmx5IGNhcm91c2VsV2Vla0xhc3RDaG9zZW5EYXlPZldlZWsgPSBnZXRDYXJvdXNlbFdlZWsoKTtcbiAgcHVibGljIHJlYWRvbmx5IGNhcm91c2VsV2Vla0FmdGVyRGF5T2ZXZWVrID0gZ2V0Q2Fyb3VzZWxXZWVrKCk7XG4gIHB1YmxpYyBsYXN0Q2hvc2VuRGF5T2ZXZWVrVmFsdWUyID0gdGhpcy5jYXJvdXNlbFdlZWsuZmlyc3Q7XG4gIHB1YmxpYyBsYXN0Q2hvc2VuRGF5T2ZXZWVrVmFsdWUgPSB0aGlzLmNhcm91c2VsV2Vlay5maXJzdDtcbiAgcHVibGljIHJlYWRvbmx5IG5lYXJlc3REYXlPZk1vbnRoID0gZ2V0Q2Fyb3VzZWwoMzEsIDEpO1xuICBwdWJsaWMgcmVhZG9ubHkgY29udGVudExhc3RDaG9zZW5EYXlPZk1vbnRoID0gZ2V0Q2Fyb3VzZWwoMzEsIDEpO1xuICBwdWJsaWMgcmVhZG9ubHkgYWZ0ZXJEYXlPZldlZWtMaXN0RGF5cyA9IGdldENhcm91c2VsKDcsIDEpO1xuICBwdWJsaWMgc2VsZWN0ZWREYXlPZk1vbnRoOiBzdHJpbmdbXSA9IFtdO1xuICBwdWJsaWMgYWZ0ZXJEYXlPZldlZWtMaXN0RGF5c1ZhbHVlID0gdGhpcy5hZnRlckRheU9mV2Vla0xpc3REYXlzLmZpcnN0O1xuICBwdWJsaWMgYWZ0ZXJEYXlPZldlZWtMaXN0RGF5T2ZXZWVrc1ZhbHVlID0gdGhpcy5jYXJvdXNlbFdlZWsuZmlyc3Q7XG4gIHB1YmxpYyByZWFkb25seSBhZnRlckRheU9mTW9udGhMaXN0RGF5cyA9IGdldENhcm91c2VsKDMxLCAxKTtcbiAgcHVibGljIGFmdGVyRGF5T2ZNb250aExpc3REYXlzVmFsdWUgPSB0aGlzLmFmdGVyRGF5T2ZNb250aExpc3REYXlzLmZpcnN0O1xuICBwdWJsaWMgcmVhZG9ubHkgYWZ0ZXJEYXlPZk1vbnRoTGlzdFJlcGVhdERheXMgPSBnZXRDYXJvdXNlbCgzMSwgMSk7XG4gIHB1YmxpYyBhZnRlckRheU9mTW9udGhMaXN0UmVwZWF0RGF5c1ZhbHVlID0gdGhpcy5hZnRlckRheU9mTW9udGhMaXN0UmVwZWF0RGF5cy5maXJzdDtcbiAgcHVibGljIG5lYXJlc3REYXlPZk1vbnRoVmFsdWUgPSAnMSc7XG4gIGNvbnN0cnVjdG9yKHB1YmxpYyByZWFkb25seSBjcm9uOiBQcml6bUNyb25TZXJ2aWNlLCBwdWJsaWMgcmVhZG9ubHkgZGVzdHJveSQ6IFByaXptRGVzdHJveVNlcnZpY2UpIHtcbiAgICBzdXBlcihcbiAgICAgIGNyb24udmFsdWUkLnBpcGUobWFwKGkgPT4gW2kuZGF5T2ZNb250aCwgaS5kYXlPZldlZWtdKSksXG4gICAgICBQcml6bUNyb25VaURheVR5cGUuZXZlcnksXG4gICAgICBQcml6bUNyb25VaURheVR5cGUsXG4gICAgICB7XG4gICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgc3RhcnQ6ICcwJyxcbiAgICAgICAgICBlbmQ6ICcxJyxcbiAgICAgICAgfSxcbiAgICAgICAgbGlzdDoge1xuICAgICAgICAgIHN0YXJ0OiBnZXRDYXJvdXNlbCgzMSwgMCksXG4gICAgICAgICAgZW5kOiBnZXRDYXJvdXNlbCgzMSwgMCksXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB2YWx1ZTogWycwJ10sXG4gICAgICAgIGxpc3Q6IGdldEFycldpdGhTdHJpbmdOdW1iZXJzKDMxLCAwLCBmYWxzZSkubWFwKChpLCBpZHgpID0+ICh7XG4gICAgICAgICAga2V5OiBpLFxuICAgICAgICAgIHZhbHVlOiBpLFxuICAgICAgICB9KSksXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBsaXN0OiB7XG4gICAgICAgICAgb246IGdldENhcm91c2VsKDMxLCAxKSxcbiAgICAgICAgICBhZnRlcjogZ2V0Q2Fyb3VzZWwoMzEsIDApLFxuICAgICAgICB9LFxuICAgICAgICB2YWx1ZToge1xuICAgICAgICAgIG9uOiAnMScsXG4gICAgICAgICAgYWZ0ZXI6ICcwJyxcbiAgICAgICAgfSxcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgcHVibGljIHNldExhc3REYXlPZk1vbnRoKCk6IHZvaWQge1xuICAgIHRoaXMuY3Jvbi51cGRhdGVXaXRoKHtcbiAgICAgIGRheU9mTW9udGg6ICdMJyxcbiAgICAgIGRheU9mV2VlazogJz8nLFxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIHNldExhc3RXZWVrRGF5T2ZNb250aCgpOiB2b2lkIHtcbiAgICB0aGlzLmNyb24udXBkYXRlV2l0aCh7XG4gICAgICBkYXlPZk1vbnRoOiAnTFcnLFxuICAgICAgZGF5T2ZXZWVrOiAnPycsXG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgb3ZlcnJpZGUgaW5pdCgpOiB2b2lkIHtcbiAgICBjb21iaW5lTGF0ZXN0KFt0aGlzLmNyb24uZGF5T2ZNb250aCQsIHRoaXMuY3Jvbi5kYXlPZldlZWskXSlcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAoKFtkYXksIGRheU9mV2Vla10pID0+IHByaXptQ29udmVydERheVRvVHlwZShkYXksIGRheU9mV2VlaykpLFxuICAgICAgICBmaWx0ZXIoaSA9PiBpICE9IHRoaXMudHlwZUNvbnRyb2wudmFsdWUpLFxuICAgICAgICB0YXAodHlwZSA9PiB7XG4gICAgICAgICAgdGhpcy50eXBlQ29udHJvbC5zZXRWYWx1ZSh0eXBlKTtcbiAgICAgICAgfSksXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgpO1xuICAgIHRoaXMuaW5pdExvY2FsU3RhdGVDaGFuZ2VyKCk7XG4gIH1cblxuICAvKipcbiAgICogc2V0IGV2ZXJ5ICpcbiAgICogKi9cbiAgcHVibGljIG92ZXJyaWRlIHNldEV2ZXJ5KCk6IHZvaWQge1xuICAgIHRoaXMuY3Jvbi51cGRhdGVXaXRoKHtcbiAgICAgIGRheU9mV2VlazogYCpgLFxuICAgICAgZGF5T2ZNb250aDogYD9gLFxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIHVwZGF0ZUxhc3RDaG9zZW5EYXlPZk1vbnRoKGxhc3RDaG9zZW5EYXlPZk1vbnRoVmFsdWU/OiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLmxhc3RDaG9zZW5EYXlPZk1vbnRoVmFsdWUgPSBsYXN0Q2hvc2VuRGF5T2ZNb250aFZhbHVlID8/IHRoaXMubGFzdENob3NlbkRheU9mTW9udGhWYWx1ZTtcbiAgICB0aGlzLmNyb24udXBkYXRlV2l0aCh7XG4gICAgICBkYXlPZldlZWs6IGA/YCxcbiAgICAgIGRheU9mTW9udGg6IGBMLSR7bGFzdENob3NlbkRheU9mTW9udGhWYWx1ZSB8fCAxfWAsXG4gICAgfSk7XG4gIH1cbiAgcHVibGljIHVwZGF0ZUxhc3RDaG9zZW5EYXlPZldlZWsobGFzdENob3NlbkRheU9mV2Vla1ZhbHVlOiBzdHJpbmcsIGFkZEVuZGluZyA9IHRydWUpOiB2b2lkIHtcbiAgICBjb25zdCBuZXdWYWx1ZSA9XG4gICAgICAoYWRkRW5kaW5nID8gbGFzdENob3NlbkRheU9mV2Vla1ZhbHVlIDogbGFzdENob3NlbkRheU9mV2Vla1ZhbHVlLnJlcGxhY2UoL0wkL2csICcnKSkgfHwgJzInO1xuICAgIHRoaXMubGFzdENob3NlbkRheU9mV2Vla1ZhbHVlID0gbmV3VmFsdWU7XG4gICAgdGhpcy5jcm9uLnVwZGF0ZVdpdGgoe1xuICAgICAgZGF5T2ZNb250aDogYD9gLFxuICAgICAgZGF5T2ZXZWVrOiBgJHtuZXdWYWx1ZX1MYCxcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGVMYXN0Q2hvc2VuRGF5T2ZDaG9zZW5XZWVrKFxuICAgIG9uTnVtYmVyT2ZXZWVrTGlzdFZhbHVlPzogc3RyaW5nIHwgbnVsbCxcbiAgICBsYXN0Q2hvc2VuRGF5T2ZXZWVrVmFsdWUyPzogc3RyaW5nXG4gICk6IHZvaWQge1xuICAgIHRoaXMub25OdW1iZXJPZldlZWtMaXN0VmFsdWUgPSBvbk51bWJlck9mV2Vla0xpc3RWYWx1ZSA/PyB0aGlzLm9uTnVtYmVyT2ZXZWVrTGlzdFZhbHVlO1xuICAgIHRoaXMubGFzdENob3NlbkRheU9mV2Vla1ZhbHVlMiA9IGxhc3RDaG9zZW5EYXlPZldlZWtWYWx1ZTIgPz8gdGhpcy5sYXN0Q2hvc2VuRGF5T2ZXZWVrVmFsdWUyO1xuICAgIHRoaXMuY3Jvbi51cGRhdGVXaXRoKHtcbiAgICAgIGRheU9mTW9udGg6IGA/YCxcbiAgICAgIGRheU9mV2VlazogYCR7dGhpcy5sYXN0Q2hvc2VuRGF5T2ZXZWVrVmFsdWUyfSMke3RoaXMub25OdW1iZXJPZldlZWtMaXN0VmFsdWV9YCxcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGVBZnRlckRheU9mV2Vlayh7XG4gICAgYWZ0ZXJEYXlPZldlZWtMaXN0RGF5c1ZhbHVlLFxuICAgIGFmdGVyRGF5T2ZXZWVrTGlzdERheU9mV2Vla3NWYWx1ZSxcbiAgfToge1xuICAgIGFmdGVyRGF5T2ZXZWVrTGlzdERheXNWYWx1ZT86IHN0cmluZztcbiAgICBhZnRlckRheU9mV2Vla0xpc3REYXlPZldlZWtzVmFsdWU/OiBzdHJpbmc7XG4gIH0gPSB7fSk6IHZvaWQge1xuICAgIHRoaXMuYWZ0ZXJEYXlPZldlZWtMaXN0RGF5c1ZhbHVlID0gYWZ0ZXJEYXlPZldlZWtMaXN0RGF5c1ZhbHVlID8/IHRoaXMuYWZ0ZXJEYXlPZldlZWtMaXN0RGF5c1ZhbHVlO1xuICAgIHRoaXMuYWZ0ZXJEYXlPZldlZWtMaXN0RGF5T2ZXZWVrc1ZhbHVlID1cbiAgICAgIGFmdGVyRGF5T2ZXZWVrTGlzdERheU9mV2Vla3NWYWx1ZSA/PyB0aGlzLmFmdGVyRGF5T2ZXZWVrTGlzdERheU9mV2Vla3NWYWx1ZTtcbiAgICBpZiAoIXRoaXMuYWZ0ZXJEYXlPZldlZWtMaXN0RGF5T2ZXZWVrc1ZhbHVlKSByZXR1cm47XG4gICAgdGhpcy5jcm9uLnVwZGF0ZVdpdGgoe1xuICAgICAgZGF5T2ZNb250aDogYD9gLFxuICAgICAgZGF5T2ZXZWVrOiBgJHt0aGlzLmFmdGVyRGF5T2ZXZWVrTGlzdERheU9mV2Vla3NWYWx1ZX0vJHt0aGlzLmFmdGVyRGF5T2ZXZWVrTGlzdERheXNWYWx1ZX1gLFxuICAgIH0pO1xuICB9XG4gIHB1YmxpYyB1cGRhdGVTZWxlY3RlZERheU9mV2VlayhzZWxlY3RlZERheU9mV2Vlazogc3RyaW5nW10pOiB2b2lkIHtcbiAgICB0aGlzLnNlbGVjdGVkRGF5T2ZXZWVrID0gc2VsZWN0ZWREYXlPZldlZWs7XG4gICAgdGhpcy5jcm9uLnVwZGF0ZVdpdGgoe1xuICAgICAgZGF5T2ZNb250aDogYD9gLFxuICAgICAgZGF5T2ZXZWVrOiB0aGlzLnNlbGVjdGVkRGF5T2ZXZWVrLmpvaW4oJywnKSxcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGVTZWxlY3RlZERheU9mTW9udGgoc2VsZWN0ZWREYXlPZk1vbnRoOiBzdHJpbmdbXSk6IHZvaWQge1xuICAgIHRoaXMuc2VsZWN0ZWREYXlPZk1vbnRoID0gc2VsZWN0ZWREYXlPZk1vbnRoO1xuICAgIHRoaXMuY3Jvbi51cGRhdGVXaXRoKHtcbiAgICAgIGRheU9mV2VlazogYD9gLFxuICAgICAgZGF5T2ZNb250aDogWy4uLm5ldyBTZXQodGhpcy5zZWxlY3RlZERheU9mTW9udGgubGVuZ3RoID8gdGhpcy5zZWxlY3RlZERheU9mTW9udGggOiBbJzEnXSldLmpvaW4oJywnKSxcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGVBZnRlckRheU9mTW9udGgoXG4gICAgYWZ0ZXJEYXlPZk1vbnRoTGlzdFJlcGVhdERheXNWYWx1ZT86IHN0cmluZyB8IG51bGwsXG4gICAgYWZ0ZXJEYXlPZk1vbnRoTGlzdERheXNWYWx1ZT86IHN0cmluZ1xuICApOiB2b2lkIHtcbiAgICB0aGlzLmFmdGVyRGF5T2ZNb250aExpc3RSZXBlYXREYXlzVmFsdWUgPVxuICAgICAgYWZ0ZXJEYXlPZk1vbnRoTGlzdFJlcGVhdERheXNWYWx1ZSA/PyB0aGlzLmFmdGVyRGF5T2ZNb250aExpc3RSZXBlYXREYXlzVmFsdWU7XG4gICAgdGhpcy5hZnRlckRheU9mTW9udGhMaXN0RGF5c1ZhbHVlID0gYWZ0ZXJEYXlPZk1vbnRoTGlzdERheXNWYWx1ZSA/PyB0aGlzLmFmdGVyRGF5T2ZNb250aExpc3REYXlzVmFsdWU7XG4gICAgdGhpcy5jcm9uLnVwZGF0ZVdpdGgoe1xuICAgICAgZGF5T2ZXZWVrOiBgP2AsXG4gICAgICBkYXlPZk1vbnRoOiBgJHt0aGlzLmFmdGVyRGF5T2ZNb250aExpc3REYXlzVmFsdWV9LyR7dGhpcy5hZnRlckRheU9mTW9udGhMaXN0UmVwZWF0RGF5c1ZhbHVlfWAsXG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlTmVhcmVzdERheU9mTW9udGgobmVhcmVzdERheU9mTW9udGhWYWx1ZT86IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMubmVhcmVzdERheU9mTW9udGhWYWx1ZSA9IG5lYXJlc3REYXlPZk1vbnRoVmFsdWUgPz8gdGhpcy5uZWFyZXN0RGF5T2ZNb250aFZhbHVlO1xuICAgIHRoaXMuY3Jvbi51cGRhdGVXaXRoKHtcbiAgICAgIGRheU9mTW9udGg6IGAke3RoaXMubmVhcmVzdERheU9mTW9udGhWYWx1ZX1XYCxcbiAgICAgIGRheU9mV2VlazogJz8nLFxuICAgIH0pO1xuICB9XG4gIHB1YmxpYyBvdmVycmlkZSB1cGRhdGVCZXR3ZWVuKHtcbiAgICBzdGFydCxcbiAgICBlbmQsXG4gIH06IHtcbiAgICBzdGFydD86IHN0cmluZztcbiAgICBlbmQ/OiBzdHJpbmc7XG4gIH0gPSB7fSk6IHZvaWQge1xuICAgIHN0YXJ0ID0gc3RhcnQgPz8gdGhpcy5zdGF0ZSQudmFsdWUuYmV0d2Vlbi5zdGFydDtcbiAgICBlbmQgPSBlbmQgPz8gdGhpcy5zdGF0ZSQudmFsdWUuYmV0d2Vlbi5lbmQ7XG4gICAgdGhpcy5zdGF0ZSQudmFsdWUuYmV0d2Vlbi5zdGFydCA9IHN0YXJ0O1xuICAgIHRoaXMuc3RhdGUkLnZhbHVlLmJldHdlZW4uZW5kID0gZW5kO1xuICAgIHRoaXMuY3Jvbi51cGRhdGVXaXRoKHtcbiAgICAgIGRheU9mTW9udGg6IGAke3N0YXJ0fS0ke2VuZH1gLFxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIG92ZXJyaWRlIGdldFR5cGVCeVZhbHVlQnlEZWZhdWx0KHZhbHVlOiBzdHJpbmcsIGNyb246IFByaXptQ3JvblZhbHVlT2JqZWN0KTogUHJpem1Dcm9uVWlCYXNlVHlwZSB7XG4gICAgcmV0dXJuIHByaXptQ29udmVydERheVRvVHlwZShjcm9uLmRheU9mTW9udGgsIGNyb24uZGF5T2ZXZWVrKSBhcyB1bmtub3duIGFzIFByaXptQ3JvblVpQmFzZVR5cGU7XG4gIH1cblxuICBwdWJsaWMgb3ZlcnJpZGUgdXBkYXRlTG9jYWxTdGF0ZShcbiAgICBbZGF5T2ZNb250aCwgZGF5T2ZXZWVrXTogW3N0cmluZywgc3RyaW5nXSxcbiAgICB0eXBlOiBQcml6bUNyb25VaURheVR5cGVcbiAgKTogdm9pZCB7XG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlIHRoaXMuVFlQRVMuYmV0d2VlbjpcbiAgICAgICAge1xuICAgICAgICAgIGNvbnN0IGFyciA9IGRheU9mTW9udGguc3BsaXQoJy0nKTtcbiAgICAgICAgICBjb25zdCBzdGFydCA9IGFyclswXSA/PyAnMCc7XG4gICAgICAgICAgY29uc3QgZW5kID0gYXJyWzFdID8/ICcwJztcblxuICAgICAgICAgIHRoaXMudXBkYXRlUGFydGlhbCh7XG4gICAgICAgICAgICB0eXBlOiBQcml6bUNyb25VaURheVR5cGUuYmV0d2VlbixcbiAgICAgICAgICAgIGJldHdlZW46IHtcbiAgICAgICAgICAgICAgc3RhcnQ6IHN0YXJ0LFxuICAgICAgICAgICAgICBlbmQ6IGVuZCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIHRoaXMuVFlQRVMuZXZlcnk6XG4gICAgICAgIHRoaXMudXBkYXRlUGFydGlhbCh7XG4gICAgICAgICAgdHlwZTogUHJpem1Dcm9uVWlEYXlUeXBlLmV2ZXJ5LFxuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgdGhpcy5UWVBFUy5zcGVjaWZpZWREYXlPZldlZWs6XG4gICAgICAgIHtcbiAgICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdGVkRGF5T2ZXZWVrKGRheU9mV2Vlay5zcGxpdCgnLCcpKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSB0aGlzLlRZUEVTLmxhc3RDaG9zZW5EYXlPZldlZWs6XG4gICAgICAgIHtcbiAgICAgICAgICB0aGlzLnVwZGF0ZUxhc3RDaG9zZW5EYXlPZldlZWsoZGF5T2ZXZWVrLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgdGhpcy5UWVBFUy5uZWFyZXN0V2Vla0RheVRvVGhlQ2hvc2VuRGF5T2ZNb250aDpcbiAgICAgICAge1xuICAgICAgICAgIHRoaXMudXBkYXRlTmVhcmVzdERheU9mTW9udGgoZGF5T2ZNb250aD8ucmVwbGFjZSgnVycsICcnKSk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgdGhpcy5UWVBFUy5vblRoZUNob3NlbkRheU9mV2VlazpcbiAgICAgICAge1xuICAgICAgICAgIGNvbnN0IFtsYXN0Q2hvc2VuRGF5T2ZXZWVrVmFsdWUyLCBvbk51bWJlck9mV2Vla0xpc3RWYWx1ZV0gPSBkYXlPZldlZWs/LnNwbGl0KCcjJykgPz8gW107XG4gICAgICAgICAgaWYgKGxhc3RDaG9zZW5EYXlPZldlZWtWYWx1ZTIgJiYgb25OdW1iZXJPZldlZWtMaXN0VmFsdWUpXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUxhc3RDaG9zZW5EYXlPZkNob3NlbldlZWsob25OdW1iZXJPZldlZWtMaXN0VmFsdWUsIGxhc3RDaG9zZW5EYXlPZldlZWtWYWx1ZTIpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIHRoaXMuVFlQRVMuc3BlY2lmaWVkRGF5T2ZNb250aDpcbiAgICAgICAge1xuICAgICAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWREYXlPZk1vbnRoKGRheU9mTW9udGguc3BsaXQoJywnKSk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgdGhpcy5UWVBFUy5sYXN0Q2hvc2VuRGF5c09mTW9udGg6XG4gICAgICAgIHtcbiAgICAgICAgICB0aGlzLnVwZGF0ZUxhc3RDaG9zZW5EYXlPZk1vbnRoKGRheU9mTW9udGg/LnJlcGxhY2UoL0wtL2csICcnKSk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgdGhpcy5UWVBFUy5hZnRlckRheU9mTW9udGg6XG4gICAgICAgIHtcbiAgICAgICAgICBjb25zdCBbYWZ0ZXJEYXlPZk1vbnRoTGlzdERheXNWYWx1ZSwgYWZ0ZXJEYXlPZk1vbnRoTGlzdFJlcGVhdERheXNWYWx1ZV0gPVxuICAgICAgICAgICAgZGF5T2ZNb250aD8uc3BsaXQoJy8nKSA/PyBbXTtcbiAgICAgICAgICB0aGlzLnVwZGF0ZUFmdGVyRGF5T2ZNb250aChhZnRlckRheU9mTW9udGhMaXN0UmVwZWF0RGF5c1ZhbHVlLCBhZnRlckRheU9mTW9udGhMaXN0RGF5c1ZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSB0aGlzLlRZUEVTLmFmdGVyRGF5T2ZXZWVrOlxuICAgICAgICB7XG4gICAgICAgICAgY29uc3QgW2FmdGVyRGF5T2ZXZWVrTGlzdERheU9mV2Vla3NWYWx1ZSwgYWZ0ZXJEYXlPZldlZWtMaXN0RGF5c1ZhbHVlXSA9XG4gICAgICAgICAgICBkYXlPZldlZWs/LnNwbGl0KCcvJykgPz8gW107XG4gICAgICAgICAgaWYgKGFmdGVyRGF5T2ZXZWVrTGlzdERheU9mV2Vla3NWYWx1ZSAmJiBhZnRlckRheU9mV2Vla0xpc3REYXlzVmFsdWUpXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUFmdGVyRGF5T2ZXZWVrKHsgYWZ0ZXJEYXlPZldlZWtMaXN0RGF5c1ZhbHVlLCBhZnRlckRheU9mV2Vla0xpc3REYXlPZldlZWtzVmFsdWUgfSk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIG92ZXJyaWRlIGlzQmFzZUNoYW5nZWQoYTogW3N0cmluZywgc3RyaW5nXSwgYjogW3N0cmluZywgc3RyaW5nXSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBhICYmIGIgJiYgYT8uWzBdID09PSBiPy5bMF0gJiYgYT8uWzFdID09PSBiPy5bMV07XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlTWFpblN0YXRlKHZhbHVlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLmNyb24udXBkYXRlV2l0aCh7XG4gICAgICBkYXlPZk1vbnRoOiB2YWx1ZSxcbiAgICB9KTtcbiAgfVxufVxuIl19