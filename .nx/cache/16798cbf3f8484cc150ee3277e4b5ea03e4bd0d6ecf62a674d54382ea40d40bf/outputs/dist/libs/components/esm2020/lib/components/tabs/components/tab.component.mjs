import { ChangeDetectionStrategy, Component, ElementRef, EventEmitter, HostBinding, Input, Optional, Output, } from '@angular/core';
import { PrizmTabsService } from '../tabs.service';
import { PolymorphOutletDirective } from '../../../directives';
import { combineLatest, fromEvent, of, switchMap, timeout } from 'rxjs';
import { Compare, PrizmDestroyService, PrizmLetContextService } from '@prizm-ui/helpers';
import { filter, first, map, startWith, takeUntil, tap } from 'rxjs/operators';
import { PrizmAbstractTestId } from '../../../abstract/interactive';
import { coerceBooleanProperty } from '@angular/cdk/coercion';
import { CommonModule } from '@angular/common';
import { PrizmIconComponent } from '../../icon';
import { PrizmCounterModule } from '../../counter';
import * as i0 from "@angular/core";
import * as i1 from "@prizm-ui/helpers";
import * as i2 from "../tabs.service";
import * as i3 from "@angular/common";
import * as i4 from "../../counter/counter.component";
export class PrizmTabComponent extends PrizmAbstractTestId {
    set counterOptions(value) {
        this._counterOptions = { ...this._counterOptions, ...value };
    }
    get disabled() {
        return this._disabled;
    }
    set disabled(value) {
        this._disabled = coerceBooleanProperty(value);
    }
    get idx() {
        return this.idx_;
    }
    constructor(inMenuContextService, tabsService, destroy, el) {
        super();
        this.inMenuContextService = inMenuContextService;
        this.tabsService = tabsService;
        this.destroy = destroy;
        this.el = el;
        this.type = 'line';
        this.icon = null;
        this.content = null;
        this.closeIcon = 'cancel-close';
        this.count = 0;
        this._counterOptions = {
            status: 'info',
            disabled: false,
        };
        this._disabled = false;
        this.idx_ = null;
        this.idx$ = this.tabsService.tabs$.pipe(map(() => this.inMenuContextService?.context?.inMenuIdx ?? this.tabsService?.findTabIdx?.(this)), tap(idx => (this.idx_ = idx)));
        this.closeTab = new EventEmitter();
        this.testId_ = 'ui_tab';
        this.isActiveTab$ = combineLatest([
            this.idx$,
            this.tabsService.activeTabIdx$,
        ]).pipe(map(([current, active]) => current === active));
        this.tab$ = this.idx$.pipe(map(idx => (typeof idx === 'number' ? this.tabsService.getTabByIdx(idx) : this)));
    }
    ngOnDestroy() {
        this.tab$
            .pipe(first(), tap(tab => {
            if (tab === this)
                this.tabsService.removeTab(tab);
        }), timeout(25), takeUntil(this.destroy))
            .subscribe();
    }
    isFromMenuTab() {
        return Compare.isNotNullish(this.inMenuContextService?.context?.inMenuIdx);
    }
    isMainProjectedTab() {
        return !this.isFromMenuTab();
    }
    initUpdateIndexOnDomUpdateListener() {
        this.tabsService.removed$$
            .pipe(switchMap(() => this.tabsService.changeParent$), startWith(void 0), filter(() => this.isMainProjectedTab()), tap(() => {
            const currentDomIdx = Array.from(this.el.nativeElement.parentElement?.children ?? []).indexOf(this.el.nativeElement);
            if (Compare.isNotNullish(this.currentDomIdx) && currentDomIdx !== this.currentDomIdx) {
                this.tabsService.moveTab(this.currentDomIdx, currentDomIdx, this);
            }
            else {
                this.tabsService.updateTab(this, currentDomIdx);
            }
            this.currentDomIdx = currentDomIdx;
        }), takeUntil(this.destroy))
            .subscribe();
    }
    initClickListenerToSelectTab() {
        fromEvent(this.el.nativeElement, 'click')
            .pipe(switchMap(() => {
            if (this.disabled)
                return of(null);
            return this.selectTab$();
        }), takeUntil(this.destroy))
            .subscribe();
    }
    ngOnInit() {
        this.initUpdateIndexOnDomUpdateListener();
        this.initClickListenerToSelectTab();
    }
    selectTab$() {
        return this.tab$.pipe(first(), tap(tab => {
            this.tabsService?.selectTab(tab);
        }));
    }
    onClose(event) {
        event.stopPropagation();
        this.tab$.pipe(first(), tap(tab => {
            tab.closeTab.emit();
        }), takeUntil(this.destroy));
        this.closeTab.emit();
    }
}
PrizmTabComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: PrizmTabComponent, deps: [{ token: i1.PrizmLetContextService, optional: true }, { token: i2.PrizmTabsService }, { token: i1.PrizmDestroyService }, { token: i0.ElementRef }], target: i0.ɵɵFactoryTarget.Component });
PrizmTabComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: PrizmTabComponent, isStandalone: true, selector: "prizm-tab", inputs: { type: "type", icon: "icon", content: "content", closeIcon: "closeIcon", count: "count", counterOptions: "counterOptions", closable: "closable", disabled: "disabled" }, outputs: { closeTab: "closeTab" }, host: { properties: { "attr.tab-type": "this.type" } }, providers: [PrizmDestroyService], usesInheritance: true, ngImport: i0, template: "<button\n  class=\"page\"\n  [class.page_active]=\"isActiveTab$ | async\"\n  [disabled]=\"disabled\"\n  [tabIndex]=\"(isActiveTab$ | async) ? -1 : ''\"\n>\n  <div class=\"page__icon\" *ngIf=\"icon\">\n    <ng-container *polymorphOutlet=\"icon; context: $any({ idx: idx$ | async, tab: this })\">\n      <prizm-icon class=\"icon icon__mark\" [size]=\"16\" [iconClass]=\"$any(icon)\"> </prizm-icon>\n    </ng-container>\n  </div>\n  <span class=\"page__title\" *ngIf=\"content\">\n    <ng-container *polymorphOutlet=\"content; context: $any({ idx: idx$ | async, tab: this })\">\n      {{ content }}\n    </ng-container>\n  </span>\n  <prizm-counter\n    [value]=\"count\"\n    [status]=\"_counterOptions.status\"\n    [disabled]=\"_counterOptions.disabled\"\n    [maxValue]=\"_counterOptions.maxValue\"\n  ></prizm-counter>\n  <div class=\"page__cancel\" *ngIf=\"closable && !disabled\" (click)=\"onClose($event)\">\n    <ng-container *polymorphOutlet=\"closeIcon; context: $any({ idx: idx$ | async, tab: this })\">\n      <prizm-icon class=\"icon\" [iconClass]=\"$any(closeIcon)\" [size]=\"16\"></prizm-icon>\n    </ng-container>\n  </div>\n</button>\n", styles: [":host{height:100%;display:inline-flex;position:relative;z-index:2}:host button{border:none;outline:none;background:transparent;max-width:var(--prizm-tab-button-max-width, unset)}:host span{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}:host .page{width:100%;padding:0 16px;display:flex;align-items:center;gap:8px;cursor:pointer;overflow:hidden;border:2px solid transparent}:host .page:focus:not(.page_active):not(:active){border:2px solid var(--prizm-v3-background-stroke-focus);border-radius:2px}:host .page:disabled{cursor:not-allowed}:host .page:disabled .page__title,:host .page:disabled .icon__mark{color:var(--prizm-v3-text-icon-disable)}:host .page:disabled .icon__mark{cursor:not-allowed}:host .page:disabled .page__counter{background:var(--prizm-v3-button-disable);color:var(--prizm-v3-text-icon-disable)}:host .page__title{font-weight:600;font-size:14px;line-height:16px;color:var(--prizm-v3-button-secondary-solid-default);transition:.4ms}:host .page_active .page__title,:host .page_active .page__icon{color:var(--prizm-v3-text-icon-primary)}:host .page__counter{font-size:12px;line-height:16px;min-height:20px;min-width:20px;padding:0 4px;display:flex;align-items:center;justify-content:center;border-radius:1.25rem;background:var(--prizm-v3-status-info-primary-default);font-weight:600;color:var(--prizm-v3-text-icon-exception)}:host .page__cancel,:host .page__icon{display:flex;cursor:pointer;color:var(--prizm-v3-button-secondary-solid-default)}:host .page__cancel{margin-left:8px}:host .page .icon{height:16px;width:16px;display:flex}:host[tab-type=line] .page{border-bottom:2px solid transparent}:host[tab-type=line] .page:hover:not(:disabled):not(.page_active):after{position:absolute;left:0;content:\" \";display:block;width:100%;bottom:0;border-bottom:2px solid var(--prizm-v3-form-stroke-hover)}:host[tab-type=line] .page_active:not(:disabled):after{position:absolute;left:0;content:\" \";display:block;width:100%;bottom:0;border-bottom:2px solid var(--prizm-v3-status-info-primary-default)}:host[tab-type=line] .page_active:disabled:after{position:absolute;left:0;content:\" \";display:block;width:100%;bottom:0;border-bottom:2px solid var(--prizm-v3-form-active)}:host[tab-type=contained] .page{border-top:2px solid transparent}:host[tab-type=contained] .page:not(.page_active){background:var(--prizm-v3-background-fill-secondary);border-right:1px solid var(--prizm-v3-background-stroke)}:host[tab-type=contained] .page:hover:not(:disabled):not(.page_active){background:var(--prizm-v3-button-ghost-hover);border-right:1px solid var(--prizm-v3-background-stroke)}:host[tab-type=contained] .page_active:not(:disabled):after{position:absolute;left:0;content:\" \";display:block;width:100%;top:0;border-top:2px solid var(--prizm-v3-status-info-primary-default)}:host[tab-type=contained] .page_active:disabled:after{position:absolute;left:0;content:\" \";display:block;width:100%;top:0;border-top:2px solid var(--prizm-v3-form-active)}.page__title:empty{display:none}.pseudo-border{position:absolute;left:0;content:\" \";display:block;width:100%}.pseudo-border-bottom{position:absolute;left:0;content:\" \";display:block;width:100%;bottom:0}.pseudo-border-top{position:absolute;left:0;content:\" \";display:block;width:100%;top:0}\n"], dependencies: [{ kind: "ngmodule", type: CommonModule }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "pipe", type: i3.AsyncPipe, name: "async" }, { kind: "component", type: PrizmIconComponent, selector: "prizm-icon", inputs: ["iconClass", "size"] }, { kind: "directive", type: PolymorphOutletDirective, selector: "[polymorphOutlet]", inputs: ["polymorphOutlet", "polymorphOutletContext", "polymorphOutletInjector"] }, { kind: "ngmodule", type: PrizmCounterModule }, { kind: "component", type: i4.PrizmCounterComponent, selector: "prizm-counter", inputs: ["disabled", "class", "maxValue", "status", "value"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: PrizmTabComponent, decorators: [{
            type: Component,
            args: [{ selector: 'prizm-tab', changeDetection: ChangeDetectionStrategy.OnPush, providers: [PrizmDestroyService], imports: [CommonModule, PrizmIconComponent, PolymorphOutletDirective, PrizmCounterModule], standalone: true, template: "<button\n  class=\"page\"\n  [class.page_active]=\"isActiveTab$ | async\"\n  [disabled]=\"disabled\"\n  [tabIndex]=\"(isActiveTab$ | async) ? -1 : ''\"\n>\n  <div class=\"page__icon\" *ngIf=\"icon\">\n    <ng-container *polymorphOutlet=\"icon; context: $any({ idx: idx$ | async, tab: this })\">\n      <prizm-icon class=\"icon icon__mark\" [size]=\"16\" [iconClass]=\"$any(icon)\"> </prizm-icon>\n    </ng-container>\n  </div>\n  <span class=\"page__title\" *ngIf=\"content\">\n    <ng-container *polymorphOutlet=\"content; context: $any({ idx: idx$ | async, tab: this })\">\n      {{ content }}\n    </ng-container>\n  </span>\n  <prizm-counter\n    [value]=\"count\"\n    [status]=\"_counterOptions.status\"\n    [disabled]=\"_counterOptions.disabled\"\n    [maxValue]=\"_counterOptions.maxValue\"\n  ></prizm-counter>\n  <div class=\"page__cancel\" *ngIf=\"closable && !disabled\" (click)=\"onClose($event)\">\n    <ng-container *polymorphOutlet=\"closeIcon; context: $any({ idx: idx$ | async, tab: this })\">\n      <prizm-icon class=\"icon\" [iconClass]=\"$any(closeIcon)\" [size]=\"16\"></prizm-icon>\n    </ng-container>\n  </div>\n</button>\n", styles: [":host{height:100%;display:inline-flex;position:relative;z-index:2}:host button{border:none;outline:none;background:transparent;max-width:var(--prizm-tab-button-max-width, unset)}:host span{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}:host .page{width:100%;padding:0 16px;display:flex;align-items:center;gap:8px;cursor:pointer;overflow:hidden;border:2px solid transparent}:host .page:focus:not(.page_active):not(:active){border:2px solid var(--prizm-v3-background-stroke-focus);border-radius:2px}:host .page:disabled{cursor:not-allowed}:host .page:disabled .page__title,:host .page:disabled .icon__mark{color:var(--prizm-v3-text-icon-disable)}:host .page:disabled .icon__mark{cursor:not-allowed}:host .page:disabled .page__counter{background:var(--prizm-v3-button-disable);color:var(--prizm-v3-text-icon-disable)}:host .page__title{font-weight:600;font-size:14px;line-height:16px;color:var(--prizm-v3-button-secondary-solid-default);transition:.4ms}:host .page_active .page__title,:host .page_active .page__icon{color:var(--prizm-v3-text-icon-primary)}:host .page__counter{font-size:12px;line-height:16px;min-height:20px;min-width:20px;padding:0 4px;display:flex;align-items:center;justify-content:center;border-radius:1.25rem;background:var(--prizm-v3-status-info-primary-default);font-weight:600;color:var(--prizm-v3-text-icon-exception)}:host .page__cancel,:host .page__icon{display:flex;cursor:pointer;color:var(--prizm-v3-button-secondary-solid-default)}:host .page__cancel{margin-left:8px}:host .page .icon{height:16px;width:16px;display:flex}:host[tab-type=line] .page{border-bottom:2px solid transparent}:host[tab-type=line] .page:hover:not(:disabled):not(.page_active):after{position:absolute;left:0;content:\" \";display:block;width:100%;bottom:0;border-bottom:2px solid var(--prizm-v3-form-stroke-hover)}:host[tab-type=line] .page_active:not(:disabled):after{position:absolute;left:0;content:\" \";display:block;width:100%;bottom:0;border-bottom:2px solid var(--prizm-v3-status-info-primary-default)}:host[tab-type=line] .page_active:disabled:after{position:absolute;left:0;content:\" \";display:block;width:100%;bottom:0;border-bottom:2px solid var(--prizm-v3-form-active)}:host[tab-type=contained] .page{border-top:2px solid transparent}:host[tab-type=contained] .page:not(.page_active){background:var(--prizm-v3-background-fill-secondary);border-right:1px solid var(--prizm-v3-background-stroke)}:host[tab-type=contained] .page:hover:not(:disabled):not(.page_active){background:var(--prizm-v3-button-ghost-hover);border-right:1px solid var(--prizm-v3-background-stroke)}:host[tab-type=contained] .page_active:not(:disabled):after{position:absolute;left:0;content:\" \";display:block;width:100%;top:0;border-top:2px solid var(--prizm-v3-status-info-primary-default)}:host[tab-type=contained] .page_active:disabled:after{position:absolute;left:0;content:\" \";display:block;width:100%;top:0;border-top:2px solid var(--prizm-v3-form-active)}.page__title:empty{display:none}.pseudo-border{position:absolute;left:0;content:\" \";display:block;width:100%}.pseudo-border-bottom{position:absolute;left:0;content:\" \";display:block;width:100%;bottom:0}.pseudo-border-top{position:absolute;left:0;content:\" \";display:block;width:100%;top:0}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.PrizmLetContextService, decorators: [{
                    type: Optional
                }] }, { type: i2.PrizmTabsService }, { type: i1.PrizmDestroyService }, { type: i0.ElementRef }]; }, propDecorators: { type: [{
                type: Input
            }, {
                type: HostBinding,
                args: ['attr.tab-type']
            }], icon: [{
                type: Input
            }], content: [{
                type: Input
            }], closeIcon: [{
                type: Input
            }], count: [{
                type: Input
            }], counterOptions: [{
                type: Input
            }], closable: [{
                type: Input
            }], disabled: [{
                type: Input
            }], closeTab: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFiLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvY29tcG9uZW50cy9zcmMvbGliL2NvbXBvbmVudHMvdGFicy9jb21wb25lbnRzL3RhYi5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL2NvbXBvbmVudHMvc3JjL2xpYi9jb21wb25lbnRzL3RhYnMvY29tcG9uZW50cy90YWIuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLHVCQUF1QixFQUN2QixTQUFTLEVBQ1QsVUFBVSxFQUNWLFlBQVksRUFDWixXQUFXLEVBQ1gsS0FBSyxFQUdMLFFBQVEsRUFDUixNQUFNLEdBQ1AsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDbkQsT0FBTyxFQUFvQix3QkFBd0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2pGLE9BQU8sRUFBRSxhQUFhLEVBQUUsU0FBUyxFQUFjLEVBQUUsRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3BGLE9BQU8sRUFBRSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUV6RixPQUFPLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMvRSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUNwRSxPQUFPLEVBQWdCLHFCQUFxQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDNUUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLFlBQVksQ0FB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O2tHQUFqQixpQkFBaUIscVVBSmpCLENBQUMsbUJBQW1CLENBQUMsaURDOUJsQyxnb0NBNEJBLHV2R0RHWSxZQUFZLHdMQUFFLGtCQUFrQixzRkFBRSx3QkFBd0IsK0lBQUUsa0JBQWtCOzJGQUc3RSxpQkFBaUI7a0JBVDdCLFNBQVM7K0JBQ0UsV0FBVyxtQkFHSix1QkFBdUIsQ0FBQyxNQUFNLGFBQ3BDLENBQUMsbUJBQW1CLENBQUMsV0FDdkIsQ0FBQyxZQUFZLEVBQUUsa0JBQWtCLEVBQUUsd0JBQXdCLEVBQUUsa0JBQWtCLENBQUMsY0FDN0UsSUFBSTs7MEJBb0RiLFFBQVE7c0lBakRtQyxJQUFJO3NCQUFqRCxLQUFLOztzQkFBSSxXQUFXO3VCQUFDLGVBQWU7Z0JBQzVCLElBQUk7c0JBQVosS0FBSztnQkFDRyxPQUFPO3NCQUFmLEtBQUs7Z0JBQ0csU0FBUztzQkFBakIsS0FBSztnQkFDRyxLQUFLO3NCQUFiLEtBQUs7Z0JBUUYsY0FBYztzQkFEakIsS0FBSztnQkFLRyxRQUFRO3NCQUFoQixLQUFLO2dCQUdGLFFBQVE7c0JBRFgsS0FBSztnQkFpQlcsUUFBUTtzQkFBeEIsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdEJpbmRpbmcsXG4gIElucHV0LFxuICBPbkRlc3Ryb3ksXG4gIE9uSW5pdCxcbiAgT3B0aW9uYWwsXG4gIE91dHB1dCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBQcml6bVRhYkNvdW50ZXJPcHRpb25zLCBQcml6bVRhYlR5cGUgfSBmcm9tICcuLi90YWJzLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQcml6bVRhYnNTZXJ2aWNlIH0gZnJvbSAnLi4vdGFicy5zZXJ2aWNlJztcbmltcG9ydCB7IFBvbHltb3JwaENvbnRlbnQsIFBvbHltb3JwaE91dGxldERpcmVjdGl2ZSB9IGZyb20gJy4uLy4uLy4uL2RpcmVjdGl2ZXMnO1xuaW1wb3J0IHsgY29tYmluZUxhdGVzdCwgZnJvbUV2ZW50LCBPYnNlcnZhYmxlLCBvZiwgc3dpdGNoTWFwLCB0aW1lb3V0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBDb21wYXJlLCBQcml6bURlc3Ryb3lTZXJ2aWNlLCBQcml6bUxldENvbnRleHRTZXJ2aWNlIH0gZnJvbSAnQHByaXptLXVpL2hlbHBlcnMnO1xuaW1wb3J0IHsgUHJpem1UYWJDb250ZXh0LCBQcml6bVRhYk1lbnVDb250ZXh0IH0gZnJvbSAnLi4vdGFicy5tb2RlbCc7XG5pbXBvcnQgeyBmaWx0ZXIsIGZpcnN0LCBtYXAsIHN0YXJ0V2l0aCwgdGFrZVVudGlsLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBQcml6bUFic3RyYWN0VGVzdElkIH0gZnJvbSAnLi4vLi4vLi4vYWJzdHJhY3QvaW50ZXJhY3RpdmUnO1xuaW1wb3J0IHsgQm9vbGVhbklucHV0LCBjb2VyY2VCb29sZWFuUHJvcGVydHkgfSBmcm9tICdAYW5ndWxhci9jZGsvY29lcmNpb24nO1xuaW1wb3J0IHsgQ29tbW9uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IFByaXptSWNvbkNvbXBvbmVudCB9IGZyb20gJy4uLy4uL2ljb24nO1xuaW1wb3J0IHsgUHJpem1Db3VudGVyTW9kdWxlIH0gZnJvbSAnLi4vLi4vY291bnRlcic7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3ByaXptLXRhYicsXG4gIHRlbXBsYXRlVXJsOiAnLi90YWIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi90YWIuY29tcG9uZW50Lmxlc3MnXSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIHByb3ZpZGVyczogW1ByaXptRGVzdHJveVNlcnZpY2VdLFxuICBpbXBvcnRzOiBbQ29tbW9uTW9kdWxlLCBQcml6bUljb25Db21wb25lbnQsIFBvbHltb3JwaE91dGxldERpcmVjdGl2ZSwgUHJpem1Db3VudGVyTW9kdWxlXSxcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcbn0pXG5leHBvcnQgY2xhc3MgUHJpem1UYWJDb21wb25lbnQgZXh0ZW5kcyBQcml6bUFic3RyYWN0VGVzdElkIGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xuICBASW5wdXQoKSBASG9zdEJpbmRpbmcoJ2F0dHIudGFiLXR5cGUnKSBwdWJsaWMgdHlwZTogUHJpem1UYWJUeXBlID0gJ2xpbmUnO1xuICBASW5wdXQoKSBpY29uOiBQb2x5bW9ycGhDb250ZW50PFByaXptVGFiQ29udGV4dD4gfCBudWxsID0gbnVsbDtcbiAgQElucHV0KCkgY29udGVudDogUG9seW1vcnBoQ29udGVudDxQcml6bVRhYkNvbnRleHQ+IHwgbnVsbCA9IG51bGw7XG4gIEBJbnB1dCgpIGNsb3NlSWNvbjogUG9seW1vcnBoQ29udGVudDxQcml6bVRhYkNvbnRleHQ+ID0gJ2NhbmNlbC1jbG9zZSc7XG4gIEBJbnB1dCgpIGNvdW50ID0gMDtcblxuICBwdWJsaWMgX2NvdW50ZXJPcHRpb25zOiBQcml6bVRhYkNvdW50ZXJPcHRpb25zID0ge1xuICAgIHN0YXR1czogJ2luZm8nLFxuICAgIGRpc2FibGVkOiBmYWxzZSxcbiAgfTtcblxuICBASW5wdXQoKVxuICBzZXQgY291bnRlck9wdGlvbnModmFsdWU6IFBhcnRpYWw8UHJpem1UYWJDb3VudGVyT3B0aW9ucz4gfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLl9jb3VudGVyT3B0aW9ucyA9IHsgLi4udGhpcy5fY291bnRlck9wdGlvbnMsIC4uLnZhbHVlIH07XG4gIH1cblxuICBASW5wdXQoKSBjbG9zYWJsZSE6IGJvb2xlYW47XG5cbiAgQElucHV0KClcbiAgZ2V0IGRpc2FibGVkKCkge1xuICAgIHJldHVybiB0aGlzLl9kaXNhYmxlZDtcbiAgfVxuICBzZXQgZGlzYWJsZWQodmFsdWU6IEJvb2xlYW5JbnB1dCkge1xuICAgIHRoaXMuX2Rpc2FibGVkID0gY29lcmNlQm9vbGVhblByb3BlcnR5KHZhbHVlKTtcbiAgfVxuICBwcml2YXRlIF9kaXNhYmxlZCA9IGZhbHNlO1xuXG4gIHByaXZhdGUgaWR4XzogbnVtYmVyIHwgbnVsbCA9IG51bGw7XG4gIHB1YmxpYyByZWFkb25seSBpZHgkID0gdGhpcy50YWJzU2VydmljZS50YWJzJC5waXBlKFxuICAgIG1hcCgoKSA9PiB0aGlzLmluTWVudUNvbnRleHRTZXJ2aWNlPy5jb250ZXh0Py5pbk1lbnVJZHggPz8gdGhpcy50YWJzU2VydmljZT8uZmluZFRhYklkeD8uKHRoaXMpKSxcbiAgICB0YXAoaWR4ID0+ICh0aGlzLmlkeF8gPSBpZHgpKVxuICApO1xuICBwdWJsaWMgZ2V0IGlkeCgpOiBudW1iZXIgfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy5pZHhfO1xuICB9XG4gIEBPdXRwdXQoKSBwdWJsaWMgY2xvc2VUYWIgPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG5cbiAgcHJpdmF0ZSBjdXJyZW50RG9tSWR4ITogbnVtYmVyO1xuICBvdmVycmlkZSByZWFkb25seSB0ZXN0SWRfID0gJ3VpX3RhYic7XG4gIHJlYWRvbmx5IGlzQWN0aXZlVGFiJDogT2JzZXJ2YWJsZTxib29sZWFuPiA9IGNvbWJpbmVMYXRlc3QoW1xuICAgIHRoaXMuaWR4JCxcbiAgICB0aGlzLnRhYnNTZXJ2aWNlLmFjdGl2ZVRhYklkeCQsXG4gIF0pLnBpcGUobWFwKChbY3VycmVudCwgYWN0aXZlXSkgPT4gY3VycmVudCA9PT0gYWN0aXZlKSk7XG5cbiAgcmVhZG9ubHkgdGFiJCA9IHRoaXMuaWR4JC5waXBlKFxuICAgIG1hcChpZHggPT4gKHR5cGVvZiBpZHggPT09ICdudW1iZXInID8gdGhpcy50YWJzU2VydmljZS5nZXRUYWJCeUlkeChpZHgpIDogdGhpcykpXG4gICk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgQE9wdGlvbmFsKClcbiAgICBwcml2YXRlIHJlYWRvbmx5IGluTWVudUNvbnRleHRTZXJ2aWNlOiBQcml6bUxldENvbnRleHRTZXJ2aWNlPFByaXptVGFiTWVudUNvbnRleHQ+LFxuICAgIHB1YmxpYyByZWFkb25seSB0YWJzU2VydmljZTogUHJpem1UYWJzU2VydmljZSxcbiAgICBwdWJsaWMgcmVhZG9ubHkgZGVzdHJveTogUHJpem1EZXN0cm95U2VydmljZSxcbiAgICBwdWJsaWMgcmVhZG9ubHkgZWw6IEVsZW1lbnRSZWY8SFRNTEVsZW1lbnQ+XG4gICkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBwdWJsaWMgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy50YWIkXG4gICAgICAucGlwZShcbiAgICAgICAgZmlyc3QoKSxcbiAgICAgICAgdGFwKHRhYiA9PiB7XG4gICAgICAgICAgaWYgKHRhYiA9PT0gdGhpcykgdGhpcy50YWJzU2VydmljZS5yZW1vdmVUYWIodGFiKTtcbiAgICAgICAgfSksXG4gICAgICAgIHRpbWVvdXQoMjUpLFxuICAgICAgICB0YWtlVW50aWwodGhpcy5kZXN0cm95KVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0Zyb21NZW51VGFiKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBDb21wYXJlLmlzTm90TnVsbGlzaCh0aGlzLmluTWVudUNvbnRleHRTZXJ2aWNlPy5jb250ZXh0Py5pbk1lbnVJZHgpO1xuICB9XG5cbiAgcHJpdmF0ZSBpc01haW5Qcm9qZWN0ZWRUYWIoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICF0aGlzLmlzRnJvbU1lbnVUYWIoKTtcbiAgfVxuXG4gIHByaXZhdGUgaW5pdFVwZGF0ZUluZGV4T25Eb21VcGRhdGVMaXN0ZW5lcigpOiB2b2lkIHtcbiAgICB0aGlzLnRhYnNTZXJ2aWNlLnJlbW92ZWQkJFxuICAgICAgLnBpcGUoXG4gICAgICAgIHN3aXRjaE1hcCgoKSA9PiB0aGlzLnRhYnNTZXJ2aWNlLmNoYW5nZVBhcmVudCQpLFxuICAgICAgICBzdGFydFdpdGgodm9pZCAwKSxcbiAgICAgICAgZmlsdGVyKCgpID0+IHRoaXMuaXNNYWluUHJvamVjdGVkVGFiKCkpLFxuICAgICAgICB0YXAoKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGN1cnJlbnREb21JZHggPSBBcnJheS5mcm9tKHRoaXMuZWwubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50Py5jaGlsZHJlbiA/PyBbXSkuaW5kZXhPZihcbiAgICAgICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKENvbXBhcmUuaXNOb3ROdWxsaXNoKHRoaXMuY3VycmVudERvbUlkeCkgJiYgY3VycmVudERvbUlkeCAhPT0gdGhpcy5jdXJyZW50RG9tSWR4KSB7XG4gICAgICAgICAgICB0aGlzLnRhYnNTZXJ2aWNlLm1vdmVUYWIodGhpcy5jdXJyZW50RG9tSWR4LCBjdXJyZW50RG9tSWR4LCB0aGlzKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy50YWJzU2VydmljZS51cGRhdGVUYWIodGhpcywgY3VycmVudERvbUlkeCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuY3VycmVudERvbUlkeCA9IGN1cnJlbnREb21JZHg7XG4gICAgICAgIH0pLFxuICAgICAgICB0YWtlVW50aWwodGhpcy5kZXN0cm95KVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBpbml0Q2xpY2tMaXN0ZW5lclRvU2VsZWN0VGFiKCk6IHZvaWQge1xuICAgIGZyb21FdmVudCh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdjbGljaycpXG4gICAgICAucGlwZShcbiAgICAgICAgc3dpdGNoTWFwKCgpID0+IHtcbiAgICAgICAgICBpZiAodGhpcy5kaXNhYmxlZCkgcmV0dXJuIG9mKG51bGwpO1xuICAgICAgICAgIHJldHVybiB0aGlzLnNlbGVjdFRhYiQoKTtcbiAgICAgICAgfSksXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBwdWJsaWMgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5pbml0VXBkYXRlSW5kZXhPbkRvbVVwZGF0ZUxpc3RlbmVyKCk7XG4gICAgdGhpcy5pbml0Q2xpY2tMaXN0ZW5lclRvU2VsZWN0VGFiKCk7XG4gIH1cblxuICBwdWJsaWMgc2VsZWN0VGFiJCgpOiBPYnNlcnZhYmxlPHVua25vd24+IHtcbiAgICByZXR1cm4gdGhpcy50YWIkLnBpcGUoXG4gICAgICBmaXJzdCgpLFxuICAgICAgdGFwKHRhYiA9PiB7XG4gICAgICAgIHRoaXMudGFic1NlcnZpY2U/LnNlbGVjdFRhYih0YWIpO1xuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgcHVibGljIG9uQ2xvc2UoZXZlbnQ6IE1vdXNlRXZlbnQpOiB2b2lkIHtcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB0aGlzLnRhYiQucGlwZShcbiAgICAgIGZpcnN0KCksXG4gICAgICB0YXAodGFiID0+IHtcbiAgICAgICAgdGFiLmNsb3NlVGFiLmVtaXQoKTtcbiAgICAgIH0pLFxuICAgICAgdGFrZVVudGlsKHRoaXMuZGVzdHJveSlcbiAgICApO1xuXG4gICAgdGhpcy5jbG9zZVRhYi5lbWl0KCk7XG4gIH1cbn1cbiIsIjxidXR0b25cbiAgY2xhc3M9XCJwYWdlXCJcbiAgW2NsYXNzLnBhZ2VfYWN0aXZlXT1cImlzQWN0aXZlVGFiJCB8IGFzeW5jXCJcbiAgW2Rpc2FibGVkXT1cImRpc2FibGVkXCJcbiAgW3RhYkluZGV4XT1cIihpc0FjdGl2ZVRhYiQgfCBhc3luYykgPyAtMSA6ICcnXCJcbj5cbiAgPGRpdiBjbGFzcz1cInBhZ2VfX2ljb25cIiAqbmdJZj1cImljb25cIj5cbiAgICA8bmctY29udGFpbmVyICpwb2x5bW9ycGhPdXRsZXQ9XCJpY29uOyBjb250ZXh0OiAkYW55KHsgaWR4OiBpZHgkIHwgYXN5bmMsIHRhYjogdGhpcyB9KVwiPlxuICAgICAgPHByaXptLWljb24gY2xhc3M9XCJpY29uIGljb25fX21hcmtcIiBbc2l6ZV09XCIxNlwiIFtpY29uQ2xhc3NdPVwiJGFueShpY29uKVwiPiA8L3ByaXptLWljb24+XG4gICAgPC9uZy1jb250YWluZXI+XG4gIDwvZGl2PlxuICA8c3BhbiBjbGFzcz1cInBhZ2VfX3RpdGxlXCIgKm5nSWY9XCJjb250ZW50XCI+XG4gICAgPG5nLWNvbnRhaW5lciAqcG9seW1vcnBoT3V0bGV0PVwiY29udGVudDsgY29udGV4dDogJGFueSh7IGlkeDogaWR4JCB8IGFzeW5jLCB0YWI6IHRoaXMgfSlcIj5cbiAgICAgIHt7IGNvbnRlbnQgfX1cbiAgICA8L25nLWNvbnRhaW5lcj5cbiAgPC9zcGFuPlxuICA8cHJpem0tY291bnRlclxuICAgIFt2YWx1ZV09XCJjb3VudFwiXG4gICAgW3N0YXR1c109XCJfY291bnRlck9wdGlvbnMuc3RhdHVzXCJcbiAgICBbZGlzYWJsZWRdPVwiX2NvdW50ZXJPcHRpb25zLmRpc2FibGVkXCJcbiAgICBbbWF4VmFsdWVdPVwiX2NvdW50ZXJPcHRpb25zLm1heFZhbHVlXCJcbiAgPjwvcHJpem0tY291bnRlcj5cbiAgPGRpdiBjbGFzcz1cInBhZ2VfX2NhbmNlbFwiICpuZ0lmPVwiY2xvc2FibGUgJiYgIWRpc2FibGVkXCIgKGNsaWNrKT1cIm9uQ2xvc2UoJGV2ZW50KVwiPlxuICAgIDxuZy1jb250YWluZXIgKnBvbHltb3JwaE91dGxldD1cImNsb3NlSWNvbjsgY29udGV4dDogJGFueSh7IGlkeDogaWR4JCB8IGFzeW5jLCB0YWI6IHRoaXMgfSlcIj5cbiAgICAgIDxwcml6bS1pY29uIGNsYXNzPVwiaWNvblwiIFtpY29uQ2xhc3NdPVwiJGFueShjbG9zZUljb24pXCIgW3NpemVdPVwiMTZcIj48L3ByaXptLWljb24+XG4gICAgPC9uZy1jb250YWluZXI+XG4gIDwvZGl2PlxuPC9idXR0b24+XG4iXX0=