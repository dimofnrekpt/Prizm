import { Injectable, NgZone } from '@angular/core';
import { merge } from 'rxjs';
import { filter, mapTo, switchMap, tap } from 'rxjs/operators';
import { prizmTypedFromEvent, prizmZoneFree } from '../../observables';
import { prizmCanScroll, prizmGetScrollParent } from '../../util/dom';
import * as i0 from "@angular/core";
export class PrizmOverscrollService {
    constructor(ngZone) {
        this.ngZone = ngZone;
    }
    run(mode, nativeElement) {
        return merge(prizmTypedFromEvent(nativeElement, 'wheel', { passive: false }).pipe(filter(() => this.isEnabled(mode)), prizmZoneFree(this.ngZone), tap(event => {
            this.processEvent(mode, event, !!event.deltaY, event.deltaY ? event.deltaY < 0 : event.deltaX < 0);
        })), prizmTypedFromEvent(nativeElement, 'touchstart', { passive: true }).pipe(switchMap(({ touches }) => {
            let { clientX, clientY } = touches[0];
            let deltaX = 0;
            let deltaY = 0;
            let vertical;
            return prizmTypedFromEvent(nativeElement, 'touchmove', {
                passive: false,
            }).pipe(filter(() => this.isEnabled(mode)), tap(event => {
                // We have to have it in tap instead of subscribe due to variables in closure
                const changedTouch = event.changedTouches[0];
                deltaX = clientX - changedTouch.clientX;
                deltaY = clientY - changedTouch.clientY;
                clientX = changedTouch.clientX;
                clientY = changedTouch.clientY;
                if (vertical === undefined) {
                    vertical = Math.abs(deltaY) > Math.abs(deltaX);
                }
                this.processEvent(mode, event, vertical, vertical ? deltaY < 0 : deltaX < 0);
            }));
        }), prizmZoneFree(this.ngZone))).pipe(mapTo(void 0));
    }
    isEnabled(mode) {
        return mode !== 'none';
    }
    processEvent(mode, event, vertical, negative) {
        const { target, currentTarget, cancelable } = event;
        if (!cancelable || !(target instanceof Element) || target?.type === 'range') {
            return;
        }
        // This is all what's needed in Chrome/Firefox thanks to CSS overscroll-behavior
        if (mode === 'all' &&
            ((vertical && !currentTarget.contains(prizmGetScrollParent(target))) ||
                (!vertical && !currentTarget.contains(prizmGetScrollParent(target, false))))) {
            event.preventDefault();
            return;
        }
        // This is Safari/IE/Edge fallback
        if (vertical &&
            ((negative && !prizmCanScroll(target, currentTarget, true, false)) ||
                (!negative && !prizmCanScroll(target, currentTarget, true, true)))) {
            event.preventDefault();
            return;
        }
        if (!vertical &&
            ((negative && !prizmCanScroll(target, currentTarget, false, false)) ||
                (!negative && !prizmCanScroll(target, currentTarget, false, true)))) {
            event.preventDefault();
        }
    }
}
PrizmOverscrollService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: PrizmOverscrollService, deps: [{ token: i0.NgZone }], target: i0.ɵɵFactoryTarget.Injectable });
PrizmOverscrollService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: PrizmOverscrollService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: PrizmOverscrollService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root',
                }]
        }], ctorParameters: function () { return [{ type: i0.NgZone }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3ZlcnNjcm9sbC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9jb21wb25lbnRzL3NyYy9saWIvZGlyZWN0aXZlcy9vdmVyc2Nyb2xsL292ZXJzY3JvbGwuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNuRCxPQUFPLEVBQUUsS0FBSyxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQ3pDLE9BQU8sRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMvRCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFdkUsT0FBTyxFQUFFLGNBQWMsRUFBRSxvQkFBb0IsRUFBRSxNQUFNLGdCQUFnQixDQUFDOztBQU10RSxNQUFNLE9BQU8sc0JBQXNCO0lBQ2pDLFlBQTZCLE1BQWM7UUFBZCxXQUFNLEdBQU4sTUFBTSxDQUFRO0lBQUcsQ0FBQztJQUV4QyxHQUFHLENBQUMsSUFBOEIsRUFBRSxhQUEwQjtRQUNuRSxPQUFPLEtBQUssQ0FDVixtQkFBbUIsQ0FBQyxhQUFhLEVBQUUsT0FBTyxFQUFFLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsSUFBSSxDQUNsRSxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUNsQyxhQUFhLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUMxQixHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDVixJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMs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LElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLGFBQWEsRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7Z0JBQ2hFLENBQUMsQ0FBQyxRQUFRLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLGFBQWEsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUNwRTtZQUNBLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztZQUV2QixPQUFPO1NBQ1I7UUFFRCxJQUNFLENBQUMsUUFBUTtZQUNULENBQUMsQ0FBQyxRQUFRLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLGFBQWEsRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7Z0JBQ2pFLENBQUMsQ0FBQyxRQUFRLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLGFBQWEsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUNyRTtZQUNBLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztTQUN4QjtJQUNILENBQUM7O21IQTFGVSxzQkFBc0I7dUhBQXRCLHNCQUFzQixjQUZyQixNQUFNOzJGQUVQLHNCQUFzQjtrQkFIbEMsVUFBVTttQkFBQztvQkFDVixVQUFVLEVBQUUsTUFBTTtpQkFDbkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBOZ1pvbmUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IG1lcmdlLCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXIsIG1hcFRvLCBzd2l0Y2hNYXAsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IHByaXptVHlwZWRGcm9tRXZlbnQsIHByaXptWm9uZUZyZWUgfSBmcm9tICcuLi8uLi9vYnNlcnZhYmxlcyc7XG5pbXBvcnQgeyBQcml6bUV2ZW50V2l0aCB9IGZyb20gJy4uLy4uL3R5cGVzJztcbmltcG9ydCB7IHByaXptQ2FuU2Nyb2xsLCBwcml6bUdldFNjcm9sbFBhcmVudCB9IGZyb20gJy4uLy4uL3V0aWwvZG9tJztcbmltcG9ydCB7IFByaXptT3ZlcnNjcm9sbE1vZGUgfSBmcm9tICcuL292ZXJzY3JvbGwubW9kZWwnO1xuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290Jyxcbn0pXG5leHBvcnQgY2xhc3MgUHJpem1PdmVyc2Nyb2xsU2VydmljZSB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgbmdab25lOiBOZ1pvbmUpIHt9XG5cbiAgcHVibGljIHJ1bihtb2RlOiBQcml6bU92ZXJzY3JvbGxNb2RlIHwgJycsIG5hdGl2ZUVsZW1lbnQ6IEhUTUxFbGVtZW50KTogT2JzZXJ2YWJsZTx2b2lkPiB7XG4gICAgcmV0dXJuIG1lcmdlKFxuICAgICAgcHJpem1UeXBlZEZyb21FdmVudChuYXRpdmVFbGVtZW50LCAnd2hlZWwnLCB7IHBhc3NpdmU6IGZhbHNlIH0pLnBpcGUoXG4gICAgICAgIGZpbHRlcigoKSA9PiB0aGlzLmlzRW5hYmxlZChtb2RlKSksXG4gICAgICAgIHByaXptWm9uZUZyZWUodGhpcy5uZ1pvbmUpLFxuICAgICAgICB0YXAoZXZlbnQgPT4ge1xuICAgICAgICAgIHRoaXMucHJvY2Vzc0V2ZW50KG1vZGUsIGV2ZW50LCAhIWV2ZW50LmRlbHRhWSwgZXZlbnQuZGVsdGFZID8gZXZlbnQuZGVsdGFZIDwgMCA6IGV2ZW50LmRlbHRhWCA8IDApO1xuICAgICAgICB9KVxuICAgICAgKSxcbiAgICAgIHByaXptVHlwZWRGcm9tRXZlbnQobmF0aXZlRWxlbWVudCwgJ3RvdWNoc3RhcnQnLCB7IHBhc3NpdmU6IHRydWUgfSkucGlwZShcbiAgICAgICAgc3dpdGNoTWFwKCh7IHRvdWNoZXMgfTogeyB0b3VjaGVzOiBUb3VjaExpc3QgfSkgPT4ge1xuICAgICAgICAgIGxldCB7IGNsaWVudFgsIGNsaWVudFkgfSA9IHRvdWNoZXNbMF07XG4gICAgICAgICAgbGV0IGRlbHRhWCA9IDA7XG4gICAgICAgICAgbGV0IGRlbHRhWSA9IDA7XG4gICAgICAgICAgbGV0IHZlcnRpY2FsOiBib29sZWFuO1xuXG4gICAgICAgICAgcmV0dXJuIHByaXptVHlwZWRGcm9tRXZlbnQobmF0aXZlRWxlbWVudCwgJ3RvdWNobW92ZScsIHtcbiAgICAgICAgICAgIHBhc3NpdmU6IGZhbHNlLFxuICAgICAgICAgIH0pLnBpcGUoXG4gICAgICAgICAgICBmaWx0ZXIoKCkgPT4gdGhpcy5pc0VuYWJsZWQobW9kZSkpLFxuICAgICAgICAgICAgdGFwKGV2ZW50ID0+IHtcbiAgICAgICAgICAgICAgLy8gV2UgaGF2ZSB0byBoYXZlIGl0IGluIHRhcCBpbnN0ZWFkIG9mIHN1YnNjcmliZSBkdWUgdG8gdmFyaWFibGVzIGluIGNsb3N1cmVcbiAgICAgICAgICAgICAgY29uc3QgY2hhbmdlZFRvdWNoID0gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF07XG5cbiAgICAgICAgICAgICAgZGVsdGFYID0gY2xpZW50WCAtIGNoYW5nZWRUb3VjaC5jbGllbnRYO1xuICAgICAgICAgICAgICBkZWx0YVkgPSBjbGllbnRZIC0gY2hhbmdlZFRvdWNoLmNsaWVudFk7XG4gICAgICAgICAgICAgIGNsaWVudFggPSBjaGFuZ2VkVG91Y2guY2xpZW50WDtcbiAgICAgICAgICAgICAgY2xpZW50WSA9IGNoYW5nZWRUb3VjaC5jbGllbnRZO1xuXG4gICAgICAgICAgICAgIGlmICh2ZXJ0aWNhbCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdmVydGljYWwgPSBNYXRoLmFicyhkZWx0YVkpID4gTWF0aC5hYnMoZGVsdGFYKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHRoaXMucHJvY2Vzc0V2ZW50KG1vZGUsIGV2ZW50LCB2ZXJ0aWNhbCwgdmVydGljYWwgPyBkZWx0YVkgPCAwIDogZGVsdGFYIDwgMCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICk7XG4gICAgICAgIH0pLFxuICAgICAgICBwcml6bVpvbmVGcmVlKHRoaXMubmdab25lKVxuICAgICAgKVxuICAgICkucGlwZShtYXBUbyh2b2lkIDApKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNFbmFibGVkKG1vZGU6IFByaXptT3ZlcnNjcm9sbE1vZGUgfCAnJyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBtb2RlICE9PSAnbm9uZSc7XG4gIH1cblxuICBwcml2YXRlIHByb2Nlc3NFdmVudChcbiAgICBtb2RlOiBQcml6bU92ZXJzY3JvbGxNb2RlIHwgJycsXG4gICAgZXZlbnQ6IFByaXptRXZlbnRXaXRoPEV2ZW50LCBIVE1MRWxlbWVudD4sXG4gICAgdmVydGljYWw6IGJvb2xlYW4sXG4gICAgbmVnYXRpdmU6IGJvb2xlYW5cbiAgKTogdm9pZCB7XG4gICAgY29uc3QgeyB0YXJnZXQsIGN1cnJlbnRUYXJnZXQsIGNhbmNlbGFibGUgfSA9IGV2ZW50O1xuXG4gICAgaWYgKCFjYW5jZWxhYmxlIHx8ICEodGFyZ2V0IGluc3RhbmNlb2YgRWxlbWVudCkgfHwgKHRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50KT8udHlwZSA9PT0gJ3JhbmdlJykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFRoaXMgaXMgYWxsIHdoYXQncyBuZWVkZWQgaW4gQ2hyb21lL0ZpcmVmb3ggdGhhbmtzIHRvIENTUyBvdmVyc2Nyb2xsLWJlaGF2aW9yXG4gICAgaWYgKFxuICAgICAgbW9kZSA9PT0gJ2FsbCcgJiZcbiAgICAgICgodmVydGljYWwgJiYgIWN1cnJlbnRUYXJnZXQuY29udGFpbnMocHJpem1HZXRTY3JvbGxQYXJlbnQodGFyZ2V0KSkpIHx8XG4gICAgICAgICghdmVydGljYWwgJiYgIWN1cnJlbnRUYXJnZXQuY29udGFpbnMocHJpem1HZXRTY3JvbGxQYXJlbnQodGFyZ2V0LCBmYWxzZSkpKSlcbiAgICApIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBUaGlzIGlzIFNhZmFyaS9JRS9FZGdlIGZhbGxiYWNrXG4gICAgaWYgKFxuICAgICAgdmVydGljYWwgJiZcbiAgICAgICgobmVnYXRpdmUgJiYgIXByaXptQ2FuU2Nyb2xsKHRhcmdldCwgY3VycmVudFRhcmdldCwgdHJ1ZSwgZmFsc2UpKSB8fFxuICAgICAgICAoIW5lZ2F0aXZlICYmICFwcml6bUNhblNjcm9sbCh0YXJnZXQsIGN1cnJlbnRUYXJnZXQsIHRydWUsIHRydWUpKSlcbiAgICApIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICAhdmVydGljYWwgJiZcbiAgICAgICgobmVnYXRpdmUgJiYgIXByaXptQ2FuU2Nyb2xsKHRhcmdldCwgY3VycmVudFRhcmdldCwgZmFsc2UsIGZhbHNlKSkgfHxcbiAgICAgICAgKCFuZWdhdGl2ZSAmJiAhcHJpem1DYW5TY3JvbGwodGFyZ2V0LCBjdXJyZW50VGFyZ2V0LCBmYWxzZSwgdHJ1ZSkpKVxuICAgICkge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==