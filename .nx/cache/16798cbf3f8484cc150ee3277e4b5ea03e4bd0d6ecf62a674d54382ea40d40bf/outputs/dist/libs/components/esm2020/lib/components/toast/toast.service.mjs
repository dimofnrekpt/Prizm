import { Inject, Injectable } from '@angular/core';
import { PrizmToastRef } from './toast-ref';
import { generateToastId } from './util';
import { PRIZM_TOAST_OPTIONS } from './toast-options';
import { PrizmToastExistException } from '../../exceptions/toast-exist.exception';
import { Subject } from 'rxjs';
import { map, shareReplay } from 'rxjs/operators';
import { PrizmToastNotExistException } from '../../exceptions/toast-not-exist.exception';
import * as i0 from "@angular/core";
export class PrizmToastService {
    constructor(options) {
        this.options = options;
        /* main storage for control by id */
        this.refs = new Map();
        this.changesSource$ = new Subject();
        this.changes$ = this.changesSource$.pipe(map(() => [...this.refs.values()].sort((a, b) => (b?.weight ?? 0) - (a?.weight ?? 0))), shareReplay(1));
        this.destroy$ = new Subject();
    }
    get size() {
        return this.refs.size;
    }
    create(content, options = {}) {
        const id = options.id || generateToastId();
        if (this.refs.has(id))
            throw new PrizmToastExistException(id);
        const ref = new PrizmToastRef(content, options.weight ?? 0, options.timer ?? this.options.timer, options.title ?? this.options.title, options.data ?? this.options.data, options.position ?? this.options.position, id, options.appearance ?? this.options.appearance, this.options, this, options.show, options.isPlatform ?? this.options.isPlatform);
        this.refs.set(id, ref);
        this.detect();
        return ref;
    }
    detect() {
        this.changesSource$.next();
    }
    updateContent(id, content) {
        if (!this.refs.has(id))
            throw new PrizmToastNotExistException(id);
        this.refs.get(id)?.updateContent(content);
    }
    updateTitle(id, title) {
        if (!this.refs.has(id))
            throw new PrizmToastNotExistException(id);
        const ref = this.refs.get(id);
        ref?.updateTitle(title);
        return ref;
    }
    delete(id) {
        if (!this.refs.has(id))
            throw new PrizmToastNotExistException(id);
        this.refs.get(id)?.destroy();
        this.refs.delete(id);
        this.detect();
    }
    deleteAll() {
        this.refs.forEach((_, id) => {
            this.delete(id);
        });
    }
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.unsubscribe();
    }
}
PrizmToastService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: PrizmToastService, deps: [{ token: PRIZM_TOAST_OPTIONS }], target: i0.ɵɵFactoryTarget.Injectable });
PrizmToastService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: PrizmToastService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: PrizmToastService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root',
                }]
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [PRIZM_TOAST_OPTIONS]
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9hc3Quc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvY29tcG9uZW50cy9zcmMvbGliL2NvbXBvbmVudHMvdG9hc3QvdG9hc3Quc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUc5RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQzVDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDekMsT0FBTyxFQUFFLG1CQUFtQixFQUE0QixNQUFNLGlCQUFpQixDQUFDO0FBQ2hGLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQ2xGLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSw0Q0FBNEMsQ0FBQzs7QUFPekYsTUFBTSxPQUFPLGlCQUFpQjtJQVc1QixZQUEwRCxPQUFpQztRQUFqQyxZQUFPLEdBQVAsT0FBTyxDQUEwQjtRQVYzRixvQ0FBb0M7UUFDbkIsU0FBSSxHQUFnQixJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQzlCLG1CQUFjLEdBQUcsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQUM3QyxhQUFRLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQzFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFD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SSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRTtZQUMxQixJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2xCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELFdBQVc7UUFDVCxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDOUIsQ0FBQzs7OEdBekVVLGlCQUFpQixrQkFXUixtQkFBbUI7a0hBWDVCLGlCQUFpQixjQUZoQixNQUFNOzJGQUVQLGlCQUFpQjtrQkFIN0IsVUFBVTttQkFBQztvQkFDVixVQUFVLEVBQUUsTUFBTTtpQkFDbkI7OzBCQVljLE1BQU07MkJBQUMsbUJBQW1CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlLCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFBvbHltb3JwaENvbnRlbnQgfSBmcm9tICcuLi8uLi9kaXJlY3RpdmVzL3BvbHltb3JwaCc7XG5pbXBvcnQgeyBQUklaTV9UT0FTVF9JRCwgUHJpem1Ub2FzdE9wdGlvbnMgfSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB7IFByaXptVG9hc3RSZWYgfSBmcm9tICcuL3RvYXN0LXJlZic7XG5pbXBvcnQgeyBnZW5lcmF0ZVRvYXN0SWQgfSBmcm9tICcuL3V0aWwnO1xuaW1wb3J0IHsgUFJJWk1fVE9BU1RfT1BUSU9OUywgUHJpem1Ub2FzdERlZmF1bHRPcHRpb25zIH0gZnJvbSAnLi90b2FzdC1vcHRpb25zJztcbmltcG9ydCB7IFByaXptVG9hc3RFeGlzdEV4Y2VwdGlvbiB9IGZyb20gJy4uLy4uL2V4Y2VwdGlvbnMvdG9hc3QtZXhpc3QuZXhjZXB0aW9uJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCwgc2hhcmVSZXBsYXkgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBQcml6bVRvYXN0Tm90RXhpc3RFeGNlcHRpb24gfSBmcm9tICcuLi8uLi9leGNlcHRpb25zL3RvYXN0LW5vdC1leGlzdC5leGNlcHRpb24nO1xuXG5leHBvcnQgdHlwZSBUb2FzdFJlZk1hcCA9IE1hcDxQUklaTV9UT0FTVF9JRCwgUHJpem1Ub2FzdFJlZj47XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnLFxufSlcbmV4cG9ydCBjbGFzcyBQcml6bVRvYXN0U2VydmljZSBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XG4gIC8qIG1haW4gc3RvcmFnZSBmb3IgY29udHJvbCBieSBpZCAqL1xuICBwcml2YXRlIHJlYWRvbmx5IHJlZnM6IFRvYXN0UmVmTWFwID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIHJlYWRvbmx5IGNoYW5nZXNTb3VyY2UkID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcbiAgcmVhZG9ubHkgY2hhbmdlcyQgPSB0aGlzLmNoYW5nZXNTb3VyY2UkLnBpcGUoXG4gICAgbWFwKCgpID0+IFsuLi50aGlzLnJlZnMudmFsdWVzKCldLnNvcnQoKGEsIGIpID0+IChiPy53ZWlnaHQgPz8gMCkgLSAoYT8ud2VpZ2h0ID8/IDApKSksXG4gICAgc2hhcmVSZXBsYXkoMSlcbiAgKTtcblxuICByZWFkb25seSBkZXN0cm95JCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG5cbiAgY29uc3RydWN0b3IoQEluamVjdChQUklaTV9UT0FTVF9PUFRJT05TKSBwcml2YXRlIHJlYWRvbmx5IG9wdGlvbnM6IFByaXptVG9hc3REZWZhdWx0T3B0aW9ucykge31cblxuICBnZXQgc2l6ZSgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLnJlZnMuc2l6ZTtcbiAgfVxuXG4gIHB1YmxpYyBjcmVhdGUoY29udGVudDogUG9seW1vcnBoQ29udGVudCwgb3B0aW9uczogUHJpem1Ub2FzdE9wdGlvbnMgPSB7fSk6IFByaXptVG9hc3RSZWYge1xuICAgIGNvbnN0IGlkID0gb3B0aW9ucy5pZCB8fCBnZW5lcmF0ZVRvYXN0SWQoKTtcbiAgICBpZiAodGhpcy5yZWZzLmhhcyhpZCkpIHRocm93IG5ldyBQcml6bVRvYXN0RXhpc3RFeGNlcHRpb24oaWQpO1xuICAgIGNvbnN0IHJlZiA9IG5ldyBQcml6bVRvYXN0UmVmKFxuICAgICAgY29udGVudCxcbiAgICAgIG9wdGlvbnMud2VpZ2h0ID8/IDAsXG4gICAgICBvcHRpb25zLnRpbWVyID8/IHRoaXMub3B0aW9ucy50aW1lcixcbiAgICAgIG9wdGlvbnMudGl0bGUgPz8gdGhpcy5vcHRpb25zLnRpdGxlLFxuICAgICAgb3B0aW9ucy5kYXRhID8/IHRoaXMub3B0aW9ucy5kYXRhLFxuICAgICAgb3B0aW9ucy5wb3NpdGlvbiA/PyB0aGlzLm9wdGlvbnMucG9zaXRpb24sXG4gICAgICBpZCxcbiAgICAgIG9wdGlvbnMuYXBwZWFyYW5jZSA/PyB0aGlzLm9wdGlvbnMuYXBwZWFyYW5jZSxcbiAgICAgIHRoaXMub3B0aW9ucyxcbiAgICAgIHRoaXMsXG4gICAgICBvcHRpb25zLnNob3csXG4gICAgICBvcHRpb25zLmlzUGxhdGZvcm0gPz8gdGhpcy5vcHRpb25zLmlzUGxhdGZvcm1cbiAgICApO1xuXG4gICAgdGhpcy5yZWZzLnNldChpZCwgcmVmKTtcbiAgICB0aGlzLmRldGVjdCgpO1xuICAgIHJldHVybiByZWY7XG4gIH1cblxuICBwdWJsaWMgZGV0ZWN0KCk6IHZvaWQge1xuICAgIHRoaXMuY2hhbmdlc1NvdXJjZSQubmV4dCgpO1xuICB9XG5cbiAgcHVibGljIHVwZGF0ZUNvbnRlbnQoaWQ6IFBSSVpNX1RPQVNUX0lELCBjb250ZW50OiBQb2x5bW9ycGhDb250ZW50KTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLnJlZnMuaGFzKGlkKSkgdGhyb3cgbmV3IFByaXptVG9hc3ROb3RFeGlzdEV4Y2VwdGlvbihpZCk7XG4gICAgdGhpcy5yZWZzLmdldChpZCk/LnVwZGF0ZUNvbnRlbnQoY29udGVudCk7XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlVGl0bGUoaWQ6IFBSSVpNX1RPQVNUX0lELCB0aXRsZTogUHJpem1Ub2FzdE9wdGlvbnNbJ3RpdGxlJ10pOiBQcml6bVRvYXN0UmVmIHtcbiAgICBpZiAoIXRoaXMucmVmcy5oYXMoaWQpKSB0aHJvdyBuZXcgUHJpem1Ub2FzdE5vdEV4aXN0RXhjZXB0aW9uKGlkKTtcbiAgICBjb25zdCByZWYgPSB0aGlzLnJlZnMuZ2V0KGlkKTtcbiAgICByZWY/LnVwZGF0ZVRpdGxlKHRpdGxlKTtcblxuICAgIHJldHVybiByZWYgYXMgUHJpem1Ub2FzdFJlZjtcbiAgfVxuXG4gIHB1YmxpYyBkZWxldGUoaWQ6IFBSSVpNX1RPQVNUX0lEKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLnJlZnMuaGFzKGlkKSkgdGhyb3cgbmV3IFByaXptVG9hc3ROb3RFeGlzdEV4Y2VwdGlvbihpZCk7XG4gICAgdGhpcy5yZWZzLmdldChpZCk/LmRlc3Ryb3koKTtcbiAgICB0aGlzLnJlZnMuZGVsZXRlKGlkKTtcbiAgICB0aGlzLmRldGVjdCgpO1xuICB9XG5cbiAgcHVibGljIGRlbGV0ZUFsbCgpOiB2b2lkIHtcbiAgICB0aGlzLnJlZnMuZm9yRWFjaCgoXywgaWQpID0+IHtcbiAgICAgIHRoaXMuZGVsZXRlKGlkKTtcbiAgICB9KTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuZGVzdHJveSQubmV4dCgpO1xuICAgIHRoaXMuZGVzdHJveSQudW5zdWJzY3JpYmUoKTtcbiAgfVxufVxuIl19