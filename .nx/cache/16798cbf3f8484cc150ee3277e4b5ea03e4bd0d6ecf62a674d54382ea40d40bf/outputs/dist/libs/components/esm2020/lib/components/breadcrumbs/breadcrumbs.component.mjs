import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChildren, ElementRef, EventEmitter, Input, Output, QueryList, ViewChild, ViewChildren, } from '@angular/core';
import { animationFrameScheduler, BehaviorSubject, merge, Subject } from 'rxjs';
import { PrizmDestroyService, prizmEmptyQueryList } from '@prizm-ui/helpers';
import { debounceTime, observeOn, takeUntil, tap } from 'rxjs/operators';
import { PrizmAbstractTestId } from '../../abstract/interactive';
import { PrizmBreadcrumbDirective } from './breadcrumbs.directive';
import { CommonModule } from '@angular/common';
import { PrizmIconModule } from '../icon';
import { PrizmDropdownHostModule } from '../dropdowns/dropdown-host';
import * as i0 from "@angular/core";
import * as i1 from "@prizm-ui/helpers";
import * as i2 from "@angular/common";
import * as i3 from "../icon/icon.component";
import * as i4 from "../dropdowns/dropdown-host/dropdown-host.component";
export class PrizmBreadcrumbsComponent extends PrizmAbstractTestId {
    set breadcrumbs(data) {
        this.breadcrumbs$.next(data);
    }
    get breadcrumbs() {
        return this.breadcrumbs$.getValue();
    }
    get activeBreadcrumbIdx() {
        return this.breadcrumbsToShow$.getValue().length - 1;
    }
    constructor(cdRef, destroy) {
        super();
        this.cdRef = cdRef;
        this.destroy = destroy;
        this.testId_ = 'ui_breadcrumbs';
        this.breadcrumbChange = new EventEmitter();
        this.breadcrumbsList = prizmEmptyQueryList();
        this.breadcrumbsItem = prizmEmptyQueryList();
        this.breadcrumbs$ = new BehaviorSubject([]);
        this.breadcrumbsToShow$ = new BehaviorSubject([]);
        this.breadcrumbsInMenu$ = new BehaviorSubject([]);
        this.isDropdownOpened = false;
        this.isContainerOverflowed = false;
        this.mutationDetector$ = new Subject();
    }
    changeBreadcrumb(idx) {
        this.breadcrumbs = this.breadcrumbs.filter((item, i) => i <= idx);
        this.breadcrumbChange.emit(this.breadcrumbs[idx]);
    }
    ngOnInit() {
        this.resizeObserver = new ResizeObserver(() => this.mutationDetector$.next());
        this.resizeObserver.observe(this.containerRef.nativeElement);
    }
    ngAfterViewInit() {
        const $mutation = this.mutationDetector$.pipe(debounceTime(200), observeOn(animationFrameScheduler), tap(() => {
            this.calculateOverflowState();
            this.setViewBreadcrumbs(this.breadcrumbs);
        }));
        const $breadcrumbsChange = this.breadcrumbs$.pipe(debounceTime(200), observeOn(animationFrameScheduler), tap(item => {
            this.calculateBreadcrumbsWidth();
            this.calculateOverflowState();
            this.setViewBreadcrumbs(item);
        }));
        merge($breadcrumbsChange, $mutation)
            .pipe(debounceTime(200), takeUntil(this.destroy))
            .subscribe(() => this.cdRef.detectChanges());
    }
    ngOnDestroy() {
        this.resizeObserver.disconnect();
        this.mutationDetector$.complete();
    }
    calculateOverflowState() {
        const containerWidth = this.containerRef.nativeElement.clientWidth;
        const contentWidth = this.breadcrumbsElementsWidth;
        if (contentWidth > containerWidth) {
            this.isContainerOverflowed = this.breadcrumbs.length > 2;
        }
        else {
            this.isDropdownOpened = false;
            this.isContainerOverflowed = false;
        }
    }
    calculateBreadcrumbsWidth() {
        this.breadcrumbsElementsWidth = this.fakeBreadcrumbContainer.nativeElement.clientWidth;
    }
    setViewBreadcrumbs(breadcrumbs) {
        if (this.isContainerOverflowed) {
            this.breadcrumbsInMenu$.next(breadcrumbs.filter((item, i) => i > 0 && i < breadcrumbs.length - 1));
            this.breadcrumbsToShow$.next(breadcrumbs.filter((item, i) => i === 0 || i === breadcrumbs.length - 1));
        }
        else {
            this.breadcrumbsInMenu$.next([]);
            this.breadcrumbsToShow$.next(breadcrumbs);
        }
    }
}
PrizmBreadcrumbsComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: PrizmBreadcrumbsComponent, deps: [{ token: i0.ChangeDetectorRef }, { token: i1.PrizmDestroyService }], target: i0.ɵɵFactoryTarget.Component });
PrizmBreadcrumbsComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: PrizmBreadcrumbsComponent, isStandalone: true, selector: "prizm-breadcrumbs", inputs: { breadcrumbs: "breadcrumbs" }, outputs: { breadcrumbChange: "breadcrumbChange" }, providers: [PrizmDestroyService], queries: [{ propertyName: "breadcrumbsItem", predicate: PrizmBreadcrumbDirective }], viewQueries: [{ propertyName: "containerRef", first: true, predicate: ["container"], descendants: true, static: true }, { propertyName: "fakeBreadcrumbContainer", first: true, predicate: ["breadcrumbsFake"], descendants: true, static: true }, { propertyName: "breadcrumbsList", predicate: ["breadcrumb"], descendants: true, read: ElementRef }], usesInheritance: true, ngImport: i0, template: "<div class=\"container\" #container>\n  <div class=\"breadcrumbs\" *ngFor=\"let item of breadcrumbsItem; let i = index\">\n    <prizm-icon\n      class=\"breadcrumbs__chevron\"\n      *ngIf=\"i !== 0\"\n      [size]=\"16\"\n      iconClass=\"chevrons-right\"\n    ></prizm-icon>\n\n    <div class=\"breadcrumb breadcrumb__name\">\n      <ng-container [ngTemplateOutlet]=\"item.template\" [ngTemplateOutletContext]=\"{ idx: i }\"></ng-container>\n    </div>\n\n    <prizm-dropdown-host\n      class=\"breadcrumbs__dots\"\n      *ngIf=\"i === 0 && this.isContainerOverflowed\"\n      [(isOpen)]=\"isDropdownOpened\"\n      [content]=\"dropdown\"\n      prizmDropdownHostWidth=\"auto\"\n    >\n      <div class=\"dropdown-inner\">\n        <prizm-icon class=\"breadcrumbs__chevron\" [size]=\"16\" iconClass=\"chevrons-right\"></prizm-icon>\n        <button class=\"dots-buttons\" (click)=\"isDropdownOpened = !isDropdownOpened\">...</button>\n      </div>\n    </prizm-dropdown-host>\n  </div>\n\n  <ng-container>\n    <div class=\"breadcrumbs\" #breadcrumb *ngFor=\"let breadcrumb of breadcrumbsToShow$ | async; let i = index\">\n      <prizm-icon\n        class=\"breadcrumbs__chevron\"\n        *ngIf=\"i !== 0\"\n        [size]=\"16\"\n        iconClass=\"chevrons-right\"\n      ></prizm-icon>\n\n      <button\n        class=\"breadcrumb\"\n        [class.breadcrumb_active]=\"i === activeBreadcrumbIdx\"\n        (click)=\"changeBreadcrumb(i)\"\n      >\n        <prizm-icon\n          class=\"breadcrumb__icon\"\n          *ngIf=\"breadcrumb.icon\"\n          [size]=\"16\"\n          [iconClass]=\"breadcrumb.icon\"\n        ></prizm-icon>\n        <span class=\"breadcrumb__name\" *ngIf=\"breadcrumb.name\">{{ breadcrumb.name }}</span>\n      </button>\n\n      <prizm-dropdown-host\n        class=\"breadcrumbs__dots\"\n        *ngIf=\"i === 0 && this.isContainerOverflowed\"\n        [(isOpen)]=\"isDropdownOpened\"\n        [content]=\"dropdown\"\n        prizmDropdownHostWidth=\"auto\"\n      >\n        <div class=\"dropdown-inner\">\n          <prizm-icon class=\"breadcrumbs__chevron\" [size]=\"16\" iconClass=\"chevrons-right\"></prizm-icon>\n          <button class=\"dots-buttons\" (click)=\"isDropdownOpened = !isDropdownOpened\">...</button>\n        </div>\n      </prizm-dropdown-host>\n    </div>\n  </ng-container>\n</div>\n\n<div class=\"container container__fake\" #breadcrumbsFake>\n  <div class=\"breadcrumbs\" #breadcrumbsFake *ngFor=\"let breadcrumb of breadcrumbs$ | async; let i = index\">\n    <prizm-icon\n      class=\"breadcrumbs__chevron\"\n      *ngIf=\"i !== 0\"\n      [size]=\"16\"\n      iconClass=\"chevrons-right\"\n    ></prizm-icon>\n    <button class=\"breadcrumb\">\n      <prizm-icon\n        class=\"breadcrumb__icon\"\n        *ngIf=\"!!breadcrumb.icon\"\n        [size]=\"16\"\n        [iconClass]=\"breadcrumb.icon\"\n      ></prizm-icon>\n      <span class=\"breadcrumb__name\">{{ breadcrumb?.name }}</span>\n    </button>\n  </div>\n</div>\n\n<ng-template #dropdown>\n  <div class=\"dropdown-content\" *ngIf=\"breadcrumbsInMenu$ | async as breadcrumbsInMenu\">\n    <ng-container *ngFor=\"let breadcrumb of breadcrumbsInMenu; let i = index\">\n      <button class=\"dropdown-breadcrumb\" (click)=\"changeBreadcrumb(i + 1)\">\n        <prizm-icon\n          class=\"dropdown-breadcrumb__icon\"\n          *ngIf=\"!!breadcrumb.icon\"\n          [size]=\"16\"\n          [iconClass]=\"breadcrumb.icon\"\n        ></prizm-icon>\n        <span class=\"dropdown-breadcrumb__name\">{{ breadcrumb?.name }}</span>\n      </button>\n    </ng-container>\n  </div>\n</ng-template>\n", styles: ["button{border:none;outline:none;background:transparent;cursor:pointer}span{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}:host{height:100%;width:100%;display:flex;position:relative;overflow:hidden}:host .container{flex:1;display:flex;overflow:hidden}:host .container__fake{position:absolute;opacity:0;z-index:0;pointer-events:none}:host .container .breadcrumbs{display:flex;align-items:center}:host .container .breadcrumbs .dropdown-inner{display:flex}:host .container .breadcrumbs__chevron{display:flex;color:var(--prizm-v3-text-icon-tertiary)}:host .container .breadcrumbs__dots{display:flex;align-items:center}:host .container .breadcrumbs__dots button:hover,:host .container .breadcrumbs__dots button:focus{color:var(--prizm-v3-button-primary-solid-hover)}:host .container .breadcrumbs .breadcrumb{height:32px;padding:0 6px;display:flex;align-items:center;justify-content:center;gap:8px;border:2px solid transparent;border-radius:4px}:host .container .breadcrumbs .breadcrumb__name{font-weight:400;font-size:12px;line-height:16px;color:var(--prizm-v3-text-icon-tertiary)}:host .container .breadcrumbs .breadcrumb__icon{height:32px;display:flex;align-items:center;justify-content:center;color:var(--prizm-v3-text-icon-tertiary)}:host .container .breadcrumbs .breadcrumb_active{cursor:auto}:host .container .breadcrumbs .breadcrumb_active .breadcrumb__name,:host .container .breadcrumbs .breadcrumb_active .breadcrumb__icon{color:var(--prizm-v3-text-icon-primary)}:host .container .breadcrumbs .breadcrumb:hover:not(.breadcrumb_active) .breadcrumb__name,:host .container .breadcrumbs .breadcrumb:hover:not(.breadcrumb_active) .breadcrumb__icon{color:var(--prizm-v3-button-primary-solid-hover);transition:.4s}:host .container .breadcrumbs .breadcrumb:focus:not(.breadcrumb_active){border-color:var(--prizm-v3-background-stroke-focus)}.dropdown-content{padding:8px 0;display:flex;flex-direction:column;background:var(--prizm-v3-background-fill-overlay)}.dropdown-content .dropdown-breadcrumb{height:32px;min-width:32px;max-width:210px;padding:0 8px;display:flex;align-items:center;gap:8px}.dropdown-content .dropdown-breadcrumb__name{height:24px;display:flex;align-items:center;font-weight:400;font-size:14px;line-height:16px;color:var(--prizm-v3-text-icon-secondary)}.dropdown-content .dropdown-breadcrumb__icon{height:32px;display:flex;align-items:center;justify-content:center;color:var(--prizm-v3-text-icon-secondary)}.dropdown-content .dropdown-breadcrumb:hover,.dropdown-content .dropdown-breadcrumb:focus{background:var(--prizm-v3-table-fill-row-hover)}.dots-buttons{color:var(--prizm-v3-text-icon-tertiary)}\n"], dependencies: [{ kind: "ngmodule", type: CommonModule }, { kind: "directive", type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i2.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "pipe", type: i2.AsyncPipe, name: "async" }, { kind: "ngmodule", type: 
            // TODO !ng16 change all icon module to svg module
            PrizmIconModule }, { kind: "component", type: i3.PrizmIconComponent, selector: "prizm-icon", inputs: ["iconClass", "size"] }, { kind: "ngmodule", type: PrizmDropdownHostModule }, { kind: "component", type: i4.PrizmDropdownHostComponent, selector: "prizm-dropdown-host", inputs: ["content", "prizmDropdownHostId", "prizmDropdownCustomContext", "delay", "canOpen", "closeByEsc", "closeOnOutsideClick", "prizmDropdownHost", "prizmDropdownHostWidth", "autoReposition", "placement", "isOpen", "dropdownStyles", "dropdownClasses"], outputs: ["isOpenChange"], exportAs: ["prizm-dropdown-host"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: PrizmBreadcrumbsComponent, decorators: [{
            type: Component,
            args: [{ selector: 'prizm-breadcrumbs', changeDetection: ChangeDetectionStrategy.OnPush, providers: [PrizmDestroyService], standalone: true, imports: [
                        CommonModule,
                        // TODO !ng16 change all icon module to svg module
                        PrizmIconModule,
                        PrizmDropdownHostModule,
                    ], template: "<div class=\"container\" #container>\n  <div class=\"breadcrumbs\" *ngFor=\"let item of breadcrumbsItem; let i = index\">\n    <prizm-icon\n      class=\"breadcrumbs__chevron\"\n      *ngIf=\"i !== 0\"\n      [size]=\"16\"\n      iconClass=\"chevrons-right\"\n    ></prizm-icon>\n\n    <div class=\"breadcrumb breadcrumb__name\">\n      <ng-container [ngTemplateOutlet]=\"item.template\" [ngTemplateOutletContext]=\"{ idx: i }\"></ng-container>\n    </div>\n\n    <prizm-dropdown-host\n      class=\"breadcrumbs__dots\"\n      *ngIf=\"i === 0 && this.isContainerOverflowed\"\n      [(isOpen)]=\"isDropdownOpened\"\n      [content]=\"dropdown\"\n      prizmDropdownHostWidth=\"auto\"\n    >\n      <div class=\"dropdown-inner\">\n        <prizm-icon class=\"breadcrumbs__chevron\" [size]=\"16\" iconClass=\"chevrons-right\"></prizm-icon>\n        <button class=\"dots-buttons\" (click)=\"isDropdownOpened = !isDropdownOpened\">...</button>\n      </div>\n    </prizm-dropdown-host>\n  </div>\n\n  <ng-container>\n    <div class=\"breadcrumbs\" #breadcrumb *ngFor=\"let breadcrumb of breadcrumbsToShow$ | async; let i = index\">\n      <prizm-icon\n        class=\"breadcrumbs__chevron\"\n        *ngIf=\"i !== 0\"\n        [size]=\"16\"\n        iconClass=\"chevrons-right\"\n      ></prizm-icon>\n\n      <button\n        class=\"breadcrumb\"\n        [class.breadcrumb_active]=\"i === activeBreadcrumbIdx\"\n        (click)=\"changeBreadcrumb(i)\"\n      >\n        <prizm-icon\n          class=\"breadcrumb__icon\"\n          *ngIf=\"breadcrumb.icon\"\n          [size]=\"16\"\n          [iconClass]=\"breadcrumb.icon\"\n        ></prizm-icon>\n        <span class=\"breadcrumb__name\" *ngIf=\"breadcrumb.name\">{{ breadcrumb.name }}</span>\n      </button>\n\n      <prizm-dropdown-host\n        class=\"breadcrumbs__dots\"\n        *ngIf=\"i === 0 && this.isContainerOverflowed\"\n        [(isOpen)]=\"isDropdownOpened\"\n        [content]=\"dropdown\"\n        prizmDropdownHostWidth=\"auto\"\n      >\n        <div class=\"dropdown-inner\">\n          <prizm-icon class=\"breadcrumbs__chevron\" [size]=\"16\" iconClass=\"chevrons-right\"></prizm-icon>\n          <button class=\"dots-buttons\" (click)=\"isDropdownOpened = !isDropdownOpened\">...</button>\n        </div>\n      </prizm-dropdown-host>\n    </div>\n  </ng-container>\n</div>\n\n<div class=\"container container__fake\" #breadcrumbsFake>\n  <div class=\"breadcrumbs\" #breadcrumbsFake *ngFor=\"let breadcrumb of breadcrumbs$ | async; let i = index\">\n    <prizm-icon\n      class=\"breadcrumbs__chevron\"\n      *ngIf=\"i !== 0\"\n      [size]=\"16\"\n      iconClass=\"chevrons-right\"\n    ></prizm-icon>\n    <button class=\"breadcrumb\">\n      <prizm-icon\n        class=\"breadcrumb__icon\"\n        *ngIf=\"!!breadcrumb.icon\"\n        [size]=\"16\"\n        [iconClass]=\"breadcrumb.icon\"\n      ></prizm-icon>\n      <span class=\"breadcrumb__name\">{{ breadcrumb?.name }}</span>\n    </button>\n  </div>\n</div>\n\n<ng-template #dropdown>\n  <div class=\"dropdown-content\" *ngIf=\"breadcrumbsInMenu$ | async as breadcrumbsInMenu\">\n    <ng-container *ngFor=\"let breadcrumb of breadcrumbsInMenu; let i = index\">\n      <button class=\"dropdown-breadcrumb\" (click)=\"changeBreadcrumb(i + 1)\">\n        <prizm-icon\n          class=\"dropdown-breadcrumb__icon\"\n          *ngIf=\"!!breadcrumb.icon\"\n          [size]=\"16\"\n          [iconClass]=\"breadcrumb.icon\"\n        ></prizm-icon>\n        <span class=\"dropdown-breadcrumb__name\">{{ breadcrumb?.name }}</span>\n      </button>\n    </ng-container>\n  </div>\n</ng-template>\n", styles: ["button{border:none;outline:none;background:transparent;cursor:pointer}span{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}:host{height:100%;width:100%;display:flex;position:relative;overflow:hidden}:host .container{flex:1;display:flex;overflow:hidden}:host .container__fake{position:absolute;opacity:0;z-index:0;pointer-events:none}:host .container .breadcrumbs{display:flex;align-items:center}:host .container .breadcrumbs .dropdown-inner{display:flex}:host .container .breadcrumbs__chevron{display:flex;color:var(--prizm-v3-text-icon-tertiary)}:host .container .breadcrumbs__dots{display:flex;align-items:center}:host .container .breadcrumbs__dots button:hover,:host .container .breadcrumbs__dots button:focus{color:var(--prizm-v3-button-primary-solid-hover)}:host .container .breadcrumbs .breadcrumb{height:32px;padding:0 6px;display:flex;align-items:center;justify-content:center;gap:8px;border:2px solid transparent;border-radius:4px}:host .container .breadcrumbs .breadcrumb__name{font-weight:400;font-size:12px;line-height:16px;color:var(--prizm-v3-text-icon-tertiary)}:host .container .breadcrumbs .breadcrumb__icon{height:32px;display:flex;align-items:center;justify-content:center;color:var(--prizm-v3-text-icon-tertiary)}:host .container .breadcrumbs .breadcrumb_active{cursor:auto}:host .container .breadcrumbs .breadcrumb_active .breadcrumb__name,:host .container .breadcrumbs .breadcrumb_active .breadcrumb__icon{color:var(--prizm-v3-text-icon-primary)}:host .container .breadcrumbs .breadcrumb:hover:not(.breadcrumb_active) .breadcrumb__name,:host .container .breadcrumbs .breadcrumb:hover:not(.breadcrumb_active) .breadcrumb__icon{color:var(--prizm-v3-button-primary-solid-hover);transition:.4s}:host .container .breadcrumbs .breadcrumb:focus:not(.breadcrumb_active){border-color:var(--prizm-v3-background-stroke-focus)}.dropdown-content{padding:8px 0;display:flex;flex-direction:column;background:var(--prizm-v3-background-fill-overlay)}.dropdown-content .dropdown-breadcrumb{height:32px;min-width:32px;max-width:210px;padding:0 8px;display:flex;align-items:center;gap:8px}.dropdown-content .dropdown-breadcrumb__name{height:24px;display:flex;align-items:center;font-weight:400;font-size:14px;line-height:16px;color:var(--prizm-v3-text-icon-secondary)}.dropdown-content .dropdown-breadcrumb__icon{height:32px;display:flex;align-items:center;justify-content:center;color:var(--prizm-v3-text-icon-secondary)}.dropdown-content .dropdown-breadcrumb:hover,.dropdown-content .dropdown-breadcrumb:focus{background:var(--prizm-v3-table-fill-row-hover)}.dots-buttons{color:var(--prizm-v3-text-icon-tertiary)}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }, { type: i1.PrizmDestroyService }]; }, propDecorators: { breadcrumbs: [{
                type: Input
            }], breadcrumbChange: [{
                type: Output
            }], containerRef: [{
                type: ViewChild,
                args: ['container', { static: true }]
            }], fakeBreadcrumbContainer: [{
                type: ViewChild,
                args: ['breadcrumbsFake', { static: true }]
            }], breadcrumbsList: [{
                type: ViewChildren,
                args: ['breadcrumb', { read: ElementRef }]
            }], breadcrumbsItem: [{
                type: ContentChildren,
                args: [PrizmBreadcrumbDirective]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnJlYWRjcnVtYnMuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9jb21wb25lbnRzL3NyYy9saWIvY29tcG9uZW50cy9icmVhZGNydW1icy9icmVhZGNydW1icy5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL2NvbXBvbmVudHMvc3JjL2xpYi9jb21wb25lbnRzL2JyZWFkY3J1bWJzL2JyZWFkY3J1bWJzLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFTCx1QkFBdUIsRUFDdkIsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxlQUFlLEVBQ2YsVUFBVSxFQUNWLFlBQVksRUFDWixLQUFLLEVBR0wsTUFBTSxFQUNOLFNBQVMsRUFDVCxTQUFTLEVBQ1QsWUFBWSxHQUNiLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxlQUFlLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNoRixPQUFPLEVBQUUsbUJBQW1CLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUM3RSxPQUFPLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDakUsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDbkUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDMUMsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sNEJBQTRCLENBQUM7Ozs7OztBQWdCckUsTUFBTSxPQUFPLHlCQUNYLFNBQVEsbUJBQW1CO0lB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QUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3hHO2FBQU07WUFDTCxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ2pDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7U0FDM0M7SUFDSCxDQUFDOztzSEF6R1UseUJBQXlCOzBHQUF6Qix5QkFBeUIsMkpBVHpCLENBQUMsbUJBQW1CLENBQUMsMERBNEJmLHdCQUF3QiwrVUFGTCxVQUFVLG9EQ3pEaEQsMmlIQXFHQSw4bkZEbkVJLFlBQVk7WUFDWixrREFBa0Q7WUFDbEQsZUFBZSx5SUFDZix1QkFBdUI7MkZBR2QseUJBQXlCO2tCQWRyQyxTQUFTOytCQUNFLG1CQUFtQixtQkFHWix1QkFBdUIsQ0FBQyxNQUFNLGFBQ3BDLENBQUMsbUJBQW1CLENBQUMsY0FDcEIsSUFBSSxXQUNQO3dCQUNQLFlBQVk7d0JBQ1osa0RBQWtEO3dCQUNsRCxlQUFlO3dCQUNmLHVCQUF1QjtxQkFDeEI7MElBTVksV0FBVztzQkFBdkIsS0FBSztnQkFVVyxnQkFBZ0I7c0JBQWhDLE1BQU07Z0JBQzBDLFlBQVk7c0JBQTVELFNBQVM7dUJBQUMsV0FBVyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTtnQkFDZSx1QkFBdUI7c0JBQTdFLFNBQVM7dUJBQUMsaUJBQWlCLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO2dCQUNXLGVBQWU7c0JBQXZFLFlBQVk7dUJBQUMsWUFBWSxFQUFFLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRTtnQkFFRSxlQUFlO3NCQUFoRSxlQUFlO3VCQUFDLHdCQUF3QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFmdGVyVmlld0luaXQsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29tcG9uZW50LFxuICBDb250ZW50Q2hpbGRyZW4sXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5wdXQsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG4gIFF1ZXJ5TGlzdCxcbiAgVmlld0NoaWxkLFxuICBWaWV3Q2hpbGRyZW4sXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSUJyZWFkY3J1bWIgfSBmcm9tICcuL2JyZWFkY3J1bWIuaW50ZXJmYWNlJztcbmltcG9ydCB7IGFuaW1hdGlvbkZyYW1lU2NoZWR1bGVyLCBCZWhhdmlvclN1YmplY3QsIG1lcmdlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBQcml6bURlc3Ryb3lTZXJ2aWNlLCBwcml6bUVtcHR5UXVlcnlMaXN0IH0gZnJvbSAnQHByaXptLXVpL2hlbHBlcnMnO1xuaW1wb3J0IHsgZGVib3VuY2VUaW1lLCBvYnNlcnZlT24sIHRha2VVbnRpbCwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgUHJpem1BYnN0cmFjdFRlc3RJZCB9IGZyb20gJy4uLy4uL2Fic3RyYWN0L2ludGVyYWN0aXZlJztcbmltcG9ydCB7IFByaXptQnJlYWRjcnVtYkRpcmVjdGl2ZSB9IGZyb20gJy4vYnJlYWRjcnVtYnMuZGlyZWN0aXZlJztcbmltcG9ydCB7IENvbW1vbk1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBQcml6bUljb25Nb2R1bGUgfSBmcm9tICcuLi9pY29uJztcbmltcG9ydCB7IFByaXptRHJvcGRvd25Ib3N0TW9kdWxlIH0gZnJvbSAnLi4vZHJvcGRvd25zL2Ryb3Bkb3duLWhvc3QnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwcml6bS1icmVhZGNydW1icycsXG4gIHRlbXBsYXRlVXJsOiAnLi9icmVhZGNydW1icy5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2JyZWFkY3J1bWJzLmNvbXBvbmVudC5sZXNzJ10sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBwcm92aWRlcnM6IFtQcml6bURlc3Ryb3lTZXJ2aWNlXSxcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcbiAgaW1wb3J0czogW1xuICAgIENvbW1vbk1vZHVsZSxcbiAgICAvLyBUT0RPICFuZzE2IGNoYW5nZSBhbGwgaWNvbiBtb2R1bGUgdG8gc3ZnIG1vZHVsZVxuICAgIFByaXptSWNvbk1vZHVsZSxcbiAgICBQcml6bURyb3Bkb3duSG9zdE1vZHVsZSxcbiAgXSxcbn0pXG5leHBvcnQgY2xhc3MgUHJpem1CcmVhZGNydW1ic0NvbXBvbmVudDxCcmVhZGNydW1iIGV4dGVuZHMgSUJyZWFkY3J1bWI+XG4gIGV4dGVuZHMgUHJpem1BYnN0cmFjdFRlc3RJZFxuICBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95LCBBZnRlclZpZXdJbml0XG57XG4gIEBJbnB1dCgpIHNldCBicmVhZGNydW1icyhkYXRhOiBCcmVhZGNydW1iW10pIHtcbiAgICB0aGlzLmJyZWFkY3J1bWJzJC5uZXh0KGRhdGEpO1xuICB9XG5cbiAgcHVibGljIGdldCBicmVhZGNydW1icygpOiBCcmVhZGNydW1iW10ge1xuICAgIHJldHVybiB0aGlzLmJyZWFkY3J1bWJzJC5nZXRWYWx1ZSgpO1xuICB9XG5cbiAgb3ZlcnJpZGUgcmVhZG9ubHkgdGVzdElkXyA9ICd1aV9icmVhZGNydW1icyc7XG5cbiAgQE91dHB1dCgpIHB1YmxpYyBicmVhZGNydW1iQ2hhbmdlOiBFdmVudEVtaXR0ZXI8QnJlYWRjcnVtYj4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBWaWV3Q2hpbGQoJ2NvbnRhaW5lcicsIHsgc3RhdGljOiB0cnVlIH0pIHB1YmxpYyBjb250YWluZXJSZWYhOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdicmVhZGNydW1ic0Zha2UnLCB7IHN0YXRpYzogdHJ1ZSB9KSBwdWJsaWMgZmFrZUJyZWFkY3J1bWJDb250YWluZXIhOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkcmVuKCdicmVhZGNydW1iJywgeyByZWFkOiBFbGVtZW50UmVmIH0pIHB1YmxpYyBicmVhZGNydW1ic0xpc3Q6IFF1ZXJ5TGlzdDxFbGVtZW50UmVmPiA9XG4gICAgcHJpem1FbXB0eVF1ZXJ5TGlzdCgpO1xuICBAQ29udGVudENoaWxkcmVuKFByaXptQnJlYWRjcnVtYkRpcmVjdGl2ZSkgcHVibGljIGJyZWFkY3J1bWJzSXRlbTogUXVlcnlMaXN0PFByaXptQnJlYWRjcnVtYkRpcmVjdGl2ZT4gPVxuICAgIHByaXptRW1wdHlRdWVyeUxpc3QoKTtcblxuICBwdWJsaWMgYnJlYWRjcnVtYnMkOiBCZWhhdmlvclN1YmplY3Q8QnJlYWRjcnVtYltdPiA9IG5ldyBCZWhhdmlvclN1YmplY3Q8QnJlYWRjcnVtYltdPihbXSk7XG4gIHB1YmxpYyBicmVhZGNydW1ic1RvU2hvdyQ6IEJlaGF2aW9yU3ViamVjdDxCcmVhZGNydW1iW10+ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxCcmVhZGNydW1iW10+KFtdKTtcbiAgcHVibGljIGJyZWFkY3J1bWJzSW5NZW51JDogQmVoYXZpb3JTdWJqZWN0PEJyZWFkY3J1bWJbXT4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0PEJyZWFkY3J1bWJbXT4oW10pO1xuXG4gIHB1YmxpYyBpc0Ryb3Bkb3duT3BlbmVkID0gZmFsc2U7XG4gIHB1YmxpYyBpc0NvbnRhaW5lck92ZXJmbG93ZWQgPSBmYWxzZTtcbiAgcHVibGljIGJyZWFkY3J1bWJzRWxlbWVudHNXaWR0aCE6IG51bWJlcjtcblxuICBwdWJsaWMgZ2V0IGFjdGl2ZUJyZWFkY3J1bWJJZHgoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5icmVhZGNydW1ic1RvU2hvdyQuZ2V0VmFsdWUoKS5sZW5ndGggLSAxO1xuICB9XG5cbiAgcHJpdmF0ZSByZXNpemVPYnNlcnZlciE6IFJlc2l6ZU9ic2VydmVyO1xuICBwcml2YXRlIG11dGF0aW9uRGV0ZWN0b3IkOiBTdWJqZWN0PHZvaWQ+ID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGNkUmVmOiBDaGFuZ2VEZXRlY3RvclJlZiwgcHJpdmF0ZSByZWFkb25seSBkZXN0cm95OiBQcml6bURlc3Ryb3lTZXJ2aWNlKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIHB1YmxpYyBjaGFuZ2VCcmVhZGNydW1iKGlkeDogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5icmVhZGNydW1icyA9IHRoaXMuYnJlYWRjcnVtYnMuZmlsdGVyKChpdGVtLCBpKSA9PiBpIDw9IGlkeCk7XG4gICAgdGhpcy5icmVhZGNydW1iQ2hhbmdlLmVtaXQodGhpcy5icmVhZGNydW1ic1tpZHhdKTtcbiAgfVxuXG4gIHB1YmxpYyBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLnJlc2l6ZU9ic2VydmVyID0gbmV3IFJlc2l6ZU9ic2VydmVyKCgpID0+IHRoaXMubXV0YXRpb25EZXRlY3RvciQubmV4dCgpKTtcbiAgICB0aGlzLnJlc2l6ZU9ic2VydmVyLm9ic2VydmUodGhpcy5jb250YWluZXJSZWYubmF0aXZlRWxlbWVudCk7XG4gIH1cblxuICBwdWJsaWMgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgIGNvbnN0ICRtdXRhdGlvbiA9IHRoaXMubXV0YXRpb25EZXRlY3RvciQucGlwZShcbiAgICAgIGRlYm91bmNlVGltZSgyMDApLFxuICAgICAgb2JzZXJ2ZU9uKGFuaW1hdGlvbkZyYW1lU2NoZWR1bGVyKSxcbiAgICAgIHRhcCgoKSA9PiB7XG4gICAgICAgIHRoaXMuY2FsY3VsYXRlT3ZlcmZsb3dTdGF0ZSgpO1xuICAgICAgICB0aGlzLnNldFZpZXdCcmVhZGNydW1icyh0aGlzLmJyZWFkY3J1bWJzKTtcbiAgICAgIH0pXG4gICAgKTtcblxuICAgIGNvbnN0ICRicmVhZGNydW1ic0NoYW5nZSA9IHRoaXMuYnJlYWRjcnVtYnMkLnBpcGUoXG4gICAgICBkZWJvdW5jZVRpbWUoMjAwKSxcbiAgICAgIG9ic2VydmVPbihhbmltYXRpb25GcmFtZVNjaGVkdWxlciksXG4gICAgICB0YXAoaXRlbSA9PiB7XG4gICAgICAgIHRoaXMuY2FsY3VsYXRlQnJlYWRjcnVtYnNXaWR0aCgpO1xuICAgICAgICB0aGlzLmNhbGN1bGF0ZU92ZXJmbG93U3RhdGUoKTtcbiAgICAgICAgdGhpcy5zZXRWaWV3QnJlYWRjcnVtYnMoaXRlbSk7XG4gICAgICB9KVxuICAgICk7XG5cbiAgICBtZXJnZSgkYnJlYWRjcnVtYnNDaGFuZ2UsICRtdXRhdGlvbilcbiAgICAgIC5waXBlKGRlYm91bmNlVGltZSgyMDApLCB0YWtlVW50aWwodGhpcy5kZXN0cm95KSlcbiAgICAgIC5zdWJzY3JpYmUoKCkgPT4gdGhpcy5jZFJlZi5kZXRlY3RDaGFuZ2VzKCkpO1xuICB9XG5cbiAgcHVibGljIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMucmVzaXplT2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuICAgIHRoaXMubXV0YXRpb25EZXRlY3RvciQuY29tcGxldGUoKTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlT3ZlcmZsb3dTdGF0ZSgpOiB2b2lkIHtcbiAgICBjb25zdCBjb250YWluZXJXaWR0aCA9IHRoaXMuY29udGFpbmVyUmVmLm5hdGl2ZUVsZW1lbnQuY2xpZW50V2lkdGg7XG4gICAgY29uc3QgY29udGVudFdpZHRoID0gdGhpcy5icmVhZGNydW1ic0VsZW1lbnRzV2lkdGg7XG5cbiAgICBpZiAoY29udGVudFdpZHRoID4gY29udGFpbmVyV2lkdGgpIHtcbiAgICAgIHRoaXMuaXNDb250YWluZXJPdmVyZmxvd2VkID0gdGhpcy5icmVhZGNydW1icy5sZW5ndGggPiAyO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmlzRHJvcGRvd25PcGVuZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMuaXNDb250YWluZXJPdmVyZmxvd2VkID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVCcmVhZGNydW1ic1dpZHRoKCk6IHZvaWQge1xuICAgIHRoaXMuYnJlYWRjcnVtYnNFbGVtZW50c1dpZHRoID0gdGhpcy5mYWtlQnJlYWRjcnVtYkNvbnRhaW5lci5uYXRpdmVFbGVtZW50LmNsaWVudFdpZHRoO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRWaWV3QnJlYWRjcnVtYnMoYnJlYWRjcnVtYnM6IEJyZWFkY3J1bWJbXSk6IHZvaWQge1xuICAgIGlmICh0aGlzLmlzQ29udGFpbmVyT3ZlcmZsb3dlZCkge1xuICAgICAgdGhpcy5icmVhZGNydW1ic0luTWVudSQubmV4dChicmVhZGNydW1icy5maWx0ZXIoKGl0ZW0sIGkpID0+IGkgPiAwICYmIGkgPCBicmVhZGNydW1icy5sZW5ndGggLSAxKSk7XG4gICAgICB0aGlzLmJyZWFkY3J1bWJzVG9TaG93JC5uZXh0KGJyZWFkY3J1bWJzLmZpbHRlcigoaXRlbSwgaSkgPT4gaSA9PT0gMCB8fCBpID09PSBicmVhZGNydW1icy5sZW5ndGggLSAxKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYnJlYWRjcnVtYnNJbk1lbnUkLm5leHQoW10pO1xuICAgICAgdGhpcy5icmVhZGNydW1ic1RvU2hvdyQubmV4dChicmVhZGNydW1icyk7XG4gICAgfVxuICB9XG59XG4iLCI8ZGl2IGNsYXNzPVwiY29udGFpbmVyXCIgI2NvbnRhaW5lcj5cbiAgPGRpdiBjbGFzcz1cImJyZWFkY3J1bWJzXCIgKm5nRm9yPVwibGV0IGl0ZW0gb2YgYnJlYWRjcnVtYnNJdGVtOyBsZXQgaSA9IGluZGV4XCI+XG4gICAgPHByaXptLWljb25cbiAgICAgIGNsYXNzPVwiYnJlYWRjcnVtYnNfX2NoZXZyb25cIlxuICAgICAgKm5nSWY9XCJpICE9PSAwXCJcbiAgICAgIFtzaXplXT1cIjE2XCJcbiAgICAgIGljb25DbGFzcz1cImNoZXZyb25zLXJpZ2h0XCJcbiAgICA+PC9wcml6bS1pY29uPlxuXG4gICAgPGRpdiBjbGFzcz1cImJyZWFkY3J1bWIgYnJlYWRjcnVtYl9fbmFtZVwiPlxuICAgICAgPG5nLWNvbnRhaW5lciBbbmdUZW1wbGF0ZU91dGxldF09XCJpdGVtLnRlbXBsYXRlXCIgW25nVGVtcGxhdGVPdXRsZXRDb250ZXh0XT1cInsgaWR4OiBpIH1cIj48L25nLWNvbnRhaW5lcj5cbiAgICA8L2Rpdj5cblxuICAgIDxwcml6bS1kcm9wZG93bi1ob3N0XG4gICAgICBjbGFzcz1cImJyZWFkY3J1bWJzX19kb3RzXCJcbiAgICAgICpuZ0lmPVwiaSA9PT0gMCAmJiB0aGlzLmlzQ29udGFpbmVyT3ZlcmZsb3dlZFwiXG4gICAgICBbKGlzT3BlbildPVwiaXNEcm9wZG93bk9wZW5lZFwiXG4gICAgICBbY29udGVudF09XCJkcm9wZG93blwiXG4gICAgICBwcml6bURyb3Bkb3duSG9zdFdpZHRoPVwiYXV0b1wiXG4gICAgPlxuICAgICAgPGRpdiBjbGFzcz1cImRyb3Bkb3duLWlubmVyXCI+XG4gICAgICAgIDxwcml6bS1pY29uIGNsYXNzPVwiYnJlYWRjcnVtYnNfX2NoZXZyb25cIiBbc2l6ZV09XCIxNlwiIGljb25DbGFzcz1cImNoZXZyb25zLXJpZ2h0XCI+PC9wcml6bS1pY29uPlxuICAgICAgICA8YnV0dG9uIGNsYXNzPVwiZG90cy1idXR0b25zXCIgKGNsaWNrKT1cImlzRHJvcGRvd25PcGVuZWQgPSAhaXNEcm9wZG93bk9wZW5lZFwiPi4uLjwvYnV0dG9uPlxuICAgICAgPC9kaXY+XG4gICAgPC9wcml6bS1kcm9wZG93bi1ob3N0PlxuICA8L2Rpdj5cblxuICA8bmctY29udGFpbmVyPlxuICAgIDxkaXYgY2xhc3M9XCJicmVhZGNydW1ic1wiICNicmVhZGNydW1iICpuZ0Zvcj1cImxldCBicmVhZGNydW1iIG9mIGJyZWFkY3J1bWJzVG9TaG93JCB8IGFzeW5jOyBsZXQgaSA9IGluZGV4XCI+XG4gICAgICA8cHJpem0taWNvblxuICAgICAgICBjbGFzcz1cImJyZWFkY3J1bWJzX19jaGV2cm9uXCJcbiAgICAgICAgKm5nSWY9XCJpICE9PSAwXCJcbiAgICAgICAgW3NpemVdPVwiMTZcIlxuICAgICAgICBpY29uQ2xhc3M9XCJjaGV2cm9ucy1yaWdodFwiXG4gICAgICA+PC9wcml6bS1pY29uPlxuXG4gICAgICA8YnV0dG9uXG4gICAgICAgIGNsYXNzPVwiYnJlYWRjcnVtYlwiXG4gICAgICAgIFtjbGFzcy5icmVhZGNydW1iX2FjdGl2ZV09XCJpID09PSBhY3RpdmVCcmVhZGNydW1iSWR4XCJcbiAgICAgICAgKGNsaWNrKT1cImNoYW5nZUJyZWFkY3J1bWIoaSlcIlxuICAgICAgPlxuICAgICAgICA8cHJpem0taWNvblxuICAgICAgICAgIGNsYXNzPVwiYnJlYWRjcnVtYl9faWNvblwiXG4gICAgICAgICAgKm5nSWY9XCJicmVhZGNydW1iLmljb25cIlxuICAgICAgICAgIFtzaXplXT1cIjE2XCJcbiAgICAgICAgICBbaWNvbkNsYXNzXT1cImJyZWFkY3J1bWIuaWNvblwiXG4gICAgICAgID48L3ByaXptLWljb24+XG4gICAgICAgIDxzcGFuIGNsYXNzPVwiYnJlYWRjcnVtYl9fbmFtZVwiICpuZ0lmPVwiYnJlYWRjcnVtYi5uYW1lXCI+e3sgYnJlYWRjcnVtYi5uYW1lIH19PC9zcGFuPlxuICAgICAgPC9idXR0b24+XG5cbiAgICAgIDxwcml6bS1kcm9wZG93bi1ob3N0XG4gICAgICAgIGNsYXNzPVwiYnJlYWRjcnVtYnNfX2RvdHNcIlxuICAgICAgICAqbmdJZj1cImkgPT09IDAgJiYgdGhpcy5pc0NvbnRhaW5lck92ZXJmbG93ZWRcIlxuICAgICAgICBbKGlzT3BlbildPVwiaXNEcm9wZG93bk9wZW5lZFwiXG4gICAgICAgIFtjb250ZW50XT1cImRyb3Bkb3duXCJcbiAgICAgICAgcHJpem1Ecm9wZG93bkhvc3RXaWR0aD1cImF1dG9cIlxuICAgICAgPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiZHJvcGRvd24taW5uZXJcIj5cbiAgICAgICAgICA8cHJpem0taWNvbiBjbGFzcz1cImJyZWFkY3J1bWJzX19jaGV2cm9uXCIgW3NpemVdPVwiMTZcIiBpY29uQ2xhc3M9XCJjaGV2cm9ucy1yaWdodFwiPjwvcHJpem0taWNvbj5cbiAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwiZG90cy1idXR0b25zXCIgKGNsaWNrKT1cImlzRHJvcGRvd25PcGVuZWQgPSAhaXNEcm9wZG93bk9wZW5lZFwiPi4uLjwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvcHJpem0tZHJvcGRvd24taG9zdD5cbiAgICA8L2Rpdj5cbiAgPC9uZy1jb250YWluZXI+XG48L2Rpdj5cblxuPGRpdiBjbGFzcz1cImNvbnRhaW5lciBjb250YWluZXJfX2Zha2VcIiAjYnJlYWRjcnVtYnNGYWtlPlxuICA8ZGl2IGNsYXNzPVwiYnJlYWRjcnVtYnNcIiAjYnJlYWRjcnVtYnNGYWtlICpuZ0Zvcj1cImxldCBicmVhZGNydW1iIG9mIGJyZWFkY3J1bWJzJCB8IGFzeW5jOyBsZXQgaSA9IGluZGV4XCI+XG4gICAgPHByaXptLWljb25cbiAgICAgIGNsYXNzPVwiYnJlYWRjcnVtYnNfX2NoZXZyb25cIlxuICAgICAgKm5nSWY9XCJpICE9PSAwXCJcbiAgICAgIFtzaXplXT1cIjE2XCJcbiAgICAgIGljb25DbGFzcz1cImNoZXZyb25zLXJpZ2h0XCJcbiAgICA+PC9wcml6bS1pY29uPlxuICAgIDxidXR0b24gY2xhc3M9XCJicmVhZGNydW1iXCI+XG4gICAgICA8cHJpem0taWNvblxuICAgICAgICBjbGFzcz1cImJyZWFkY3J1bWJfX2ljb25cIlxuICAgICAgICAqbmdJZj1cIiEhYnJlYWRjcnVtYi5pY29uXCJcbiAgICAgICAgW3NpemVdPVwiMTZcIlxuICAgICAgICBbaWNvbkNsYXNzXT1cImJyZWFkY3J1bWIuaWNvblwiXG4gICAgICA+PC9wcml6bS1pY29uPlxuICAgICAgPHNwYW4gY2xhc3M9XCJicmVhZGNydW1iX19uYW1lXCI+e3sgYnJlYWRjcnVtYj8ubmFtZSB9fTwvc3Bhbj5cbiAgICA8L2J1dHRvbj5cbiAgPC9kaXY+XG48L2Rpdj5cblxuPG5nLXRlbXBsYXRlICNkcm9wZG93bj5cbiAgPGRpdiBjbGFzcz1cImRyb3Bkb3duLWNvbnRlbnRcIiAqbmdJZj1cImJyZWFkY3J1bWJzSW5NZW51JCB8IGFzeW5jIGFzIGJyZWFkY3J1bWJzSW5NZW51XCI+XG4gICAgPG5nLWNvbnRhaW5lciAqbmdGb3I9XCJsZXQgYnJlYWRjcnVtYiBvZiBicmVhZGNydW1ic0luTWVudTsgbGV0IGkgPSBpbmRleFwiPlxuICAgICAgPGJ1dHRvbiBjbGFzcz1cImRyb3Bkb3duLWJyZWFkY3J1bWJcIiAoY2xpY2spPVwiY2hhbmdlQnJlYWRjcnVtYihpICsgMSlcIj5cbiAgICAgICAgPHByaXptLWljb25cbiAgICAgICAgICBjbGFzcz1cImRyb3Bkb3duLWJyZWFkY3J1bWJfX2ljb25cIlxuICAgICAgICAgICpuZ0lmPVwiISFicmVhZGNydW1iLmljb25cIlxuICAgICAgICAgIFtzaXplXT1cIjE2XCJcbiAgICAgICAgICBbaWNvbkNsYXNzXT1cImJyZWFkY3J1bWIuaWNvblwiXG4gICAgICAgID48L3ByaXptLWljb24+XG4gICAgICAgIDxzcGFuIGNsYXNzPVwiZHJvcGRvd24tYnJlYWRjcnVtYl9fbmFtZVwiPnt7IGJyZWFkY3J1bWI/Lm5hbWUgfX08L3NwYW4+XG4gICAgICA8L2J1dHRvbj5cbiAgICA8L25nLWNvbnRhaW5lcj5cbiAgPC9kaXY+XG48L25nLXRlbXBsYXRlPlxuIl19