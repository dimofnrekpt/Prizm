import { ChangeDetectionStrategy, Component, ElementRef, EventEmitter, Inject, Input, Optional, Output, Renderer2, ViewChild, } from '@angular/core';
import { PrizmDestroyService, PrizmLetDirective, PrizmPluckPipe, PrizmSanitizerPipe, } from '@prizm-ui/helpers';
import { PRIZM_FILEUPLOAD_OPTIONS, prizmFileUploadDefaultOptions } from './file-upload-options';
import { PRIZM_FILE_UPLOAD } from '../../tokens';
import { Observable } from 'rxjs';
import { prizmI18nInitWithKey } from '../../services';
import { PrizmAbstractTestId } from '@prizm-ui/core';
import { coerceBooleanProperty } from '@angular/cdk/coercion';
import { CommonModule } from '@angular/common';
import { PrizmButtonComponent } from '../button';
import { PrizmProgressBarComponent } from '../progress';
import { PrizmIconComponent } from '../icon';
import { PrizmUploadStatusPipe } from './pipes/upload-status.pipe';
import { PrizmFileSizePipe } from './pipes/file-size.pipe';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "rxjs";
export class PrizmFileUploadComponent extends PrizmAbstractTestId {
    constructor(renderer, fileUpload$, customOptions) {
        super();
        this.renderer = renderer;
        this.fileUpload$ = fileUpload$;
        this.testId_ = 'ui_file_upload';
        this.options = { ...prizmFileUploadDefaultOptions };
        this.listeners = [];
        this.validationErrors = {};
        this.accept = '';
        this.multiple = false;
        this.maxFileSize = Number.MAX_SAFE_INTEGER;
        this.maxFilesCount = Number.MAX_SAFE_INTEGER;
        this._disabled = false;
        this.beforeFilesChange = new EventEmitter();
        this.filesChange = new EventEmitter();
        this.filesValidationErrors = new EventEmitter();
        this.filesCountError = new EventEmitter();
        this.retry = new EventEmitter();
        this.filesMap = new Map();
        this.options = { ...this.options, ...customOptions };
    }
    get disabled() {
        return this._disabled;
    }
    set disabled(value) {
        this._disabled = coerceBooleanProperty(value);
    }
    set progress(progress) {
        for (const key of Object.keys(progress)) {
            if (this.filesMap.has(key)) {
                this.filesMap.set(key, { ...this.filesMap.get(key), ...progress[key] });
            }
        }
    }
    get files() {
        return [...this.filesMap.entries()].map(([_, { file }]) => file);
    }
    ngAfterViewInit() {
        this.listeners.push(this.renderer.listen(this.dropzoneElementRef.nativeElement, 'dragover', this.dropzoneDragOverListener.bind(this)));
        this.listeners.push(this.renderer.listen(this.dropzoneElementRef.nativeElement, 'dragleave', this.dropzoneDragLeaveListener.bind(this)));
    }
    ngOnDestroy() {
        for (const listener of this.listeners) {
            listener();
        }
    }
    onDrop(event) {
        event.preventDefault();
        if (this.disabled === false) {
            const { files } = event.dataTransfer;
            this.selectFiles(Array.from(files));
        }
        this.dropzoneElementRef.nativeElement.classList.remove('active');
    }
    onFileInputChange(event) {
        const inputFile = event.target;
        if (inputFile.files.length > 0) {
            this.selectFiles(Array.from(inputFile.files));
            inputFile.value = '';
        }
    }
    getFileExtension(file) {
        return '.' + file.name.split('.').pop();
    }
    removeFile(filename, options = { emitEvent: true }) {
        if (options.emitEvent) {
            this.beforeFilesChange.next();
        }
        const fileData = this.filesMap.get(filename);
        if (fileData.url) {
            URL.revokeObjectURL(fileData.url);
        }
        this.filesMap.delete(filename);
        if (options.emitEvent) {
            this.filesChange.next(this.files);
        }
    }
    clearFiles(options = { emitEvent: true }) {
        if (options.emitEvent) {
            this.beforeFilesChange.next();
        }
        for (const file of this.filesMap.keys()) {
            this.removeFile(file);
        }
        if (options.emitEvent) {
            this.filesChange.next([]);
        }
    }
    filesTrackBy(index, file) {
        return file.key;
    }
    retryUpload(filename) {
        // eslint-disable-next-line @typescript-eslint/ban-ts-comment
        // @ts-ignore
        this.retry.emit(this.filesMap.get(filename).file);
    }
    dropzoneDragOverListener(event) {
        event.preventDefault();
        if (this.disabled === false) {
            // eslint-disable-next-line @typescript-eslint/ban-ts-comment
            // @ts-ignore
            event.dataTransfer.dropEffect = 'copy';
            this.dropzoneElementRef.nativeElement.classList.add('active');
        }
        else {
            // eslint-disable-next-line @typescript-eslint/ban-ts-comment
            // @ts-ignore
            event.dataTransfer.dropEffect = 'none';
        }
    }
    dropzoneDragLeaveListener() {
        this.dropzoneElementRef.nativeElement.classList.remove('active');
    }
    selectFiles(files) {
        const filteredFiles = files.filter(file => this.validate(file));
        if (filteredFiles.length === 0) {
            this.emitValidationErrors();
            return;
        }
        this.beforeFilesChange.next();
        if (filteredFiles.length > this.maxFilesCount) {
            this.filesCountError.next(filteredFiles.slice(this.maxFilesCount).map(file => file.name));
            filteredFiles.length = this.maxFilesCount;
        }
        this.emitValidationErrors();
        this.clearFiles({ emitEvent: false });
        for (const file of filteredFiles) {
            this.filesMap.set(file.name, {
                file,
                progress: 0,
                error: false,
                url: this.isImage(file) ? URL.createObjectURL(file) : null,
            });
        }
        this.filesChange.next(this.files);
    }
    validate(file) {
        const errors = {};
        if (this.accept && this.isFileTypeValid(file) === false) {
            errors.accept = { expect: this.accept, current: file.type };
        }
        if (file.size > this.maxFileSize) {
            errors.size = { max: this.maxFileSize, current: file.size };
        }
        const valid = Object.keys(errors).length === 0;
        if (valid === false) {
            this.validationErrors[file.name] = errors;
        }
        return valid;
    }
    emitValidationErrors() {
        if (Object.entries(this.validationErrors).length > 0) {
            this.filesValidationErrors.next(this.validationErrors);
            this.validationErrors = {};
        }
    }
    isImage(file) {
        return /^image\//.test(file.type);
    }
    isFileTypeValid(file) {
        const acceptableTypes = this.accept.split(',').map(type => type.trim());
        for (const type of acceptableTypes) {
            const acceptable = this.isWildcard(type)
                ? this.getTypeClass(file.type) === this.getTypeClass(type)
                : file.type == type || this.getFileExtension(file).toLowerCase() === type.toLowerCase();
            if (acceptable) {
                return true;
            }
        }
        return false;
    }
    getTypeClass(fileType) {
        return fileType.substring(0, fileType.indexOf('/'));
    }
    isWildcard(fileType) {
        return fileType.indexOf('*') !== -1;
    }
}
PrizmFileUploadComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: PrizmFileUploadComponent, deps: [{ token: i0.Renderer2 }, { token: PRIZM_FILE_UPLOAD }, { token: PRIZM_FILEUPLOAD_OPTIONS, optional: true }], target: i0.ɵɵFactoryTarget.Component });
PrizmFileUploadComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: PrizmFileUploadComponent, isStandalone: true, selector: "prizm-file-upload", inputs: { accept: "accept", multiple: "multiple", maxFileSize: "maxFileSize", maxFilesCount: "maxFilesCount", disabled: "disabled", progress: "progress" }, outputs: { beforeFilesChange: "beforeFilesChange", filesChange: "filesChange", filesValidationErrors: "filesValidationErrors", filesCountError: "filesCountError", retry: "retry" }, providers: [PrizmDestroyService, ...prizmI18nInitWithKey(PRIZM_FILE_UPLOAD, 'fileUpload')], viewQueries: [{ propertyName: "dropzoneElementRef", first: true, predicate: ["dropzone"], descendants: true }], usesInheritance: true, ngImport: i0, template: "<ng-container *prizmLet=\"fileUpload$ | async as translations\">\n  <input\n    class=\"hidden\"\n    #inputFile\n    [multiple]=\"multiple\"\n    [accept]=\"accept\"\n    (change)=\"onFileInputChange($event)\"\n    type=\"file\"\n  />\n\n  <div class=\"dropzone\" #dropzone (drop)=\"onDrop($event)\">\n    <div class=\"dropzone__title\">\n      {{ translations | prizmPluck : ['dropzone__title'] }}\n    </div>\n    <div class=\"dropzone__description\">\n      {{ translations | prizmPluck : ['dropzone__description'] }}\n    </div>\n    <div class=\"dropzone__user-content\">\n      <ng-content></ng-content>\n    </div>\n\n    <button\n      class=\"dropzone__file-select\"\n      [disabled]=\"disabled\"\n      (click)=\"inputFile.click()\"\n      type=\"button\"\n      prizmButton\n      appearanceType=\"outline\"\n      appearance=\"secondary\"\n      size=\"m\"\n    >\n      {{ translations | prizmPluck : ['btn__select'] }}\n    </button>\n  </div>\n\n  <div class=\"files\" *ngIf=\"filesMap.size > 0\">\n    <div class=\"file files__item\" *ngFor=\"let item of filesMap | keyvalue; trackBy: filesTrackBy\">\n      <div class=\"file__preview\">\n        <img\n          class=\"file__image\"\n          *ngIf=\"item.value.url; else iconTpl\"\n          [src]=\"item.value.url | prizmSanitizer : 'bypassSecurityTrustResourceUrl'\"\n        />\n\n        <ng-template #iconTpl>\n          <prizm-icon class=\"file__icon\" [size]=\"16\" iconClass=\"files-file\"></prizm-icon>\n        </ng-template>\n      </div>\n\n      <div class=\"file__info\">\n        <span class=\"file__name\">{{ item.key }}</span>\n        <span class=\"file__size\">{{ item.value.file.size | prizmFileSize }}</span>\n      </div>\n\n      <div class=\"file__stage\">\n        {{  options.statusNames?.[item.value.progress | prizmUploadStatus : item.value.error] ?? (translations | prizmPluck : [item.value.progress | prizmUploadStatus : item.value.error]) }}\n      </div>\n\n      <button\n        class=\"file__retry-btn\"\n        *ngIf=\"item.value.error && options.showRetryButtons\"\n        [disabled]=\"disabled\"\n        [icon]=\"'arrows-refresh'\"\n        (click)=\"retryUpload(item.key)\"\n        prizmIconButton\n        appearanceType=\"ghost\"\n        appearance=\"secondary\"\n        size=\"s\"\n      ></button>\n\n      <button\n        class=\"file__delete-btn\"\n        [disabled]=\"disabled\"\n        [icon]=\"'delete'\"\n        (click)=\"removeFile(item.key)\"\n        prizmIconButton\n        appearanceType=\"ghost\"\n        appearance=\"secondary\"\n        size=\"s\"\n      ></button>\n\n      <div class=\"file__progress progress\">\n        <progress\n          class=\"progress__bar {{ item.value.progress | prizmUploadStatus : item.value.error }}\"\n          [value]=\"item.value.progress\"\n          prizmProgressBar\n          max=\"100\"\n          size=\"s\"\n        ></progress>\n        <span class=\"progress__value\">{{ item.value.progress }}%</span>\n      </div>\n    </div>\n  </div>\n</ng-container>\n", styles: [":host{display:block}.hidden{display:none}.dropzone{padding:32px;border:1px dashed var(--prizm-v3-form-stroke-default);border-radius:2px;background-color:var(--prizm-v3-form-fill-default);display:flex;flex-direction:column;align-items:center}.dropzone.active{background-color:var(--prizm-v3-table-fill-row-hover);border:1px dashed var(--prizm-v3-form-stroke-hover)}.dropzone__title{font-weight:600;font-size:16px;line-height:20px;margin-bottom:8px;color:var(--prizm-v3-text-icon-primary)}.dropzone__description{font-weight:400;font-size:14px;line-height:20px;color:var(--prizm-v3-text-icon-secondary)}.dropzone__user-content{font-weight:400;font-size:12px;line-height:16px;margin-top:8px;color:var(--prizm-v3-text-icon-tertiary)}.dropzone__user-content:empty{display:none}.dropzone__file-select,.files{margin-top:16px}.file{display:grid;grid-template-columns:44px 8px fit-content(60%) auto 24px 24px;grid-template-rows:24px 20px;align-items:end;align-items:baseline}.file:not(:last-child){margin-bottom:8px}.file__preview{grid-row-start:1;grid-row-end:3;align-self:stretch;display:flex;align-items:center;justify-content:center;background-color:var(--prizm-v3-form-fill-default);border:1px solid var(--prizm-v3-form-stroke-default);border-radius:2px}.file__icon{color:var(--prizm-v3-text-icon-secondary)}.file__image{object-fit:cover;height:44px;width:44px}.file__info{grid-column-start:3;grid-column-end:4;padding-right:8px;overflow:hidden;text-overflow:ellipsis;display:flex;gap:8px;align-items:baseline}.file__name{font-weight:600;font-size:14px;line-height:20px;color:var(--prizm-v3-text-icon-primary)}.file__size{font-size:10px;line-height:12px;color:var(--prizm-v3-text-icon-tertiary)}.file__stage{font-size:10px;line-height:12px;color:var(--prizm-v3-text-icon-tertiary);grid-column-start:4;grid-column-end:5}.file__retry-btn{justify-self:start;grid-column-start:5}.file__delete-btn{grid-column-start:6}.file__progress{grid-column-start:3;grid-column-end:-1;align-self:end}.progress{display:flex;align-items:center}.progress__bar.progress{color:var(--prizm-v3-status-info-primary-default)}.progress__bar.warning{color:var(--prizm-v3-status-alarm-primary-default)}.progress__bar.success{color:var(--prizm-v3-status-success-primary-default)}.progress__value{margin-left:8px;font-weight:500;font-size:10px;line-height:12px;color:var(--prizm-v3-text-icon-secondary)}\n"], dependencies: [{ kind: "ngmodule", type: CommonModule }, { kind: "directive", type: i1.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "pipe", type: i1.AsyncPipe, name: "async" }, { kind: "pipe", type: i1.KeyValuePipe, name: "keyvalue" }, { kind: "pipe", type: PrizmUploadStatusPipe, name: "prizmUploadStatus" }, { kind: "pipe", type: PrizmFileSizePipe, name: "prizmFileSize" }, { kind: "pipe", type: PrizmSanitizerPipe, name: "prizmSanitizer" }, { kind: "pipe", type: PrizmPluckPipe, name: "prizmPluck" }, { kind: "directive", type: PrizmLetDirective, selector: "[prizmLet]", inputs: ["prizmLet"], exportAs: ["prizmLet"] }, { kind: "component", type: PrizmProgressBarComponent, selector: "progress[prizmProgressBar]", inputs: ["color", "trackColor", "size"] }, { kind: "component", type: PrizmButtonComponent, selector: "button[prizmButton], button[prizmIconButton], a[prizmButton], a[prizmIconButton]", inputs: ["size", "icon", "iconRight", "appearance", "appearanceType", "disabled", "showLoader"] }, { kind: "component", type: PrizmIconComponent, selector: "prizm-icon", inputs: ["iconClass", "size"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: PrizmFileUploadComponent, decorators: [{
            type: Component,
            args: [{ selector: 'prizm-file-upload', changeDetection: ChangeDetectionStrategy.OnPush, imports: [
                        CommonModule,
                        PrizmUploadStatusPipe,
                        PrizmFileSizePipe,
                        PrizmSanitizerPipe,
                        PrizmPluckPipe,
                        PrizmLetDirective,
                        PrizmProgressBarComponent,
                        PrizmButtonComponent,
                        PrizmIconComponent,
                    ], standalone: true, providers: [PrizmDestroyService, ...prizmI18nInitWithKey(PRIZM_FILE_UPLOAD, 'fileUpload')], template: "<ng-container *prizmLet=\"fileUpload$ | async as translations\">\n  <input\n    class=\"hidden\"\n    #inputFile\n    [multiple]=\"multiple\"\n    [accept]=\"accept\"\n    (change)=\"onFileInputChange($event)\"\n    type=\"file\"\n  />\n\n  <div class=\"dropzone\" #dropzone (drop)=\"onDrop($event)\">\n    <div class=\"dropzone__title\">\n      {{ translations | prizmPluck : ['dropzone__title'] }}\n    </div>\n    <div class=\"dropzone__description\">\n      {{ translations | prizmPluck : ['dropzone__description'] }}\n    </div>\n    <div class=\"dropzone__user-content\">\n      <ng-content></ng-content>\n    </div>\n\n    <button\n      class=\"dropzone__file-select\"\n      [disabled]=\"disabled\"\n      (click)=\"inputFile.click()\"\n      type=\"button\"\n      prizmButton\n      appearanceType=\"outline\"\n      appearance=\"secondary\"\n      size=\"m\"\n    >\n      {{ translations | prizmPluck : ['btn__select'] }}\n    </button>\n  </div>\n\n  <div class=\"files\" *ngIf=\"filesMap.size > 0\">\n    <div class=\"file files__item\" *ngFor=\"let item of filesMap | keyvalue; trackBy: filesTrackBy\">\n      <div class=\"file__preview\">\n        <img\n          class=\"file__image\"\n          *ngIf=\"item.value.url; else iconTpl\"\n          [src]=\"item.value.url | prizmSanitizer : 'bypassSecurityTrustResourceUrl'\"\n        />\n\n        <ng-template #iconTpl>\n          <prizm-icon class=\"file__icon\" [size]=\"16\" iconClass=\"files-file\"></prizm-icon>\n        </ng-template>\n      </div>\n\n      <div class=\"file__info\">\n        <span class=\"file__name\">{{ item.key }}</span>\n        <span class=\"file__size\">{{ item.value.file.size | prizmFileSize }}</span>\n      </div>\n\n      <div class=\"file__stage\">\n        {{  options.statusNames?.[item.value.progress | prizmUploadStatus : item.value.error] ?? (translations | prizmPluck : [item.value.progress | prizmUploadStatus : item.value.error]) }}\n      </div>\n\n      <button\n        class=\"file__retry-btn\"\n        *ngIf=\"item.value.error && options.showRetryButtons\"\n        [disabled]=\"disabled\"\n        [icon]=\"'arrows-refresh'\"\n        (click)=\"retryUpload(item.key)\"\n        prizmIconButton\n        appearanceType=\"ghost\"\n        appearance=\"secondary\"\n        size=\"s\"\n      ></button>\n\n      <button\n        class=\"file__delete-btn\"\n        [disabled]=\"disabled\"\n        [icon]=\"'delete'\"\n        (click)=\"removeFile(item.key)\"\n        prizmIconButton\n        appearanceType=\"ghost\"\n        appearance=\"secondary\"\n        size=\"s\"\n      ></button>\n\n      <div class=\"file__progress progress\">\n        <progress\n          class=\"progress__bar {{ item.value.progress | prizmUploadStatus : item.value.error }}\"\n          [value]=\"item.value.progress\"\n          prizmProgressBar\n          max=\"100\"\n          size=\"s\"\n        ></progress>\n        <span class=\"progress__value\">{{ item.value.progress }}%</span>\n      </div>\n    </div>\n  </div>\n</ng-container>\n", styles: [":host{display:block}.hidden{display:none}.dropzone{padding:32px;border:1px dashed var(--prizm-v3-form-stroke-default);border-radius:2px;background-color:var(--prizm-v3-form-fill-default);display:flex;flex-direction:column;align-items:center}.dropzone.active{background-color:var(--prizm-v3-table-fill-row-hover);border:1px dashed var(--prizm-v3-form-stroke-hover)}.dropzone__title{font-weight:600;font-size:16px;line-height:20px;margin-bottom:8px;color:var(--prizm-v3-text-icon-primary)}.dropzone__description{font-weight:400;font-size:14px;line-height:20px;color:var(--prizm-v3-text-icon-secondary)}.dropzone__user-content{font-weight:400;font-size:12px;line-height:16px;margin-top:8px;color:var(--prizm-v3-text-icon-tertiary)}.dropzone__user-content:empty{display:none}.dropzone__file-select,.files{margin-top:16px}.file{display:grid;grid-template-columns:44px 8px fit-content(60%) auto 24px 24px;grid-template-rows:24px 20px;align-items:end;align-items:baseline}.file:not(:last-child){margin-bottom:8px}.file__preview{grid-row-start:1;grid-row-end:3;align-self:stretch;display:flex;align-items:center;justify-content:center;background-color:var(--prizm-v3-form-fill-default);border:1px solid var(--prizm-v3-form-stroke-default);border-radius:2px}.file__icon{color:var(--prizm-v3-text-icon-secondary)}.file__image{object-fit:cover;height:44px;width:44px}.file__info{grid-column-start:3;grid-column-end:4;padding-right:8px;overflow:hidden;text-overflow:ellipsis;display:flex;gap:8px;align-items:baseline}.file__name{font-weight:600;font-size:14px;line-height:20px;color:var(--prizm-v3-text-icon-primary)}.file__size{font-size:10px;line-height:12px;color:var(--prizm-v3-text-icon-tertiary)}.file__stage{font-size:10px;line-height:12px;color:var(--prizm-v3-text-icon-tertiary);grid-column-start:4;grid-column-end:5}.file__retry-btn{justify-self:start;grid-column-start:5}.file__delete-btn{grid-column-start:6}.file__progress{grid-column-start:3;grid-column-end:-1;align-self:end}.progress{display:flex;align-items:center}.progress__bar.progress{color:var(--prizm-v3-status-info-primary-default)}.progress__bar.warning{color:var(--prizm-v3-status-alarm-primary-default)}.progress__bar.success{color:var(--prizm-v3-status-success-primary-default)}.progress__value{margin-left:8px;font-weight:500;font-size:10px;line-height:12px;color:var(--prizm-v3-text-icon-secondary)}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.Renderer2 }, { type: i2.Observable, decorators: [{
                    type: Inject,
                    args: [PRIZM_FILE_UPLOAD]
                }] }, { type: undefined, decorators: [{
                    type: Optional
                }, {
                    type: Inject,
                    args: [PRIZM_FILEUPLOAD_OPTIONS]
                }] }]; }, propDecorators: { dropzoneElementRef: [{
                type: ViewChild,
                args: ['dropzone']
            }], accept: [{
                type: Input
            }], multiple: [{
                type: Input
            }], maxFileSize: [{
                type: Input
            }], maxFilesCount: [{
                type: Input
            }], disabled: [{
                type: Input
            }], progress: [{
                type: Input
            }], beforeFilesChange: [{
                type: Output
            }], filesChange: [{
                type: Output
            }], filesValidationErrors: [{
                type: Output
            }], filesCountError: [{
                type: Output
            }], retry: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS11cGxvYWQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9jb21wb25lbnRzL3NyYy9saWIvY29tcG9uZW50cy9maWxlLXVwbG9hZC9maWxlLXVwbG9hZC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL2NvbXBvbmVudHMvc3JjL2xpYi9jb21wb25lbnRzL2ZpbGUtdXBsb2FkL2ZpbGUtdXBsb2FkLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBQ1osTUFBTSxFQUNOLEtBQUssRUFFTCxRQUFRLEVBQ1IsTUFBTSxFQUNOLFNBQVMsRUFDVCxTQUFTLEdBQ1YsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUNMLG1CQUFtQixFQUNuQixpQkFBaUIsRUFDakIsY0FBYyxFQUNkLGtCQUFrQixHQUNuQixNQUFNLG1CQUFtQixDQUFDO0FBTzNCLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSw2QkFBNkIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ2hHLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUNqRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRWxDLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JELE9BQU8sRUFBZ0IscUJBQXFCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUM1RSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ2pELE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFN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OzRDQVJ2QixrQkFBa0I7c0JBQXhDLFNBQVM7dUJBQUMsVUFBVTtnQkFrQlosTUFBTTtzQkFBZCxLQUFLO2dCQUNHLFFBQVE7c0JBQWhCLEtBQUs7Z0JBQ0csV0FBVztzQkFBbkIsS0FBSztnQkFDRyxhQUFhO3NCQUFyQixLQUFLO2dCQUdGLFFBQVE7c0JBRFgsS0FBSztnQkFTTyxRQUFRO3NCQUFwQixLQUFLO2dCQVFJLGlCQUFpQjtzQkFBMUIsTUFBTTtnQkFDRyxXQUFXO3NCQUFwQixNQUFNO2dCQUNHLHFCQUFxQjtzQkFBOUIsTUFBTTtnQkFDRyxlQUFlO3NCQUF4QixNQUFNO2dCQUNHLEtBQUs7c0JBQWQsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFmdGVyVmlld0luaXQsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5qZWN0LFxuICBJbnB1dCxcbiAgT25EZXN0cm95LFxuICBPcHRpb25hbCxcbiAgT3V0cHV0LFxuICBSZW5kZXJlcjIsXG4gIFZpZXdDaGlsZCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7XG4gIFByaXptRGVzdHJveVNlcnZpY2UsXG4gIFByaXptTGV0RGlyZWN0aXZlLFxuICBQcml6bVBsdWNrUGlwZSxcbiAgUHJpem1TYW5pdGl6ZXJQaXBlLFxufSBmcm9tICdAcHJpem0tdWkvaGVscGVycyc7XG5pbXBvcnQge1xuICBQcml6bUZpbGVzTWFwLFxuICBQcml6bUZpbGVzUHJvZ3Jlc3MsXG4gIFByaXptRmlsZVVwbG9hZE9wdGlvbnMsXG4gIFByaXptRmlsZVZhbGlkYXRpb25FcnJvcnMsXG59IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IHsgUFJJWk1fRklMRVVQTE9BRF9PUFRJT05TLCBwcml6bUZpbGVVcGxvYWREZWZhdWx0T3B0aW9ucyB9IGZyb20gJy4vZmlsZS11cGxvYWQtb3B0aW9ucyc7XG5pbXBvcnQgeyBQUklaTV9GSUxFX1VQTE9BRCB9IGZyb20gJy4uLy4uL3Rva2Vucyc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBQcml6bUxhbmd1YWdlRmlsZVVwbG9hZCB9IGZyb20gJ0Bwcml6bS11aS9pMThuJztcbmltcG9ydCB7IHByaXptSTE4bkluaXRXaXRoS2V5IH0gZnJvbSAnLi4vLi4vc2VydmljZXMnO1xuaW1wb3J0IHsgUHJpem1BYnN0cmFjdFRlc3RJZCB9IGZyb20gJ0Bwcml6bS11aS9jb3JlJztcbmltcG9ydCB7IEJvb2xlYW5JbnB1dCwgY29lcmNlQm9vbGVhblByb3BlcnR5IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2NvZXJjaW9uJztcbmltcG9ydCB7IENvbW1vbk1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBQcml6bUJ1dHRvbkNvbXBvbmVudCB9IGZyb20gJy4uL2J1dHRvbic7XG5pbXBvcnQgeyBQcml6bVByb2dyZXNzQmFyQ29tcG9uZW50IH0gZnJvbSAnLi4vcHJvZ3Jlc3MnO1xuaW1wb3J0IHsgUHJpem1JY29uQ29tcG9uZW50IH0gZnJvbSAnLi4vaWNvbic7XG5pbXBvcnQgeyBQcml6bVVwbG9hZFN0YXR1c1BpcGUgfSBmcm9tICcuL3BpcGVzL3VwbG9hZC1zdGF0dXMucGlwZSc7XG5pbXBvcnQgeyBQcml6bUZpbGVTaXplUGlwZSB9IGZyb20gJy4vcGlwZXMvZmlsZS1zaXplLnBpcGUnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwcml6bS1maWxlLXVwbG9hZCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9maWxlLXVwbG9hZC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2ZpbGUtdXBsb2FkLmNvbXBvbmVudC5sZXNzJ10sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBpbXBvcnRzOiBbXG4gICAgQ29tbW9uTW9kdWxlLFxuICAgIFByaXptVXBsb2FkU3RhdHVzUGlwZSxcbiAgICBQcml6bUZpbGVTaXplUGlwZSxcbiAgICBQcml6bVNhbml0aXplclBpcGUsXG4gICAgUHJpem1QbHVja1BpcGUsXG4gICAgUHJpem1MZXREaXJlY3RpdmUsXG4gICAgUHJpem1Qcm9ncmVzc0JhckNvbXBvbmVudCxcbiAgICBQcml6bUJ1dHRvbkNvbXBvbmVudCxcbiAgICBQcml6bUljb25Db21wb25lbnQsXG4gIF0sXG4gIHN0YW5kYWxvbmU6IHRydWUsXG4gIHByb3ZpZGVyczogW1ByaXptRGVzdHJveVNlcnZpY2UsIC4uLnByaXptSTE4bkluaXRXaXRoS2V5KFBSSVpNX0ZJTEVfVVBMT0FELCAnZmlsZVVwbG9hZCcpXSxcbn0pXG5leHBvcnQgY2xhc3MgUHJpem1GaWxlVXBsb2FkQ29tcG9uZW50IGV4dGVuZHMgUHJpem1BYnN0cmFjdFRlc3RJZCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XG4gIEBWaWV3Q2hpbGQoJ2Ryb3B6b25lJykgZHJvcHpvbmVFbGVtZW50UmVmITogRWxlbWVudFJlZjxIVE1MRGl2RWxlbWVudD47XG5cbiAgb3ZlcnJpZGUgcmVhZG9ubHkgdGVzdElkXyA9ICd1aV9maWxlX3VwbG9hZCc7XG5cbiAgb3B0aW9uczogUHJpem1GaWxlVXBsb2FkT3B0aW9ucyA9IHsgLi4ucHJpem1GaWxlVXBsb2FkRGVmYXVsdE9wdGlvbnMgfTtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIEBJbmplY3QoUFJJWk1fRklMRV9VUExPQUQpIHB1YmxpYyByZWFkb25seSBmaWxlVXBsb2FkJDogT2JzZXJ2YWJsZTxQcml6bUxhbmd1YWdlRmlsZVVwbG9hZFsnZmlsZVVwbG9hZCddPixcbiAgICBAT3B0aW9uYWwoKSBASW5qZWN0KFBSSVpNX0ZJTEVVUExPQURfT1BUSU9OUykgY3VzdG9tT3B0aW9uczogUHJpem1GaWxlVXBsb2FkT3B0aW9uc1xuICApIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMub3B0aW9ucyA9IHsgLi4udGhpcy5vcHRpb25zLCAuLi5jdXN0b21PcHRpb25zIH07XG4gIH1cblxuICBwcml2YXRlIGxpc3RlbmVyczogQXJyYXk8KCkgPT4gdm9pZD4gPSBbXTtcblxuICBwcml2YXRlIHZhbGlkYXRpb25FcnJvcnM6IHsgW2ZpbGVuYW1lOiBzdHJpbmddOiBQcml6bUZpbGVWYWxpZGF0aW9uRXJyb3JzIH0gPSB7fTtcblxuICBASW5wdXQoKSBhY2NlcHQgPSAnJztcbiAgQElucHV0KCkgbXVsdGlwbGUgPSBmYWxzZTtcbiAgQElucHV0KCkgbWF4RmlsZVNpemUgPSBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUjtcbiAgQElucHV0KCkgbWF4RmlsZXNDb3VudCA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSO1xuXG4gIEBJbnB1dCgpXG4gIGdldCBkaXNhYmxlZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fZGlzYWJsZWQ7XG4gIH1cbiAgc2V0IGRpc2FibGVkKHZhbHVlOiBCb29sZWFuSW5wdXQpIHtcbiAgICB0aGlzLl9kaXNhYmxlZCA9IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eSh2YWx1ZSk7XG4gIH1cbiAgcHJpdmF0ZSBfZGlzYWJsZWQgPSBmYWxzZTtcblxuICBASW5wdXQoKSBzZXQgcHJvZ3Jlc3MocHJvZ3Jlc3M6IFByaXptRmlsZXNQcm9ncmVzcykge1xuICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKHByb2dyZXNzKSkge1xuICAgICAgaWYgKHRoaXMuZmlsZXNNYXAuaGFzKGtleSkpIHtcbiAgICAgICAgdGhpcy5maWxlc01hcC5zZXQoa2V5LCB7IC4uLnRoaXMuZmlsZXNNYXAuZ2V0KGtleSksIC4uLnByb2dyZXNzW2tleV0gfSBhcyBhbnkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIEBPdXRwdXQoKSBiZWZvcmVGaWxlc0NoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcbiAgQE91dHB1dCgpIGZpbGVzQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxBcnJheTxGaWxlPj4oKTtcbiAgQE91dHB1dCgpIGZpbGVzVmFsaWRhdGlvbkVycm9ycyA9IG5ldyBFdmVudEVtaXR0ZXI8eyBbZmlsZW5hbWU6IHN0cmluZ106IFByaXptRmlsZVZhbGlkYXRpb25FcnJvcnMgfT4oKTtcbiAgQE91dHB1dCgpIGZpbGVzQ291bnRFcnJvciA9IG5ldyBFdmVudEVtaXR0ZXI8QXJyYXk8c3RyaW5nPj4oKTtcbiAgQE91dHB1dCgpIHJldHJ5ID0gbmV3IEV2ZW50RW1pdHRlcjxGaWxlPigpO1xuXG4gIHB1YmxpYyBmaWxlc01hcDogUHJpem1GaWxlc01hcCA9IG5ldyBNYXAoKTtcblxuICBnZXQgZmlsZXMoKTogQXJyYXk8RmlsZT4ge1xuICAgIHJldHVybiBbLi4udGhpcy5maWxlc01hcC5lbnRyaWVzKCldLm1hcCgoW18sIHsgZmlsZSB9XSkgPT4gZmlsZSk7XG4gIH1cblxuICBwdWJsaWMgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgIHRoaXMubGlzdGVuZXJzLnB1c2goXG4gICAgICB0aGlzLnJlbmRlcmVyLmxpc3RlbihcbiAgICAgICAgdGhpcy5kcm9wem9uZUVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCxcbiAgICAgICAgJ2RyYWdvdmVyJyxcbiAgICAgICAgdGhpcy5kcm9wem9uZURyYWdPdmVyTGlzdGVuZXIuYmluZCh0aGlzKVxuICAgICAgKVxuICAgICk7XG5cbiAgICB0aGlzLmxpc3RlbmVycy5wdXNoKFxuICAgICAgdGhpcy5yZW5kZXJlci5saXN0ZW4oXG4gICAgICAgIHRoaXMuZHJvcHpvbmVFbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsXG4gICAgICAgICdkcmFnbGVhdmUnLFxuICAgICAgICB0aGlzLmRyb3B6b25lRHJhZ0xlYXZlTGlzdGVuZXIuYmluZCh0aGlzKVxuICAgICAgKVxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgZm9yIChjb25zdCBsaXN0ZW5lciBvZiB0aGlzLmxpc3RlbmVycykge1xuICAgICAgbGlzdGVuZXIoKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgb25Ecm9wKGV2ZW50OiBEcmFnRXZlbnQpOiB2b2lkIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgaWYgKHRoaXMuZGlzYWJsZWQgPT09IGZhbHNlKSB7XG4gICAgICBjb25zdCB7IGZpbGVzIH0gPSBldmVudC5kYXRhVHJhbnNmZXIgYXMgYW55O1xuICAgICAgdGhpcy5zZWxlY3RGaWxlcyhBcnJheS5mcm9tKGZpbGVzKSk7XG4gICAgfVxuXG4gICAgdGhpcy5kcm9wem9uZUVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgfVxuXG4gIHB1YmxpYyBvbkZpbGVJbnB1dENoYW5nZShldmVudDogRXZlbnQpOiB2b2lkIHtcbiAgICBjb25zdCBpbnB1dEZpbGUgPSBldmVudC50YXJnZXQgYXMgSFRNTElucHV0RWxlbWVudCBhcyBhbnk7XG5cbiAgICBpZiAoaW5wdXRGaWxlLmZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuc2VsZWN0RmlsZXMoQXJyYXkuZnJvbShpbnB1dEZpbGUuZmlsZXMpKTtcbiAgICAgIGlucHV0RmlsZS52YWx1ZSA9ICcnO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXRGaWxlRXh0ZW5zaW9uKGZpbGU6IEZpbGUpOiBzdHJpbmcge1xuICAgIHJldHVybiAnLicgKyBmaWxlLm5hbWUuc3BsaXQoJy4nKS5wb3AoKTtcbiAgfVxuXG4gIHB1YmxpYyByZW1vdmVGaWxlKGZpbGVuYW1lOiBzdHJpbmcsIG9wdGlvbnM6IHsgZW1pdEV2ZW50OiBib29sZWFuIH0gPSB7IGVtaXRFdmVudDogdHJ1ZSB9KTogdm9pZCB7XG4gICAgaWYgKG9wdGlvbnMuZW1pdEV2ZW50KSB7XG4gICAgICB0aGlzLmJlZm9yZUZpbGVzQ2hhbmdlLm5leHQoKTtcbiAgICB9XG4gICAgY29uc3QgZmlsZURhdGEgPSB0aGlzLmZpbGVzTWFwLmdldChmaWxlbmFtZSkgYXMgYW55O1xuICAgIGlmIChmaWxlRGF0YS51cmwpIHtcbiAgICAgIFVSTC5yZXZva2VPYmplY3RVUkwoZmlsZURhdGEudXJsKTtcbiAgICB9XG4gICAgdGhpcy5maWxlc01hcC5kZWxldGUoZmlsZW5hbWUpO1xuXG4gICAgaWYgKG9wdGlvbnMuZW1pdEV2ZW50KSB7XG4gICAgICB0aGlzLmZpbGVzQ2hhbmdlLm5leHQodGhpcy5maWxlcyk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGNsZWFyRmlsZXMob3B0aW9uczogeyBlbWl0RXZlbnQ6IGJvb2xlYW4gfSA9IHsgZW1pdEV2ZW50OiB0cnVlIH0pOiB2b2lkIHtcbiAgICBpZiAob3B0aW9ucy5lbWl0RXZlbnQpIHtcbiAgICAgIHRoaXMuYmVmb3JlRmlsZXNDaGFuZ2UubmV4dCgpO1xuICAgIH1cblxuICAgIGZvciAoY29uc3QgZmlsZSBvZiB0aGlzLmZpbGVzTWFwLmtleXMoKSkge1xuICAgICAgdGhpcy5yZW1vdmVGaWxlKGZpbGUpO1xuICAgIH1cblxuICAgIGlmIChvcHRpb25zLmVtaXRFdmVudCkge1xuICAgICAgdGhpcy5maWxlc0NoYW5nZS5uZXh0KFtdKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZmlsZXNUcmFja0J5KGluZGV4OiBudW1iZXIsIGZpbGU6IHsga2V5OiBzdHJpbmc7IHZhbHVlOiBhbnkgfSk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGZpbGUua2V5O1xuICB9XG5cbiAgcHVibGljIHJldHJ5VXBsb2FkKGZpbGVuYW1lOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHRoaXMucmV0cnkuZW1pdCh0aGlzLmZpbGVzTWFwLmdldChmaWxlbmFtZSkuZmlsZSkgYXMgYW55O1xuICB9XG5cbiAgcHJpdmF0ZSBkcm9wem9uZURyYWdPdmVyTGlzdGVuZXIoZXZlbnQ6IERyYWdFdmVudCk6IHZvaWQge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgaWYgKHRoaXMuZGlzYWJsZWQgPT09IGZhbHNlKSB7XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICBldmVudC5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdCA9ICdjb3B5JztcbiAgICAgIHRoaXMuZHJvcHpvbmVFbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXRzLWNvbW1lbnRcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIGV2ZW50LmRhdGFUcmFuc2Zlci5kcm9wRWZmZWN0ID0gJ25vbmUnO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZHJvcHpvbmVEcmFnTGVhdmVMaXN0ZW5lcigpOiB2b2lkIHtcbiAgICB0aGlzLmRyb3B6b25lRWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZWxlY3RGaWxlcyhmaWxlczogRmlsZVtdKTogdm9pZCB7XG4gICAgY29uc3QgZmlsdGVyZWRGaWxlcyA9IGZpbGVzLmZpbHRlcihmaWxlID0+IHRoaXMudmFsaWRhdGUoZmlsZSkpO1xuXG4gICAgaWYgKGZpbHRlcmVkRmlsZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aGlzLmVtaXRWYWxpZGF0aW9uRXJyb3JzKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5iZWZvcmVGaWxlc0NoYW5nZS5uZXh0KCk7XG5cbiAgICBpZiAoZmlsdGVyZWRGaWxlcy5sZW5ndGggPiB0aGlzLm1heEZpbGVzQ291bnQpIHtcbiAgICAgIHRoaXMuZmlsZXNDb3VudEVycm9yLm5leHQoZmlsdGVyZWRGaWxlcy5zbGljZSh0aGlzLm1heEZpbGVzQ291bnQpLm1hcChmaWxlID0+IGZpbGUubmFtZSkpO1xuICAgICAgZmlsdGVyZWRGaWxlcy5sZW5ndGggPSB0aGlzLm1heEZpbGVzQ291bnQ7XG4gICAgfVxuXG4gICAgdGhpcy5lbWl0VmFsaWRhdGlvbkVycm9ycygpO1xuXG4gICAgdGhpcy5jbGVhckZpbGVzKHsgZW1pdEV2ZW50OiBmYWxzZSB9KTtcblxuICAgIGZvciAoY29uc3QgZmlsZSBvZiBmaWx0ZXJlZEZpbGVzKSB7XG4gICAgICB0aGlzLmZpbGVzTWFwLnNldChmaWxlLm5hbWUsIHtcbiAgICAgICAgZmlsZSxcbiAgICAgICAgcHJvZ3Jlc3M6IDAsXG4gICAgICAgIGVycm9yOiBmYWxzZSxcbiAgICAgICAgdXJsOiB0aGlzLmlzSW1hZ2UoZmlsZSkgPyBVUkwuY3JlYXRlT2JqZWN0VVJMKGZpbGUpIDogKG51bGwgYXMgYW55KSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHRoaXMuZmlsZXNDaGFuZ2UubmV4dCh0aGlzLmZpbGVzKTtcbiAgfVxuXG4gIHByaXZhdGUgdmFsaWRhdGUoZmlsZTogRmlsZSk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGVycm9yczogUHJpem1GaWxlVmFsaWRhdGlvbkVycm9ycyA9IHt9O1xuXG4gICAgaWYgKHRoaXMuYWNjZXB0ICYmIHRoaXMuaXNGaWxlVHlwZVZhbGlkKGZpbGUpID09PSBmYWxzZSkge1xuICAgICAgZXJyb3JzLmFjY2VwdCA9IHsgZXhwZWN0OiB0aGlzLmFjY2VwdCwgY3VycmVudDogZmlsZS50eXBlIH07XG4gICAgfVxuXG4gICAgaWYgKGZpbGUuc2l6ZSA+IHRoaXMubWF4RmlsZVNpemUpIHtcbiAgICAgIGVycm9ycy5zaXplID0geyBtYXg6IHRoaXMubWF4RmlsZVNpemUsIGN1cnJlbnQ6IGZpbGUuc2l6ZSB9O1xuICAgIH1cblxuICAgIGNvbnN0IHZhbGlkID0gT2JqZWN0LmtleXMoZXJyb3JzKS5sZW5ndGggPT09IDA7XG5cbiAgICBpZiAodmFsaWQgPT09IGZhbHNlKSB7XG4gICAgICB0aGlzLnZhbGlkYXRpb25FcnJvcnNbZmlsZS5uYW1lXSA9IGVycm9ycztcbiAgICB9XG5cbiAgICByZXR1cm4gdmFsaWQ7XG4gIH1cblxuICBwcml2YXRlIGVtaXRWYWxpZGF0aW9uRXJyb3JzKCk6IHZvaWQge1xuICAgIGlmIChPYmplY3QuZW50cmllcyh0aGlzLnZhbGlkYXRpb25FcnJvcnMpLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuZmlsZXNWYWxpZGF0aW9uRXJyb3JzLm5leHQodGhpcy52YWxpZGF0aW9uRXJyb3JzKTtcbiAgICAgIHRoaXMudmFsaWRhdGlvbkVycm9ycyA9IHt9O1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaXNJbWFnZShmaWxlOiBGaWxlKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIC9eaW1hZ2VcXC8vLnRlc3QoZmlsZS50eXBlKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNGaWxlVHlwZVZhbGlkKGZpbGU6IEZpbGUpOiBib29sZWFuIHtcbiAgICBjb25zdCBhY2NlcHRhYmxlVHlwZXMgPSB0aGlzLmFjY2VwdC5zcGxpdCgnLCcpLm1hcCh0eXBlID0+IHR5cGUudHJpbSgpKTtcbiAgICBmb3IgKGNvbnN0IHR5cGUgb2YgYWNjZXB0YWJsZVR5cGVzKSB7XG4gICAgICBjb25zdCBhY2NlcHRhYmxlID0gdGhpcy5pc1dpbGRjYXJkKHR5cGUpXG4gICAgICAgID8gdGhpcy5nZXRUeXBlQ2xhc3MoZmlsZS50eXBlKSA9PT0gdGhpcy5nZXRUeXBlQ2xhc3ModHlwZSlcbiAgICAgICAgOiBmaWxlLnR5cGUgPT0gdHlwZSB8fCB0aGlzLmdldEZpbGVFeHRlbnNpb24oZmlsZSkudG9Mb3dlckNhc2UoKSA9PT0gdHlwZS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICBpZiAoYWNjZXB0YWJsZSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBwcml2YXRlIGdldFR5cGVDbGFzcyhmaWxlVHlwZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gZmlsZVR5cGUuc3Vic3RyaW5nKDAsIGZpbGVUeXBlLmluZGV4T2YoJy8nKSk7XG4gIH1cblxuICBwcml2YXRlIGlzV2lsZGNhcmQoZmlsZVR5cGU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBmaWxlVHlwZS5pbmRleE9mKCcqJykgIT09IC0xO1xuICB9XG59XG4iLCI8bmctY29udGFpbmVyICpwcml6bUxldD1cImZpbGVVcGxvYWQkIHwgYXN5bmMgYXMgdHJhbnNsYXRpb25zXCI+XG4gIDxpbnB1dFxuICAgIGNsYXNzPVwiaGlkZGVuXCJcbiAgICAjaW5wdXRGaWxlXG4gICAgW211bHRpcGxlXT1cIm11bHRpcGxlXCJcbiAgICBbYWNjZXB0XT1cImFjY2VwdFwiXG4gICAgKGNoYW5nZSk9XCJvbkZpbGVJbnB1dENoYW5nZSgkZXZlbnQpXCJcbiAgICB0eXBlPVwiZmlsZVwiXG4gIC8+XG5cbiAgPGRpdiBjbGFzcz1cImRyb3B6b25lXCIgI2Ryb3B6b25lIChkcm9wKT1cIm9uRHJvcCgkZXZlbnQpXCI+XG4gICAgPGRpdiBjbGFzcz1cImRyb3B6b25lX190aXRsZVwiPlxuICAgICAge3sgdHJhbnNsYXRpb25zIHwgcHJpem1QbHVjayA6IFsnZHJvcHpvbmVfX3RpdGxlJ10gfX1cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwiZHJvcHpvbmVfX2Rlc2NyaXB0aW9uXCI+XG4gICAgICB7eyB0cmFuc2xhdGlvbnMgfCBwcml6bVBsdWNrIDogWydkcm9wem9uZV9fZGVzY3JpcHRpb24nXSB9fVxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJkcm9wem9uZV9fdXNlci1jb250ZW50XCI+XG4gICAgICA8bmctY29udGVudD48L25nLWNvbnRlbnQ+XG4gICAgPC9kaXY+XG5cbiAgICA8YnV0dG9uXG4gICAgICBjbGFzcz1cImRyb3B6b25lX19maWxlLXNlbGVjdFwiXG4gICAgICBbZGlzYWJsZWRdPVwiZGlzYWJsZWRcIlxuICAgICAgKGNsaWNrKT1cImlucHV0RmlsZS5jbGljaygpXCJcbiAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgcHJpem1CdXR0b25cbiAgICAgIGFwcGVhcmFuY2VUeXBlPVwib3V0bGluZVwiXG4gICAgICBhcHBlYXJhbmNlPVwic2Vjb25kYXJ5XCJcbiAgICAgIHNpemU9XCJtXCJcbiAgICA+XG4gICAgICB7eyB0cmFuc2xhdGlvbnMgfCBwcml6bVBsdWNrIDogWydidG5fX3NlbGVjdCddIH19XG4gICAgPC9idXR0b24+XG4gIDwvZGl2PlxuXG4gIDxkaXYgY2xhc3M9XCJmaWxlc1wiICpuZ0lmPVwiZmlsZXNNYXAuc2l6ZSA+IDBcIj5cbiAgICA8ZGl2IGNsYXNzPVwiZmlsZSBmaWxlc19faXRlbVwiICpuZ0Zvcj1cImxldCBpdGVtIG9mIGZpbGVzTWFwIHwga2V5dmFsdWU7IHRyYWNrQnk6IGZpbGVzVHJhY2tCeVwiPlxuICAgICAgPGRpdiBjbGFzcz1cImZpbGVfX3ByZXZpZXdcIj5cbiAgICAgICAgPGltZ1xuICAgICAgICAgIGNsYXNzPVwiZmlsZV9faW1hZ2VcIlxuICAgICAgICAgICpuZ0lmPVwiaXRlbS52YWx1ZS51cmw7IGVsc2UgaWNvblRwbFwiXG4gICAgICAgICAgW3NyY109XCJpdGVtLnZhbHVlLnVybCB8IHByaXptU2FuaXRpemVyIDogJ2J5cGFzc1NlY3VyaXR5VHJ1c3RSZXNvdXJjZVVybCdcIlxuICAgICAgICAvPlxuXG4gICAgICAgIDxuZy10ZW1wbGF0ZSAjaWNvblRwbD5cbiAgICAgICAgICA8cHJpem0taWNvbiBjbGFzcz1cImZpbGVfX2ljb25cIiBbc2l6ZV09XCIxNlwiIGljb25DbGFzcz1cImZpbGVzLWZpbGVcIj48L3ByaXptLWljb24+XG4gICAgICAgIDwvbmctdGVtcGxhdGU+XG4gICAgICA8L2Rpdj5cblxuICAgICAgPGRpdiBjbGFzcz1cImZpbGVfX2luZm9cIj5cbiAgICAgICAgPHNwYW4gY2xhc3M9XCJmaWxlX19uYW1lXCI+e3sgaXRlbS5rZXkgfX08L3NwYW4+XG4gICAgICAgIDxzcGFuIGNsYXNzPVwiZmlsZV9fc2l6ZVwiPnt7IGl0ZW0udmFsdWUuZmlsZS5zaXplIHwgcHJpem1GaWxlU2l6ZSB9fTwvc3Bhbj5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8ZGl2IGNsYXNzPVwiZmlsZV9fc3RhZ2VcIj5cbiAgICAgICAge3sgIG9wdGlvbnMuc3RhdHVzTmFtZXM/LltpdGVtLnZhbHVlLnByb2dyZXNzIHwgcHJpem1VcGxvYWRTdGF0dXMgOiBpdGVtLnZhbHVlLmVycm9yXSA/PyAodHJhbnNsYXRpb25zIHwgcHJpem1QbHVjayA6IFtpdGVtLnZhbHVlLnByb2dyZXNzIHwgcHJpem1VcGxvYWRTdGF0dXMgOiBpdGVtLnZhbHVlLmVycm9yXSkgfX1cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8YnV0dG9uXG4gICAgICAgIGNsYXNzPVwiZmlsZV9fcmV0cnktYnRuXCJcbiAgICAgICAgKm5nSWY9XCJpdGVtLnZhbHVlLmVycm9yICYmIG9wdGlvbnMuc2hvd1JldHJ5QnV0dG9uc1wiXG4gICAgICAgIFtkaXNhYmxlZF09XCJkaXNhYmxlZFwiXG4gICAgICAgIFtpY29uXT1cIidhcnJvd3MtcmVmcmVzaCdcIlxuICAgICAgICAoY2xpY2spPVwicmV0cnlVcGxvYWQoaXRlbS5rZXkpXCJcbiAgICAgICAgcHJpem1JY29uQnV0dG9uXG4gICAgICAgIGFwcGVhcmFuY2VUeXBlPVwiZ2hvc3RcIlxuICAgICAgICBhcHBlYXJhbmNlPVwic2Vjb25kYXJ5XCJcbiAgICAgICAgc2l6ZT1cInNcIlxuICAgICAgPjwvYnV0dG9uPlxuXG4gICAgICA8YnV0dG9uXG4gICAgICAgIGNsYXNzPVwiZmlsZV9fZGVsZXRlLWJ0blwiXG4gICAgICAgIFtkaXNhYmxlZF09XCJkaXNhYmxlZFwiXG4gICAgICAgIFtpY29uXT1cIidkZWxldGUnXCJcbiAgICAgICAgKGNsaWNrKT1cInJlbW92ZUZpbGUoaXRlbS5rZXkpXCJcbiAgICAgICAgcHJpem1JY29uQnV0dG9uXG4gICAgICAgIGFwcGVhcmFuY2VUeXBlPVwiZ2hvc3RcIlxuICAgICAgICBhcHBlYXJhbmNlPVwic2Vjb25kYXJ5XCJcbiAgICAgICAgc2l6ZT1cInNcIlxuICAgICAgPjwvYnV0dG9uPlxuXG4gICAgICA8ZGl2IGNsYXNzPVwiZmlsZV9fcHJvZ3Jlc3MgcHJvZ3Jlc3NcIj5cbiAgICAgICAgPHByb2dyZXNzXG4gICAgICAgICAgY2xhc3M9XCJwcm9ncmVzc19fYmFyIHt7IGl0ZW0udmFsdWUucHJvZ3Jlc3MgfCBwcml6bVVwbG9hZFN0YXR1cyA6IGl0ZW0udmFsdWUuZXJyb3IgfX1cIlxuICAgICAgICAgIFt2YWx1ZV09XCJpdGVtLnZhbHVlLnByb2dyZXNzXCJcbiAgICAgICAgICBwcml6bVByb2dyZXNzQmFyXG4gICAgICAgICAgbWF4PVwiMTAwXCJcbiAgICAgICAgICBzaXplPVwic1wiXG4gICAgICAgID48L3Byb2dyZXNzPlxuICAgICAgICA8c3BhbiBjbGFzcz1cInByb2dyZXNzX192YWx1ZVwiPnt7IGl0ZW0udmFsdWUucHJvZ3Jlc3MgfX0lPC9zcGFuPlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuPC9uZy1jb250YWluZXI+XG4iXX0=