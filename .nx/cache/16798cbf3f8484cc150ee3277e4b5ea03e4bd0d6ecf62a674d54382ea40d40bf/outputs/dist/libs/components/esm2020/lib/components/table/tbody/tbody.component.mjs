import { __decorate, __metadata } from "tslib";
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChild, ContentChildren, EventEmitter, forwardRef, Inject, Input, Output, QueryList, } from '@angular/core';
import { isDataSource } from '@angular/cdk/collections';
import { prizmDefaultProp } from '@prizm-ui/core';
import { PrizmDestroyService, prizmEmptyQueryList } from '@prizm-ui/helpers';
import { BehaviorSubject, isObservable } from 'rxjs';
import { switchMap, takeUntil, tap } from 'rxjs/operators';
import { PrizmTableEmptyDirective } from '../directives/empty.directive';
import { PrizmTableLoadingDirective } from '../directives/loading.directive';
import { PrizmRowDirective } from '../directives/row.directive';
import { PrizmTableDirective } from '../directives/table.directive';
import { PrizmTableTreeLoadingDirective } from '../directives/tree-loading.directive';
import { PRIZM_TABLE_PROVIDER } from '../providers/table.provider';
import { PrizmTableSorterService } from '../service';
import { PrizmTableTreeService } from '../service/tree.service';
import { PrizmTrComponent } from '../tr/tr.component';
import * as i0 from "@angular/core";
import * as i1 from "../service";
import * as i2 from "../service/tree.service";
import * as i3 from "@prizm-ui/helpers";
import * as i4 from "@angular/common";
import * as i5 from "../../../directives/polymorph/directives/outlet";
import * as i6 from "../../icon/icon.component";
import * as i7 from "../directives/row-init.directive";
import * as i8 from "../tr/tr.directive";
import * as i9 from "../directives/table.directive";
export class PrizmTbodyComponent {
    /**
     * The table's source of data, which can be provided in three ways (in order of complexity):
     *   - Simple data array (each object represents one table row)
     *   - Stream that emits a data array each time the array changes
     *   - `DataSource` object that implements the connect/disconnect interface.
     *
     * If the data array reference is changed, the table
     * will automatically trigger an update to the rows.
     * Mutation of an array (push, unshift) will not.
     *
     * When providing an Observable stream, the table will trigger an update automatically when the
     * stream emits a new array of data.
     *
     * Finally, when providing a `DataSource` object, the table will use the Observable stream
     * provided by the DataSource's `connect` function and trigger updates when that stream emits new data array
     * values. During the table's `ngOnDestroy` or when the data source is removed from the table, the
     * table will call the DataSource's `disconnect` function.
     *
     * For a `DataSource`-s we skip internal sorting, so that users can use their own sorting mechanisms
     * i.e. server-side sorting can use different data-base's collation strategies.
     * On the other hand users can connect `sorterService` to `PrizmTableDataSource`:
     *
     * @example
     * ```
     *  \@ViewChild(PrizmTableDirective) table;
     *  \@ViewChild(PrizmPaginatorComponent) paginator;
     *
     *  ngAfterViewInit() {
     *    this.dataSource = new PrizmTableDataSource([]);
     *    this.dataSource.paginator = this.paginator;
     *    this.dataSource.sorter = this.table.sorterService;
     *  }
     * ```
     */
    set data(dataSource) {
        if (this._dataSource !== dataSource) {
            this._switchDataSource(dataSource ?? []);
        }
    }
    get data() {
        return this._dataSource;
    }
    /**
     * Currently displayed set of data.
     */
    get view() {
        return this._data;
    }
    /**
     * Currently displayed set of data.
     *
     * @deprecated
     */
    get sorted() {
        return this._data;
    }
    constructor(table, sorterService, tableTreeService, destroy$, changeDetectorRef) {
        this.table = table;
        this.sorterService = sorterService;
        this.tableTreeService = tableTreeService;
        this.destroy$ = destroy$;
        this.changeDetectorRef = changeDetectorRef;
        this.heading = ``;
        this.open = true;
        this.openChange = new EventEmitter();
        this.rows = prizmEmptyQueryList();
        this.columnsCount = 0;
        /**
         * Stream containing the latest information on what rows are being displayed on screen.
         *
         * @private Not used internally, just needed by `CollectionViewer` interface.
         */
        this.viewChange = new BehaviorSubject({
            start: 0,
            end: Number.MAX_VALUE,
        });
    }
    ngAfterViewInit() {
        this.table.tableService.tableMaxColspan$
            .pipe(takeUntil(this.destroy$))
            .subscribe((columnsCount) => {
            this.columnsCount = columnsCount;
            this.changeDetectorRef.detectChanges();
        });
    }
    ngOnDestroy() {
        if (isDataSource(this.data)) {
            this.data.disconnect(this);
        }
    }
    onClick() {
        this.open = !this.open;
        this.openChange.emit(this.open);
    }
    /**
     * Switch to the provided data source by resetting the data and unsubscribing from the current.
     */
    _switchDataSource(dataSource) {
        this._data = [];
        // Disconnect from previous data source if needed
        if (isDataSource(this.data)) {
            this.data.disconnect(this);
        }
        this._dataSource = dataSource;
        let dataStream;
        if (isDataSource(dataSource)) {
            dataStream = dataSource.connect(this);
        }
        else if (isObservable(dataSource)) {
            dataStream = dataSource.pipe(switchMap(data => this.sorterService.sort$(data)));
        }
        else if (Array.isArray(dataSource)) {
            dataStream = this.sorterService.sort$(dataSource);
        }
        // eslint-disable-next-line @typescript-eslint/ban-ts-comment
        // @ts-ignore
        this.renderData$ = dataStream.pipe(tap(data => {
            this._data = data || [];
        }));
    }
    sortChildren(children$) {
        return children$.pipe(switchMap(children => this.sorterService.sort$(children)));
    }
}
PrizmTbodyComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: PrizmTbodyComponent, deps: [{ token: forwardRef(() => PrizmTableDirective) }, { token: i1.PrizmTableSorterService }, { token: i2.PrizmTableTreeService }, { token: i3.PrizmDestroyService }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
PrizmTbodyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.9", type: PrizmTbodyComponent, selector: "[prizmTbody] ", inputs: { data: "data", heading: "heading", open: "open" }, outputs: { openChange: "openChange" }, providers: PRIZM_TABLE_PROVIDER, queries: [{ propertyName: "loadingTemplate", first: true, predicate: PrizmTableLoadingDirective, descendants: true }, { propertyName: "emptyTemplate", first: true, predicate: PrizmTableEmptyDirective, descendants: true }, { propertyName: "treeLoadingTemplate", first: true, predicate: PrizmTableTreeLoadingDirective, descendants: true }, { propertyName: "row", first: true, predicate: i0.forwardRef(function () { return PrizmRowDirective; }), descendants: true }, { propertyName: "rows", predicate: i0.forwardRef(function () { return PrizmTrComponent; }) }], ngImport: i0, template: "<ng-content></ng-content>\n<tr *ngIf=\"heading\">\n  <th class=\"heading\" [colSpan]=\"columnsCount\">\n    <div class=\"heading__container\">\n      <prizm-icon\n        class=\"heading__icon\"\n        [class.heading__icon_expanded]=\"open\"\n        (click)=\"onClick()\"\n        iconClass=\"arrows-chevron-right\"\n      ></prizm-icon>\n      <span class=\"heading__content\">\n        <ng-container *polymorphOutlet=\"heading as text\">{{ text }}</ng-container>\n      </span>\n    </div>\n  </th>\n</tr>\n\n<ng-container *ngIf=\"open && row\">\n  <ng-container *ngIf=\"renderData$ | async as data; else loadingWrapperTemplate\">\n    <ng-container *ngIf=\"!!data?.length; else emptyWrapperTemplate\">\n      <ng-template\n        *ngFor=\"\n          let item of data;\n          index as index;\n          odd as odd;\n          even as even;\n          first as first;\n          last as last;\n          count as count;\n          trackBy: row.prizmRowTrackBy\n        \"\n        [template]=\"templateRowElement\"\n        [context]=\"\n          $any({\n            item: item,\n            index: index,\n            rowIdx: index,\n            odd: odd,\n            even: even,\n            getRowId: row.prizmRowGetRowId,\n            first: first,\n            last: last,\n            count: count,\n            deepLevel: 0\n          })\n        \"\n        prizmTableRowInit\n      ></ng-template>\n    </ng-container>\n  </ng-container>\n</ng-container>\n\n<ng-template #loadingWrapperTemplate>\n  <ng-container *ngTemplateOutlet=\"loadingTemplate?.template || loadingWrapperTemplate\"></ng-container>\n\n  <ng-template #loadingWrapperTemplate>\n    <tr>\n      <td [colSpan]=\"columnsCount\">Loading...</td>\n    </tr>\n  </ng-template>\n</ng-template>\n\n<ng-template #emptyWrapperTemplate>\n  <ng-container *ngTemplateOutlet=\"emptyTemplate?.template || emptyInnerTemplate\"></ng-container>\n\n  <ng-template #emptyInnerTemplate>\n    <tr class=\"empty-row\">\n      <td [colSpan]=\"columnsCount\">\u2014</td>\n    </tr>\n  </ng-template>\n</ng-template>\n\n<ng-template\n  #templateRowElement\n  let-item=\"item\"\n  let-index=\"index\"\n  let-odd=\"odd\"\n  let-even=\"even\"\n  let-first=\"first\"\n  let-last=\"last\"\n  let-count=\"count\"\n  let-deepLevel=\"deepLevel\"\n  let-parentItem=\"parentItem\"\n  let-parentIdx=\"parentIdx\"\n  let-rowIdx=\"rowIdx\"\n>\n  <ng-container\n    [ngTemplateOutlet]=\"$any(row?.template)\"\n    [ngTemplateOutletContext]=\"{\n      $implicit: item,\n      rowIdx: rowIdx,\n      parentIdx: parentIdx,\n      parentItem: parentItem,\n      index: index,\n      odd: odd,\n      item: item,\n      even: even,\n      deepLevel: deepLevel,\n      first: first,\n      last: last,\n      count: count\n    }\"\n  ></ng-container>\n\n  <ng-container *ngIf=\"tableTreeService.canShowChild(index) | async\">\n    <ng-template #treeLoadingTemplateRef>\n      <ng-container\n        [ngTemplateOutlet]=\"treeLoadingTemplate?.template || defaultTreeLoading\"\n        [ngTemplateOutletContext]=\"{\n          item: item,\n          parentIdx: index,\n          parentItem: item,\n          deepLevel: deepLevel,\n          first: first,\n          last: last,\n          count: count\n        }\"\n      >\n      </ng-container>\n      <ng-template #defaultTreeLoading>\n        <tr>\n          <td>Loading...</td>\n        </tr>\n      </ng-template>\n    </ng-template>\n\n    <ng-container\n      *ngIf=\"\n        row?.prizmRowGetChildren && item\n          | prizmCallFunc : $any(row?.prizmRowGetChildren)\n          | prizmCallFunc : sortChildren\n          | async as children;\n        else treeLoadingTemplateRef\n      \"\n    >\n      <ng-template\n        *ngFor=\"\n          let childItem of $any(children);\n          index as childIndex;\n          odd as childOdd;\n          even as childEven;\n          first as childFirst;\n          last as childLast;\n          count as childCount;\n          trackBy: $any(row?.prizmRowTrackBy)\n        \"\n        [template]=\"templateRowElement\"\n        [context]=\"\n          $any({\n            item: childItem,\n            rowIdx: childIndex,\n            parentIdx: index,\n            getRowId: $any(row?.prizmRowGetRowId),\n            parentItem: item,\n            deepLevel: (deepLevel ?? 0) + 1,\n            first: childFirst,\n            last: childLast,\n            count: childCount + count\n          })\n        \"\n        prizmTableRowInit\n      >\n      </ng-template>\n    </ng-container>\n  </ng-container>\n</ng-template>\n\n<ng-content select=\"[footer]\"></ng-content>\n", styles: [":host{font-size:14px;line-height:16px;color:var(--prizm-v3-text-icon-secondary);font-weight:400}:host .heading{padding:0;border:1px solid var(--prizm-v3-table-stroke-cell-default);border-top:none}:host .heading__container{height:100%;width:100%;display:flex;align-items:center;font-weight:400}:host .heading__icon{height:24px;width:24px;margin:0 4px;display:flex;align-items:center;justify-content:center;color:var(--prizm-v3-button-secondary-solid-default);cursor:pointer;transition:.4s}:host .heading__icon_expanded{transform:rotate(90deg)}:host .heading__content{height:100%;display:flex;align-items:center;justify-content:flex-start;flex:1}.empty-row td{border:1px solid var(--prizm-v3-table-stroke-cell-default);border-top:transparent}:host-context([data-size=\"xs\"]){font-size:12px;line-height:12px}:host-context([data-size=\"xs\"]) .heading,:host-context([data-size=\"xs\"]) .empty-row{height:16px}:host-context([data-size=\"s\"]) .heading,:host-context([data-size=\"s\"]) .empty-row{height:24px}:host-context([data-size=\"m\"]) .heading,:host-context([data-size=\"m\"]) .empty-row{height:32px}:host-context([data-size=\"l\"]) .heading,:host-context([data-size=\"l\"]) .empty-row{height:40px}\n"], dependencies: [{ kind: "directive", type: i4.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i4.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "directive", type: i5.PolymorphOutletDirective, selector: "[polymorphOutlet]", inputs: ["polymorphOutlet", "polymorphOutletContext", "polymorphOutletInjector"] }, { kind: "component", type: i6.PrizmIconComponent, selector: "prizm-icon", inputs: ["iconClass", "size"] }, { kind: "directive", type: i7.PrizmTableRowInitDirective, selector: "ng-template[prizmTableRowInit]", inputs: ["context", "template"] }, { kind: "directive", type: i8.PrizmTrDirective, selector: "tr:not([prizmTr])" }, { kind: "pipe", type: i4.AsyncPipe, name: "async" }, { kind: "pipe", type: i3.PrizmCallFuncPipe, name: "prizmCallFunc" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
__decorate([
    prizmDefaultProp(),
    __metadata("design:type", Object)
], PrizmTbodyComponent.prototype, "heading", void 0);
__decorate([
    prizmDefaultProp(),
    __metadata("design:type", Object)
], PrizmTbodyComponent.prototype, "open", void 0);
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.9", ngImport: i0, type: PrizmTbodyComponent, decorators: [{
            type: Component,
            args: [{ selector: `[prizmTbody] `, changeDetection: ChangeDetectionStrategy.OnPush, providers: PRIZM_TABLE_PROVIDER, template: "<ng-content></ng-content>\n<tr *ngIf=\"heading\">\n  <th class=\"heading\" [colSpan]=\"columnsCount\">\n    <div class=\"heading__container\">\n      <prizm-icon\n        class=\"heading__icon\"\n        [class.heading__icon_expanded]=\"open\"\n        (click)=\"onClick()\"\n        iconClass=\"arrows-chevron-right\"\n      ></prizm-icon>\n      <span class=\"heading__content\">\n        <ng-container *polymorphOutlet=\"heading as text\">{{ text }}</ng-container>\n      </span>\n    </div>\n  </th>\n</tr>\n\n<ng-container *ngIf=\"open && row\">\n  <ng-container *ngIf=\"renderData$ | async as data; else loadingWrapperTemplate\">\n    <ng-container *ngIf=\"!!data?.length; else emptyWrapperTemplate\">\n      <ng-template\n        *ngFor=\"\n          let item of data;\n          index as index;\n          odd as odd;\n          even as even;\n          first as first;\n          last as last;\n          count as count;\n          trackBy: row.prizmRowTrackBy\n        \"\n        [template]=\"templateRowElement\"\n        [context]=\"\n          $any({\n            item: item,\n            index: index,\n            rowIdx: index,\n            odd: odd,\n            even: even,\n            getRowId: row.prizmRowGetRowId,\n            first: first,\n            last: last,\n            count: count,\n            deepLevel: 0\n          })\n        \"\n        prizmTableRowInit\n      ></ng-template>\n    </ng-container>\n  </ng-container>\n</ng-container>\n\n<ng-template #loadingWrapperTemplate>\n  <ng-container *ngTemplateOutlet=\"loadingTemplate?.template || loadingWrapperTemplate\"></ng-container>\n\n  <ng-template #loadingWrapperTemplate>\n    <tr>\n      <td [colSpan]=\"columnsCount\">Loading...</td>\n    </tr>\n  </ng-template>\n</ng-template>\n\n<ng-template #emptyWrapperTemplate>\n  <ng-container *ngTemplateOutlet=\"emptyTemplate?.template || emptyInnerTemplate\"></ng-container>\n\n  <ng-template #emptyInnerTemplate>\n    <tr class=\"empty-row\">\n      <td [colSpan]=\"columnsCount\">\u2014</td>\n    </tr>\n  </ng-template>\n</ng-template>\n\n<ng-template\n  #templateRowElement\n  let-item=\"item\"\n  let-index=\"index\"\n  let-odd=\"odd\"\n  let-even=\"even\"\n  let-first=\"first\"\n  let-last=\"last\"\n  let-count=\"count\"\n  let-deepLevel=\"deepLevel\"\n  let-parentItem=\"parentItem\"\n  let-parentIdx=\"parentIdx\"\n  let-rowIdx=\"rowIdx\"\n>\n  <ng-container\n    [ngTemplateOutlet]=\"$any(row?.template)\"\n    [ngTemplateOutletContext]=\"{\n      $implicit: item,\n      rowIdx: rowIdx,\n      parentIdx: parentIdx,\n      parentItem: parentItem,\n      index: index,\n      odd: odd,\n      item: item,\n      even: even,\n      deepLevel: deepLevel,\n      first: first,\n      last: last,\n      count: count\n    }\"\n  ></ng-container>\n\n  <ng-container *ngIf=\"tableTreeService.canShowChild(index) | async\">\n    <ng-template #treeLoadingTemplateRef>\n      <ng-container\n        [ngTemplateOutlet]=\"treeLoadingTemplate?.template || defaultTreeLoading\"\n        [ngTemplateOutletContext]=\"{\n          item: item,\n          parentIdx: index,\n          parentItem: item,\n          deepLevel: deepLevel,\n          first: first,\n          last: last,\n          count: count\n        }\"\n      >\n      </ng-container>\n      <ng-template #defaultTreeLoading>\n        <tr>\n          <td>Loading...</td>\n        </tr>\n      </ng-template>\n    </ng-template>\n\n    <ng-container\n      *ngIf=\"\n        row?.prizmRowGetChildren && item\n          | prizmCallFunc : $any(row?.prizmRowGetChildren)\n          | prizmCallFunc : sortChildren\n          | async as children;\n        else treeLoadingTemplateRef\n      \"\n    >\n      <ng-template\n        *ngFor=\"\n          let childItem of $any(children);\n          index as childIndex;\n          odd as childOdd;\n          even as childEven;\n          first as childFirst;\n          last as childLast;\n          count as childCount;\n          trackBy: $any(row?.prizmRowTrackBy)\n        \"\n        [template]=\"templateRowElement\"\n        [context]=\"\n          $any({\n            item: childItem,\n            rowIdx: childIndex,\n            parentIdx: index,\n            getRowId: $any(row?.prizmRowGetRowId),\n            parentItem: item,\n            deepLevel: (deepLevel ?? 0) + 1,\n            first: childFirst,\n            last: childLast,\n            count: childCount + count\n          })\n        \"\n        prizmTableRowInit\n      >\n      </ng-template>\n    </ng-container>\n  </ng-container>\n</ng-template>\n\n<ng-content select=\"[footer]\"></ng-content>\n", styles: [":host{font-size:14px;line-height:16px;color:var(--prizm-v3-text-icon-secondary);font-weight:400}:host .heading{padding:0;border:1px solid var(--prizm-v3-table-stroke-cell-default);border-top:none}:host .heading__container{height:100%;width:100%;display:flex;align-items:center;font-weight:400}:host .heading__icon{height:24px;width:24px;margin:0 4px;display:flex;align-items:center;justify-content:center;color:var(--prizm-v3-button-secondary-solid-default);cursor:pointer;transition:.4s}:host .heading__icon_expanded{transform:rotate(90deg)}:host .heading__content{height:100%;display:flex;align-items:center;justify-content:flex-start;flex:1}.empty-row td{border:1px solid var(--prizm-v3-table-stroke-cell-default);border-top:transparent}:host-context([data-size=\"xs\"]){font-size:12px;line-height:12px}:host-context([data-size=\"xs\"]) .heading,:host-context([data-size=\"xs\"]) .empty-row{height:16px}:host-context([data-size=\"s\"]) .heading,:host-context([data-size=\"s\"]) .empty-row{height:24px}:host-context([data-size=\"m\"]) .heading,:host-context([data-size=\"m\"]) .empty-row{height:32px}:host-context([data-size=\"l\"]) .heading,:host-context([data-size=\"l\"]) .empty-row{height:40px}\n"] }]
        }], ctorParameters: function () { return [{ type: i9.PrizmTableDirective, decorators: [{
                    type: Inject,
                    args: [forwardRef(() => PrizmTableDirective)]
                }] }, { type: i1.PrizmTableSorterService }, { type: i2.PrizmTableTreeService }, { type: i3.PrizmDestroyService }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { data: [{
                type: Input
            }], heading: [{
                type: Input
            }], open: [{
                type: Input
            }], openChange: [{
                type: Output
            }], loadingTemplate: [{
                type: ContentChild,
                args: [PrizmTableLoadingDirective]
            }], emptyTemplate: [{
                type: ContentChild,
                args: [PrizmTableEmptyDirective]
            }], treeLoadingTemplate: [{
                type: ContentChild,
                args: [PrizmTableTreeLoadingDirective]
            }], row: [{
                type: ContentChild,
                args: [forwardRef(() => PrizmRowDirective)]
            }], rows: [{
                type: ContentChildren,
                args: [forwardRef(() => PrizmTrComponent)]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGJvZHkuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9jb21wb25lbnRzL3NyYy9saWIvY29tcG9uZW50cy90YWJsZS90Ym9keS90Ym9keS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL2NvbXBvbmVudHMvc3JjL2xpYi9jb21wb25lbnRzL3RhYmxlL3Rib2R5L3Rib2R5LmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBRUwsdUJBQXVCLEVBQ3ZCLGlCQUFpQixFQUNqQixTQUFTLEVBQ1QsWUFBWSxFQUNaLGVBQWUsRUFDZixZQUFZLEVBQ1osVUFBVSxFQUNWLE1BQU0sRUFDTixLQUFLLEVBRUwsTUFBTSxFQUNOLFNBQVMsR0FDVixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQW9CLFlBQVksRUFBYSxNQUFNLDBCQUEwQixDQUFDO0FBRXJGLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQzdFLE9BQU8sRUFBRSxlQUFlLEVBQUUsWUFBWSxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQ2pFLE9BQU8sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNELE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ3pFLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBQzdFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ3BFLE9BQU8sRUFBRSw4QkFBOEIsRUFBRSxNQUFNLHND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QkFBZ0IsRUFBRTs7b0RBQ1k7QUFFL0I7SUFDQyxnQkFBZ0IsRUFBRTs7aURBQ1A7MkZBNUVELG1CQUFtQjtrQkFSL0IsU0FBUzsrQkFFRSxlQUFlLG1CQUdSLHVCQUF1QixDQUFDLE1BQU0sYUFDcEMsb0JBQW9COzswQkE4RzVCLE1BQU07MkJBQUMsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLG1CQUFtQixDQUFDO3dMQXRFM0MsSUFBSTtzQkFEUCxLQUFLO2dCQW1DTixPQUFPO3NCQUZOLEtBQUs7Z0JBTU4sSUFBSTtzQkFGSCxLQUFLO2dCQUtHLFVBQVU7c0JBRGxCLE1BQU07Z0JBSUUsZUFBZTtzQkFEdkIsWUFBWTt1QkFBQywwQkFBMEI7Z0JBSS9CLGFBQWE7c0JBRHJCLFlBQVk7dUJBQUMsd0JBQXdCO2dCQUk3QixtQkFBbUI7c0JBRDNCLFlBQVk7dUJBQUMsOEJBQThCO2dCQUluQyxHQUFHO3NCQURYLFlBQVk7dUJBQUMsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLGlCQUFpQixDQUFDO2dCQUl4QyxJQUFJO3NCQURaLGVBQWU7dUJBQUMsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLGdCQUFnQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIENvbnRlbnRDaGlsZCxcbiAgQ29udGVudENoaWxkcmVuLFxuICBFdmVudEVtaXR0ZXIsXG4gIGZvcndhcmRSZWYsXG4gIEluamVjdCxcbiAgSW5wdXQsXG4gIE9uRGVzdHJveSxcbiAgT3V0cHV0LFxuICBRdWVyeUxpc3QsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBDb2xsZWN0aW9uVmlld2VyLCBpc0RhdGFTb3VyY2UsIExpc3RSYW5nZSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9jb2xsZWN0aW9ucyc7XG5cbmltcG9ydCB7IHByaXptRGVmYXVsdFByb3AgfSBmcm9tICdAcHJpem0tdWkvY29yZSc7XG5pbXBvcnQgeyBQcml6bURlc3Ryb3lTZXJ2aWNlLCBwcml6bUVtcHR5UXVlcnlMaXN0IH0gZnJvbSAnQHByaXptLXVpL2hlbHBlcnMnO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBpc09ic2VydmFibGUsIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHN3aXRjaE1hcCwgdGFrZVVudGlsLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBQb2x5bW9ycGhDb250ZW50IH0gZnJvbSAnLi4vLi4vLi4vZGlyZWN0aXZlcyc7XG5pbXBvcnQgeyBQcml6bVRhYmxlRW1wdHlEaXJlY3RpdmUgfSBmcm9tICcuLi9kaXJlY3RpdmVzL2VtcHR5LmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBQcml6bVRhYmxlTG9hZGluZ0RpcmVjdGl2ZSB9IGZyb20gJy4uL2RpcmVjdGl2ZXMvbG9hZGluZy5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgUHJpem1Sb3dEaXJlY3RpdmUgfSBmcm9tICcuLi9kaXJlY3RpdmVzL3Jvdy5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgUHJpem1UYWJsZURpcmVjdGl2ZSB9IGZyb20gJy4uL2RpcmVjdGl2ZXMvdGFibGUuZGlyZWN0aXZlJztcbmltcG9ydCB7IFByaXptVGFibGVUcmVlTG9hZGluZ0RpcmVjdGl2ZSB9IGZyb20gJy4uL2RpcmVjdGl2ZXMvdHJlZS1sb2FkaW5nLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBQUklaTV9UQUJMRV9QUk9WSURFUiB9IGZyb20gJy4uL3Byb3ZpZGVycy90YWJsZS5wcm92aWRlcic7XG5pbXBvcnQgeyBQcml6bVRhYmxlU29ydGVyU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2UnO1xuaW1wb3J0IHsgUHJpem1UYWJsZVRyZWVTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZS90cmVlLnNlcnZpY2UnO1xuaW1wb3J0IHsgUHJpem1UYWJsZURhdGFTb3VyY2VJbnB1dCB9IGZyb20gJy4uL3RhYmxlLnR5cGVzJztcbmltcG9ydCB7IFByaXptVHJDb21wb25lbnQgfSBmcm9tICcuLi90ci90ci5jb21wb25lbnQnO1xuXG5AQ29tcG9uZW50KHtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC9jb21wb25lbnQtc2VsZWN0b3JcbiAgc2VsZWN0b3I6IGBbcHJpem1UYm9keV0gYCxcbiAgdGVtcGxhdGVVcmw6IGAuL3Rib2R5LmNvbXBvbmVudC5odG1sYCxcbiAgc3R5bGVVcmxzOiBbYC4vdGJvZHkuY29tcG9uZW50Lmxlc3NgXSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIHByb3ZpZGVyczogUFJJWk1fVEFCTEVfUFJPVklERVIsXG59KVxuZXhwb3J0IGNsYXNzIFByaXptVGJvZHlDb21wb25lbnQ8VCBleHRlbmRzIFBhcnRpYWw8UmVjb3JkPGtleW9mIFQsIHVua25vd24+Pj5cbiAgaW1wbGVtZW50cyBDb2xsZWN0aW9uVmlld2VyLCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3lcbntcbiAgLyoqXG4gICAqIFRoZSB0YWJsZSdzIHNvdXJjZSBvZiBkYXRhLCB3aGljaCBjYW4gYmUgcHJvdmlkZWQgaW4gdGhyZWUgd2F5cyAoaW4gb3JkZXIgb2YgY29tcGxleGl0eSk6XG4gICAqICAgLSBTaW1wbGUgZGF0YSBhcnJheSAoZWFjaCBvYmplY3QgcmVwcmVzZW50cyBvbmUgdGFibGUgcm93KVxuICAgKiAgIC0gU3RyZWFtIHRoYXQgZW1pdHMgYSBkYXRhIGFycmF5IGVhY2ggdGltZSB0aGUgYXJyYXkgY2hhbmdlc1xuICAgKiAgIC0gYERhdGFTb3VyY2VgIG9iamVjdCB0aGF0IGltcGxlbWVudHMgdGhlIGNvbm5lY3QvZGlzY29ubmVjdCBpbnRlcmZhY2UuXG4gICAqXG4gICAqIElmIHRoZSBkYXRhIGFycmF5IHJlZmVyZW5jZSBpcyBjaGFuZ2VkLCB0aGUgdGFibGVcbiAgICogd2lsbCBhdXRvbWF0aWNhbGx5IHRyaWdnZXIgYW4gdXBkYXRlIHRvIHRoZSByb3dzLlxuICAgKiBNdXRhdGlvbiBvZiBhbiBhcnJheSAocHVzaCwgdW5zaGlmdCkgd2lsbCBub3QuXG4gICAqXG4gICAqIFdoZW4gcHJvdmlkaW5nIGFuIE9ic2VydmFibGUgc3RyZWFtLCB0aGUgdGFibGUgd2lsbCB0cmlnZ2VyIGFuIHVwZGF0ZSBhdXRvbWF0aWNhbGx5IHdoZW4gdGhlXG4gICAqIHN0cmVhbSBlbWl0cyBhIG5ldyBhcnJheSBvZiBkYXRhLlxuICAgKlxuICAgKiBGaW5hbGx5LCB3aGVuIHByb3ZpZGluZyBhIGBEYXRhU291cmNlYCBvYmplY3QsIHRoZSB0YWJsZSB3aWxsIHVzZSB0aGUgT2JzZXJ2YWJsZSBzdHJlYW1cbiAgICogcHJvdmlkZWQgYnkgdGhlIERhdGFTb3VyY2UncyBgY29ubmVjdGAgZnVuY3Rpb24gYW5kIHRyaWdnZXIgdXBkYXRlcyB3aGVuIHRoYXQgc3RyZWFtIGVtaXRzIG5ldyBkYXRhIGFycmF5XG4gICAqIHZhbHVlcy4gRHVyaW5nIHRoZSB0YWJsZSdzIGBuZ09uRGVzdHJveWAgb3Igd2hlbiB0aGUgZGF0YSBzb3VyY2UgaXMgcmVtb3ZlZCBmcm9tIHRoZSB0YWJsZSwgdGhlXG4gICAqIHRhYmxlIHdpbGwgY2FsbCB0aGUgRGF0YVNvdXJjZSdzIGBkaXNjb25uZWN0YCBmdW5jdGlvbi5cbiAgICpcbiAgICogRm9yIGEgYERhdGFTb3VyY2VgLXMgd2Ugc2tpcCBpbnRlcm5hbCBzb3J0aW5nLCBzbyB0aGF0IHVzZXJzIGNhbiB1c2UgdGhlaXIgb3duIHNvcnRpbmcgbWVjaGFuaXNtc1xuICAgKiBpLmUuIHNlcnZlci1zaWRlIHNvcnRpbmcgY2FuIHVzZSBkaWZmZXJlbnQgZGF0YS1iYXNlJ3MgY29sbGF0aW9uIHN0cmF0ZWdpZXMuXG4gICAqIE9uIHRoZSBvdGhlciBoYW5kIHVzZXJzIGNhbiBjb25uZWN0IGBzb3J0ZXJTZXJ2aWNlYCB0byBgUHJpem1UYWJsZURhdGFTb3VyY2VgOlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBcbiAgICogIFxcQFZpZXdDaGlsZChQcml6bVRhYmxlRGlyZWN0aXZlKSB0YWJsZTtcbiAgICogIFxcQFZpZXdDaGlsZChQcml6bVBhZ2luYXRvckNvbXBvbmVudCkgcGFnaW5hdG9yO1xuICAgKlxuICAgKiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgKiAgICB0aGlzLmRhdGFTb3VyY2UgPSBuZXcgUHJpem1UYWJsZURhdGFTb3VyY2UoW10pO1xuICAgKiAgICB0aGlzLmRhdGFTb3VyY2UucGFnaW5hdG9yID0gdGhpcy5wYWdpbmF0b3I7XG4gICAqICAgIHRoaXMuZGF0YVNvdXJjZS5zb3J0ZXIgPSB0aGlzLnRhYmxlLnNvcnRlclNlcnZpY2U7XG4gICAqICB9XG4gICAqIGBgYFxuICAgKi9cbiAgQElucHV0KClcbiAgc2V0IGRhdGEoZGF0YVNvdXJjZTogUHJpem1UYWJsZURhdGFTb3VyY2VJbnB1dDxUPikge1xuICAgIGlmICh0aGlzLl9kYXRhU291cmNlICE9PSBkYXRhU291cmNlKSB7XG4gICAgICB0aGlzLl9zd2l0Y2hEYXRhU291cmNlKGRhdGFTb3VyY2UgPz8gW10pO1xuICAgIH1cbiAgfVxuXG4gIGdldCBkYXRhKCk6IFByaXptVGFibGVEYXRhU291cmNlSW5wdXQ8VD4ge1xuICAgIHJldHVybiB0aGlzLl9kYXRhU291cmNlO1xuICB9XG4gIHByaXZhdGUgX2RhdGFTb3VyY2UhOiBQcml6bVRhYmxlRGF0YVNvdXJjZUlucHV0PFQ+O1xuXG4gIC8qKlxuICAgKiBDdXJyZW50bHkgZGlzcGxheWVkIHNldCBvZiBkYXRhLlxuICAgKi9cbiAgZ2V0IHZpZXcoKTogcmVhZG9ubHkgVFtdIHtcbiAgICByZXR1cm4gdGhpcy5fZGF0YTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDdXJyZW50bHkgZGlzcGxheWVkIHNldCBvZiBkYXRhLlxuICAgKlxuICAgKiBAZGVwcmVjYXRlZFxuICAgKi9cbiAgZ2V0IHNvcnRlZCgpOiByZWFkb25seSBUW10ge1xuICAgIHJldHVybiB0aGlzLl9kYXRhO1xuICB9XG5cbiAgLyoqIExhdGVzdCBkYXRhIHByb3ZpZGVkIGJ5IHRoZSBkYXRhIHNvdXJjZS4gKi9cbiAgcHJvdGVjdGVkIF9kYXRhITogcmVhZG9ubHkgVFtdO1xuXG4gIC8qIHByb3RlY3RlZCAqLyByZW5kZXJEYXRhJCE6IE9ic2VydmFibGU8cmVhZG9ubHkgVFtdPjtcblxuICBASW5wdXQoKVxuICBAcHJpem1EZWZhdWx0UHJvcCgpXG4gIGhlYWRpbmc6IFBvbHltb3JwaENvbnRlbnQgPSBgYDtcblxuICBASW5wdXQoKVxuICBAcHJpem1EZWZhdWx0UHJvcCgpXG4gIG9wZW4gPSB0cnVlO1xuXG4gIEBPdXRwdXQoKVxuICByZWFkb25seSBvcGVuQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xuXG4gIEBDb250ZW50Q2hpbGQoUHJpem1UYWJsZUxvYWRpbmdEaXJlY3RpdmUpXG4gIHJlYWRvbmx5IGxvYWRpbmdUZW1wbGF0ZT86IFByaXptVGFibGVMb2FkaW5nRGlyZWN0aXZlO1xuXG4gIEBDb250ZW50Q2hpbGQoUHJpem1UYWJsZUVtcHR5RGlyZWN0aXZlKVxuICByZWFkb25seSBlbXB0eVRlbXBsYXRlPzogUHJpem1UYWJsZUVtcHR5RGlyZWN0aXZlO1xuXG4gIEBDb250ZW50Q2hpbGQoUHJpem1UYWJsZVRyZWVMb2FkaW5nRGlyZWN0aXZlKVxuICByZWFkb25seSB0cmVlTG9hZGluZ1RlbXBsYXRlPzogUHJpem1UYWJsZVRyZWVMb2FkaW5nRGlyZWN0aXZlO1xuXG4gIEBDb250ZW50Q2hpbGQoZm9yd2FyZFJlZigoKSA9PiBQcml6bVJvd0RpcmVjdGl2ZSkpXG4gIHJlYWRvbmx5IHJvdz86IFByaXptUm93RGlyZWN0aXZlPFQ+O1xuXG4gIEBDb250ZW50Q2hpbGRyZW4oZm9yd2FyZFJlZigoKSA9PiBQcml6bVRyQ29tcG9uZW50KSlcbiAgcmVhZG9ubHkgcm93czogUXVlcnlMaXN0PFByaXptVHJDb21wb25lbnQ8VD4+ID0gcHJpem1FbXB0eVF1ZXJ5TGlzdCgpO1xuXG4gIGNvbHVtbnNDb3VudCA9IDA7XG4gIC8qKlxuICAgKiBTdHJlYW0gY29udGFpbmluZyB0aGUgbGF0ZXN0IGluZm9ybWF0aW9uIG9uIHdoYXQgcm93cyBhcmUgYmVpbmcgZGlzcGxheWVkIG9uIHNjcmVlbi5cbiAgICpcbiAgICogQHByaXZhdGUgTm90IHVzZWQgaW50ZXJuYWxseSwganVzdCBuZWVkZWQgYnkgYENvbGxlY3Rpb25WaWV3ZXJgIGludGVyZmFjZS5cbiAgICovXG4gIHJlYWRvbmx5IHZpZXdDaGFuZ2UgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PExpc3RSYW5nZT4oe1xuICAgIHN0YXJ0OiAwLFxuICAgIGVuZDogTnVtYmVyLk1BWF9WQUxVRSxcbiAgfSk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgQEluamVjdChmb3J3YXJkUmVmKCgpID0+IFByaXptVGFibGVEaXJlY3RpdmUpKVxuICAgIHJlYWRvbmx5IHRhYmxlOiBQcml6bVRhYmxlRGlyZWN0aXZlPFQ+LFxuICAgIHB1YmxpYyByZWFkb25seSBzb3J0ZXJTZXJ2aWNlOiBQcml6bVRhYmxlU29ydGVyU2VydmljZTxUPixcbiAgICBwdWJsaWMgcmVhZG9ubHkgdGFibGVUcmVlU2VydmljZTogUHJpem1UYWJsZVRyZWVTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgZGVzdHJveSQ6IFByaXptRGVzdHJveVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBjaGFuZ2VEZXRlY3RvclJlZjogQ2hhbmdlRGV0ZWN0b3JSZWZcbiAgKSB7fVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLnRhYmxlLnRhYmxlU2VydmljZS50YWJsZU1heENvbHNwYW4kXG4gICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpXG4gICAgICAuc3Vic2NyaWJlKChjb2x1bW5zQ291bnQ6IG51bWJlcikgPT4ge1xuICAgICAgICB0aGlzLmNvbHVtbnNDb3VudCA9IGNvbHVtbnNDb3VudDtcbiAgICAgICAgdGhpcy5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICB9KTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIGlmIChpc0RhdGFTb3VyY2UodGhpcy5kYXRhKSkge1xuICAgICAgdGhpcy5kYXRhLmRpc2Nvbm5lY3QodGhpcyk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIG9uQ2xpY2soKTogdm9pZCB7XG4gICAgdGhpcy5vcGVuID0gIXRoaXMub3BlbjtcbiAgICB0aGlzLm9wZW5DaGFuZ2UuZW1pdCh0aGlzLm9wZW4pO1xuICB9XG5cbiAgLyoqXG4gICAqIFN3aXRjaCB0byB0aGUgcHJvdmlkZWQgZGF0YSBzb3VyY2UgYnkgcmVzZXR0aW5nIHRoZSBkYXRhIGFuZCB1bnN1YnNjcmliaW5nIGZyb20gdGhlIGN1cnJlbnQuXG4gICAqL1xuICBwcml2YXRlIF9zd2l0Y2hEYXRhU291cmNlKGRhdGFTb3VyY2U6IFByaXptVGFibGVEYXRhU291cmNlSW5wdXQ8VD4pOiB2b2lkIHtcbiAgICB0aGlzLl9kYXRhID0gW107XG5cbiAgICAvLyBEaXNjb25uZWN0IGZyb20gcHJldmlvdXMgZGF0YSBzb3VyY2UgaWYgbmVlZGVkXG4gICAgaWYgKGlzRGF0YVNvdXJjZSh0aGlzLmRhdGEpKSB7XG4gICAgICB0aGlzLmRhdGEuZGlzY29ubmVjdCh0aGlzKTtcbiAgICB9XG5cbiAgICB0aGlzLl9kYXRhU291cmNlID0gZGF0YVNvdXJjZTtcblxuICAgIGxldCBkYXRhU3RyZWFtOiBPYnNlcnZhYmxlPHJlYWRvbmx5IFRbXT47XG4gICAgaWYgKGlzRGF0YVNvdXJjZShkYXRhU291cmNlKSkge1xuICAgICAgZGF0YVN0cmVhbSA9IGRhdGFTb3VyY2UuY29ubmVjdCh0aGlzKTtcbiAgICB9IGVsc2UgaWYgKGlzT2JzZXJ2YWJsZShkYXRhU291cmNlKSkge1xuICAgICAgZGF0YVN0cmVhbSA9IGRhdGFTb3VyY2UucGlwZShzd2l0Y2hNYXAoZGF0YSA9PiB0aGlzLnNvcnRlclNlcnZpY2Uuc29ydCQoZGF0YSBhcyBUW10pKSk7XG4gICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGRhdGFTb3VyY2UpKSB7XG4gICAgICBkYXRhU3RyZWFtID0gdGhpcy5zb3J0ZXJTZXJ2aWNlLnNvcnQkKGRhdGFTb3VyY2UpO1xuICAgIH1cblxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXRzLWNvbW1lbnRcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgdGhpcy5yZW5kZXJEYXRhJCA9IGRhdGFTdHJlYW0ucGlwZShcbiAgICAgIHRhcChkYXRhID0+IHtcbiAgICAgICAgdGhpcy5fZGF0YSA9IGRhdGEgfHwgW107XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgc29ydENoaWxkcmVuKGNoaWxkcmVuJDogT2JzZXJ2YWJsZTxUW10+KTogT2JzZXJ2YWJsZTxyZWFkb25seSBUW10+IHtcbiAgICByZXR1cm4gY2hpbGRyZW4kLnBpcGUoc3dpdGNoTWFwKGNoaWxkcmVuID0+IHRoaXMuc29ydGVyU2VydmljZS5zb3J0JChjaGlsZHJlbikpKTtcbiAgfVxufVxuIiwiPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuPHRyICpuZ0lmPVwiaGVhZGluZ1wiPlxuICA8dGggY2xhc3M9XCJoZWFkaW5nXCIgW2NvbFNwYW5dPVwiY29sdW1uc0NvdW50XCI+XG4gICAgPGRpdiBjbGFzcz1cImhlYWRpbmdfX2NvbnRhaW5lclwiPlxuICAgICAgPHByaXptLWljb25cbiAgICAgICAgY2xhc3M9XCJoZWFkaW5nX19pY29uXCJcbiAgICAgICAgW2NsYXNzLmhlYWRpbmdfX2ljb25fZXhwYW5kZWRdPVwib3BlblwiXG4gICAgICAgIChjbGljayk9XCJvbkNsaWNrKClcIlxuICAgICAgICBpY29uQ2xhc3M9XCJhcnJvd3MtY2hldnJvbi1yaWdodFwiXG4gICAgICA+PC9wcml6bS1pY29uPlxuICAgICAgPHNwYW4gY2xhc3M9XCJoZWFkaW5nX19jb250ZW50XCI+XG4gICAgICAgIDxuZy1jb250YWluZXIgKnBvbHltb3JwaE91dGxldD1cImhlYWRpbmcgYXMgdGV4dFwiPnt7IHRleHQgfX08L25nLWNvbnRhaW5lcj5cbiAgICAgIDwvc3Bhbj5cbiAgICA8L2Rpdj5cbiAgPC90aD5cbjwvdHI+XG5cbjxuZy1jb250YWluZXIgKm5nSWY9XCJvcGVuICYmIHJvd1wiPlxuICA8bmctY29udGFpbmVyICpuZ0lmPVwicmVuZGVyRGF0YSQgfCBhc3luYyBhcyBkYXRhOyBlbHNlIGxvYWRpbmdXcmFwcGVyVGVtcGxhdGVcIj5cbiAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiISFkYXRhPy5sZW5ndGg7IGVsc2UgZW1wdHlXcmFwcGVyVGVtcGxhdGVcIj5cbiAgICAgIDxuZy10ZW1wbGF0ZVxuICAgICAgICAqbmdGb3I9XCJcbiAgICAgICAgICBsZXQgaXRlbSBvZiBkYXRhO1xuICAgICAgICAgIGluZGV4IGFzIGluZGV4O1xuICAgICAgICAgIG9kZCBhcyBvZGQ7XG4gICAgICAgICAgZXZlbiBhcyBldmVuO1xuICAgICAgICAgIGZpcnN0IGFzIGZpcnN0O1xuICAgICAgICAgIGxhc3QgYXMgbGFzdDtcbiAgICAgICAgICBjb3VudCBhcyBjb3VudDtcbiAgICAgICAgICB0cmFja0J5OiByb3cucHJpem1Sb3dUcmFja0J5XG4gICAgICAgIFwiXG4gICAgICAgIFt0ZW1wbGF0ZV09XCJ0ZW1wbGF0ZVJvd0VsZW1lbnRcIlxuICAgICAgICBbY29udGV4dF09XCJcbiAgICAgICAgICAkYW55KHtcbiAgICAgICAgICAgIGl0ZW06IGl0ZW0sXG4gICAgICAgICAgICBpbmRleDogaW5kZXgsXG4gICAgICAgICAgICByb3dJZHg6IGluZGV4LFxuICAgICAgICAgICAgb2RkOiBvZGQsXG4gICAgICAgICAgICBldmVuOiBldmVuLFxuICAgICAgICAgICAgZ2V0Um93SWQ6IHJvdy5wcml6bVJvd0dldFJvd0lkLFxuICAgICAgICAgICAgZmlyc3Q6IGZpcnN0LFxuICAgICAgICAgICAgbGFzdDogbGFzdCxcbiAgICAgICAgICAgIGNvdW50OiBjb3VudCxcbiAgICAgICAgICAgIGRlZXBMZXZlbDogMFxuICAgICAgICAgIH0pXG4gICAgICAgIFwiXG4gICAgICAgIHByaXptVGFibGVSb3dJbml0XG4gICAgICA+PC9uZy10ZW1wbGF0ZT5cbiAgICA8L25nLWNvbnRhaW5lcj5cbiAgPC9uZy1jb250YWluZXI+XG48L25nLWNvbnRhaW5lcj5cblxuPG5nLXRlbXBsYXRlICNsb2FkaW5nV3JhcHBlclRlbXBsYXRlPlxuICA8bmctY29udGFpbmVyICpuZ1RlbXBsYXRlT3V0bGV0PVwibG9hZGluZ1RlbXBsYXRlPy50ZW1wbGF0ZSB8fCBsb2FkaW5nV3JhcHBlclRlbXBsYXRlXCI+PC9uZy1jb250YWluZXI+XG5cbiAgPG5nLXRlbXBsYXRlICNsb2FkaW5nV3JhcHBlclRlbXBsYXRlPlxuICAgIDx0cj5cbiAgICAgIDx0ZCBbY29sU3Bhbl09XCJjb2x1bW5zQ291bnRcIj5Mb2FkaW5nLi4uPC90ZD5cbiAgICA8L3RyPlxuICA8L25nLXRlbXBsYXRlPlxuPC9uZy10ZW1wbGF0ZT5cblxuPG5nLXRlbXBsYXRlICNlbXB0eVdyYXBwZXJUZW1wbGF0ZT5cbiAgPG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cImVtcHR5VGVtcGxhdGU/LnRlbXBsYXRlIHx8IGVtcHR5SW5uZXJUZW1wbGF0ZVwiPjwvbmctY29udGFpbmVyPlxuXG4gIDxuZy10ZW1wbGF0ZSAjZW1wdHlJbm5lclRlbXBsYXRlPlxuICAgIDx0ciBjbGFzcz1cImVtcHR5LXJvd1wiPlxuICAgICAgPHRkIFtjb2xTcGFuXT1cImNvbHVtbnNDb3VudFwiPuKAlDwvdGQ+XG4gICAgPC90cj5cbiAgPC9uZy10ZW1wbGF0ZT5cbjwvbmctdGVtcGxhdGU+XG5cbjxuZy10ZW1wbGF0ZVxuICAjdGVtcGxhdGVSb3dFbGVtZW50XG4gIGxldC1pdGVtPVwiaXRlbVwiXG4gIGxldC1pbmRleD1cImluZGV4XCJcbiAgbGV0LW9kZD1cIm9kZFwiXG4gIGxldC1ldmVuPVwiZXZlblwiXG4gIGxldC1maXJzdD1cImZpcnN0XCJcbiAgbGV0LWxhc3Q9XCJsYXN0XCJcbiAgbGV0LWNvdW50PVwiY291bnRcIlxuICBsZXQtZGVlcExldmVsPVwiZGVlcExldmVsXCJcbiAgbGV0LXBhcmVudEl0ZW09XCJwYXJlbnRJdGVtXCJcbiAgbGV0LXBhcmVudElkeD1cInBhcmVudElkeFwiXG4gIGxldC1yb3dJZHg9XCJyb3dJZHhcIlxuPlxuICA8bmctY29udGFpbmVyXG4gICAgW25nVGVtcGxhdGVPdXRsZXRdPVwiJGFueShyb3c/LnRlbXBsYXRlKVwiXG4gICAgW25nVGVtcGxhdGVPdXRsZXRDb250ZXh0XT1cIntcbiAgICAgICRpbXBsaWNpdDogaXRlbSxcbiAgICAgIHJvd0lkeDogcm93SWR4LFxuICAgICAgcGFyZW50SWR4OiBwYXJlbnRJZHgsXG4gICAgICBwYXJlbnRJdGVtOiBwYXJlbnRJdGVtLFxuICAgICAgaW5kZXg6IGluZGV4LFxuICAgICAgb2RkOiBvZGQsXG4gICAgICBpdGVtOiBpdGVtLFxuICAgICAgZXZlbjogZXZlbixcbiAgICAgIGRlZXBMZXZlbDogZGVlcExldmVsLFxuICAgICAgZmlyc3Q6IGZpcnN0LFxuICAgICAgbGFzdDogbGFzdCxcbiAgICAgIGNvdW50OiBjb3VudFxuICAgIH1cIlxuICA+PC9uZy1jb250YWluZXI+XG5cbiAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInRhYmxlVHJlZVNlcnZpY2UuY2FuU2hvd0NoaWxkKGluZGV4KSB8IGFzeW5jXCI+XG4gICAgPG5nLXRlbXBsYXRlICN0cmVlTG9hZGluZ1RlbXBsYXRlUmVmPlxuICAgICAgPG5nLWNvbnRhaW5lclxuICAgICAgICBbbmdUZW1wbGF0ZU91dGxldF09XCJ0cmVlTG9hZGluZ1RlbXBsYXRlPy50ZW1wbGF0ZSB8fCBkZWZhdWx0VHJlZUxvYWRpbmdcIlxuICAgICAgICBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwie1xuICAgICAgICAgIGl0ZW06IGl0ZW0sXG4gICAgICAgICAgcGFyZW50SWR4OiBpbmRleCxcbiAgICAgICAgICBwYXJlbnRJdGVtOiBpdGVtLFxuICAgICAgICAgIGRlZXBMZXZlbDogZGVlcExldmVsLFxuICAgICAgICAgIGZpcnN0OiBmaXJzdCxcbiAgICAgICAgICBsYXN0OiBsYXN0LFxuICAgICAgICAgIGNvdW50OiBjb3VudFxuICAgICAgICB9XCJcbiAgICAgID5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgPG5nLXRlbXBsYXRlICNkZWZhdWx0VHJlZUxvYWRpbmc+XG4gICAgICAgIDx0cj5cbiAgICAgICAgICA8dGQ+TG9hZGluZy4uLjwvdGQ+XG4gICAgICAgIDwvdHI+XG4gICAgICA8L25nLXRlbXBsYXRlPlxuICAgIDwvbmctdGVtcGxhdGU+XG5cbiAgICA8bmctY29udGFpbmVyXG4gICAgICAqbmdJZj1cIlxuICAgICAgICByb3c/LnByaXptUm93R2V0Q2hpbGRyZW4gJiYgaXRlbVxuICAgICAgICAgIHwgcHJpem1DYWxsRnVuYyA6ICRhbnkocm93Py5wcml6bVJvd0dldENoaWxkcmVuKVxuICAgICAgICAgIHwgcHJpem1DYWxsRnVuYyA6IHNvcnRDaGlsZHJlblxuICAgICAgICAgIHwgYXN5bmMgYXMgY2hpbGRyZW47XG4gICAgICAgIGVsc2UgdHJlZUxvYWRpbmdUZW1wbGF0ZVJlZlxuICAgICAgXCJcbiAgICA+XG4gICAgICA8bmctdGVtcGxhdGVcbiAgICAgICAgKm5nRm9yPVwiXG4gICAgICAgICAgbGV0IGNoaWxkSXRlbSBvZiAkYW55KGNoaWxkcmVuKTtcbiAgICAgICAgICBpbmRleCBhcyBjaGlsZEluZGV4O1xuICAgICAgICAgIG9kZCBhcyBjaGlsZE9kZDtcbiAgICAgICAgICBldmVuIGFzIGNoaWxkRXZlbjtcbiAgICAgICAgICBmaXJzdCBhcyBjaGlsZEZpcnN0O1xuICAgICAgICAgIGxhc3QgYXMgY2hpbGRMYXN0O1xuICAgICAgICAgIGNvdW50IGFzIGNoaWxkQ291bnQ7XG4gICAgICAgICAgdHJhY2tCeTogJGFueShyb3c/LnByaXptUm93VHJhY2tCeSlcbiAgICAgICAgXCJcbiAgICAgICAgW3RlbXBsYXRlXT1cInRlbXBsYXRlUm93RWxlbWVudFwiXG4gICAgICAgIFtjb250ZXh0XT1cIlxuICAgICAgICAgICRhbnkoe1xuICAgICAgICAgICAgaXRlbTogY2hpbGRJdGVtLFxuICAgICAgICAgICAgcm93SWR4OiBjaGlsZEluZGV4LFxuICAgICAgICAgICAgcGFyZW50SWR4OiBpbmRleCxcbiAgICAgICAgICAgIGdldFJvd0lkOiAkYW55KHJvdz8ucHJpem1Sb3dHZXRSb3dJZCksXG4gICAgICAgICAgICBwYXJlbnRJdGVtOiBpdGVtLFxuICAgICAgICAgICAgZGVlcExldmVsOiAoZGVlcExldmVsID8/IDApICsgMSxcbiAgICAgICAgICAgIGZpcnN0OiBjaGlsZEZpcnN0LFxuICAgICAgICAgICAgbGFzdDogY2hpbGRMYXN0LFxuICAgICAgICAgICAgY291bnQ6IGNoaWxkQ291bnQgKyBjb3VudFxuICAgICAgICAgIH0pXG4gICAgICAgIFwiXG4gICAgICAgIHByaXptVGFibGVSb3dJbml0XG4gICAgICA+XG4gICAgICA8L25nLXRlbXBsYXRlPlxuICAgIDwvbmctY29udGFpbmVyPlxuICA8L25nLWNvbnRhaW5lcj5cbjwvbmctdGVtcGxhdGU+XG5cbjxuZy1jb250ZW50IHNlbGVjdD1cIltmb290ZXJdXCI+PC9uZy1jb250ZW50PlxuIl19