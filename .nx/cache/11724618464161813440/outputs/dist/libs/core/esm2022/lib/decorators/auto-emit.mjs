export function prizmAutoEmit(options = {}) {
  return (target, key) => {
    const defaultValue = options.defaultValue ?? null;
    const memberName = key;
    const hiddenPropertyName = options.name ?? `${memberName}Change`;
    let lastValue;
    Object.defineProperty(target, memberName, {
      set(newValue) {
        const value = (lastValue = newValue ?? defaultValue);
        const method = this[hiddenPropertyName];
        if (typeof method?.next !== 'function') {
          console.error('prizmAutoEmit: Can find subject', {
            method,
            hiddenPropertyName,
            value,
            self: this,
          });
          return;
        }
        method.next(
          (typeof options?.calculate === 'function' ? options?.calculate?.(value, this) : value) ??
            defaultValue
        );
      },
      get() {
        return lastValue;
      },
    });
  };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0by1lbWl0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9jb3JlL3NyYy9saWIvZGVjb3JhdG9ycy9hdXRvLWVtaXQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBSUEsTUFBTSxVQUFVLGFBQWEsQ0FDM0IsVUFPSSxFQUFFO0lBRU4sT0FBTyxDQUFDLE1BQVcsRUFBRSxHQUFHLEVBQVEsRUFBRTtRQUNoQyxNQUFNLFlBQVksR0FBRyxPQUFPLENBQUMsWUFBWSxJQUFJLElBQUksQ0FBQztRQUNsRCxNQUFNLFVBQVUsR0FBRyxHQUFhLENBQUM7UUFDakMsTUFBTSxrQkFBa0IsR0FBRyxPQUFPLENBQUMsSUFBSSxJQUFJLEdBQUcsVUFBVSxRQUFRLENBQUM7UUFDakUsSUFBSSxTQUFZLENBQUM7UUFDakIsTUFBTSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsVUFBVSxFQUFFO1lBQ3hDLEdBQUcsQ0FBQyxRQUFXO2dCQUNiLE1BQU0sS0FBSyxHQUFHLENBQUMsU0FBUyxHQUFHLFFBQVEsSUFBSyxZQUFrQixDQUFDLENBQUM7Z0JBQzVELE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBZSxDQUFDO2dCQUN0RCxJQUFJLE9BQU8sTUFBTSxFQUFFLElBQUksS0FBSyxVQUFVLEVBQUU7b0JBQ3RDLE9BQU8sQ0FBQyxLQUFLLENBQUMsaUNBQWlDLEVBQUU7d0JBQy9DLE1BQU07d0JBQ04sa0JBQWtCO3dCQUNsQixLQUFLO3dCQUNMLElBQUksRUFBRSxJQUFJO3FCQUNYLENBQUMsQ0FBQztvQkFDSCxPQUFPO2lCQUNSO2dCQUNELE1BQU0sQ0FBQyxJQUFJLENBQ1QsQ0FBQyxPQUFPLE9BQU8sRUFBRSxTQUFTLEtBQUssVUFBVSxDQUFDLENBQUMsQ0FBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBTyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7b0JBQzFGLFlBQWtCLENBQ3RCLENBQUM7WUFDSixDQUFDO1lBQ0QsR0FBRztnQkFDRCxPQUFPLFNBQVMsQ0FBQztZQUNuQixDQUFDO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcblxuZXhwb3J0IHR5cGUgUHJpem1BdXRvRW1pdENhbGN1bGF0ZTxWYWwsIEJhc2VDbGFzcywgUiA9IHVua25vd24+ID0gKHZhbDogVmFsLCB2YWx1ZTogQmFzZUNsYXNzKSA9PiBSO1xuXG5leHBvcnQgZnVuY3Rpb24gcHJpem1BdXRvRW1pdDxUPihcbiAgb3B0aW9uczoge1xuICAgIGRlZmF1bHRWYWx1ZT86IFQ7XG4gICAgLyoqXG4gICAgICogZGVmYXVsdCBuYW1lIGAke25hbWV9Q2hhbmdlYFxuICAgICAqICovXG4gICAgbmFtZT86IHN0cmluZyB8IHN5bWJvbDtcbiAgICBjYWxjdWxhdGU/OiBQcml6bUF1dG9FbWl0Q2FsY3VsYXRlPGFueSwgYW55LCBUPjtcbiAgfSA9IHt9XG4pOiBQcm9wZXJ0eURlY29yYXRvciB7XG4gIHJldHVybiAodGFyZ2V0OiBhbnksIGtleSk6IHZvaWQgPT4ge1xuICAgIGNvbnN0IGRlZmF1bHRWYWx1ZSA9IG9wdGlvbnMuZGVmYXVsdFZhbHVlID8/IG51bGw7XG4gICAgY29uc3QgbWVtYmVyTmFtZSA9IGtleSBhcyBzdHJpbmc7XG4gICAgY29uc3QgaGlkZGVuUHJvcGVydHlOYW1lID0gb3B0aW9ucy5uYW1lID8/IGAke21lbWJlck5hbWV9Q2hhbmdlYDtcbiAgICBsZXQgbGFzdFZhbHVlOiBUO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIG1lbWJlck5hbWUsIHtcbiAgICAgIHNldChuZXdWYWx1ZTogVCkge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IChsYXN0VmFsdWUgPSBuZXdWYWx1ZSA/PyAoZGVmYXVsdFZhbHVlIGFzIFQpKTtcbiAgICAgICAgY29uc3QgbWV0aG9kID0gdGhpc1toaWRkZW5Qcm9wZXJ0eU5hbWVdIGFzIFN1YmplY3Q8VD47XG4gICAgICAgIGlmICh0eXBlb2YgbWV0aG9kPy5uZXh0ICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcigncHJpem1BdXRvRW1pdDogQ2FuIGZpbmQgc3ViamVjdCcsIHtcbiAgICAgICAgICAgIG1ldGhvZCxcbiAgICAgICAgICAgIGhpZGRlblByb3BlcnR5TmFtZSxcbiAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgc2VsZjogdGhpcyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbWV0aG9kLm5leHQoXG4gICAgICAgICAgKHR5cGVvZiBvcHRpb25zPy5jYWxjdWxhdGUgPT09ICdmdW5jdGlvbicgPyAob3B0aW9ucz8uY2FsY3VsYXRlPy4odmFsdWUsIHRoaXMpIGFzIFQpIDogdmFsdWUpID8/XG4gICAgICAgICAgICAoZGVmYXVsdFZhbHVlIGFzIFQpXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgZ2V0KCkge1xuICAgICAgICByZXR1cm4gbGFzdFZhbHVlO1xuICAgICAgfSxcbiAgICB9KTtcbiAgfTtcbn1cbiJdfQ==
