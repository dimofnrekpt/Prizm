"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[70320],{70320:(pt,D,F)=>{F.d(D,{LZ:()=>k,Rn:()=>j,gV:()=>V,wn:()=>b,Uw:()=>P,b_:()=>H,vf:()=>W,Ff:()=>$,Bp:()=>I,tP:()=>R,Yh:()=>B,dj:()=>_,cR:()=>S,Xc:()=>it,rO:()=>st,rI:()=>K,AR:()=>E});const G=["area","base","basefont","bgsound","br","col","command","embed","frame","hr","image","img","input","isindex","keygen","link","menuitem","meta","nextid","param","source","track","wbr"],L=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g,C=r=>{const t={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},e=r.match(/<\/?([^\s]+?)[/\s>]/);if(e&&(t.name=e[1],t.voidElement=G.includes(e[1])||"/"===r.charAt(r.length-2),t.name.startsWith("!--"))){const s=r.indexOf("--\x3e");return{type:"comment",comment:-1!==s?r.slice(4,s):""}}const u=new RegExp(L);let n=null;for(;n=u.exec(r),null!==n;)if(n[0].trim())if(n[1]){const s=n[1].trim();let c=[s,""];s.indexOf("=")>-1?(c=s.split("="),t.attrs[c[0]]=c[1]):t.attrs[c[0]]=null,u.lastIndex--}else n[2]&&(t.attrs[n[2]]=n[3].trim().substring(1,n[3].length-1));return t},N=(r,t={})=>{const e=(r=>{const t=(r=>r.trim().replace(/(^(\s|\t)+|(( |\t)+)$)/gm,""))(r).split("\n"),e=[];let u="";for(let n=0;n<t.length;n+=1){const s=t[n];s.endsWith("/>")?(e.push(`${u}${s.slice(0,-2)} />`),u=""):s.endsWith(">")?(e.push(`${u}${s.startsWith(">")||s.startsWith("<")?"":" "}${s}`),u=""):u+=u.length?` ${s}`:s}return e})(r);let u=((r,t={})=>{const e=t.char||" ",u=t.count||2;let n=0;const s=[];return r.reverse().reduce((c,p)=>{s.length&&n&&s[n]&&s[n]===p.substring(1,s[n].length+1)&&(s.splice(n,1),n--);const m=[`${e.repeat(n?n*u:0)}${p}`,...c];return"</"===p.substring(0,2)&&(n++,s[n]=p.substring(2,p.length-1)),m},[]).join("\n")})(e,t);return!u&&r&&(u=r),u},Y=/<[a-zA-Z0-9\-!/](?:"[^"]*"|'[^']*'|[^'">])*>/g,q=/^\s*$/,J=Object.create(null),K=(r,t={})=>{r=N(r),t||(t={}),t.components||(t.components=J);const e=[],u=[];let n,s=-1,c=!1;if(0!==r.indexOf("<")){const p=r.indexOf("<");e.push({type:"text",content:-1===p?r:r.substring(0,p)})}return r.replace(Y,function(p,l){if(c){if(p!=="</"+n.name+">")return"";c=!1}const m="/"!==p.charAt(1),ct=p.startsWith("\x3c!--"),T=l+p.length,v=r.charAt(T);let a;if(ct){const d=C(p);return s<0?(e.push(d),e):(a=u[s],a&&a.children&&Array.isArray(a.children)&&a.children.push(d),e)}if(m&&(s++,n=C(p),"tag"===n.type&&n.name&&t.components&&t.components[n.name]&&(n.type="component",c=!0),!n.voidElement&&!c&&v&&"<"!==v&&Array.isArray(n.children)&&n.children.push({type:"text",content:r.slice(T,r.indexOf("<",T))}),0===s&&e.push(n),a=u[s-1],a&&a.children&&a.children.push(n),u[s]=n),(!m||n.voidElement)&&(s>-1&&(n.voidElement||n.name===p.slice(2,-1))&&(s--,n=-1===s?e:u[s]),!c&&"<"!==v&&v)){a=-1===s?e:u[s].children;const d=r.indexOf("<",T);let z=r.slice(T,-1===d?void 0:d);q.test(z)&&(z=" "),(d>-1&&s+a.length>=0||" "!==z)&&a&&Array.isArray(a)&&a.push({type:"text",content:z})}}),e};function x(r,t){switch(t.type){case"text":return r+t.content;case"tag":return r+="<"+t.name+(t.attrs?function Q(r){const t=[];for(const e in r)t.push(null===r[e]?e:e+'="'+r[e]+'"');return t.length?" "+t.join(" "):""}(t.attrs):"")+(t.voidElement?"/>":">"),t.voidElement?r:r+t.children.reduce(x,"")+"</"+t.name+">";case"comment":return r+"\x3c!--"+t.comment+"--\x3e";default:return""}}const E=(r,t=!0)=>{let e=r.reduce(function(u,n){return u+x("",n)},"");return t&&(e=N(e)),e};var i=(()=>{return(r=i||(i={})).input="input",r.inputVar="input-variable",r.inputOutput="input-output",r.output="output",i;var r})();class o{create(t){return{type:this.type,payload:t}}}function y(r){return`[${r}]`}function O(r){return`(${r})`}function f(r,t,e=[i.inputOutput,i.input,i.output,i.inputVar]){if(!t||!r)return null;const u=A(r),n=(c,p)=>c in t?{attrName:c,value:t[c],type:p}:null;if(e.includes(i.input)){const c=n(u,i.input);if(c)return c}if(e.includes(i.inputVar)){const c=n(y(u),i.inputVar);if(c)return c}if(e.includes(i.output)){const c=n(O(u),i.output);if(c)return c}return(c=>{const p=h(c),l=g(c);return n(p,i.inputOutput)??n(l,i.inputOutput)})(u)}function w(r,t,e=[i.inputOutput,i.input,i.output,i.inputVar]){return!!t&&!!((e.includes(i.input)||e.includes(i.inputOutput))&&(r in t||h(r)in t||g(r)in t)||(e.includes(i.inputVar)||e.includes(i.inputOutput))&&(y(r)in t||h(r)in t||g(r)in t)||(e.includes(i.output)||e.includes(i.inputOutput))&&(O(r)in t||h(r)in t||g(r)in t))}function h(r){return`[(${r})]`}function g(r){return`([${r}])`}function A(r){return r.replace(/[[(\]) ]/g,"")}function st(r,t){return(new r).create(t)}class I extends o{constructor(){super(...arguments),this.type="not-supported"}run(t,e,u){const n=e.attr??u?.originName;if(!n)return t;const s=t.children??[];"inputs"===u.runIn&&w(n,t.attrs);const c=[];"tasks"===u.runIn?c.push(i.input,i.inputOutput,i.inputVar,i.output):"inputs"===u.runIn?c.push(i.input,i.inputOutput,i.inputVar):"outputs"===u.runIn&&c.push(i.output,i.inputOutput);const p=f(n,t.attrs,c);return p&&delete t.attrs[p.attrName],s.push({type:"comment",comment:`TODO not supported attr <${p?.attrName??n}> in <${t.name}> with value <${p?.value}>`}),e.extraComment&&s.push({type:"comment",comment:e.extraComment}),t.children=[...s],{...t}}}class $ extends o{constructor(){super(...arguments),this.type="move-to-content"}run(t,e,u){const n=e.attr||u.originName;if(!n)return t;const s=function nt(r,t){const e=f(t=A(t),r),u=e?.type,n=e?.value;switch(u){case i.input:return n;case i.inputVar:case i.inputOutput:return`{{${n}}}`;default:return null}}(t.attrs,n);return t.attrs=function et(r,t){const e=y(t=A(t)),u=O(t),n=h(t),s=g(t);return delete r[t],delete r[e],delete r[u],delete r[n],delete r[s],r}(t.attrs,n),e.notClearChildren||(t.children=[]),s&&t.children.push({type:"text",content:s}),{...t}}}class P extends o{constructor(){super(...arguments),this.type="change-name"}run(t,e,u){const{name:n}=e;return n?{...t,name:n}:t}}class V extends o{constructor(){super(...arguments),this.type="add-comment"}run(t,e,u){const{comment:n}=e;if(!(e.attr??u?.originName))return t;const c=t.children??[];return c.push({type:"comment",comment:n}),t.children=c,{...t}}}class k extends o{constructor(){super(...arguments),this.type="add-attribute"}run(t,e,u){const n=e.attr;if(!n)return t;const s=e.passValue&&u.originName?f(u.attrName,t.attrs)?.value:null;return{...t,attrs:{...t.attrs,[n]:s}}}}class B extends o{constructor(){super(...arguments),this.type="rename"}run(t,e,u){if(!e||!e.newAttrName)return t;e.oldAttrName&&(e.oldAttrName=A(e.oldAttrName));let n=e.oldAttrName??u?.attrName;if(!u.runIn)return t;const s=f(n,u.sourceNode.attrs,"outputs"===u.runIn?[i.output]:[i.input,i.inputVar]);if(!s)return t;n=s.attrName;const c=function rt(r,t){switch(t){case i.inputOutput:return h(r);case i.output:return O(r);case i.inputVar:return y(r);default:return r}}(e.newAttrName,s?.type);return t.attrs[c]="value"in e?e.value:s.value,(t!==u.sourceNode||n!==c)&&delete u.sourceNode.attrs[n],e.needFixApi&&(t.children=[...t.children??[],{type:"comment",comment:`TODO: ${n} > ${e.newAttrName} has different api, please manually fix it here`}]),{...t}}}class W extends o{constructor(){super(...arguments),this.type="move-content-to-component"}run(t,e,u){if(!e.name)return t;const s={name:e.name,attrs:e.attrs??{},children:e.children??[],type:e.type??"tag",voidElement:e.voidElement??!1};return s.children.push(...t.children??[]),t.children=[s],{...t}}}class R extends o{constructor(){super(...arguments),this.type="remove-attribute"}run(t,e,u){const n=e.attr??u?.originName;if(!n)return t;const s=[];"tasks"===u.runIn?s.push(i.input,i.inputOutput,i.inputVar,i.output):"inputs"===u.runIn?s.push(i.input,i.inputOutput,i.inputVar):"outputs"===u.runIn&&s.push(i.output,i.inputOutput);const c=f(n,t.attrs,s);return c&&delete t.attrs[c.attrName],{...t}}}class j extends o{constructor(){super(...arguments),this.type="add-children"}run(t,e,u){if(!e.name)return t;const s={name:e.name,attrs:{...e.attrs??{}},children:e.children??[],type:e.type??"tag",voidElement:e.voidElement??!1};return s.children.push(...t.children??[]),t.children=[s],{...t}}}class H extends o{constructor(){super(...arguments),this.type="comment-content"}run(t,e,u){const n=E(t.children??[]);return n&&(t.children=[{type:"comment",comment:n}]),{...t}}}class ut{constructor(){this.storageByType=new Map}setByType(t,e){this.storageByType.set(t,e)}get obj(){return Object.fromEntries(this.storageByType.entries())}updateByType(t,e){const u=this.getByType(t)??{};this.setByType(t,{...u,...e})}getByType(t){return this.storageByType.get(t)??null}clear(){this.storageByType.clear()}}const M="save-to-call-on-demand";class S extends o{constructor(){super(...arguments),this.type=M}run(t,e,u){return u.storage.updateByType(this.type,{[e.id]:{action:e.action,context:u}}),{...t}}}class b extends o{constructor(){super(...arguments),this.type="call-with-new-source"}run(t,e,u){const n=u.storage.getByType(M),s=Array.isArray(e.id)?e.id:[e.id];for(const c of s){const p=n?.[c];p&&(t=u.processor.runAction(t,p.action,({task:l})=>({task:l,sourceNode:p.context.sourceNode,...p.context})))}return{...t}}}class _ extends o{constructor(){super(...arguments),this.type="run-tasks-on-node"}run(t,e,u){const n=e.tasks??[];if(!e.dontRunOnOnMain)for(const s of n)t=u.processor.processAction(t,s,u);if(e.runOnChildren){const s=t.children??[];for(const c in s)s[c]=this.run(s[c],{...e,dontRunOnOnMain:!1},u);t.children=s}return{...t}}}class it{constructor(t){this.tasks=t,this.storage=new ut,this.defaultTasks=[new b,new _,new k,new j,new I,new $,new H,new R,new S,new B,new V,new P,new W]}nodeNeedToChange(t,e){return"string"==typeof e.selector?t.name===e.selector:!!Array.isArray(e.selector)&&Boolean(e.selector.find(u=>"byAttr"===u.type&&!Object.entries(u.attrs).map(([s,c])=>{const p=f(s,t.attrs);return!(!p||void 0!==c&&p.value!==c)}).includes(!1))&&!0)}runAction(t,e,u){try{const n=this.defaultTasks.find(s=>s.type===e.type);n&&(t=n.run(t,e.payload,u({task:n,sourceNode:t})))}catch(n){console.error("Warning:prizm-template-task:runAction",n)}return t}needToChange(t,e=this.tasks){return!(!t||!Array.isArray(t)||!t.find(u=>{for(const n of this.tasks)if(this.nodeNeedToChange(u,n))return!0;return!1}))}clear(){this.storage.clear()}processAction(t,e,u){let n;return this.nodeNeedToChange(t,e)&&(n={...t},e.tasks.forEach(s=>{n=this.runAction(n,s,({task:c,sourceNode:p})=>this.generateContext(null,"tasks",p,c,u))}),e.defaultInputs&&Object.entries(e.defaultInputs).forEach(([s,c])=>{t.attrs[s]||t.attrs[`[${s}]`]||t.attrs[`[(${s})]`]||t.attrs[`([${s}])`]||("string"!=typeof c&&(s=`[${s}]`),t.attrs[s]=c)}),e.inputs&&Object.entries(e.inputs).forEach(([s,c])=>{w(s,t.attrs,[i.input,i.inputVar,i.inputOutput])&&c.forEach(p=>{n=this.runAction(n,p,({task:l,sourceNode:m})=>this.generateContext(s,"inputs",m,l,u))})}),e.outputs&&Object.entries(e.outputs).forEach(([s,c])=>{w(s,t.attrs,[i.output,i.inputOutput])&&c.forEach(p=>{n=this.runAction(n,p,({task:l,sourceNode:m})=>this.generateContext(s,"outputs",m,l,u))})}),t=n),t.children=t.children?.map(s=>this.processAction(s,e,u))??[],n&&e.finishTasks?.forEach(s=>{n=this.runAction(n,s,({task:c,sourceNode:p})=>this.generateContext(null,"tasks",p,c,u))}),t}processTasks(t){return t.map(e=>{for(const u of this.tasks)e=this.processAction(e,u,{});return e})}generateContext(t,e,u,n,s){return{attrName:t&&A(t),originName:t,runIn:e,sourceNode:u,storage:this.storage,task:n,processor:this,type:t&&(r=t,(r=r.trim()).startsWith("[")?i.inputVar:r.startsWith("([")||r.startsWith("[(")?i.inputOutput:r.startsWith("(")?i.output:i.input),...s??{}};var r}}}}]);